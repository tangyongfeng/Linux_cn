<!DOCTYPE html>
<html lang="zh">
<head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="generator" content="Pelican" />
        <title>Artipie：可用于 Python 的开源仓库管理器</title>
        <link rel="stylesheet" href="/theme/css/main.css" />
        <meta name="description" content="Author: Alena Gerasimova Artipie 是一个开源的自托管的仓库管理器，它不仅可以用于 Python。 在学生时代使用 Python 开发时，我发现我需要一些私人的集 …" />
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">linux_cn</a></h1>
                <nav><ul>
                    <li><a href="/category/chuan-shan-jia-zhuan-fang">穿山甲专访</a></li>
                    <li><a href="/category/dai-ma-ying-xiong">代码英雄</a></li>
                    <li><a href="/category/fen-xiang">分享</a></li>
                    <li><a href="/category/guan-dian">观点</a></li>
                    <li><a href="/category/huo-dong">活动</a></li>
                    <li><a href="/category/ji-ke-man-hua">极客漫画</a></li>
                    <li class="active"><a href="/category/ji-zhu">技术</a></li>
                    <li><a href="/category/kai-yuan-zhi-hui">开源智慧</a></li>
                    <li><a href="/category/linux-fa-xing-ban">Linux 发行版</a></li>
                    <li><a href="/category/mei-ri-an-quan-zi-xun">每日安全资讯</a></li>
                    <li><a href="/category/misc">Misc</a></li>
                    <li><a href="/category/qu-kuai-lian">区块链</a></li>
                    <li><a href="/category/rong-qi-yu-yun">容器与云</a></li>
                    <li><a href="/category/ruan-jian-kai-fa">软件开发</a></li>
                    <li><a href="/category/shu-mei-pai">树莓派</a></li>
                    <li><a href="/category/xi-tong-yun-wei">系统运维</a></li>
                    <li><a href="/category/xin-wen">新闻</a></li>
                    <li><a href="/category/ying-he-guan-cha">硬核观察</a></li>
                    <li><a href="/category/zhi-ye-sheng-ya">职业生涯</a></li>
                    <li><a href="/category/zhong-jiang-ming-dan">中奖名单</a></li>
                    <li><a href="/category/zhuo-mian-ying-yong">桌面应用</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="/2023/03/artipieke-yong-yu-python-de-kai-yuan-cang-ku-guan-li-qi.html" rel="bookmark"
           title="Permalink to Artipie：可用于 Python 的开源仓库管理器">Artipie：可用于 Python 的开源仓库管理器</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2023-03-02T23:22:00+01:00">
                Published: Thu 02 March 2023
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/linux-fans-from-china.html">linux fans from china</a>
        </address>
<p>In <a href="/category/ji-zhu">技术</a>.</p>

</footer><!-- /.post-info -->      <p>Author: Alena Gerasimova</p>
<p><img alt="" src="/data/attachment/album/202303/02/232208fgy56v5egv7ipgg2.jpg"></p>
<blockquote>
<p>Artipie 是一个开源的自托管的仓库管理器，它不仅可以用于 Python。</p>
</blockquote>
<p>在学生时代使用 Python 开发时，我发现我需要一些私人的集中存储。这样我就可以存储二进制和文本数据文件，以及 Python 软件包。我在 <a href="https://github.com/artipie">Artipie</a> 中找到了答案，这是一个开源的自托管的软件仓库管理器。</p>
<p>在大学里，我和我的同事们对来自实验测量的大量数据进行研究。我使用 Python 来处理和可视化它们。当时我的大学同事是数学家，没有软件开发技术的经验。他们通常只是在闪存盘上或通过电子邮件传递数据和代码。我努力向他们介绍像 <a href="https://opensource.com/tags/git">Git</a> 这样的版本管理系统，但没有成功。</p>
<h3>Python 仓库</h3>
<p>Artipie 支持 <a href="https://pypi.org/">PyPI</a> 仓库，与 <a href="https://github.com/pypa/twine">twine</a> 和 <a href="https://pip.pypa.io/en/stable/">pip</a> 兼容。这意味着你可以完全像在 <a href="https://pypi.org/">PyPI</a> 和 <a href="https://test.pypi.org/">TestPyPI</a> 仓库上安装或发布软件包那样使用 Artipie Python 仓库。</p>
<p>要创建你自己的 Python 仓库，你可以使用名为 <a href="https://central.artipie.com/signin">Artipie Central</a> 的 Artipie 托管实例。当你登录后，你会看到一个列出你的仓库的页面（开始时是空的），以及一个添加新仓库的表单。为你的新仓库选择一个名字（例如，<code>mypython</code>），选择 <code>Python</code> 作为仓库类型，然后点击 “<ruby> 添加 <rt>  Add </rt></ruby>” 按钮。</p>
<p>接下来，你会看到一个以 <a href="https://www.redhat.com/sysadmin/yaml-beginners">YAML</a> 格式显示仓库设置的页面：</p>
<div class="highlight"><pre><span></span><code><span class="n">repo</span><span class="p">:</span>
<span class="w">  </span><span class="n">type</span><span class="p">:</span><span class="w"> </span><span class="n">file</span>
<span class="w">  </span><span class="n">storage</span><span class="p">:</span><span class="w"> </span><span class="n">default</span>
<span class="w">  </span><span class="n">permissions</span><span class="p">:</span>
<span class="w">    </span><span class="n">olenagerasimova</span><span class="p">:</span>
<span class="w">      </span><span class="o">-</span><span class="w"> </span><span class="n">upload</span>
<span class="w">      </span><span class="o">-</span><span class="w"> </span><span class="n">download</span>
<span class="w">    </span><span class="s2">&quot;*&quot;</span><span class="p">:</span>
<span class="w">      </span><span class="o">-</span><span class="w"> </span><span class="n">download</span>
</code></pre></div>

<p>这些设置基本上与 Python 相同。只有仓库的类型不同。在这个例子中，二进制仓库被称为 <code>data</code>。它包含三个带有一些数字的文本文件：</p>
<div class="highlight"><pre><span></span><code><span class="mf">6</span>
<span class="mf">3.5</span>
<span class="mf">5</span>
<span class="mf">4</span>
<span class="mf">4.5</span>
<span class="mf">3</span>
<span class="mf">2.7</span>
<span class="mf">5</span>
<span class="mf">6</span>
<span class="mf">3</span>
<span class="mf">1.2</span>
<span class="mf">3.2</span>
<span class="mf">6</span>
</code></pre></div>

<p>另外两个文件的形式相同（只是数字不同）。要想自己看这些文件，请在浏览器中打开链接 <a href="https://central.artipie.com/olenagerasimova/data/y1.dat">一</a>、<a href="https://central.artipie.com/olenagerasimova/data/y2.dat">二</a> 和 <a href="https://central.artipie.com/olenagerasimova/data/y3.dat">三</a> 并下载文件，或者你可以用 <code>httpie</code> 执行 GET 请求：</p>
<div class="highlight"><pre><span></span><code>httpie -a https://central.artipie.com/olenagerasimova/data/y1.dat &gt; ./data/y1.da
</code></pre></div>

<p>这些文件是用 PUT 请求上传到 Artipie Central 的 <code>data</code> 存储库的：</p>
<div class="highlight"><pre><span></span><code><span class="n">httpie</span><span class="w"> </span><span class="o">-</span><span class="n">a</span><span class="w"> </span><span class="nl">olenagerasimova</span><span class="p">:</span><span class="o">***</span><span class="w"> </span><span class="n">PUT</span><span class="w"> </span>
<span class="nl">https</span><span class="p">:</span><span class="o">//</span><span class="n">central</span><span class="p">.</span><span class="n">artipie</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">olenagerasimova</span><span class="o">/</span><span class="k">data</span><span class="o">/</span><span class="n">y1</span><span class="p">.</span><span class="n">dat</span><span class="w"> </span><span class="nv">@data</span><span class="o">/</span><span class="n">y1</span><span class="p">.</span><span class="n">dat</span>

<span class="n">httpie</span><span class="w"> </span><span class="o">-</span><span class="n">a</span><span class="w"> </span><span class="nl">olenagerasimova</span><span class="p">:</span><span class="o">***</span><span class="w"> </span><span class="n">PUT</span><span class="w"> </span>
<span class="nl">https</span><span class="p">:</span><span class="o">//</span><span class="n">central</span><span class="p">.</span><span class="n">artipie</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">olenagerasimova</span><span class="o">/</span><span class="k">data</span><span class="o">/</span><span class="n">y2</span><span class="p">.</span><span class="n">dat</span><span class="w"> </span><span class="nv">@data</span><span class="o">/</span><span class="n">y2</span><span class="p">.</span><span class="n">dat</span>

<span class="n">httpie</span><span class="w"> </span><span class="o">-</span><span class="n">a</span><span class="w"> </span><span class="nl">olenagerasimova</span><span class="p">:</span><span class="o">***</span><span class="w"> </span><span class="n">PUT</span><span class="w"> </span>
<span class="nl">https</span><span class="p">:</span><span class="o">//</span><span class="n">central</span><span class="p">.</span><span class="n">artipie</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">olenagerasimova</span><span class="o">/</span><span class="k">data</span><span class="o">/</span><span class="n">y3</span><span class="p">.</span><span class="n">dat</span><span class="w"> </span><span class="nv">@data</span><span class="o">/</span><span class="n">y3</span><span class="p">.</span><span class="n">dat</span>
</code></pre></div>

<p>由于这个二进制仓库的 API 非常简单（HTTP <code>PUT</code> 和 <code>GET</code> 请求），用任何语言编写一段代码来上传和下载所需的文件都很容易。</p>
<h3>Python 项目</h3>
<p>可以从我的 <a href="https://github.com/artipie/pypi-example">GitHub 仓库</a>中获得一个 Python 项目的示例源代码。这个示例的主要想法是，从 Artipie Central 下载三个数据文件，将数字读入数组，并使用这些数组来绘制一个图。使用 <code>pip</code> 来安装这个例子包并运行它：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>python3<span class="w"> </span>-m<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>--index-url<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>https://central.artipie.com/olenagerasimova/pypi/<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>pypiexample
$<span class="w"> </span>python3<span class="w"> </span>-m<span class="w"> </span>pypiexample
</code></pre></div>

<p>通过设置 <code>--index-url</code> 到 Artipie Central 的 Python 仓库，<code>pip</code> 从它那里下载软件包，而不是通常默认的 PyPi 仓库。运行这些命令后，会显示一个带有三条曲线的极坐标图，这是数据文件的可视化。</p>
<p>要将软件包发布到 Artipie Central 仓库，请用 <code>twine</code> 构建并上传：</p>
<div class="highlight"><pre><span></span><code><span class="n">commandline</span>
<span class="o">$</span><span class="w"> </span><span class="n">python</span><span class="w"> </span><span class="n">setup</span><span class="o">.</span><span class="n">py</span><span class="w"> </span><span class="n">sdist</span><span class="w"> </span><span class="n">bdist_wheel</span>

<span class="o">$</span><span class="w"> </span><span class="n">twine</span><span class="w"> </span><span class="n">upload</span><span class="w"> </span><span class="o">--</span><span class="n">repository</span><span class="o">-</span><span class="n">url</span><span class="w"> </span>\
<span class="w">  </span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">central</span><span class="o">.</span><span class="n">artipie</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">olenagerasimova</span><span class="o">/</span><span class="n">pypi</span>
<span class="w">  </span><span class="o">-</span><span class="n">u</span><span class="w"> </span><span class="n">olenagerasimova</span><span class="w"> </span><span class="o">-</span><span class="n">p</span><span class="w"> </span><span class="o">***</span><span class="w"> </span><span class="n">dist</span><span class="o">/*</span>
</code></pre></div>

<p>在 Artipie Central 中设置 <code>files</code> 仓库，并创建一个 Python 示例项目是多么容易。不过，你不必使用 Artipie Central。Artipie 可以自托管，所以你可以在你自己的本地网络上运行一个仓库。</p>
<h3>将 Artipie 作为一个容器运行</h3>
<p>将 Artipie 作为一个容器运行，设置起来就像安装 Podman 或 Docker 一样容易。假设你已经安装了其中之一，打开终端：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>podman<span class="w"> </span>run<span class="w"> </span>-it<span class="w"> </span>-p<span class="w"> </span><span class="m">8080</span>:8080<span class="w"> </span>-p<span class="w"> </span><span class="m">8086</span>:8086<span class="w"> </span>artipie/artipie:latest
</code></pre></div>

<p>这将启动一个运行最新 Artipie 版本的新容器。它还映射了两个端口。你的仓库在 8080 端口提供服务。Artipie 的 Rest API 和 Swagger 文档在 8086 端口提供。新的镜像会生成一个默认的配置，打印一个正在运行的仓库列表，测试证书，以及一个指向 <a href="https://swagger.io/">Swagger</a> 文档的链接到你的控制台。</p>
<p>你也可以使用 Artipie Rest API 来查看现有的仓库：</p>
<ul>
<li>进入 Swagger 文档页面 <code>http://localhost:8086/api/index-org.html</code>。</li>
<li>在 “<ruby> 选择一个定义 <rt>  Select a definition </rt></ruby>” 列表中，选择 “<ruby> 认证令牌 <rt>  Auth token </rt></ruby>”。</li>
<li>生成并复制用户 <code>artipie</code> 的认证令牌，密码是 <code>artipie</code>。</li>
<li>切换到 “<ruby> 仓库 <rt>  Repositories </rt></ruby>” 定义，点击 “<ruby> 认证 <rt>  Authorize </rt></ruby>” 按钮，然后粘贴令牌。</li>
</ul>
<p><img alt="Image of the Swagger documentation page," src="/data/attachment/album/202303/02/232239crq8q68rim18699r.jpg"></p>
<p>对 <code>/api/v1/repository/list</code> 执行一个 GET 请求。在响应中，你会收到一个包含三个默认仓库的 JSON 列表：</p>
<div class="highlight"><pre><span></span><code>[
  &quot;artipie/my-bin&quot;,
  &quot;artipie/my-docker&quot;,
  &quot;artipie/my-maven&quot;
]
</code></pre></div>

<p>默认配置中不包括 Python 仓库。你可以通过从 Swagger 接口向 <code>/api/v1/repository/{user}/{repo}</code> 执行 PUT 请求来纠正。在这种情况下，<code>user</code> 是默认用户的名字（<code>artipie</code>），<code>repo</code> 是新仓库的名字。你可以把你的新 Python 代码库称为 <code>my-pypi</code>。下面是一个请求体的例子，包含带仓库设置的 JSON 对象：</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span><span class="w"> </span>
<span class="w">  </span><span class="s2">&quot;repo&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;pypi&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;storage&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;default&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;permissions&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="s2">&quot;*&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="s2">&quot;download&quot;</span>
<span class="w">      </span><span class="p">],</span>
<span class="w">      </span><span class="s2">&quot;artipie&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="s2">&quot;upload&quot;</span>
<span class="w">      </span><span class="p">]</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>所有的 JSON 字段都和你在仪表板上创建 YAML 格式的仓库时一样。我们版本库的类型是 <code>pypi</code>，使用默认存储，任何人都可以下载，但只有用户 <code>artipie</code> 可以上传。</p>
<p>再次向 <code>/api/v1/repository/list</code> 发出 GET 请求，确保你的仓库被创建。现在，你有四个仓库：</p>
<div class="highlight"><pre><span></span><code>[
  &quot;artipie/my-bin&quot;,
  &quot;artipie/my-docker&quot;,
  &quot;artipie/my-maven&quot;,
  &quot;artipie/my-pypi&quot;
]
</code></pre></div>

<p>你已经创建了你自己的 Artipie 安装，包含了几个仓库！ Artipie 镜像既可以在个人电脑上运行，也可以在私人网络内的远程服务器上运行。你可以用它来在一个公司、团体或大学内交换软件包。这是一个建立你自己的软件服务的简单方法，而且它不仅仅适用于 Python。花些时间来探索 Artipie，看看它能为你带来什么。</p>
    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>links</h2>
                        <ul>
                            <li><a href="https://getpelican.com/">Pelican</a></li>
                            <li><a href="https://www.python.org/">Python.org</a></li>
                            <li><a href="https://palletsprojects.com/p/jinja/">Jinja2</a></li>
                            <li><a href="#">You can modify those links in your config file</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>

                            <li><a href="#">You can add links in your config file</a></li>
                            <li><a href="#">Another social link</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a rel="nofollow" href="https://getpelican.com/">Pelican</a>, which takes great advantage of <a rel="nofollow" href="https://www.python.org/">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a rel="nofollow" href="https://www.smashingmagazine.com/2009/08/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>