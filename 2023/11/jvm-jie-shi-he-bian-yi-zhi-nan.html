<!DOCTYPE html>
<html lang="zh">
<head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="generator" content="Pelican" />
        <title>JVM 解释和编译指南</title>
        <link rel="stylesheet" href="/theme/css/main.css" />
        <meta name="description" content="Author: Jayashree Huttanagoudar 通过理解解释、即时编译和预先编译之间的区别，有效地使用它们。 Java 是一种跨平台的编程语言。程序源代码会被编 …" />
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">linux_cn</a></h1>
                <nav><ul>
                    <li><a href="/category/chuan-shan-jia-zhuan-fang">穿山甲专访</a></li>
                    <li><a href="/category/dai-ma-ying-xiong">代码英雄</a></li>
                    <li><a href="/category/fen-xiang">分享</a></li>
                    <li><a href="/category/guan-dian">观点</a></li>
                    <li><a href="/category/huo-dong">活动</a></li>
                    <li><a href="/category/ji-ke-man-hua">极客漫画</a></li>
                    <li><a href="/category/ji-zhu">技术</a></li>
                    <li><a href="/category/kai-yuan-zhi-hui">开源智慧</a></li>
                    <li><a href="/category/linux-fa-xing-ban">Linux 发行版</a></li>
                    <li><a href="/category/mei-ri-an-quan-zi-xun">每日安全资讯</a></li>
                    <li><a href="/category/misc">Misc</a></li>
                    <li><a href="/category/qu-kuai-lian">区块链</a></li>
                    <li><a href="/category/rong-qi-yu-yun">容器与云</a></li>
                    <li class="active"><a href="/category/ruan-jian-kai-fa">软件开发</a></li>
                    <li><a href="/category/shu-mei-pai">树莓派</a></li>
                    <li><a href="/category/xi-tong-yun-wei">系统运维</a></li>
                    <li><a href="/category/xin-wen">新闻</a></li>
                    <li><a href="/category/ying-he-guan-cha">硬核观察</a></li>
                    <li><a href="/category/zhi-ye-sheng-ya">职业生涯</a></li>
                    <li><a href="/category/zhong-jiang-ming-dan">中奖名单</a></li>
                    <li><a href="/category/zhuo-mian-ying-yong">桌面应用</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="/2023/11/jvm-jie-shi-he-bian-yi-zhi-nan.html" rel="bookmark"
           title="Permalink to JVM 解释和编译指南">JVM 解释和编译指南</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2023-11-06T09:36:37+01:00">
                Published: Mon 06 November 2023
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/linux-fans-from-china.html">linux fans from china</a>
        </address>
<p>In <a href="/category/ruan-jian-kai-fa">软件开发</a>.</p>

</footer><!-- /.post-info -->      <p>Author: Jayashree Huttanagoudar</p>
<p><img alt="" src="/data/attachment/album/202311/06/093552kheiob71meqierhd.png"></p>
<blockquote>
<p>通过理解解释、即时编译和预先编译之间的区别，有效地使用它们。</p>
</blockquote>
<p>Java 是一种跨平台的编程语言。程序源代码会被编译为 <ruby> 字节码 <rt>  bytecode </rt></ruby>，然后字节码在运行时被转换为 <ruby> 机器码 <rt>  machine code </rt></ruby>。<ruby> 解释器 <rt>  interpreter </rt></ruby> 在物理机器上模拟出的抽象计算机上执行字节码指令。<ruby> 即时 <rt>  just-in-time </rt></ruby>（JIT）编译发生在运行期，而 <ruby> 预先 <rt>  ahead-of-time </rt></ruby>（AOT）编译发生在构建期。</p>
<p>本文将说明解释器、JIT 和 AOT 分别何时起作用，以及如何在 JIT 和 AOT 之间权衡。</p>
<h3>源代码、字节码、机器码</h3>
<p>应用程序通常是由 C、C++ 或 Java 等编程语言编写。用这些高级编程语言编写的指令集合称为源代码。源代码是人类可读的。要在目标机器上执行它，需要将源代码转换为机器可读的机器码。这个转换工作通常是由 <ruby> 编译器 <rt>  compiler </rt></ruby> 来完成的。</p>
<p>然而，在 Java 中，源代码首先被转换为一种中间形式，称为字节码。字节码是平台无关的，所以 Java 被称为平台无关编程语言。Java 编译器 <code>javac</code> 将源代码转换为字节码。然后解释器解释执行字节码。</p>
<p>下面是一个简单的 Java 程序, <code>Hello.java</code>：</p>
<div class="highlight"><pre><span></span><code><span class="c1">//Hello.java</span>
<span class="n">public</span><span class="w"> </span><span class="n">class</span><span class="w"> </span><span class="n">Hello</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">void</span><span class="w"> </span><span class="n">main</span><span class="p">(</span><span class="n">String</span><span class="p">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="n">System</span><span class="p">.</span><span class="n">out</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;Inside Hello World!&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>使用 <code>javac</code> 编译它，生成包含字节码的 <code>Hello.class</code> 文件。</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>javac<span class="w"> </span>Hello.java
$<span class="w"> </span>ls
Hello.class<span class="w">  </span>Hello.java
</code></pre></div>

<p>现在，使用 <code>javap</code> 来反汇编 <code>Hello.class</code> 文件的内容。使用 <code>javap</code> 时如果不指定任何选项，它将打印基本信息，包括编译这个 <code>.class</code> 文件的源文件、包名称、公共和受保护字段以及类的方法。</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>javap<span class="w"> </span>Hello.class
Compiled<span class="w"> </span>from<span class="w"> </span><span class="s2">&quot;Hello.java&quot;</span>
public<span class="w"> </span>class<span class="w"> </span>Hello<span class="w"> </span><span class="o">{</span>
<span class="w">    </span>public<span class="w"> </span>Hello<span class="o">()</span><span class="p">;</span>
<span class="w">    </span>public<span class="w"> </span>static<span class="w"> </span>void<span class="w"> </span>main<span class="o">(</span>java.lang.String<span class="o">[])</span><span class="p">;</span>
<span class="o">}</span>
</code></pre></div>

<p>要查看 <code>.class</code> 文件中的字节码内容，使用 <code>-c</code> 选项：</p>
<div class="highlight"><pre><span></span><code><span class="o">$</span><span class="w"> </span><span class="n">javap</span><span class="w"> </span><span class="o">-</span><span class="n">c</span><span class="w"> </span><span class="n">Hello</span><span class="o">.</span><span class="k">class</span>
<span class="n">Compiled</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="s2">&quot;Hello.java&quot;</span>
<span class="n">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="n">Hello</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">public</span><span class="w"> </span><span class="n">Hello</span><span class="p">();</span>
<span class="w">        </span><span class="n">Code</span><span class="p">:</span>
<span class="w">           </span><span class="mi">0</span><span class="p">:</span><span class="w"> </span><span class="n">aload_0</span>
<span class="w">           </span><span class="mi">1</span><span class="p">:</span><span class="w"> </span><span class="n">invokespecial</span><span class="w"> </span><span class="c1">#1                      // Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V</span>
<span class="w">           </span><span class="mi">4</span><span class="p">:</span><span class="w"> </span><span class="k">return</span>

<span class="w">  </span><span class="n">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="nb nb-Type">void</span><span class="w"> </span><span class="n">main</span><span class="p">(</span><span class="n">java</span><span class="o">.</span><span class="n">lang</span><span class="o">.</span><span class="n">String</span><span class="p">[]);</span>
<span class="w">        </span><span class="n">Code</span><span class="p">:</span>
<span class="w">           </span><span class="mi">0</span><span class="p">:</span><span class="w"> </span><span class="n">getstatic</span><span class="w">         </span><span class="c1">#2                      // Field java/lang/System.out:Ljava/io/PrintStream;</span>
<span class="w">           </span><span class="mi">3</span><span class="p">:</span><span class="w"> </span><span class="n">ldc</span><span class="w">               </span><span class="c1">#3                      // String Inside Hello World!</span>
<span class="w">           </span><span class="mi">5</span><span class="p">:</span><span class="w"> </span><span class="n">invokevirtual</span><span class="w"> </span><span class="c1">#4                      // Method    </span>
<span class="n">java</span><span class="o">/</span><span class="n">io</span><span class="o">/</span><span class="n">PrintStream</span><span class="o">.</span><span class="n">println</span><span class="p">:(</span><span class="n">Ljava</span><span class="o">/</span><span class="n">lang</span><span class="o">/</span><span class="nb nb-Type">String</span><span class="p">;)</span><span class="n">V</span>
<span class="w">           </span><span class="mi">8</span><span class="p">:</span><span class="w"> </span><span class="k">return</span>
<span class="p">}</span>
</code></pre></div>

<p>要获取更详细的信息，使用 <code>-v</code> 选项：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>javap<span class="w"> </span>-v<span class="w"> </span>Hello.class
</code></pre></div>

<h3>解释器，JIT 和 AOT</h3>
<p>解释器负责在物理机器上模拟出的抽象计算机上执行字节码指令。当使用 <code>javac</code> 编译源代码，然后使用 <code>java</code> 执行时，解释器在程序运行时运行并完成它的目标。</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>javac<span class="w"> </span>Hello.java
$<span class="w"> </span>java<span class="w"> </span>Hello
Inside<span class="w"> </span>Hello<span class="w"> </span>World!
</code></pre></div>

<p>JIT 编译器也在运行期发挥作用。当解释器解释 Java 程序时，另一个称为运行时 <ruby> 分析器 <rt>  profiler </rt></ruby> 的组件将静默地监视程序的执行，统计各部分代码被解释的次数。基于这些统计信息可以检测出程序的 <ruby> 热点 <rt>  hotspot </rt></ruby>，即那些经常被解释的代码。一旦代码被解释次数超过设定的阈值，它们满足被 JIT 编译器直接转换为机器码的条件。所以 JIT 编译器也被称为分析优化的编译器。从字节码到机器码的转换是在程序运行过程中进行的，因此称为即时编译。JIT 减少了解释器将同一组指令模拟为机器码的负担。</p>
<p>AOT 编译器在构建期编译代码。在构建时将需要频繁解释和 JIT 编译的代码直接编译为机器码可以缩短 <ruby> Java 虚拟机 <rt>  Java Virtual Machine </rt></ruby>（JVM） 的<ruby> 预热 <rt>  warm-up </rt></ruby>时间。（LCTT 译注：Java 程序启动后首先字节码被解释执行，此时执行效率较低。等到程序运行了足够的时间后，代码热点被检测出来，JIT 开始发挥作用，程序运行效率提升。JIT 发挥作用之前的过程就是预热。）AOT 是在 Java 9 中引入的一个实验性特性。<code>jaotc</code> 使用 Graal 编译器（它本身也是用 Java 编写的）来实现 AOT 编译。</p>
<p>以 <code>Hello.java</code> 为例：</p>
<div class="highlight"><pre><span></span><code><span class="c1">//Hello.java</span>
<span class="n">public</span><span class="w"> </span><span class="n">class</span><span class="w"> </span><span class="n">Hello</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">void</span><span class="w"> </span><span class="n">main</span><span class="p">(</span><span class="n">String</span><span class="p">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="n">out</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;Inside Hello World!&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>


$<span class="w"> </span><span class="n">javac</span><span class="w"> </span><span class="n">Hello</span><span class="p">.</span><span class="n">java</span>
$<span class="w"> </span><span class="n">jaotc</span><span class="w"> </span><span class="o">--</span><span class="n">output</span><span class="w"> </span><span class="n">libHello</span><span class="p">.</span><span class="n">so</span><span class="w"> </span><span class="n">Hello</span><span class="p">.</span><span class="n">class</span>
$<span class="w"> </span><span class="n">java</span><span class="w"> </span><span class="o">-</span><span class="n">XX</span><span class="p">:</span><span class="o">+</span><span class="n">UnlockExperimentalVMOptions</span><span class="w"> </span><span class="o">-</span><span class="n">XX</span><span class="p">:</span><span class="n">AOTLibrary</span><span class="p">=.</span><span class="o">/</span><span class="n">libHello</span><span class="p">.</span><span class="n">so</span><span class="w"> </span><span class="n">Hello</span>
<span class="n">Inside</span><span class="w"> </span><span class="n">Hello</span><span class="w"> </span><span class="n">World</span>!
</code></pre></div>

<h3>解释和编译发生的时机</h3>
<p>下面通过例子来展示 Java 在什么时候使用解释器，以及 JIT 和 AOT 何时参与进来。这里有一个简单的程序 <code>Demo.java</code> :</p>
<div class="highlight"><pre><span></span><code><span class="c1">//Demo.java</span>
<span class="n">public</span><span class="w"> </span><span class="n">class</span><span class="w"> </span><span class="n">Demo</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="nb">int</span><span class="w"> </span><span class="n">square</span><span class="p">(</span><span class="nb">int</span><span class="w"> </span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="n">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="n">i</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>


<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">void</span><span class="w"> </span><span class="n">main</span><span class="p">(</span><span class="n">String</span><span class="p">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="n">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nb">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="p">=</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="n">out</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;call &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Integer</span><span class="p">.</span><span class="n">valueOf</span><span class="p">(</span><span class="n">i</span><span class="p">));</span>
<span class="w">            </span><span class="n">long</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">System</span><span class="p">.</span><span class="n">nanoTime</span><span class="p">();</span>
<span class="w">            </span><span class="n">Int</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">Demo</span><span class="p">().</span><span class="n">square</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
<span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="n">out</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;Square(i) = &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">r</span><span class="p">);</span>
<span class="w">            </span><span class="n">long</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">System</span><span class="p">.</span><span class="n">nanoTime</span><span class="p">();</span>
<span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="n">out</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;elapsed= &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">b</span><span class="o">-</span><span class="n">a</span><span class="p">));</span>
<span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="n">out</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;--------------------------------&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>在这个程序的 <code>main()</code> 方法中创建了一个 <code>Demo</code> 对象的实例，并调用该实例的 <code>square()</code>方法，然后显示 <code>for</code> 循环迭代变量的平方值。编译并运行它：</p>
<div class="highlight"><pre><span></span><code><span class="c">$ javac Demo</span><span class="nt">.</span><span class="c">java</span>
<span class="c">$ java Demo</span>
<span class="c">1 iteration</span>
<span class="c">Square(i) = 1</span>
<span class="c">Time taken= 8432439</span>
<span class="nb">--------------------------------</span>
<span class="c">2 iteration</span>
<span class="c">Square(i) = 4</span>
<span class="c">Time taken= 54631</span>
<span class="nb">--------------------------------</span>
<span class="nt">.</span>
<span class="nt">.</span>
<span class="nt">.</span>
<span class="nb">--------------------------------</span>
<span class="c">10 iteration</span>
<span class="c">Square(i) = 100</span>
<span class="c">Time taken= 66498</span>
<span class="nb">--------------------------------</span>
</code></pre></div>

<p>上面的结果是由谁产生的呢？是解释器，JIT 还是 AOT？在目前的情况下，它完全是通过解释产生的。我是怎么得出这个结论的呢？只有代码被解释的次数必须超过某个阈值时，这些热点代码片段才会被加入 JIT 编译队列。只有这时，JIT 编译才会发挥作用。使用以下命令查看 JDK 11 中的该阈值：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>java<span class="w"> </span>-XX:+PrintFlagsFinal<span class="w"> </span>-version<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>CompileThreshold
<span class="w"> </span>intx<span class="w"> </span><span class="nv">CompileThreshold</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="m">10000</span><span class="w">                                      </span><span class="o">{</span>pd<span class="w"> </span>product<span class="o">}</span><span class="w"> </span><span class="o">{</span>default<span class="o">}</span>
<span class="o">[</span>...<span class="o">]</span>
openjdk<span class="w"> </span>version<span class="w"> </span><span class="s2">&quot;11.0.13&quot;</span><span class="w"> </span><span class="m">2021</span>-10-19
OpenJDK<span class="w"> </span>Runtime<span class="w"> </span>Environment<span class="w"> </span><span class="m">18</span>.9<span class="w"> </span><span class="o">(</span>build<span class="w"> </span><span class="m">11</span>.0.13+8<span class="o">)</span>
OpenJDK<span class="w"> </span><span class="m">64</span>-Bit<span class="w"> </span>Server<span class="w"> </span>VM<span class="w"> </span><span class="m">18</span>.9<span class="w"> </span><span class="o">(</span>build<span class="w"> </span><span class="m">11</span>.0.13+8,<span class="w"> </span>mixed<span class="w"> </span>mode,<span class="w"> </span>sharing<span class="o">)</span>
</code></pre></div>

<p>上面的输出表明，一段代码被解释 10,000 次才符合 JIT 编译的条件。这个阈值是否可以手动调整呢？是否有 JVM 标志可以指示出方法是否被 JIT 编译了呢？答案是肯定的，而且有多种方式可以达到这个目的。</p>
<p>使用 <code>-XX:+PrintCompilation</code> 选项可以查看一个方法是否被 JIT 编译。除此之外，使用 <code>-Xbatch</code> 标志可以提高输出的可读性。如果解释和 JIT 同时发生，<code>-Xbatch</code> 可以帮助区分两者的输出。使用这些标志如下：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>java<span class="w"> </span>-Xbatch<span class="w">  </span>-XX:+PrintCompilation<span class="w">  </span>Demo
<span class="w">         </span><span class="m">34</span><span class="w">        </span><span class="m">1</span><span class="w">        </span>b<span class="w">  </span><span class="m">3</span><span class="w">           </span>java.util.concurrent.ConcurrentHashMap::tabAt<span class="w"> </span><span class="o">(</span><span class="m">22</span><span class="w"> </span>bytes<span class="o">)</span>
<span class="w">         </span><span class="m">35</span><span class="w">        </span><span class="m">2</span><span class="w">         </span>n<span class="w"> </span><span class="m">0</span><span class="w">           </span>jdk.internal.misc.Unsafe::getObjectVolatile<span class="w"> </span><span class="o">(</span>native<span class="o">)</span><span class="w">   </span>
<span class="w">         </span><span class="m">35</span><span class="w">        </span><span class="m">3</span><span class="w">        </span>b<span class="w">  </span><span class="m">3</span><span class="w">           </span>java.lang.Object::&lt;init&gt;<span class="w"> </span><span class="o">(</span><span class="m">1</span><span class="w"> </span>bytes<span class="o">)</span>
<span class="o">[</span>...<span class="o">]</span>
<span class="w">        </span><span class="m">210</span><span class="w">  </span><span class="m">269</span><span class="w">         </span>n<span class="w"> </span><span class="m">0</span><span class="w">           </span>java.lang.reflect.Array::newArray<span class="w"> </span><span class="o">(</span>native<span class="o">)</span><span class="w">   </span><span class="o">(</span>static<span class="o">)</span>
<span class="w">        </span><span class="m">211</span><span class="w">  </span><span class="m">270</span><span class="w">        </span>b<span class="w">  </span><span class="m">3</span><span class="w">           </span>java.lang.String::substring<span class="w"> </span><span class="o">(</span><span class="m">58</span><span class="w"> </span>bytes<span class="o">)</span>
<span class="o">[</span>...<span class="o">]</span>
--------------------------------
<span class="m">10</span><span class="w"> </span>iteration
Square<span class="o">(</span>i<span class="o">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">100</span>
Time<span class="w"> </span><span class="nv">taken</span><span class="o">=</span><span class="w"> </span><span class="m">50150</span>
--------------------------------
</code></pre></div>

<p>注意，上面命令的实际输出太长了，这里我只是截取了一部分。输出很长的原因是除了 <code>Demo</code> 程序的代码外，JDK 内部类的函数也被编译了。由于我的重点是 <code>Demo.java</code> 代码，我希望排除内部包的函数来简化输出。通过选项 <code>-XX:CompileCommandFile</code> 可以禁用内部类的 JIT：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>java<span class="w"> </span>-Xbatch<span class="w"> </span>-XX:+PrintCompilation<span class="w"> </span>-XX:CompileCommandFile<span class="o">=</span>hotspot_compiler<span class="w"> </span>Demo
</code></pre></div>

<p>在选项 <code>-XX:CompileCommandFile</code> 指定的文件 <code>hotspot_compiler</code> 中包含了要排除的包：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>cat<span class="w"> </span>hotspot_compiler
quiet
exclude<span class="w"> </span>java/*<span class="w"> </span>*
exclude<span class="w"> </span>jdk/*<span class="w"> </span>*
exclude<span class="w"> </span>sun/*<span class="w"> </span>*
</code></pre></div>

<p>第一行的 <code>quiet</code> 告诉 JVM 不要输出任何关于被排除类的内容。用 <code>-XX:CompileThreshold</code> 将 JIT 阈值设置为 5。这意味着在解释 5 次之后，就会进行 JIT 编译：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>java<span class="w"> </span>-Xbatch<span class="w"> </span>-XX:+PrintCompilation<span class="w"> </span>-XX:CompileCommandFile<span class="o">=</span>hotspot_compiler<span class="w"> </span><span class="se">\</span>
-XX:CompileThreshold<span class="o">=</span><span class="m">5</span><span class="w"> </span>Demo
<span class="w">        </span><span class="m">47</span><span class="w">      </span><span class="m">1</span><span class="w">       </span>n<span class="w"> </span><span class="m">0</span><span class="w">     </span>java.lang.invoke.MethodHandle::linkToStatic<span class="o">(</span>LLLLLL<span class="o">)</span>L<span class="w"> </span><span class="o">(</span>native<span class="o">)</span><span class="w">   </span>
<span class="w">           </span><span class="o">(</span>static<span class="o">)</span>
<span class="w">        </span><span class="m">47</span><span class="w">      </span><span class="m">2</span><span class="w">       </span>n<span class="w"> </span><span class="m">0</span><span class="w">     </span>java.lang.invoke.MethodHandle::invokeBasic<span class="o">(</span>LLLLL<span class="o">)</span>L<span class="w"> </span><span class="o">(</span>native<span class="o">)</span><span class="w">   </span>
<span class="w">        </span><span class="m">47</span><span class="w">      </span><span class="m">3</span><span class="w">       </span>n<span class="w"> </span><span class="m">0</span><span class="w">     </span>java.lang.invoke.MethodHandle::linkToSpecial<span class="o">(</span>LLLLLLL<span class="o">)</span>L<span class="w"> </span><span class="o">(</span>native<span class="o">)</span><span class="w">   </span>
<span class="w">           </span><span class="o">(</span>static<span class="o">)</span>
<span class="w">        </span><span class="m">48</span><span class="w">      </span><span class="m">4</span><span class="w">       </span>n<span class="w"> </span><span class="m">0</span><span class="w">     </span>java.lang.invoke.MethodHandle::linkToStatic<span class="o">(</span>L<span class="o">)</span>I<span class="w"> </span><span class="o">(</span>native<span class="o">)</span><span class="w">   </span><span class="o">(</span>static<span class="o">)</span>
<span class="w">        </span><span class="m">48</span><span class="w">      </span><span class="m">5</span><span class="w">       </span>n<span class="w"> </span><span class="m">0</span><span class="w">     </span>java.lang.invoke.MethodHandle::invokeBasic<span class="o">()</span>I<span class="w"> </span><span class="o">(</span>native<span class="o">)</span><span class="w">   </span>
<span class="w">        </span><span class="m">48</span><span class="w">      </span><span class="m">6</span><span class="w">       </span>n<span class="w"> </span><span class="m">0</span><span class="w">     </span>java.lang.invoke.MethodHandle::linkToSpecial<span class="o">(</span>LL<span class="o">)</span>I<span class="w"> </span><span class="o">(</span>native<span class="o">)</span><span class="w">   </span>
<span class="w">           </span><span class="o">(</span>static<span class="o">)</span>
<span class="o">[</span>...<span class="o">]</span>
<span class="w">        </span><span class="m">1</span><span class="w"> </span>iteration
<span class="w">        </span><span class="m">69</span><span class="w">   </span><span class="m">40</span><span class="w">         </span>n<span class="w"> </span><span class="m">0</span><span class="w">     </span>java.lang.invoke.MethodHandle::linkToStatic<span class="o">(</span>ILIIL<span class="o">)</span>I<span class="w"> </span><span class="o">(</span>native<span class="o">)</span><span class="w">   </span>
<span class="w">           </span><span class="o">(</span>static<span class="o">)</span>
<span class="o">[</span>...<span class="o">]</span>
Square<span class="o">(</span>i<span class="o">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span>
<span class="w">        </span><span class="m">78</span><span class="w">   </span><span class="m">48</span><span class="w">         </span>n<span class="w"> </span><span class="m">0</span><span class="w">     </span>java.lang.invoke.MethodHandle::linkToStatic<span class="o">(</span>ILIJL<span class="o">)</span>I<span class="w"> </span><span class="o">(</span>native<span class="o">)</span><span class="w">   </span>
<span class="o">(</span>static<span class="o">)</span>
<span class="w">        </span><span class="m">79</span><span class="w">   </span><span class="m">49</span><span class="w">         </span>n<span class="w"> </span><span class="m">0</span><span class="w">     </span>java.lang.invoke.MethodHandle::invokeBasic<span class="o">(</span>ILIJ<span class="o">)</span>I<span class="w"> </span><span class="o">(</span>native<span class="o">)</span><span class="w">   </span>
<span class="o">[</span>...<span class="o">]</span>
<span class="w">        </span><span class="m">86</span><span class="w">   </span><span class="m">54</span><span class="w">         </span>n<span class="w"> </span><span class="m">0</span><span class="w">     </span>java.lang.invoke.MethodHandle::invokeBasic<span class="o">(</span>J<span class="o">)</span>L<span class="w"> </span><span class="o">(</span>native<span class="o">)</span><span class="w">   </span>
<span class="w">        </span><span class="m">87</span><span class="w">   </span><span class="m">55</span><span class="w">         </span>n<span class="w"> </span><span class="m">0</span><span class="w">     </span>java.lang.invoke.MethodHandle::linkToSpecial<span class="o">(</span>LJL<span class="o">)</span>L<span class="w"> </span><span class="o">(</span>native<span class="o">)</span><span class="w">   </span>
<span class="o">(</span>static<span class="o">)</span>
Time<span class="w"> </span><span class="nv">taken</span><span class="o">=</span><span class="w"> </span><span class="m">8962738</span>
--------------------------------
<span class="m">2</span><span class="w"> </span>iteration
Square<span class="o">(</span>i<span class="o">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">4</span>
Time<span class="w"> </span><span class="nv">taken</span><span class="o">=</span><span class="w"> </span><span class="m">26759</span>
--------------------------------

<span class="m">10</span><span class="w"> </span>iteration
Square<span class="o">(</span>i<span class="o">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">100</span>
Time<span class="w"> </span><span class="nv">taken</span><span class="o">=</span><span class="w"> </span><span class="m">26492</span>
--------------------------------
</code></pre></div>

<p>好像输出结果跟只用解释时并没有什么区别。根据 Oracle 的文档，这是因为只有禁用 <code>TieredCompilation</code> 时 <code>-XX:CompileThreshold</code> 才会生效：</p>
<div class="highlight"><pre><span></span><code><span class="err">$</span> <span class="s s-Atom">java</span> <span class="o">-</span><span class="nv">Xbatch</span> <span class="o">-</span><span class="nv">XX</span><span class="o">:+</span><span class="nv">PrintCompilation</span> <span class="o">-</span><span class="nv">XX</span><span class="o">:</span><span class="nv">CompileCommandFile</span><span class="o">=</span><span class="s s-Atom">hotspot_compiler</span> <span class="s s-Atom">\</span>
<span class="o">-</span><span class="nv">XX</span><span class="o">:-</span><span class="nv">TieredCompilation</span> <span class="o">-</span><span class="nv">XX</span><span class="o">:</span><span class="nv">CompileThreshold</span><span class="o">=</span><span class="mi">5</span> <span class="nv">Demo</span>
<span class="mi">124</span>     <span class="mi">1</span>       <span class="s s-Atom">n</span>       <span class="s s-Atom">java</span><span class="p">.</span><span class="s s-Atom">lang</span><span class="p">.</span><span class="s s-Atom">invoke</span><span class="p">.</span><span class="nv">MethodHandle</span><span class="o">::</span><span class="nf">linkToStatic</span><span class="p">(</span><span class="nv">LLLLLL</span><span class="p">)</span><span class="nv">L</span> <span class="p">(</span><span class="s s-Atom">native</span><span class="p">)</span>   <span class="p">(</span><span class="s s-Atom">static</span><span class="p">)</span>
<span class="mi">127</span>     <span class="mi">2</span>       <span class="s s-Atom">n</span>       <span class="s s-Atom">java</span><span class="p">.</span><span class="s s-Atom">lang</span><span class="p">.</span><span class="s s-Atom">invoke</span><span class="p">.</span><span class="nv">MethodHandle</span><span class="o">::</span><span class="nf">invokeBasic</span><span class="p">(</span><span class="nv">LLLLL</span><span class="p">)</span><span class="nv">L</span> <span class="p">(</span><span class="s s-Atom">native</span><span class="p">)</span>   
<span class="p">[...]</span>
<span class="mi">1</span> <span class="s s-Atom">iteration</span>
        <span class="mi">187</span>   <span class="mi">40</span>        <span class="s s-Atom">n</span>       <span class="s s-Atom">java</span><span class="p">.</span><span class="s s-Atom">lang</span><span class="p">.</span><span class="s s-Atom">invoke</span><span class="p">.</span><span class="nv">MethodHandle</span><span class="o">::</span><span class="nf">linkToStatic</span><span class="p">(</span><span class="nv">ILIIL</span><span class="p">)</span><span class="nv">I</span> <span class="p">(</span><span class="s s-Atom">native</span><span class="p">)</span>   <span class="p">(</span><span class="s s-Atom">static</span><span class="p">)</span>
<span class="p">[...]</span>
<span class="p">(</span><span class="s s-Atom">native</span><span class="p">)</span>   <span class="p">(</span><span class="s s-Atom">static</span><span class="p">)</span>
        <span class="mi">212</span>   <span class="mi">54</span>        <span class="s s-Atom">n</span>       <span class="s s-Atom">java</span><span class="p">.</span><span class="s s-Atom">lang</span><span class="p">.</span><span class="s s-Atom">invoke</span><span class="p">.</span><span class="nv">MethodHandle</span><span class="o">::</span><span class="nf">invokeBasic</span><span class="p">(</span><span class="nv">J</span><span class="p">)</span><span class="nv">L</span> <span class="p">(</span><span class="s s-Atom">native</span><span class="p">)</span>   
        <span class="mi">212</span>   <span class="mi">55</span>        <span class="s s-Atom">n</span>       <span class="s s-Atom">java</span><span class="p">.</span><span class="s s-Atom">lang</span><span class="p">.</span><span class="s s-Atom">invoke</span><span class="p">.</span><span class="nv">MethodHandle</span><span class="o">::</span><span class="nf">linkToSpecial</span><span class="p">(</span><span class="nv">LJL</span><span class="p">)</span><span class="nv">L</span> <span class="p">(</span><span class="s s-Atom">native</span><span class="p">)</span>   <span class="p">(</span><span class="s s-Atom">static</span><span class="p">)</span>
<span class="nv">Time</span> <span class="s s-Atom">taken</span><span class="o">=</span> <span class="mi">12337415</span>
<span class="p">[...]</span>
<span class="s s-Atom">--------------------------------</span>
<span class="mi">4</span> <span class="s s-Atom">iteration</span>
<span class="nv">Square</span><span class="p">(</span><span class="s s-Atom">i</span><span class="p">)</span> <span class="o">=</span> <span class="mi">16</span>
<span class="nv">Time</span> <span class="s s-Atom">taken</span><span class="o">=</span> <span class="mi">37183</span>
<span class="s s-Atom">--------------------------------</span>
<span class="mi">5</span> <span class="s s-Atom">iteration</span>
        <span class="mi">214</span>   <span class="mi">56</span>        <span class="s s-Atom">b</span>       <span class="nv">Demo</span><span class="o">::&lt;</span><span class="s s-Atom">init</span><span class="o">&gt;</span> <span class="p">(</span><span class="mi">5</span> <span class="s s-Atom">bytes</span><span class="p">)</span>
        <span class="mi">215</span>   <span class="mi">57</span>        <span class="s s-Atom">b</span>       <span class="nv">Demo</span><span class="o">::</span><span class="nf">square</span> <span class="p">(</span><span class="mi">16</span> <span class="s s-Atom">bytes</span><span class="p">)</span>
<span class="nv">Square</span><span class="p">(</span><span class="s s-Atom">i</span><span class="p">)</span> <span class="o">=</span> <span class="mi">25</span>
<span class="nv">Time</span> <span class="s s-Atom">taken</span><span class="o">=</span> <span class="mi">983002</span>
<span class="s s-Atom">--------------------------------</span>
<span class="mi">6</span> <span class="s s-Atom">iteration</span>
<span class="nv">Square</span><span class="p">(</span><span class="s s-Atom">i</span><span class="p">)</span> <span class="o">=</span> <span class="mi">36</span>
<span class="nv">Time</span> <span class="s s-Atom">taken</span><span class="o">=</span> <span class="mi">81589</span>
<span class="p">[...]</span>
<span class="mi">10</span> <span class="s s-Atom">iteration</span>
<span class="nv">Square</span><span class="p">(</span><span class="s s-Atom">i</span><span class="p">)</span> <span class="o">=</span> <span class="mi">100</span>
<span class="nv">Time</span> <span class="s s-Atom">taken</span><span class="o">=</span> <span class="mi">52393</span>
</code></pre></div>

<p>可以看到在第五次迭代之后，代码片段被 JIT 编译了：</p>
<div class="highlight"><pre><span></span><code>--------------------------------
5 iteration
        214   56        b       Demo::&lt;init&gt; (5 bytes)
        215   57        b       Demo::square (16 bytes)
Square(i) = 25
Time taken= 983002
--------------------------------
</code></pre></div>

<p>可以看到，与 <code>square()</code> 方法一起，构造方法也被 JIT 编译了。在 <code>for</code> 循环中调用 <code>square()</code> 之前要先构造 <code>Demo</code> 实例，所以构造方法的解释次数同样达到 JIT 编译阈值。这个例子说明了在解释发生之后何时 JIT 会介入。</p>
<p>要查看编译后的代码，需要使用 <code>-XX:+PrintAssembly</code> 标志，该标志仅在库路径中有反汇编器时才起作用。对于 OpenJDK，使用 <code>hsdis</code> 作为反汇编器。下载合适版本的反汇编程序库，在本例中是 <code>hsdis-amd64.so</code>，并将其放在 <code>Java_HOME/lib/server</code> 目录下。使用时还需要在 <code>-XX:+PrintAssembly</code> 之前增加 <code>-XX:+UnlockDiagnosticVMOptions</code> 选项。否则，JVM 会给你一个警告。</p>
<p>完整命令如下：</p>
<div class="highlight"><pre><span></span><code><span class="n">$</span><span class="w"> </span><span class="n">java</span><span class="w"> </span><span class="o">-</span><span class="n">Xbatch</span><span class="w"> </span><span class="o">-</span><span class="n">XX</span><span class="o">:+</span><span class="n">PrintCompilation</span><span class="w"> </span><span class="o">-</span><span class="n">XX</span><span class="o">:</span><span class="n">CompileCommandFile</span><span class="o">=</span><span class="n">hotspot_compiler</span><span class="w"> </span><span class="err">\</span><span class="w"> </span><span class="o">-</span><span class="n">XX</span><span class="o">:-</span><span class="n">TieredCompilation</span><span class="w"> </span><span class="o">-</span><span class="n">XX</span><span class="o">:</span><span class="n">CompileThreshold</span><span class="o">=</span><span class="mi">5</span><span class="w"> </span><span class="o">-</span><span class="n">XX</span><span class="o">:+</span><span class="n">UnlockDiagnosticVMOptions</span><span class="w"> </span><span class="err">\</span><span class="w"> </span><span class="o">-</span><span class="n">XX</span><span class="o">:+</span><span class="n">PrintAssembly</span><span class="w"> </span><span class="n">Demo</span>
<span class="p">[...]</span>
<span class="mi">5</span><span class="w"> </span><span class="n">iteration</span>
<span class="w">        </span><span class="mi">178</span><span class="w">   </span><span class="mi">56</span><span class="w">        </span><span class="n">b</span><span class="w">       </span><span class="n">Demo</span><span class="o">::&lt;</span><span class="n">init</span><span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="mi">5</span><span class="w"> </span><span class="n">bytes</span><span class="p">)</span>
<span class="n">Compiled</span><span class="w"> </span><span class="n">method</span><span class="w"> </span><span class="p">(</span><span class="n">c2</span><span class="p">)</span><span class="w">    </span><span class="mi">178</span><span class="w">   </span><span class="mi">56</span><span class="w">                </span><span class="n">Demo</span><span class="o">::&lt;</span><span class="n">init</span><span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="mi">5</span><span class="w"> </span><span class="n">bytes</span><span class="p">)</span>
<span class="w"> </span><span class="n">total</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">heap</span><span class="w">  </span><span class="p">[</span><span class="mh">0x00007fd4d08dad10</span><span class="p">,</span><span class="mh">0x00007fd4d08dafe0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">720</span>
<span class="w"> </span><span class="n">relocation</span><span class="w">     </span><span class="p">[</span><span class="mh">0x00007fd4d08dae88</span><span class="p">,</span><span class="mh">0x00007fd4d08daea0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">24</span>
<span class="p">[...]</span>
<span class="w"> </span><span class="n">handler</span><span class="w"> </span><span class="n">table</span><span class="w">  </span><span class="p">[</span><span class="mh">0x00007fd4d08dafc8</span><span class="p">,</span><span class="mh">0x00007fd4d08dafe0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">24</span>
<span class="p">[...]</span>
<span class="w"> </span><span class="n">dependencies</span><span class="w">   </span><span class="p">[</span><span class="mh">0x00007fd4d08db3c0</span><span class="p">,</span><span class="mh">0x00007fd4d08db3c8</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">8</span>
<span class="w"> </span><span class="n">handler</span><span class="w"> </span><span class="n">table</span><span class="w">  </span><span class="p">[</span><span class="mh">0x00007fd4d08db3c8</span><span class="p">,</span><span class="mh">0x00007fd4d08db3f8</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">48</span>
<span class="o">----------------------------------------------------------------------</span>
<span class="n">Demo</span><span class="p">.</span><span class="n">square</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="n">I</span><span class="w">  </span><span class="p">[</span><span class="mh">0x00007fd4d08db1c0</span><span class="p">,</span><span class="w"> </span><span class="mh">0x00007fd4d08db2b8</span><span class="p">]</span><span class="w">  </span><span class="mi">248</span><span class="w"> </span><span class="n">bytes</span>
<span class="p">[</span><span class="n">Entry</span><span class="w"> </span><span class="n">Point</span><span class="p">]</span>
<span class="p">[</span><span class="n">Constants</span><span class="p">]</span>
<span class="w">  </span><span class="cp"># {method} {0x00007fd4b841f4b0} &#39;square&#39; &#39;(I)I&#39; in &#39;Demo&#39;</span>
<span class="w">  </span><span class="cp"># this:       rsi:rsi   = &#39;Demo&#39;</span>
<span class="w">  </span><span class="cp"># parm0:      rdx     = int</span>
<span class="w">  </span><span class="cp">#             [sp+0x20]  (sp of caller)</span>
<span class="p">[...]</span>
<span class="p">[</span><span class="n">Stub</span><span class="w"> </span><span class="n">Code</span><span class="p">]</span>
<span class="w">  </span><span class="mh">0x00007fd4d08db280</span><span class="o">:</span><span class="w"> </span><span class="n">movabs</span><span class="w"> </span><span class="n">$0x0</span><span class="p">,</span><span class="o">%</span><span class="n">rbx</span><span class="w">          </span><span class="p">;</span><span class="w">   </span><span class="p">{</span><span class="n">no_reloc</span><span class="p">}</span>
<span class="w">  </span><span class="mh">0x00007fd4d08db28a</span><span class="o">:</span><span class="w"> </span><span class="n">jmpq</span><span class="w">   </span><span class="mh">0x00007fd4d08db28a</span><span class="w">  </span><span class="p">;</span><span class="w">   </span><span class="p">{</span><span class="n">runtime_call</span><span class="p">}</span>
<span class="w">  </span><span class="mh">0x00007fd4d08db28f</span><span class="o">:</span><span class="w"> </span><span class="n">movabs</span><span class="w"> </span><span class="n">$0x0</span><span class="p">,</span><span class="o">%</span><span class="n">rbx</span><span class="w">          </span><span class="p">;</span><span class="w">   </span><span class="p">{</span><span class="n">static_stub</span><span class="p">}</span>
<span class="w">  </span><span class="mh">0x00007fd4d08db299</span><span class="o">:</span><span class="w"> </span><span class="n">jmpq</span><span class="w">   </span><span class="mh">0x00007fd4d08db299</span><span class="w">  </span><span class="p">;</span><span class="w">   </span><span class="p">{</span><span class="n">runtime_call</span><span class="p">}</span>
<span class="p">[</span><span class="n">Exception</span><span class="w"> </span><span class="n">Handler</span><span class="p">]</span>
<span class="w">  </span><span class="mh">0x00007fd4d08db29e</span><span class="o">:</span><span class="w"> </span><span class="n">jmpq</span><span class="w">   </span><span class="mh">0x00007fd4d08bb880</span><span class="w">  </span><span class="p">;</span><span class="w">   </span><span class="p">{</span><span class="n">runtime_call</span><span class="w"> </span><span class="n">ExceptionBlob</span><span class="p">}</span>
<span class="p">[</span><span class="n">Deopt</span><span class="w"> </span><span class="n">Handler</span><span class="w"> </span><span class="n">Code</span><span class="p">]</span>
<span class="w">  </span><span class="mh">0x00007fd4d08db2a3</span><span class="o">:</span><span class="w"> </span><span class="n">callq</span><span class="w">  </span><span class="mh">0x00007fd4d08db2a8</span>
<span class="w">  </span><span class="mh">0x00007fd4d08db2a8</span><span class="o">:</span><span class="w"> </span><span class="n">subq</span><span class="w">   </span><span class="n">$0x5</span><span class="p">,(</span><span class="o">%</span><span class="n">rsp</span><span class="p">)</span>
<span class="w">  </span><span class="mh">0x00007fd4d08db2ad</span><span class="o">:</span><span class="w"> </span><span class="n">jmpq</span><span class="w">   </span><span class="mh">0x00007fd4d08a01a0</span><span class="w">  </span><span class="p">;</span><span class="w">   </span><span class="p">{</span><span class="n">runtime_call</span><span class="w"> </span><span class="n">DeoptimizationBlob</span><span class="p">}</span>
<span class="w">  </span><span class="mh">0x00007fd4d08db2b2</span><span class="o">:</span><span class="w"> </span><span class="n">hlt</span><span class="w">    </span>
<span class="w">  </span><span class="mh">0x00007fd4d08db2b3</span><span class="o">:</span><span class="w"> </span><span class="n">hlt</span><span class="w">    </span>
<span class="w">  </span><span class="mh">0x00007fd4d08db2b4</span><span class="o">:</span><span class="w"> </span><span class="n">hlt</span><span class="w">    </span>
<span class="w">  </span><span class="mh">0x00007fd4d08db2b5</span><span class="o">:</span><span class="w"> </span><span class="n">hlt</span><span class="w">    </span>
<span class="w">  </span><span class="mh">0x00007fd4d08db2b6</span><span class="o">:</span><span class="w"> </span><span class="n">hlt</span><span class="w">    </span>
<span class="w">  </span><span class="mh">0x00007fd4d08db2b7</span><span class="o">:</span><span class="w"> </span><span class="n">hlt</span><span class="w">    </span>
<span class="n">ImmutableOopMap</span><span class="p">{</span><span class="n">rbp</span><span class="o">=</span><span class="n">NarrowOop</span><span class="w"> </span><span class="p">}</span><span class="n">pc</span><span class="w"> </span><span class="n">offsets</span><span class="o">:</span><span class="w"> </span><span class="mi">96</span>
<span class="n">ImmutableOopMap</span><span class="p">{}</span><span class="n">pc</span><span class="w"> </span><span class="n">offsets</span><span class="o">:</span><span class="w"> </span><span class="mi">112</span>
<span class="n">ImmutableOopMap</span><span class="p">{</span><span class="n">rbp</span><span class="o">=</span><span class="n">Oop</span><span class="w"> </span><span class="p">}</span><span class="n">pc</span><span class="w"> </span><span class="n">offsets</span><span class="o">:</span><span class="w"> </span><span class="mi">148</span><span class="w"> </span><span class="n">Square</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">25</span>
<span class="n">Time</span><span class="w"> </span><span class="n">taken</span><span class="o">=</span><span class="w"> </span><span class="mi">2567698</span>
<span class="o">--------------------------------</span>
<span class="mi">6</span><span class="w"> </span><span class="n">iteration</span>
<span class="n">Square</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">36</span>
<span class="n">Time</span><span class="w"> </span><span class="n">taken</span><span class="o">=</span><span class="w"> </span><span class="mi">76752</span>
<span class="p">[...]</span>
<span class="o">--------------------------------</span>
<span class="mi">10</span><span class="w"> </span><span class="n">iteration</span>
<span class="n">Square</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">100</span>
<span class="n">Time</span><span class="w"> </span><span class="n">taken</span><span class="o">=</span><span class="w"> </span><span class="mi">52888</span>
</code></pre></div>

<p>我只截取了输出中与 <code>Demo.java</code> 相关的部分。</p>
<p>现在再来看看 AOT 编译。它是在 JDK9 中引入的特性。AOT 是用于生成 <code>.so</code> 这样的库文件的静态编译器。用 AOT 可以将指定的类编译成 <code>.so</code> 库。这个库可以直接执行，而不用解释或 JIT 编译。如果 JVM 没有检测到 AOT 编译的代码，它会进行常规的解释和 JIT 编译。</p>
<p>使用 AOT 编译的命令如下：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>jaotc<span class="w"> </span>--output<span class="o">=</span>libDemo.so<span class="w"> </span>Demo.class
</code></pre></div>

<p>用下面的命令来查看共享库的符号表：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>nm<span class="w"> </span>libDemo.so
</code></pre></div>

<p>要使用生成的 <code>.so</code> 库，使用 <code>-XX:+UnlockExperimentalVMOptions</code> 和 <code>-XX:AOTLibrary</code>：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>java<span class="w"> </span>-XX:+UnlockExperimentalVMOptions<span class="w"> </span>-XX:AOTLibrary<span class="o">=</span>./libDemo.so<span class="w"> </span>Demo
<span class="m">1</span><span class="w"> </span>iteration
Square<span class="o">(</span>i<span class="o">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span>
Time<span class="w"> </span><span class="nv">taken</span><span class="o">=</span><span class="w"> </span><span class="m">7831139</span>
--------------------------------
<span class="m">2</span><span class="w"> </span>iteration
Square<span class="o">(</span>i<span class="o">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">4</span>
Time<span class="w"> </span><span class="nv">taken</span><span class="o">=</span><span class="w"> </span><span class="m">36619</span>
<span class="o">[</span>...<span class="o">]</span>
<span class="m">10</span><span class="w"> </span>iteration
Square<span class="o">(</span>i<span class="o">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">100</span>
Time<span class="w"> </span><span class="nv">taken</span><span class="o">=</span><span class="w"> </span><span class="m">42085</span>
</code></pre></div>

<p>从输出上看，跟完全用解释的情况没有区别。为了确认 AOT 发挥了作用，使用 <code>-XX:+PrintAOT</code>：</p>
<div class="highlight"><pre><span></span><code><span class="o">$</span><span class="w"> </span><span class="n">java</span><span class="w"> </span><span class="o">-</span><span class="n">XX</span><span class="p">:</span><span class="o">+</span><span class="n">UnlockExperimentalVMOptions</span><span class="w"> </span><span class="o">-</span><span class="n">XX</span><span class="p">:</span><span class="n">AOTLibrary</span><span class="o">=./</span><span class="n">libDemo</span><span class="o">.</span><span class="n">so</span><span class="w"> </span><span class="o">-</span><span class="n">XX</span><span class="p">:</span><span class="o">+</span><span class="n">PrintAOT</span><span class="w"> </span><span class="n">Demo</span>
<span class="w">         </span><span class="mi">28</span><span class="w">        </span><span class="mi">1</span><span class="w">         </span><span class="n">loaded</span><span class="w">        </span><span class="o">./</span><span class="n">libDemo</span><span class="o">.</span><span class="n">so</span><span class="w">  </span><span class="n">aot</span><span class="w"> </span><span class="n">library</span>
<span class="w">         </span><span class="mi">80</span><span class="w">        </span><span class="mi">1</span><span class="w">         </span><span class="n">aot</span><span class="p">[</span><span class="w"> </span><span class="mi">1</span><span class="p">]</span><span class="w">   </span><span class="n">Demo</span><span class="o">.</span><span class="n">main</span><span class="p">([</span><span class="n">Ljava</span><span class="o">/</span><span class="n">lang</span><span class="o">/</span><span class="nb nb-Type">String</span><span class="p">;)</span><span class="n">V</span>
<span class="w">         </span><span class="mi">80</span><span class="w">        </span><span class="mi">2</span><span class="w">         </span><span class="n">aot</span><span class="p">[</span><span class="w"> </span><span class="mi">1</span><span class="p">]</span><span class="w">   </span><span class="n">Demo</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">I</span><span class="p">)</span><span class="n">I</span>
<span class="w">         </span><span class="mi">80</span><span class="w">        </span><span class="mi">3</span><span class="w">         </span><span class="n">aot</span><span class="p">[</span><span class="w"> </span><span class="mi">1</span><span class="p">]</span><span class="w">   </span><span class="n">Demo</span><span class="o">.&lt;</span><span class="n">init</span><span class="o">&gt;</span><span class="p">()</span><span class="n">V</span>
<span class="mi">1</span><span class="w"> </span><span class="n">iteration</span>
<span class="n">Square</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
<span class="n">Time</span><span class="w"> </span><span class="n">taken</span><span class="o">=</span><span class="w"> </span><span class="mi">7252921</span>
<span class="o">--------------------------------</span>
<span class="mi">2</span><span class="w"> </span><span class="n">iteration</span>
<span class="n">Square</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span>
<span class="n">Time</span><span class="w"> </span><span class="n">taken</span><span class="o">=</span><span class="w"> </span><span class="mi">57443</span>
<span class="p">[</span><span class="o">...</span><span class="p">]</span>
<span class="mi">10</span><span class="w"> </span><span class="n">iteration</span>
<span class="n">Square</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">100</span>
<span class="n">Time</span><span class="w"> </span><span class="n">taken</span><span class="o">=</span><span class="w"> </span><span class="mi">53586</span>
</code></pre></div>

<p>要确认没有发生 JIT 编译，用如下命令：</p>
<div class="highlight"><pre><span></span><code><span class="err">$</span> <span class="s s-Atom">java</span> <span class="o">-</span><span class="nv">XX</span><span class="o">:+</span><span class="nv">UnlockExperimentalVMOptions</span> <span class="o">-</span><span class="nv">Xbatch</span> <span class="o">-</span><span class="nv">XX</span><span class="o">:+</span><span class="nv">PrintCompilation</span> <span class="s s-Atom">\</span> <span class="o">-</span><span class="nv">XX</span><span class="o">:</span><span class="nv">CompileCommandFile</span><span class="o">=</span><span class="s s-Atom">hotspot_compiler</span> <span class="o">-</span><span class="nv">XX</span><span class="o">:-</span><span class="nv">TieredCompilation</span> <span class="s s-Atom">\</span> <span class="o">-</span><span class="nv">XX</span><span class="o">:</span><span class="nv">CompileThreshold</span><span class="o">=</span><span class="mi">3</span> <span class="o">-</span><span class="nv">XX</span><span class="o">:</span><span class="nv">AOTLibrary</span><span class="s s-Atom">=./libDemo</span><span class="p">.</span><span class="s s-Atom">so</span> <span class="o">-</span><span class="nv">XX</span><span class="o">:+</span><span class="nv">PrintAOT</span> <span class="nv">Demo</span>
         <span class="mi">19</span>        <span class="mi">1</span>         <span class="s s-Atom">loaded</span>        <span class="p">.</span><span class="o">/</span><span class="s s-Atom">libDemo</span><span class="p">.</span><span class="s s-Atom">so</span>  <span class="s s-Atom">aot</span> <span class="s s-Atom">library</span>
         <span class="mi">77</span>        <span class="mi">1</span>         <span class="s s-Atom">aot</span><span class="p">[</span> <span class="mi">1</span><span class="p">]</span>   <span class="nv">Demo</span><span class="p">.</span><span class="nf">square</span><span class="p">(</span><span class="nv">I</span><span class="p">)</span><span class="nv">I</span>
         <span class="mi">77</span>        <span class="mi">2</span>         <span class="s s-Atom">aot</span><span class="p">[</span> <span class="mi">1</span><span class="p">]</span>   <span class="nv">Demo</span><span class="p">.</span><span class="nf">main</span><span class="p">([</span><span class="nv">Ljava</span><span class="o">/</span><span class="s s-Atom">lang</span><span class="o">/</span><span class="nv">String</span><span class="p">;)</span><span class="nv">V</span>
         <span class="mi">77</span>        <span class="mi">3</span>         <span class="s s-Atom">aot</span><span class="p">[</span> <span class="mi">1</span><span class="p">]</span>   <span class="nv">Demo</span><span class="p">.</span><span class="o">&lt;</span><span class="s s-Atom">init&gt;</span><span class="p">()</span><span class="nv">V</span>
         <span class="mi">77</span>        <span class="mi">2</span>         <span class="s s-Atom">aot</span><span class="p">[</span> <span class="mi">1</span><span class="p">]</span>   <span class="nv">Demo</span><span class="p">.</span><span class="nf">main</span><span class="p">([</span><span class="nv">Ljava</span><span class="o">/</span><span class="s s-Atom">lang</span><span class="o">/</span><span class="nv">String</span><span class="p">;)</span><span class="nv">V</span>   <span class="s s-Atom">made</span> <span class="o">not</span> <span class="s s-Atom">entrant</span>
<span class="p">[...]</span>
<span class="mi">4</span> <span class="s s-Atom">iteration</span>
<span class="nv">Square</span><span class="p">(</span><span class="s s-Atom">i</span><span class="p">)</span> <span class="o">=</span> <span class="mi">16</span>
<span class="nv">Time</span> <span class="s s-Atom">taken</span><span class="o">=</span> <span class="mi">43366</span>
<span class="p">[...]</span>
<span class="mi">10</span> <span class="s s-Atom">iteration</span>
<span class="nv">Square</span><span class="p">(</span><span class="s s-Atom">i</span><span class="p">)</span> <span class="o">=</span> <span class="mi">100</span>
<span class="nv">Time</span> <span class="s s-Atom">taken</span><span class="o">=</span> <span class="mi">59554</span>
</code></pre></div>

<p>需要特别注意的是，修改被 AOT 编译了的源代码后，一定要重新生成 <code>.so</code> 库文件。否则，过时的的 AOT 编译库文件不会起作用。例如，修改 <code>square()</code> 方法，使其计算立方值：</p>
<div class="highlight"><pre><span></span><code><span class="c1">//Demo.java</span>
<span class="n">public</span><span class="w"> </span><span class="n">class</span><span class="w"> </span><span class="n">Demo</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="nb">int</span><span class="w"> </span><span class="n">square</span><span class="p">(</span><span class="nb">int</span><span class="w"> </span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="n">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="n">i</span><span class="o">*</span><span class="n">i</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">void</span><span class="w"> </span><span class="n">main</span><span class="p">(</span><span class="n">String</span><span class="p">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="n">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nb">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="p">=</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="n">System</span><span class="p">.</span><span class="n">out</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Integer</span><span class="p">.</span><span class="n">valueOf</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s">&quot; iteration&quot;</span><span class="p">);</span>
<span class="w">          </span><span class="n">long</span><span class="w"> </span><span class="n">start</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">System</span><span class="p">.</span><span class="n">nanoTime</span><span class="p">();</span>
<span class="w">          </span><span class="nb">int</span><span class="w"> </span><span class="n">r</span><span class="p">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">Demo</span><span class="p">().</span><span class="n">square</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
<span class="w">          </span><span class="n">System</span><span class="p">.</span><span class="n">out</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;Square(i) = &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">r</span><span class="p">);</span>
<span class="w">          </span><span class="n">long</span><span class="w"> </span><span class="k">end</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">System</span><span class="p">.</span><span class="n">nanoTime</span><span class="p">();</span>
<span class="w">          </span><span class="n">System</span><span class="p">.</span><span class="n">out</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;Time taken= &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="k">end</span><span class="o">-</span><span class="n">start</span><span class="p">));</span>
<span class="w">          </span><span class="n">System</span><span class="p">.</span><span class="n">out</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;--------------------------------&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>重新编译 <code>Demo.java</code>：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>java<span class="w"> </span>Demo.java
</code></pre></div>

<p>但不重新生成 <code>libDemo.so</code>。使用下面命令运行 <code>Demo</code>：</p>
<div class="highlight"><pre><span></span><code><span class="err">$</span> <span class="s s-Atom">java</span> <span class="o">-</span><span class="nv">XX</span><span class="o">:+</span><span class="nv">UnlockExperimentalVMOptions</span> <span class="o">-</span><span class="nv">Xbatch</span> <span class="o">-</span><span class="nv">XX</span><span class="o">:+</span><span class="nv">PrintCompilation</span> <span class="o">-</span><span class="nv">XX</span><span class="o">:</span><span class="nv">CompileCommandFile</span><span class="o">=</span><span class="s s-Atom">hotspot_compiler</span> <span class="o">-</span><span class="nv">XX</span><span class="o">:-</span><span class="nv">TieredCompilation</span> <span class="o">-</span><span class="nv">XX</span><span class="o">:</span><span class="nv">CompileThreshold</span><span class="o">=</span><span class="mi">3</span> <span class="o">-</span><span class="nv">XX</span><span class="o">:</span><span class="nv">AOTLibrary</span><span class="s s-Atom">=./libDemo</span><span class="p">.</span><span class="s s-Atom">so</span> <span class="o">-</span><span class="nv">XX</span><span class="o">:+</span><span class="nv">PrintAOT</span> <span class="nv">Demo</span>
         <span class="mi">20</span>        <span class="mi">1</span>         <span class="s s-Atom">loaded</span>        <span class="p">.</span><span class="o">/</span><span class="s s-Atom">libDemo</span><span class="p">.</span><span class="s s-Atom">so</span>  <span class="s s-Atom">aot</span> <span class="s s-Atom">library</span>
         <span class="mi">74</span>        <span class="mi">1</span>         <span class="s s-Atom">n</span>           <span class="s s-Atom">java</span><span class="p">.</span><span class="s s-Atom">lang</span><span class="p">.</span><span class="s s-Atom">invoke</span><span class="p">.</span><span class="nv">MethodHandle</span><span class="o">::</span><span class="nf">linkToStatic</span><span class="p">(</span><span class="nv">LLLLLL</span><span class="p">)</span><span class="nv">L</span> <span class="p">(</span><span class="s s-Atom">native</span><span class="p">)</span>   <span class="p">(</span><span class="s s-Atom">static</span><span class="p">)</span>
<span class="mi">2</span> <span class="s s-Atom">iteration</span>
<span class="nf">sqrt</span><span class="p">(</span><span class="s s-Atom">i</span><span class="p">)</span> <span class="o">=</span> <span class="mi">8</span>
<span class="nv">Time</span> <span class="s s-Atom">taken</span><span class="o">=</span> <span class="mi">43838</span>
<span class="s s-Atom">--------------------------------</span>
<span class="mi">3</span> <span class="s s-Atom">iteration</span>
        <span class="mi">137</span>   <span class="mi">56</span>        <span class="s s-Atom">b</span>            <span class="nv">Demo</span><span class="o">::&lt;</span><span class="s s-Atom">init</span><span class="o">&gt;</span> <span class="p">(</span><span class="mi">5</span> <span class="s s-Atom">bytes</span><span class="p">)</span>
        <span class="mi">138</span>   <span class="mi">57</span>        <span class="s s-Atom">b</span>            <span class="nv">Demo</span><span class="o">::</span><span class="nf">square</span> <span class="p">(</span><span class="mi">6</span> <span class="s s-Atom">bytes</span><span class="p">)</span>
<span class="nf">sqrt</span><span class="p">(</span><span class="s s-Atom">i</span><span class="p">)</span> <span class="o">=</span> <span class="mi">27</span>
<span class="nv">Time</span> <span class="s s-Atom">taken</span><span class="o">=</span> <span class="mi">534649</span>
<span class="s s-Atom">--------------------------------</span>
<span class="mi">4</span> <span class="s s-Atom">iteration</span>
<span class="nf">sqrt</span><span class="p">(</span><span class="s s-Atom">i</span><span class="p">)</span> <span class="o">=</span> <span class="mi">64</span>
<span class="nv">Time</span> <span class="s s-Atom">taken</span><span class="o">=</span> <span class="mi">51916</span>
<span class="p">[...]</span>
<span class="mi">10</span> <span class="s s-Atom">iteration</span>
<span class="nf">sqrt</span><span class="p">(</span><span class="s s-Atom">i</span><span class="p">)</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="nv">Time</span> <span class="s s-Atom">taken</span><span class="o">=</span> <span class="mi">47132</span>
</code></pre></div>

<p>可以看到，虽然旧版本的 <code>libDemo.so</code> 被加载了，但 JVM 检测出它已经过时了。每次生成 <code>.class</code> 文件时，都会在类文件中添加一个指纹，并在 AOT 库中保存该指纹。修改源代码后类指纹与旧的 AOT 库中的指纹不匹配了，所以没有执行 AOT 编译生成的原生机器码。从输出可以看出，现在实际上是 JIT 在起作用（注意 <code>-XX:CompileThreshold</code> 被设置为了 3）。</p>
<h3>AOT 和 JIT 之间的权衡</h3>
<p>如果你的目标是减少 JVM 的预热时间，请使用 AOT，这可以减少运行时负担。问题是 AOT 没有足够的数据来决定哪段代码需要预编译为原生代码。相比之下，JIT 在运行时起作用，却对预热时间有一定的影响。然而，它将有足够的分析数据来更高效地编译和反编译代码。</p>
<p><em>（题图：MJ/ed3e6e15-56c7-4c1d-aff1-84a225faeeeb）</em></p>
    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>links</h2>
                        <ul>
                            <li><a href="https://getpelican.com/">Pelican</a></li>
                            <li><a href="https://www.python.org/">Python.org</a></li>
                            <li><a href="https://palletsprojects.com/p/jinja/">Jinja2</a></li>
                            <li><a href="#">You can modify those links in your config file</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>

                            <li><a href="#">You can add links in your config file</a></li>
                            <li><a href="#">Another social link</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a rel="nofollow" href="https://getpelican.com/">Pelican</a>, which takes great advantage of <a rel="nofollow" href="https://www.python.org/">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a rel="nofollow" href="https://www.smashingmagazine.com/2009/08/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>