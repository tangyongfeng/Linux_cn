<!DOCTYPE html>
<html lang="zh">
<head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="generator" content="Pelican" />
        <title>PHP-RSA加密跨域通讯实战</title>
        <link rel="stylesheet" href="/theme/css/main.css" />
        <meta name="description" content="Author: PHILO AUTH：PHILO EMAIL：lijianying12 at gmail.com 基于POST GET 的http通讯虽然非常成熟，但是很容易被人监听。 并且如果使用跨域jsonp的通讯很容易在历史记录中发现通讯网址以及参数。为了克服这些问题， 并且降低服务器成本 …" />
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">linux_cn</a></h1>
                <nav><ul>
                    <li><a href="/category/chuan-shan-jia-zhuan-fang">穿山甲专访</a></li>
                    <li><a href="/category/dai-ma-ying-xiong">代码英雄</a></li>
                    <li><a href="/category/fen-xiang">分享</a></li>
                    <li><a href="/category/guan-dian">观点</a></li>
                    <li><a href="/category/huo-dong">活动</a></li>
                    <li><a href="/category/ji-ke-man-hua">极客漫画</a></li>
                    <li><a href="/category/ji-zhu">技术</a></li>
                    <li><a href="/category/kai-yuan-zhi-hui">开源智慧</a></li>
                    <li><a href="/category/linux-fa-xing-ban">Linux 发行版</a></li>
                    <li><a href="/category/mei-ri-an-quan-zi-xun">每日安全资讯</a></li>
                    <li><a href="/category/misc">Misc</a></li>
                    <li><a href="/category/qu-kuai-lian">区块链</a></li>
                    <li><a href="/category/rong-qi-yu-yun">容器与云</a></li>
                    <li class="active"><a href="/category/ruan-jian-kai-fa">软件开发</a></li>
                    <li><a href="/category/shu-mei-pai">树莓派</a></li>
                    <li><a href="/category/xi-tong-yun-wei">系统运维</a></li>
                    <li><a href="/category/xin-wen">新闻</a></li>
                    <li><a href="/category/ying-he-guan-cha">硬核观察</a></li>
                    <li><a href="/category/zhi-ye-sheng-ya">职业生涯</a></li>
                    <li><a href="/category/zhong-jiang-ming-dan">中奖名单</a></li>
                    <li><a href="/category/zhuo-mian-ying-yong">桌面应用</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="/2014/10/php-rsajia-mi-kua-yu-tong-xun-shi-zhan.html" rel="bookmark"
           title="Permalink to PHP-RSA加密跨域通讯实战">PHP-RSA加密跨域通讯实战</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2014-10-11T11:59:00+02:00">
                Published: Sat 11 October 2014
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/linux-fans-from-china.html">linux fans from china</a>
        </address>
<p>In <a href="/category/ruan-jian-kai-fa">软件开发</a>.</p>

</footer><!-- /.post-info -->      <p>Author: PHILO</p>
<p>AUTH：PHILO EMAIL：lijianying12 at gmail.com</p>
<p>基于POST GET 的http通讯虽然非常成熟，但是很容易被人监听。 并且如果使用跨域jsonp的通讯很容易在历史记录中发现通讯网址以及参数。为了克服这些问题， 并且降低服务器成本，我们没有使用SSL而使用 RSA加密。文章中的php加密解密 JS的加密解密 互相加密解密 都能验证通过。</p>
<p>其中PHP依赖常见的OPENSSL LIB 。 JS依赖 jsencrypt。</p>
<p>我们使用jsonp get RSA加密通讯好处如下：</p>
<ol>
<li>前后分离适合cdn加速。</li>
<li>安全跨域更适合松散结构的网站。</li>
<li>不用去买ssl证书了。</li>
</ol>
<p><img alt="" src="/data/attachment/album/201410/11/115936l9puic922s79s0m7.jpg"></p>
<h2>首先要生成密匙对</h2>
<div class="highlight"><pre><span></span><code>openssl genrsa 1024 &gt; private.key
openssl rsa -in private.key -pubout &gt; public.key
</code></pre></div>

<h2>JS的RSA加密流程</h2>
<p>下载最新版本请移步到github：<a href="https://github.com/travist/jsencrypt">jsencrypt</a> 代码在目录BIN下面是否用压缩的根据情况决定。</p>
<h3>生成KEY</h3>
<div class="highlight"><pre><span></span><code><span class="k">var</span><span class="w"> </span><span class="n">keySize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1024</span><span class="p">;</span><span class="w"> </span><span class="o">//</span><span class="err">加密强度</span>
<span class="k">var</span><span class="w"> </span><span class="n">crypt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">JSEncrypt</span><span class="p">({</span><span class="n">default_key_size</span><span class="p">:</span><span class="w"> </span><span class="n">keySize</span><span class="p">});</span><span class="w">  </span><span class="o">//</span><span class="n">RSA</span><span class="w"> </span><span class="err">操作对象</span>
<span class="o">//</span><span class="err">方法</span><span class="mi">1</span><span class="w"> </span><span class="p">(</span><span class="n">async</span><span class="p">)</span>
<span class="n">crypt</span><span class="o">.</span><span class="n">getKey</span><span class="p">(</span><span class="n">function</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">crypt</span><span class="o">.</span><span class="n">getPrivateKey</span><span class="p">();</span>
<span class="w">    </span><span class="n">crypt</span><span class="o">.</span><span class="n">getPublicKey</span><span class="p">();</span>
<span class="p">});</span>
<span class="o">//</span><span class="err">方法</span><span class="mi">2</span><span class="err">：</span>
<span class="n">crypt</span><span class="o">.</span><span class="n">getKey</span><span class="p">();</span>
<span class="n">crypt</span><span class="o">.</span><span class="n">getPrivateKey</span><span class="p">();</span>
<span class="n">crypt</span><span class="o">.</span><span class="n">getPublicKey</span><span class="p">();</span>
</code></pre></div>

<h3>客户端加密场景：</h3>
<div class="highlight"><pre><span></span><code><span class="k">var</span><span class="w"> </span><span class="n">crypt1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">JSEncrypt</span><span class="p">();</span><span class="w"> </span><span class="o">//</span><span class="err">新建</span><span class="n">rsa对象</span>
<span class="w">        </span><span class="k">var</span><span class="w"> </span><span class="n">publickey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;</span><span class="se">\</span>
<span class="s1">        -----BEGIN PUBLIC KEY-----</span><span class="se">\</span>
<span class="s1">        MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQC3N8LJFqlsa6loCgFpgZVMr/Sx</span><span class="se">\</span>
<span class="s1">        DMQY7pr0euNQfh2g+UVPbB0MGhoc7nWL0FQhCgDedbjQw/nGFStFx7W1+0o1oRTY</span><span class="se">\</span>
<span class="s1">        u5ebNVivZSobraUv7LJvwT8O66Zs8cxbKLqQ/nE/WwJvXomSIckH6R8iOUO8/QT9</span><span class="se">\</span>
<span class="s1">        kv6/L0Uma3qA07pmDQIDAQAB</span><span class="se">\</span>
<span class="s1">        -----END PUBLIC KEY-----</span><span class="se">\</span>
<span class="s1">                &#39;</span><span class="p">;</span>
<span class="n">crypt1</span><span class="o">.</span><span class="n">setPublicKey</span><span class="p">(</span><span class="n">publickey</span><span class="w"> </span><span class="p">);</span><span class="o">//</span><span class="err">添加来自服务端的</span><span class="n">publickey</span>
<span class="n">crypt1</span><span class="o">.</span><span class="n">encrypt</span><span class="p">(</span><span class="s1">&#39;abc&#39;</span><span class="p">);</span><span class="w"> </span><span class="o">//</span><span class="err">返回值为加密后的结果</span>
</code></pre></div>

<h3>客户端解密场景:</h3>
<div class="highlight"><pre><span></span><code><span class="w">        </span><span class="k">var</span><span class="w"> </span><span class="n">privatekey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;-----BEGIN RSA PRIVATE KEY-----</span><span class="se">\</span>
<span class="s1">        MIICXQIBAAKBgQC3N8LJFqlsa6loCgFpgZVMr/SxDMQY7pr0euNQfh2g+UVPbB0M</span><span class="se">\</span>
<span class="s1">        Ghoc7nWL0FQhCgDedbjQw/nGFStFx7W1+0o1oRTYu5ebNVivZSobraUv7LJvwT8O</span><span class="se">\</span>
<span class="s1">        66Zs8cxbKLqQ/nE/WwJvXomSIckH6R8iOUO8/QT9kv6/L0Uma3qA07pmDQIDAQAB</span><span class="se">\</span>
<span class="s1">        AoGBAKba3UWModbfZXQeSJLxNCqWw9zJp3ydL/keQQ35DLqgyIJAD2QKEWXvtJUT</span><span class="se">\</span>
<span class="s1">        sMo19fyicSGOmFXQyYvPCKkmpLkOMAj1XaNpSMtSrcMx+gC01PO6Ey9rsUxW1g3u</span><span class="se">\</span>
<span class="s1">        fpqbEk9E3a5AtCS0I61nbUpRL6rqMtR5o2wcNR3TLtJt7pjxAkEA7hlFJKU1zWGp</span><span class="se">\</span>
<span class="s1">        OvvkJDnHc2NOCEJoGjqCR9wwv96+/xAykl2laI6WvEbbhjoO0+8+d17oigjhneS5</span><span class="se">\</span>
<span class="s1">        2UKFcfqw7wJBAMT+MCQ5TYLQlvjrBaDMqOdLsqtaDE6CpkrgwV820QMvHOo3R4Xd</span><span class="se">\</span>
<span class="s1">        uSbrA2tOr9t2/x+FzF971lRGdPFIch9UYMMCQQCZtO6SDaWCBP3++gX57OL5dq41</span><span class="se">\</span>
<span class="s1">        XsldxU+9nERMWTvr5UUAgDv8F7Dvsr6dFHXmE5i77yUnlzwvdi0UOIF1Z2U5AkBV</span><span class="se">\</span>
<span class="s1">        wyRKYPgx34Ya0JcerntKV1Zt60I4XADx0G/feAn/DN/VyENHMISPQPm4GgXN0jy4</span><span class="se">\</span>
<span class="s1">        CJQ1bcCd6B65fQTSRvXpAkA2Vv5yXzeKDls/AyxHEoros/VYftVc1HOFC++q13Rw</span><span class="se">\</span>
<span class="s1">        NH2rnlRT8FMTFEqL9MYRqvvYAFf5VmH0M1Nx5t4LRN+l</span><span class="se">\</span>
<span class="s1">        -----END RSA PRIVATE KEY-----</span><span class="se">\</span>
<span class="s1">                &#39;</span><span class="p">;</span>
<span class="k">var</span><span class="w"> </span><span class="n">crypt2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">JSEncrypt</span><span class="p">();</span><span class="o">//</span><span class="err">新建加密对象</span>
<span class="n">crypt2</span><span class="o">.</span><span class="n">setPrivateKey</span><span class="p">(</span><span class="n">privatekey</span><span class="p">);</span><span class="o">//</span><span class="err">给加密对象设置</span><span class="n">privatekey</span>
<span class="n">crypt2</span><span class="o">.</span><span class="n">getPublicKey</span><span class="p">();</span><span class="o">//</span><span class="n">Tip</span><span class="w"> </span><span class="err">我们是不需要存储</span><span class="n">publickey的直接用private能得到publickey</span>
<span class="n">crypt2</span><span class="o">.</span><span class="n">decrypt</span><span class="p">(</span><span class="s2">&quot;MeUqWB5LwTh8crzPqbZtEtKuZxYvPWH9CTCChK1qoBzIgIXGPCdzNMbiH0cCYHl5qWSERIDOgDIgv4dXsIMjEJ5q0cp/qNQYHM5va0iw0UvKvQB1E8aWtY2nFEPy4F+ArQ0Mj/ijr/CntEP1jHKC3WU9nu2kYrBIBnbj14Bs+kI=&quot;</span><span class="p">);</span><span class="o">//</span><span class="err">调用解密方法</span>
</code></pre></div>

<h4>但是虽然写到了这里，加密方面还是不够用，因为1024长度的RSA加密最多只能加密长度为117的字符串。而URL长度最多为4k因此这里我们要让加密长度达到2691以达到能用的程度。</h4>
<p>那么这种加密长度大概能容纳多少数据呢？ 我们借助<a href="http://www.json-generator.com/">json-generator</a>来帮忙生成JSON</p>
<div class="highlight"><pre><span></span><code><span class="w">    </span><span class="nx">sdata</span><span class="w"> </span><span class="p">=[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="s">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;542f9ac2359c7d881bc0298e&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;index&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;guid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;db1dacc1-b870-4e3c-bc1a-80dfd9506610&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;isActive&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;balance&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;$1,570.15&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;picture&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;http://placehold.it/32x32&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;age&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">36</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;eyeColor&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;blue&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Effie Barr&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;gender&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;female&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;company&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ZORK&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;email&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;effiebarr@zork.com&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;phone&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;+1 (802) 574-3379&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;address&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;951 Cortelyou Road, Wikieup, Colorado, 4694&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;about&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Sunt reprehenderit do laboris velit qui elit duis velit qui. Nostrud sit eiusmod cillum exercitation veniam ad sint irure cupidatat sunt consectetur magna. Amet nisi velit laboris amet officia et velit nisi nostrud ipsum. Cupidatat et fugiat esse minim occaecat cillum enim exercitation laboris velit nisi est enim aute. Enim do pariatur\r\n&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;registered&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;2014-05-08T15:26:35 -08:00&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;latitude&quot;</span><span class="p">:</span><span class="w"> </span><span class="m m-Double">48.576424</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;longitude&quot;</span><span class="p">:</span><span class="w"> </span><span class="m m-Double">146.634137</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;tags&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">                </span><span class="s">&quot;esse&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s">&quot;proident&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s">&quot;quis&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s">&quot;consectetur&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s">&quot;magna&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s">&quot;tempor&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s">&quot;anim&quot;</span>
<span class="w">            </span><span class="p">],</span>
<span class="w">            </span><span class="s">&quot;friends&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">                </span><span class="p">{</span>
<span class="w">                    </span><span class="s">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">                    </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Trisha Cannon&quot;</span>
<span class="w">                </span><span class="p">},</span>
<span class="w">                </span><span class="p">{</span>
<span class="w">                    </span><span class="s">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">                    </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Todd Bullock&quot;</span>
<span class="w">                </span><span class="p">},</span>
<span class="w">                </span><span class="p">{</span>
<span class="w">                    </span><span class="s">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span>
<span class="w">                    </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Eileen Drake&quot;</span>
<span class="w">                </span><span class="p">},</span>
<span class="w">                </span><span class="p">{</span>
<span class="w">                    </span><span class="s">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span>
<span class="w">                    </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Ferrell Kelly&quot;</span>
<span class="w">                </span><span class="p">},</span>
<span class="w">                </span><span class="p">{</span>
<span class="w">                    </span><span class="s">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span>
<span class="w">                    </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Fischer Blankenship&quot;</span>
<span class="w">                </span><span class="p">},</span>
<span class="w">                </span><span class="p">{</span>
<span class="w">                    </span><span class="s">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span>
<span class="w">                    </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Morales Mann&quot;</span>
<span class="w">                </span><span class="p">},</span>
<span class="w">                </span><span class="p">{</span>
<span class="w">                    </span><span class="s">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span>
<span class="w">                    </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Brandie Pittman&quot;</span>
<span class="w">                </span><span class="p">},</span>
<span class="w">                </span><span class="p">{</span>
<span class="w">                    </span><span class="s">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span>
<span class="w">                    </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Virgie Kerr&quot;</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">],</span>
<span class="w">            </span><span class="s">&quot;greeting&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Hello, Effie Barr! You have 1 unread messages.&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;favoriteFruit&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;apple&quot;</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="s">&quot;_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;542f9ac21c260d03e763a4f2&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;index&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;guid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;9e3a3d8a-26f8-46b7-aca0-336a194808b1&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;isActive&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;balance&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;$3,617.89&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;picture&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;http://placehold.it/32x32&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;age&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">31</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;eyeColor&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;brown&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Butler Best&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;gender&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;male&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;company&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;SPORTAN&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;email&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;butlerbest@sportan.com&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;phone&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;+1 (905) 428-3046&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;address&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;798 Joval Court, Wanship, Delaware, 8974&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;about&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Nostrud occaecat id sunt pariatur ad nisi do veniam sit officia non consequat amet fugiat. Est eiusmod labore ut cillum qui eu elit ut eiusmod exercitation. Ut anim nostrud eiusmod voluptate tempor proident id do pariatur. In Lorem ullamco ea irure adipisicing. Quis est dolor ex commodo aliqua nisi elit sit elit anim fugiat sunt amet. Enim consequat ipsum occaecat ipsum tempor deserunt dolor veniam nostrud. Anim cillum ullamco cupidatat aute velit fugiat sit enim in amet anim mollit dolor eiusmod.\r\n&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;registered&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;2014-08-02T06:15:44 -08:00&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;latitude&quot;</span><span class="p">:</span><span class="w"> </span><span class="o">-</span><span class="m m-Double">20.529765</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;longitude&quot;</span><span class="p">:</span><span class="w"> </span><span class="m m-Double">2.396578</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;tags&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">                </span><span class="s">&quot;consequat&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s">&quot;enim&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s">&quot;magna&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s">&quot;sunt&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s">&quot;Lorem&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s">&quot;quis&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s">&quot;commodo&quot;</span>
<span class="w">            </span><span class="p">],</span>
<span class="w">            </span><span class="s">&quot;friends&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">                </span><span class="p">{</span>
<span class="w">                    </span><span class="s">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">                    </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Kenya Rice&quot;</span>
<span class="w">                </span><span class="p">},</span>
<span class="w">                </span><span class="p">{</span>
<span class="w">                    </span><span class="s">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">                    </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Hale Knowles&quot;</span>
<span class="w">                </span><span class="p">},</span>
<span class="w">                </span><span class="p">{</span>
<span class="w">                    </span><span class="s">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span>
<span class="w">                    </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Michael Stephens&quot;</span>
<span class="w">                </span><span class="p">},</span>
<span class="w">                </span><span class="p">{</span>
<span class="w">                    </span><span class="s">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span>
<span class="w">                    </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Holder Bailey&quot;</span>
<span class="w">                </span><span class="p">},</span>
<span class="w">                </span><span class="p">{</span>
<span class="w">                    </span><span class="s">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span>
<span class="w">                    </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Garner Luna&quot;</span>
<span class="w">                </span><span class="p">},</span>
<span class="w">                </span><span class="p">{</span>
<span class="w">                    </span><span class="s">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span>
<span class="w">                    </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Alyce Sawyer&quot;</span>
<span class="w">                </span><span class="p">},</span>
<span class="w">                </span><span class="p">{</span>
<span class="w">                    </span><span class="s">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span>
<span class="w">                    </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Rivas Owens&quot;</span>
<span class="w">                </span><span class="p">},</span>
<span class="w">                </span><span class="p">{</span>
<span class="w">                    </span><span class="s">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span>
<span class="w">                    </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Jan Petersen&quot;</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">],</span>
<span class="w">            </span><span class="s">&quot;greeting&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Hello, Butler Best! You have 8 unread messages.&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;favoriteFruit&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;banana&quot;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
</code></pre></div>

<p>表单json能达到这么长已经是很极端的情况了。因此这种方法绝对是够用的。</p>
<h3>长表单内容加解密方法：</h3>
<div class="highlight"><pre><span></span><code><span class="k">function</span><span class="w"> </span><span class="nf">encrypt_data</span><span class="p">(</span>publickey,data<span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">length</span><span class="o">&gt;</span><span class="w"> </span><span class="mi">2691</span><span class="p">){</span><span class="k">return</span><span class="p">;}</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="nb">length</span><span class="w"> </span><span class="n">limit</span>
<span class="w">    </span><span class="nb">var</span><span class="w"> </span><span class="n">crypt</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">JSEncrypt</span><span class="p">();</span>
<span class="w">    </span><span class="n">crypt</span><span class="p">.</span><span class="n">setPublicKey</span><span class="p">(</span><span class="n">publickey</span><span class="p">);</span>
<span class="w">    </span><span class="n">crypt_res</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="nb">var</span><span class="w"> </span><span class="n">index</span><span class="p">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">index</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">length</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">data</span><span class="p">.</span><span class="n">length</span><span class="c">%117)/117+1 ; index++)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="nb">var</span><span class="w"> </span><span class="n">subdata</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">data</span><span class="p">.</span><span class="n">substr</span><span class="p">(</span><span class="n">index</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">117</span><span class="p">,</span><span class="mi">117</span><span class="p">);</span>
<span class="w">        </span><span class="n">crypt_res</span><span class="w"> </span><span class="o">+</span><span class="p">=</span><span class="w"> </span><span class="n">crypt</span><span class="p">.</span><span class="n">encrypt</span><span class="p">(</span><span class="n">subdata</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">crypt_res</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">function</span><span class="w"> </span><span class="nf">decrypt_data</span><span class="p">(</span>privatekey,data<span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="nb">var</span><span class="w"> </span><span class="n">crypt</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">JSEncrypt</span><span class="p">();</span>
<span class="w">    </span><span class="n">crypt</span><span class="p">.</span><span class="n">setPrivateKey</span><span class="p">(</span><span class="n">privatekey</span><span class="p">);</span>
<span class="w">    </span><span class="n">datas</span><span class="p">=</span><span class="n">data</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;=&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="n">var</span><span class="w"> </span><span class="s">decrypt_res=&quot;&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="n">datas</span><span class="p">.</span><span class="n">forEach</span><span class="p">(</span><span class="k">function</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">item</span>!<span class="p">=</span><span class="s">&quot;&quot;</span><span class="p">){</span><span class="n">de_res</span><span class="w"> </span><span class="o">+</span><span class="p">=</span><span class="w"> </span><span class="n">crypt</span><span class="p">.</span><span class="n">decrypt</span><span class="p">(</span><span class="n">item</span><span class="p">);}</span>
<span class="w">    </span><span class="p">});</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">decrypt_res</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

<p>##########NextPage[title=]##########</p>
<h2>PHP的RSA加密</h2>
<h3>php加密解密类</h3>
<p>首先要检查phpinfo里面有没有openssl支持</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="n">mycrypt</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>

<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="o">$</span><span class="n">pubkey</span><span class="p">;</span><span class="w">  </span>
<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="o">$</span><span class="n">privkey</span><span class="p">;</span><span class="w">  </span>

<span class="w">    </span><span class="n">function</span><span class="w"> </span><span class="n">__construct</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
<span class="w">                </span><span class="o">$</span><span class="n">this</span><span class="o">-&gt;</span><span class="n">pubkey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">file_get_contents</span><span class="p">(</span><span class="s1">&#39;./public.key&#39;</span><span class="p">);</span><span class="w">  </span>
<span class="w">                </span><span class="o">$</span><span class="n">this</span><span class="o">-&gt;</span><span class="n">privkey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">file_get_contents</span><span class="p">(</span><span class="s1">&#39;./private.key&#39;</span><span class="p">);</span><span class="w">  </span>
<span class="w">    </span><span class="p">}</span><span class="w">  </span>

<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="n">encrypt</span><span class="p">(</span><span class="o">$</span><span class="n">data</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">openssl_public_encrypt</span><span class="p">(</span><span class="o">$</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="o">$</span><span class="n">encrypted</span><span class="p">,</span><span class="w"> </span><span class="o">$</span><span class="n">this</span><span class="o">-&gt;</span><span class="n">pubkey</span><span class="p">))</span><span class="w">  </span>
<span class="w">            </span><span class="o">$</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">base64_encode</span><span class="p">(</span><span class="o">$</span><span class="n">encrypted</span><span class="p">);</span><span class="w">  </span>
<span class="w">        </span><span class="k">else</span><span class="w">  </span>
<span class="w">            </span><span class="n">throw</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">Exception</span><span class="p">(</span><span class="s1">&#39;Unable to encrypt data. Perhaps it is bigger than the key size?&#39;</span><span class="p">);</span><span class="w">  </span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="o">$</span><span class="n">data</span><span class="p">;</span><span class="w">  </span>
<span class="w">    </span><span class="p">}</span><span class="w">  </span>

<span class="w">    </span><span class="n">public</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="n">decrypt</span><span class="p">(</span><span class="o">$</span><span class="n">data</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">openssl_private_decrypt</span><span class="p">(</span><span class="n">base64_decode</span><span class="p">(</span><span class="o">$</span><span class="n">data</span><span class="p">),</span><span class="w"> </span><span class="o">$</span><span class="n">decrypted</span><span class="p">,</span><span class="w"> </span><span class="o">$</span><span class="n">this</span><span class="o">-&gt;</span><span class="n">privkey</span><span class="p">))</span><span class="w">  </span>
<span class="w">            </span><span class="o">$</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">$</span><span class="n">decrypted</span><span class="p">;</span><span class="w">  </span>
<span class="w">        </span><span class="k">else</span><span class="w">  </span>
<span class="w">            </span><span class="o">$</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">;</span><span class="w">  </span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="o">$</span><span class="n">data</span><span class="p">;</span><span class="w">  </span>
<span class="w">    </span><span class="p">}</span><span class="w">  </span>

<span class="p">}</span><span class="w">  </span>
</code></pre></div>

<p><strong>密匙文件位置问题，是放到访问接口的附近就可以了如果是CI的话就放到index.php旁边就行了。</strong> 但是要注意一点，一定要做访问设置，不然key会暴出来的，那时候信息一旦截获就惨了。</p>
<h3>类的使用</h3>
<div class="highlight"><pre><span></span><code><span class="err">$</span><span class="n">rsa</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">mycrypt</span><span class="p">();</span><span class="w">  </span>
<span class="n">echo</span><span class="w"> </span><span class="err">$</span><span class="n">rsa</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kr">encrypt</span><span class="p">(</span><span class="s">&#39;abc&#39;</span><span class="p">);</span><span class="w">  </span>
<span class="n">echo</span><span class="w"> </span><span class="err">$</span><span class="n">rsa</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">decrypt</span><span class="p">(</span><span class="s">&#39;W+ducpssNJlyp2XYE08wwokHfT0bm87yBz9vviZbfjAGsy/U9Ns9FIed684lWjYyyofi/1YWrU0Mp8vLOYi8l6CfklBY=&#39;</span><span class="p">);</span><span class="w">  </span>
</code></pre></div>

<h3>长数据加密解密</h3>
<div class="highlight"><pre><span></span><code><span class="k">function</span><span class="w"> </span><span class="nf">encrypt_data</span><span class="p">(</span>$publickey,$data<span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span>$<span class="n">rsa</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">mycrypt</span><span class="p">();</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span>$<span class="n">publickey</span><span class="w"> </span>!<span class="p">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">){</span>
<span class="w">        </span>$<span class="n">rsa</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">pubkey</span><span class="w"> </span><span class="p">=</span><span class="w"> </span>$<span class="n">publickey</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span>$<span class="n">crypt_res</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="k">for</span><span class="p">(</span>$<span class="nb">i</span><span class="p">=</span><span class="mi">0</span><span class="p">;</span>$<span class="nb">i</span><span class="o">&lt;</span><span class="p">((</span><span class="n">strlen</span><span class="p">(</span>$<span class="n">data</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">strlen</span><span class="p">(</span>$<span class="n">data</span><span class="p">)</span><span class="c">%117)/117+1); $i++)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span>$<span class="n">crypt_res</span><span class="w"> </span><span class="p">=</span><span class="w"> </span>$<span class="n">crypt_res</span><span class="p">.(</span>$<span class="n">rsa</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">encrypt</span><span class="p">(</span><span class="n">mb_strcut</span><span class="p">(</span>$<span class="n">data</span><span class="p">,</span><span class="w"> </span>$<span class="nb">i</span><span class="o">*</span><span class="mi">117</span><span class="p">,</span><span class="w"> </span><span class="mi">117</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;utf-8&#39;</span><span class="p">)));</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span>$<span class="n">crypt_res</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">function</span><span class="w"> </span><span class="nf">decrypt_data</span><span class="p">(</span>$privatekey,$data<span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span>$<span class="n">rsa</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">mycrypt</span><span class="p">();</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span>$<span class="n">privatekey</span><span class="w"> </span>!<span class="p">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">){</span><span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nb">null</span><span class="w"> </span><span class="n">use</span><span class="w"> </span><span class="n">default</span>
<span class="w">        </span>$<span class="n">rsa</span><span class="w"> </span><span class="o">-&gt;</span><span class="n">privkey</span><span class="w"> </span><span class="p">=</span><span class="w"> </span>$<span class="n">privatekey</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span>$<span class="n">decrypt_res</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">;</span>
<span class="w">    </span>$<span class="n">datas</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">explode</span><span class="p">(</span><span class="s">&#39;=&#39;</span><span class="p">,</span>$<span class="n">data</span><span class="p">);</span>
<span class="w">    </span><span class="n">foreach</span><span class="w"> </span><span class="p">(</span>$<span class="n">datas</span><span class="w"> </span><span class="n">as</span><span class="w"> </span>$<span class="n">value</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span>$<span class="n">decrypt_res</span><span class="w"> </span><span class="p">=</span><span class="w"> </span>$<span class="n">decrypt_res</span><span class="p">.</span>$<span class="n">rsa</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">decrypt</span><span class="p">(</span>$<span class="n">value</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span>$<span class="n">decrypt_res</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

<h2>JSONP 跨域通讯</h2>
<p>我们经过千辛万苦经过加密终于能做到通讯安全了。 当然我们的下一步是通过JSONP 的get通讯来实现跨域通讯啦。 经过测试：我们的JS中最长的Case url长度是3956 在加上跨域url callbac参数，经过测试正好差20到4095 （一般的URI长度限制为4K）</p>
<div class="highlight"><pre><span></span><code><span class="err">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span><span class="w">  </span>
<span class="w">    </span><span class="k">type</span><span class="p">:</span><span class="s">&quot;get&quot;</span><span class="p">,</span><span class="w">  </span>
<span class="w">    </span><span class="nx">async</span><span class="p">:</span><span class="kc">false</span><span class="p">,</span><span class="w">  </span><span class="c1">// 设置同步通讯或者异步通讯</span>
<span class="w">    </span><span class="nx">url</span><span class="p">:</span><span class="s">&quot;http://22500e31b5a12457.sinaapp.com/ubtamat/getPubKey?c=hknHQKIy3dyeeajyAwZ+raUkV1ezFbgU8zk+54cNQtrcEGozUjXpYhbC6fxz2hCOgp9feIsM1xKJFm5pkAGQ2UcUOc5EJNCAz6L0mXkZbTBmh3PufWxOE7TaicqRCRtZGGNB2qpm2WruXjYg1lPcrPz/rhFZx4DSJvEHkCm7ZU0=......(加密后的结果太长，省略)&quot;</span><span class="p">,</span><span class="w">  </span>
<span class="w">    </span><span class="nx">dataType</span><span class="p">:</span><span class="s">&quot;jsonp&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">jsonp</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">,</span>
<span class="p">});</span><span class="w"> </span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="nx">header</span><span class="p">(</span><span class="s">&quot;Content-type: application/javascript; charset=utf-8&quot;</span><span class="p">);</span>
<span class="err">$</span><span class="nx">response</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;console.log(&#39;test response!&#39;)&quot;</span><span class="p">;</span>
<span class="err">$</span><span class="nx">callback</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="err">$</span><span class="nx">this</span><span class="o">-&gt;</span><span class="nx">input</span><span class="o">-&gt;</span><span class="nx">GET</span><span class="p">(</span><span class="err">&#39;</span><span class="nx">callback</span><span class="err">&#39;</span><span class="p">);</span>
<span class="nx">echo</span><span class="w"> </span><span class="err">$</span><span class="nx">callback</span><span class="p">.</span><span class="err">$</span><span class="nx">response</span><span class="p">;</span>
</code></pre></div>

<p>PHP代码是CI框架controler中的部分代码 并且经过了必要的裁剪。 更加细节的参数都放到GET里面就可以了。 处理之后按照上面的形式处理返回值就ok 如果你配置成功了，你将会在网页的控制台上看到自己动态的， 或者像我一样静态的控制台输出。 如果要是想获取数据到网页的话还是要借助<strong>回调函数</strong>来实现</p>
<h2>JSONP跨域获取通讯结果</h2>
<p>请看下面代码：</p>
<p>客户端代码</p>
<div class="highlight"><pre><span></span><code><span class="k">var</span><span class="w"> </span><span class="n">global</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb nb-Type">null</span><span class="p">;</span>
<span class="n">function</span><span class="w"> </span><span class="n">jpc</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">global</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">result</span><span class="o">.</span><span class="n">msg</span><span class="p">;</span>
<span class="p">}</span>

<span class="o">$.</span><span class="n">ajax</span><span class="p">({</span><span class="w">  </span>
<span class="w">    </span><span class="n">type</span><span class="p">:</span><span class="s2">&quot;get&quot;</span><span class="p">,</span><span class="w">  </span>
<span class="w">    </span><span class="n">async</span><span class="p">:</span><span class="bp">false</span><span class="p">,</span><span class="w">  </span><span class="o">//</span><span class="w"> </span><span class="err">设置同步通讯或者异步通讯</span>
<span class="w">    </span><span class="n">url</span><span class="p">:</span><span class="s2">&quot;http://22500e31b5a12457.sinaapp.com/ubtamat/getPubKey&quot;</span><span class="p">,</span><span class="w">  </span>
<span class="w">    </span><span class="n">dataType</span><span class="p">:</span><span class="s2">&quot;jsonp&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="n">jsonp</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;jpc&quot;</span><span class="p">,</span>
<span class="p">});</span><span class="w"> </span>
</code></pre></div>

<p>服务器端代码</p>
<div class="highlight"><pre><span></span><code><span class="nx">header</span><span class="p">(</span><span class="s">&quot;Content-type: application/javascript; charset=utf-8&quot;</span><span class="p">);</span>
<span class="err">$</span><span class="nx">response</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;jpc({&#39;msg&#39;:123456})&quot;</span><span class="p">;</span>
<span class="err">$</span><span class="nx">callback</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="err">$</span><span class="nx">this</span><span class="o">-&gt;</span><span class="nx">input</span><span class="o">-&gt;</span><span class="nx">GET</span><span class="p">(</span><span class="err">&#39;</span><span class="nx">callback</span><span class="err">&#39;</span><span class="p">);</span>
<span class="nx">echo</span><span class="w"> </span><span class="err">$</span><span class="nx">callback</span><span class="p">.</span><span class="err">$</span><span class="nx">response</span><span class="p">;</span>
</code></pre></div>

<p>此次通讯的结果会在jcp当中调用执行，并且返回的内容会记录到 global 变量当中。</p>
<h2>实战</h2>
<p>从上文中，我们已经找到了整个加密过程方法了，但是距离实战还是有一定距离的。 首先我们实战的话需要克服接口比较少，功能比较多，单个接口维护用时比较长的问题。</p>
<p>为了解决上面的问题我们做出如下设计。</p>
<h3>客户端方面：</h3>
<p>设计一个通讯类：只管跟服务器通讯。别的业务什么都不管。</p>
<div class="highlight"><pre><span></span><code><span class="o">//</span><span class="n">create</span><span class="w"> </span><span class="n">connection</span><span class="w"> </span><span class="n">object</span><span class="o">.</span>
<span class="k">var</span><span class="w"> </span><span class="n">ConnServ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="nb nb-Type">Object</span><span class="p">();</span>

<span class="n">ConnServ</span><span class="o">.</span><span class="n">tmpResponse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;not initial&quot;</span><span class="p">;</span>

<span class="o">//</span><span class="n">call</span><span class="w"> </span><span class="n">back</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="n">register</span><span class="w"> </span><span class="n">slot</span><span class="o">.</span>
<span class="n">ConnServ</span><span class="o">.</span><span class="n">CallBackFunction</span><span class="o">=</span><span class="n">function</span><span class="p">(){</span><span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
<span class="w">    </span><span class="s2">&quot;call back function set error ! U must set a business call back function!&quot;</span>
<span class="p">)};</span>

<span class="o">//</span><span class="n">input</span><span class="w"> </span><span class="n">only</span><span class="w"> </span><span class="n">encrypted</span><span class="w"> </span><span class="n">data</span><span class="o">!!!</span>
<span class="o">//</span><span class="n">send</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">server</span>
<span class="n">ConnServ</span><span class="o">.</span><span class="n">send</span><span class="o">=</span><span class="n">function</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="o">/</span>\<span class="o">+/</span><span class="n">g</span><span class="p">,</span><span class="s2">&quot;$&quot;</span><span class="p">);</span><span class="w">  </span><span class="o">//</span><span class="n">replace</span><span class="w"> </span><span class="n">all</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="o">$</span>
<span class="w">    </span><span class="o">$.</span><span class="n">ajax</span><span class="p">({</span>
<span class="w">        </span><span class="n">type</span><span class="p">:</span><span class="s2">&quot;get&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="n">async</span><span class="p">:</span><span class="bp">false</span><span class="p">,</span><span class="w">  </span>
<span class="w">        </span><span class="n">url</span><span class="p">:</span><span class="s2">&quot;http://22500e317.sinaapp.com/ubtamat?c=&quot;</span><span class="o">+</span><span class="n">data</span><span class="p">,</span>
<span class="w">        </span><span class="n">dataType</span><span class="p">:</span><span class="s2">&quot;jsonp&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="n">jsonp</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;jpc&quot;</span>
<span class="w">    </span><span class="p">});</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s2">&quot;Send Finish&quot;</span><span class="p">;</span>
<span class="p">}</span>

<span class="o">//</span><span class="n">default</span><span class="w"> </span><span class="n">call</span><span class="w"> </span><span class="n">back</span><span class="w"> </span><span class="n">funcation</span>
<span class="n">function</span><span class="w"> </span><span class="n">jpc</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">ConnServ</span><span class="o">.</span><span class="n">tmpResponse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">res</span><span class="o">.</span><span class="n">msg</span><span class="p">;</span>
<span class="w">    </span><span class="n">ConnServ</span><span class="o">.</span><span class="n">CallBackFunction</span><span class="p">();</span>
<span class="p">}</span>


<span class="o">//</span><span class="n">public</span><span class="w"> </span><span class="n">key</span><span class="w"> </span><span class="n">store</span><span class="o">.</span>
<span class="n">ConnServ</span><span class="o">.</span><span class="n">getpublickey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">function</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s2">&quot;\-&quot;</span><span class="w"> </span><span class="o">+</span>
<span class="w">        </span><span class="s2">&quot;----BEGIN PUBLIC KEY----- &quot;</span><span class="w"> </span><span class="o">+</span>
<span class="o">...................................................</span>
<span class="w">        </span><span class="s2">&quot;-----END PUBLIC KEY-----&quot;</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

<p>在上面代码中请注意，RSA加密过后的字符串当中有一个非法字符+要转换成其他合法字符发送到服务器才可以。 不然参数会错误。 等传输到服务器中自己转换回来在解密就好了。</p>
<h3>服务器端方面：</h3>
<p>首先我们接收到消息之后要对消息进行解密，之后根据报文内容选择服务器上的功能。然后把其他参数输入到业务类中执行即可。 因此我们使用了命令模式来实现单一接口的丰富业务功能。 其他的我们需要对CI框架的配置进行调整： 首先global config里面需要调整 $config['global_xss_filtering'] = FALSE; 因为如果传输过来的报文解密不了就直接抛弃不进行处理（防止CC攻击第一层）这样就从url上防止了攻击的可能性。 当然我们还是没有完全避免注入风险这时我们就需要在业务类里面调用安全模块：</p>
<div class="highlight"><pre><span></span><code><span class="w"> </span><span class="err">$</span><span class="n">this</span><span class="o">-&gt;</span><span class="n">security</span><span class="o">-&gt;</span><span class="n">xss_clean</span><span class="p">()</span>
</code></pre></div>

<p>来实现第二层的XSS攻击。这是服务器端设计主要需要说的位置。</p>
<h4>服务器获取数据处理全过程</h4>
<ol>
<li>从get接口获得参数c的加密数据</li>
<li>对数据进行RSA解密。</li>
<li>判断数据包时间戳。如果超时直接抛弃（防止从浏览器记录中直接发送request到服务器，下面是安全方面的说明）<ul>
<li>首先如果不修改数据只修改时间戳不可能从截获的数据报文中实现，因为需要重新加密，如果想得到内容需要服务器上的privatekey解密保证安全</li>
<li>如果数据包截获直接发送数据包在超时范围内直接获取数据包内容，也不能实现攻击，因为在客户端有临时RSA密匙对生成并且在发送的时候会同时发送publickey 给服务器做session的存储内容并且伪装客户的客户端没有privatekey所以获取任何关于登陆之后的消息根本无法解析。</li>
</ul>
</li>
<li>对解密后的数据进行xss检查</li>
<li>解析报文中需要调用什么功能直接调用反射得到业务类的实例</li>
<li>调度业务类，并且把得到的参数赋值给业务执行函数的参数。</li>
</ol>
<h4>服务器处理数据过程只跟业务有关</h4>
<h4>服务器返回数据全过程</h4>
<ol>
<li>业务处理完成之后针对每一个用户的登陆情况对返回值进行加密。</li>
<li>response</li>
</ol>
<h4>以上业务涉及的部分代码（给出的代码未涉及以上说的安全部分。）</h4>
<div class="highlight"><pre><span></span><code><span class="c1">//CI 控制器里面的方法</span>
<span class="n">public</span><span class="w"> </span><span class="k">function</span><span class="w"> </span><span class="n">index</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">header</span><span class="p">(</span><span class="s">&quot;Content-Type: text/html;charset=UTF-8&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="no">$</span><span class="n">callback</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="no">$</span><span class="n">this</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nb">input</span><span class="o">-&gt;</span><span class="n">GET</span><span class="p">(</span><span class="s">&#39;callback&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="no">$</span><span class="n">input_data</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">str_replace</span><span class="p">(</span><span class="s">&quot;$&quot;</span><span class="p">,</span><span class="s">&quot;+&quot;</span><span class="p">,</span><span class="no">$</span><span class="n">this</span><span class="o">-&gt;</span><span class="nb">input</span><span class="o">-&gt;</span><span class="n">GET</span><span class="p">(</span><span class="s">&#39;c&#39;</span><span class="p">));</span>
<span class="w">    </span><span class="no">$</span><span class="n">input_data</span><span class="w"> </span><span class="p">=</span><span class="no">$</span><span class="n">this</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">rsa</span><span class="o">-&gt;</span><span class="n">decrypt_data</span><span class="p">(</span><span class="no">$</span><span class="n">input_data</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="no">$</span><span class="n">input_data</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">){</span><span class="k">return</span><span class="p">;}</span><span class="c1">//如果数据不对解析就会失败，直接抛弃数据包，避免cracker构造数据包问题</span>
<span class="w">    </span><span class="c1">//这里插入时间戳检查代码</span>
<span class="w">    </span><span class="c1">//这插入xss检查</span>
<span class="w">    </span><span class="no">$</span><span class="n">output_data</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">command</span><span class="p">(</span><span class="no">$</span><span class="n">input_data</span><span class="p">);</span>
<span class="w">    </span><span class="no">$</span><span class="n">response</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;jpc({&#39;msg&#39;:&quot;</span><span class="p">.</span><span class="no">$</span><span class="n">output_data</span><span class="p">.</span><span class="s">&quot;})&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="no">$</span><span class="n">callback</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="no">$</span><span class="n">this</span><span class="o">-&gt;</span><span class="nb">input</span><span class="o">-&gt;</span><span class="n">GET</span><span class="p">(</span><span class="s">&#39;callback&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="n">echo</span><span class="w"> </span><span class="no">$</span><span class="n">callback</span><span class="p">.</span><span class="no">$</span><span class="n">response</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="c1">//命令模式中的业务调度方法</span>
<span class="k">function</span><span class="w"> </span><span class="nf">command</span><span class="p">(</span>$input<span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">try</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="no">$</span><span class="n">obj_input</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">json_decode</span><span class="p">(</span><span class="no">$</span><span class="nb">input</span><span class="p">);</span>
<span class="w">        </span><span class="no">$</span><span class="n">action</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="no">$</span><span class="n">obj_input</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;action&quot;</span><span class="p">};</span>
<span class="w">        </span><span class="no">$</span><span class="n">business_action</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">ReflectionClass</span><span class="p">(</span><span class="no">$</span><span class="n">action</span><span class="p">);</span>
<span class="w">        </span><span class="no">$</span><span class="n">instance</span><span class="w">  </span><span class="p">=</span><span class="w"> </span><span class="no">$</span><span class="n">business_action</span><span class="o">-&gt;</span><span class="n">newInstanceArgs</span><span class="p">();</span>
<span class="w">        </span><span class="no">$</span><span class="n">output</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="no">$</span><span class="n">instance</span><span class="o">-&gt;</span><span class="n">Action</span><span class="p">(</span><span class="no">$</span><span class="n">obj_input</span><span class="p">);</span>
<span class="w">        </span><span class="c1">//对output变量进行rsa加密</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;&#39;&quot;</span><span class="p">.</span><span class="no">$</span><span class="n">output</span><span class="p">.</span><span class="s">&quot;&#39;&quot;</span><span class="p">;</span><span class="w"> </span><span class="c1">// here only accept string</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">catch</span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="no">$</span><span class="n">e</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w">  </span><span class="s">&quot;&#39;&quot;</span><span class="p">.</span><span class="no">$</span><span class="n">e</span><span class="o">-&gt;</span><span class="n">getMessage</span><span class="p">().</span><span class="s">&quot;&#39;&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h4>以下是配合业务进行的工具函数：</h4>
<div class="highlight"><pre><span></span><code><span class="o">//</span><span class="err">命令接口定义</span>
<span class="n">interface</span><span class="w"> </span><span class="n">ICommand</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">function</span><span class="w"> </span><span class="n">Action</span><span class="p">(</span><span class="o">$</span><span class="n">arg_obj</span><span class="p">);</span>
<span class="p">}</span><span class="w"> </span>
<span class="o">//</span><span class="err">把此函数放到</span><span class="n">system</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">common</span><span class="o">.</span><span class="n">php</span>
<span class="o">//</span><span class="err">实现了输入一个文件夹就自动加载所有文件夹中的所有的类。</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="n">function_exists</span><span class="p">(</span><span class="s1">&#39;require_once_dir&#39;</span><span class="p">))</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">function</span><span class="w"> </span><span class="n">require_once_dir</span><span class="p">(</span><span class="o">$</span><span class="n">path</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="o">$</span><span class="n">dir_list</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">scandir</span><span class="p">(</span><span class="o">$</span><span class="n">path</span><span class="p">);</span>
<span class="w">        </span><span class="n">foreach</span><span class="p">(</span><span class="o">$</span><span class="n">dir_list</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="o">$</span><span class="n">file</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="o">$</span><span class="n">file</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s2">&quot;..&quot;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">$</span><span class="n">file</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s2">&quot;.&quot;</span><span class="w"> </span><span class="p">)</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="n">require_once</span><span class="p">(</span><span class="o">$</span><span class="n">path</span><span class="o">.</span><span class="s2">&quot;/&quot;</span><span class="o">.$</span><span class="n">file</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="o">//</span><span class="err">使用：</span>
<span class="o">//</span><span class="err">在</span><span class="n">application</span><span class="o">/</span><span class="n">config</span><span class="o">/</span><span class="n">autoload</span><span class="o">.</span><span class="n">php中添加类似如下代码</span><span class="err">：</span>
<span class="n">require_once_dir</span><span class="p">(</span><span class="n">APPPATH</span><span class="o">.</span><span class="s2">&quot;/controllers/lib&quot;</span><span class="p">);</span>
<span class="n">require_once_dir</span><span class="p">(</span><span class="n">APPPATH</span><span class="o">.</span><span class="s2">&quot;/controllers/actions&quot;</span><span class="p">);</span>
</code></pre></div>

<h4>以下是实现业务的例子：</h4>
<div class="highlight"><pre><span></span><code><span class="kd">class</span><span class="w"> </span><span class="nx">register</span><span class="w"> </span><span class="nx">implements</span><span class="w">  </span><span class="nx">ICommand</span><span class="p">{</span>
<span class="w">    </span><span class="nx">public</span><span class="w"> </span><span class="nx">function</span><span class="w"> </span><span class="nx">Action</span><span class="p">(</span><span class="err">$</span><span class="nx">arg_obj</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;we are do nothing: &quot;</span><span class="p">.</span><span class="nx">json_encode</span><span class="p">(</span><span class="err">$</span><span class="nx">arg_obj</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>通过以上基本方法，我们可以实现，只要业务继承我们声明的接口就可以开始写业务了。 别的什么都不用管，专注于业务即可，其他的安全、IO等问题都已经一并解决。 并且每一个业务都进行了rsa加密xss攻击过滤伪造数据包攻击。 以及在response加密只能是固定客户端才能看到报文内容的全过程。 但是一定要注意一点，注册这个业务后面要嵌套登陆进行，不然看不到返回值。</p>
<h4>数据包必须包含的要素：</h4>
<ol>
<li>acton （业务名）</li>
<li>req_time (请求时间)</li>
<li>public_key (如果是注册跟登陆时候需要提交临时公匙)</li>
</ol>
<h2>总结</h2>
<p>因为时间仓促所以只能写到这里了。 如果您发现了我文章中的bug欢迎发email批评指正。非常感谢！ 同时本方案也会成为我们开源社区linux52.com后台系统中的接口设计方案。 当然我们社区所有维护的文档都会进行反复验证，如果出问题我们会及时更新。 以维护文档的正确性。 点击<a href="https://github.com/lijianying10/FixLinux/blob/master/prob/PHP-RSA%E5%8A%A0%E5%AF%86%E8%B7%A8%E5%9F%9F%E9%80%9A%E8%AE%AF%E5%AE%9E%E6%88%98.md">=这=里=</a>查看文档最新版本。</p>
<p>关键词</p>
    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>links</h2>
                        <ul>
                            <li><a href="https://getpelican.com/">Pelican</a></li>
                            <li><a href="https://www.python.org/">Python.org</a></li>
                            <li><a href="https://palletsprojects.com/p/jinja/">Jinja2</a></li>
                            <li><a href="#">You can modify those links in your config file</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>

                            <li><a href="#">You can add links in your config file</a></li>
                            <li><a href="#">Another social link</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a rel="nofollow" href="https://getpelican.com/">Pelican</a>, which takes great advantage of <a rel="nofollow" href="https://www.python.org/">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a rel="nofollow" href="https://www.smashingmagazine.com/2009/08/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>