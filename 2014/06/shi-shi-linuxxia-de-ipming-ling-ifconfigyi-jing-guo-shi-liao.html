<!DOCTYPE html>
<html lang="zh">
<head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="generator" content="Pelican" />
        <title>试试Linux下的ip命令，ifconfig已经过时了</title>
        <link rel="stylesheet" href="/theme/css/main.css" />
        <meta name="description" content="Author: '' linux的ip命令和ifconfig类似，但前者功能更强大，并旨在取代后者。使用ip命令，只需一个命令，你就能很轻松地执行一些网络管理任务 …" />
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">linux_cn</a></h1>
                <nav><ul>
                    <li><a href="/category/chuan-shan-jia-zhuan-fang">穿山甲专访</a></li>
                    <li><a href="/category/dai-ma-ying-xiong">代码英雄</a></li>
                    <li><a href="/category/fen-xiang">分享</a></li>
                    <li><a href="/category/guan-dian">观点</a></li>
                    <li><a href="/category/huo-dong">活动</a></li>
                    <li><a href="/category/ji-ke-man-hua">极客漫画</a></li>
                    <li class="active"><a href="/category/ji-zhu">技术</a></li>
                    <li><a href="/category/kai-yuan-zhi-hui">开源智慧</a></li>
                    <li><a href="/category/linux-fa-xing-ban">Linux 发行版</a></li>
                    <li><a href="/category/mei-ri-an-quan-zi-xun">每日安全资讯</a></li>
                    <li><a href="/category/misc">Misc</a></li>
                    <li><a href="/category/qu-kuai-lian">区块链</a></li>
                    <li><a href="/category/rong-qi-yu-yun">容器与云</a></li>
                    <li><a href="/category/ruan-jian-kai-fa">软件开发</a></li>
                    <li><a href="/category/shu-mei-pai">树莓派</a></li>
                    <li><a href="/category/xi-tong-yun-wei">系统运维</a></li>
                    <li><a href="/category/xin-wen">新闻</a></li>
                    <li><a href="/category/ying-he-guan-cha">硬核观察</a></li>
                    <li><a href="/category/zhi-ye-sheng-ya">职业生涯</a></li>
                    <li><a href="/category/zhong-jiang-ming-dan">中奖名单</a></li>
                    <li><a href="/category/zhuo-mian-ying-yong">桌面应用</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="/2014/06/shi-shi-linuxxia-de-ipming-ling-ifconfigyi-jing-guo-shi-liao.html" rel="bookmark"
           title="Permalink to 试试Linux下的ip命令，ifconfig已经过时了">试试Linux下的ip命令，ifconfig已经过时了</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2014-06-04T09:00:00+02:00">
                Published: Wed 04 June 2014
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/linux-fans-from-china.html">linux fans from china</a>
        </address>
<p>In <a href="/category/ji-zhu">技术</a>.</p>

</footer><!-- /.post-info -->      <p>Author: ''</p>
<p>linux的<strong>ip</strong>命令和<strong>ifconfig</strong>类似，但前者功能更强大，并旨在取代后者。使用ip命令，只需一个命令，你就能很轻松地执行一些网络管理任务。ifconfig是net-tools中已被废弃使用的一个命令，许多年前就已经没有维护了。iproute2套件里提供了许多增强功能的命令，ip命令即是其中之一。</p>
<p><img alt="Net tools vs Iproute2" src="/data/attachment/album/201406/04/003404uy9l1t5zayzllylm.png"></p>
<p>要安装ip，请<a href="http://www.linuxgrill.com/anonymous/iproute2/NEW-OSDL/">点击这里</a>下载<strong>iproute2套装工具</strong> 。不过，大多数Linux发行版已经预装了iproute2工具。</p>
<p>你也可以使用git命令来下载最新源代码来编译：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>git<span class="w"> </span>clone<span class="w"> </span>https://kernel.googlesource.com/pub/scm/linux/kernel/git/shemminger/iproute2.git
</code></pre></div>

<p><img alt="iproute2 git clone" src="/data/attachment/album/201406/04/003410tpix2804k660lwu4.png"></p>
<h3>设置和删除Ip地址</h3>
<p>要给你的机器设置一个IP地址，可以使用下列ip命令：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>sudo<span class="w"> </span>ip<span class="w"> </span>addr<span class="w"> </span>add<span class="w"> </span><span class="m">192</span>.168.0.193/24<span class="w"> </span>dev<span class="w"> </span>wlan0
</code></pre></div>

<p>请注意IP地址要有一个后缀，比如/24。这种用法用于在无类域内路由选择（CIDR）中来显示所用的子网掩码。在这个例子中，子网掩码是255.255.255.0。</p>
<p>在你按照上述方式设置好IP地址后，需要查看是否已经生效。</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>ip<span class="w"> </span>addr<span class="w"> </span>show<span class="w"> </span>wlan0
</code></pre></div>

<p><img alt="set ip address" src="/data/attachment/album/201406/04/003411qp4xsem5491ee49t.png"></p>
<p>你也可以使用相同的方式来删除IP地址，只需用del代替add。</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>sudo<span class="w"> </span>ip<span class="w"> </span>addr<span class="w"> </span>del<span class="w"> </span><span class="m">192</span>.168.0.193/24<span class="w"> </span>dev<span class="w"> </span>wlan0
</code></pre></div>

<p><img alt="delete ip address" src="/data/attachment/album/201406/04/003412dottfn0jnidyykd2.png"></p>
<h3>列出路由表条目</h3>
<p>ip命令的路由对象的参数还可以帮助你查看网络中的路由数据，并设置你的路由表。第一个条目是默认的路由条目，你可以随意改动它。</p>
<p>在这个例子中，有几个路由条目。这个结果显示有几个设备通过不同的网络接口连接起来。它们包括WIFI、以太网和一个点对点连接。</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>ip<span class="w"> </span>route<span class="w"> </span>show
</code></pre></div>

<p><img alt="ip route show" src="/data/attachment/album/201406/04/003413mnehm4uinhziu287.png"></p>
<p>假设现在你有一个IP地址，你需要知道路由包从哪里来。可以使用下面的路由选项（译注：列出了路由所使用的接口等）：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>ip<span class="w"> </span>route<span class="w"> </span>get<span class="w"> </span><span class="m">10</span>.42.0.47
</code></pre></div>

<p><img alt="ip route get" src="/data/attachment/album/201406/04/003414h53e34qwjfo34emm.png"></p>
<h3>更改默认路由</h3>
<p>要更改默认路由，使用下面ip命令：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>sudo<span class="w"> </span>ip<span class="w"> </span>route<span class="w"> </span>add<span class="w"> </span>default<span class="w"> </span>via<span class="w"> </span><span class="m">192</span>.168.0.196
</code></pre></div>

<p><img alt="default route" src="/data/attachment/album/201406/04/003415i8d82ulsa4c4jcd4.png"></p>
<h3>显示网络统计数据</h3>
<p>使用ip命令还可以显示不同网络接口的统计数据。</p>
<p><img alt="ip statistics all interfaces" src="/data/attachment/album/201406/04/003417l1jc4h5537m050wy.png"></p>
<p>当你需要获取一个特定网络接口的信息时，在网络接口名字后面添加选项<strong>ls</strong>即可。使用多个选项<strong>-s</strong>会给你这个特定接口更详细的信息。特别是在排除网络连接故障时，这会非常有用。</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>ip<span class="w"> </span>-s<span class="w"> </span>-s<span class="w"> </span>link<span class="w"> </span>ls<span class="w"> </span>p2p1
</code></pre></div>

<p><img alt="ip link statistics" src="/data/attachment/album/201406/04/003418acoo0krhjellollu.png"></p>
<h3>ARP条目</h3>
<p>地址解析协议（ARP）用于将一个IP地址转换成它对应的物理地址，也就是通常所说的MAC地址。使用ip命令的neigh或者neighbour选项，你可以查看接入你所在的局域网的设备的MAC地址。</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>ip<span class="w"> </span>neighbour
</code></pre></div>

<p><img alt="ip neighbour" src="/data/attachment/album/201406/04/003419uzm96tbvujb5bvqe.png"></p>
<h3>监控netlink消息</h3>
<p>也可以使用ip命令查看netlink消息。monitor选项允许你查看网络设备的状态。比如，所在局域网的一台电脑根据它的状态可以被分类成REACHABLE或者STALE。使用下面的命令：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>ip<span class="w"> </span>monitor<span class="w"> </span>all
</code></pre></div>

<p><img alt="ip monitor all" src="/data/attachment/album/201406/04/003420ap2j3jjvjk3jvvoo.png"></p>
<h3>激活和停止网络接口</h3>
<p>你可以使用ip命令的up和down选项来激某个特定的接口，就像ifconfig的用法一样。</p>
<p>在这个例子中，当ppp0接口被激活和在它被停止和再次激活之后，你可以看到相应的路由表条目。这个接口可能是wlan0或者eth0。将ppp0更改为你可用的任意接口即可。</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>sudo<span class="w"> </span>ip<span class="w"> </span>link<span class="w"> </span><span class="nb">set</span><span class="w"> </span>ppp0<span class="w"> </span>down

$<span class="w"> </span>sudo<span class="w"> </span>ip<span class="w"> </span>link<span class="w"> </span><span class="nb">set</span><span class="w"> </span>ppp0<span class="w"> </span>up
</code></pre></div>

<p><img alt="ip link set up and down" src="/data/attachment/album/201406/04/003421mdudvkazcgkl6g8d.png"></p>
<h3>获取帮助</h3>
<p>当你陷入困境，不知道某一个特定的选项怎么用的时候，你可以使用help选项。man页面并不会提供许多关于如何使用ip选项的信息，因此这里就是获取帮助的地方。</p>
<p>比如，想知道关于route选项更多的信息：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>ip<span class="w"> </span>route<span class="w"> </span><span class="nb">help</span>
</code></pre></div>

<p><img alt="ip route help" src="/data/attachment/album/201406/04/003422xh9xm2wihecdjhif.png"></p>
<h3>小结</h3>
<p>对于网络管理员们和所有的Linux使用者们，ip命令是必备工具。是时候抛弃ifconfig命令了，特别是当你写脚本时。</p>
    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>links</h2>
                        <ul>
                            <li><a href="https://getpelican.com/">Pelican</a></li>
                            <li><a href="https://www.python.org/">Python.org</a></li>
                            <li><a href="https://palletsprojects.com/p/jinja/">Jinja2</a></li>
                            <li><a href="#">You can modify those links in your config file</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>

                            <li><a href="#">You can add links in your config file</a></li>
                            <li><a href="#">Another social link</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a rel="nofollow" href="https://getpelican.com/">Pelican</a>, which takes great advantage of <a rel="nofollow" href="https://www.python.org/">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a rel="nofollow" href="https://www.smashingmagazine.com/2009/08/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>