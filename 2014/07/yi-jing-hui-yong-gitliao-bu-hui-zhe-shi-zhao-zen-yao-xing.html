<!DOCTYPE html>
<html lang="zh">
<head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="generator" content="Pelican" />
        <title>已经会用Git了？不会这十招怎么行</title>
        <link rel="stylesheet" href="/theme/css/main.css" />
        <meta name="description" content="Author: Shaumik Daityari 之前我们发了一些教程让你熟悉Git基础和在团队合作环境中使用Git.我们讨论的这些Git命令足够让一个开发者在Git的世界里生存下去。在这篇教程里，我们试着探索 …" />
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">linux_cn</a></h1>
                <nav><ul>
                    <li><a href="/category/chuan-shan-jia-zhuan-fang">穿山甲专访</a></li>
                    <li><a href="/category/dai-ma-ying-xiong">代码英雄</a></li>
                    <li><a href="/category/fen-xiang">分享</a></li>
                    <li><a href="/category/guan-dian">观点</a></li>
                    <li><a href="/category/huo-dong">活动</a></li>
                    <li><a href="/category/ji-ke-man-hua">极客漫画</a></li>
                    <li><a href="/category/ji-zhu">技术</a></li>
                    <li><a href="/category/kai-yuan-zhi-hui">开源智慧</a></li>
                    <li><a href="/category/linux-fa-xing-ban">Linux 发行版</a></li>
                    <li><a href="/category/mei-ri-an-quan-zi-xun">每日安全资讯</a></li>
                    <li><a href="/category/misc">Misc</a></li>
                    <li><a href="/category/qu-kuai-lian">区块链</a></li>
                    <li><a href="/category/rong-qi-yu-yun">容器与云</a></li>
                    <li class="active"><a href="/category/ruan-jian-kai-fa">软件开发</a></li>
                    <li><a href="/category/shu-mei-pai">树莓派</a></li>
                    <li><a href="/category/xi-tong-yun-wei">系统运维</a></li>
                    <li><a href="/category/xin-wen">新闻</a></li>
                    <li><a href="/category/ying-he-guan-cha">硬核观察</a></li>
                    <li><a href="/category/zhi-ye-sheng-ya">职业生涯</a></li>
                    <li><a href="/category/zhong-jiang-ming-dan">中奖名单</a></li>
                    <li><a href="/category/zhuo-mian-ying-yong">桌面应用</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="/2014/07/yi-jing-hui-yong-gitliao-bu-hui-zhe-shi-zhao-zen-yao-xing.html" rel="bookmark"
           title="Permalink to 已经会用Git了？不会这十招怎么行">已经会用Git了？不会这十招怎么行</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2014-07-25T15:24:00+02:00">
                Published: Fri 25 July 2014
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/linux-fans-from-china.html">linux fans from china</a>
        </address>
<p>In <a href="/category/ruan-jian-kai-fa">软件开发</a>.</p>

</footer><!-- /.post-info -->      <p>Author: Shaumik Daityari</p>
<p>之前我们发了一些教程让你熟悉<a href="http://www.sitepoint.com/git-for-beginners/">Git基础</a>和<a href="http://www.sitepoint.com/getting-started-git-team-environment/">在团队合作环境中使用Git</a>.我们讨论的这些Git命令足够让一个开发者在Git的世界里生存下去。在这篇教程里，我们试着探索如何高效地管理你的时间以及如何充分利用Git提供的特性。</p>
<p><img alt="" src="/data/attachment/album/201407/25/152443ax2ruxfx1e04fr1g.png"></p>
<blockquote>
<p>注意：这里介绍的命令中有的包含方括号(例如：git add -p [file_name])。在这些例子中，你应该用你自己的数字、标识符等替代方括号里的内容，并且去掉方括号。</p>
</blockquote>
<h3>1. Git自动补全</h3>
<p>如果你在命令行环境中运行Git命令，每次都手动地逐个输入命令是一件很无聊的事。为此，你可以花几分钟时间配置一下Git命令的自动补全功能。</p>
<p>在*nix系统运行下列命令下载自动补全脚本：</p>
<div class="highlight"><pre><span></span><code>cd ~
curl https://raw.github.com/git/git/master/contrib/completion/git-completion.bash -o ~/.git-completion.bash
</code></pre></div>

<p>然后，添加下面的行到你的~/.bash_profile文件：</p>
<div class="highlight"><pre><span></span><code><span class="k">if</span><span class="w"> </span>[<span class="w"> </span><span class="o">-</span><span class="nv">f</span><span class="w"> </span><span class="o">~/</span>.<span class="nv">git</span><span class="o">-</span><span class="nv">completion</span>.<span class="nv">bash</span><span class="w"> </span>]<span class="c1">; then</span>
<span class="w">    </span>.<span class="w"> </span><span class="o">~/</span>.<span class="nv">git</span><span class="o">-</span><span class="nv">completion</span>.<span class="nv">bash</span>
<span class="nv">fi</span>
</code></pre></div>

<p>尽管我之前已经提到过，但我还是想再强调一下：如果你想使用完整的Git特性，你绝bi应该切换到命令行环境。</p>
<h3>2. 在Git中忽略文件</h3>
<p>你是不是对出现在你Git库里面的编译生成文件（比如.pyc)感到很无语？或者你是不是很厌恶不小心将他们添加到了Git？直接看这里，这里有一个方法可以让你告诉Git忽略所有这些文件和目录。只需要创建一个名字为.gitignore的文件，里面列出你不想要Git跟踪的文件和目录。可以用感叹号(!)列出例外情况。</p>
<div class="highlight"><pre><span></span><code><span class="o">*</span><span class="p">.</span><span class="n">pyc</span>
<span class="o">*</span><span class="p">.</span><span class="n">exe</span>
<span class="n">my_db_config</span><span class="o">/</span>

<span class="sx">!main.pyc</span>
</code></pre></div>

<h3>3. 谁动了我的代码？</h3>
<p>当事情出了乱子时立马责怪别人这是人类的天性。如果你的服务器程序不能正常工作了，要找出罪魁祸首是非常简单的--只需要执行git blame。这个命令告诉你文件里的每一行的作者是谁，最后改动那一行的提交，以及提交的时间戳。</p>
<div class="highlight"><pre><span></span><code><span class="n">git</span><span class="w"> </span><span class="n">blame</span><span class="w"> </span><span class="o">[</span><span class="n">file_name</span><span class="o">]</span>
</code></pre></div>

<p><img alt="git blame demonstration" src="/data/attachment/album/201407/25/152454j21c8f0lq1d8oaft.png"></p>
<p>在下面的截图里，你可以看到在一个更大的库里这个命令的输出是什么样的：</p>
<p><img alt="git blame on the ATutor repository" src="/data/attachment/album/201407/25/152455nmtyrim99x29pgbv.png"></p>
<h3>4. 查看库的历史</h3>
<p>在之前的教程里，我们已经看过了如何使用git log命令。不管怎样，有3个选项你应该知道。</p>
<ul>
<li><strong>--oneline</strong> - 压缩每次的提交信息，只保留一个缩减的Hash值和说明文字，然后把这些都展示在一行里。</li>
<li><strong>--graph</strong> - 这个选项将在左边画出一个文字界面的提交历史图。如果你只有一个分支，用这个选项查看历史时是没什么意义的。</li>
<li><strong>--all</strong> - 显示所有分支历史。</li>
</ul>
<p>这是这3个选项合起来使用的效果：</p>
<p><img alt="Use of git log with all, graph and oneline" src="/data/attachment/album/201407/25/152457thz97ry9wvrlymva.png"></p>
<h3>5. 不要丢失对某个提交的跟踪</h3>
<p>假设你提交了一些不需要的东西，然后你进行了hard重置回到之前的状态。后来，你发现在这个过程中你丢失了其他一些重要的信息，你想要把这些信息找回来，或者至少可以查看一下这些信息。这就需要git reflog帮忙。</p>
<p>简单的git log只能告诉你最近的提交，这个提交的父提交，父提交的父提交，等等。但是git reflog是一个HEAD指向的提交的列表。记住，这个列表依赖于你自己的本地操作环境，它不是库的一部分，也不包含在push或者merge中。</p>
<p>如果执行git log命令，可以看到提交历史，这是我的库的一部分：</p>
<p><img alt="Project history" src="/data/attachment/album/201407/25/152458ml32qjhp2l92pbbl.png"></p>
<p>但是，git reflog命令显示了一个被我用hard重置丢掉的提交(b1b0ee9-HEAD@{4}).</p>
<p><img alt="Git reflog" src="/data/attachment/album/201407/25/152459c0nnz0koew230f3f.png"></p>
<h3>6. 暂存文件的一部分更改以便进行一次提交</h3>
<p>通常依据特性来提交是一个好的实践方法，意思是说，每一个提交都只添加一个特性或者修复一个bug。想一下如果你一次修复了两个bug或者添加了两个特性但是都还没有逐个提交该怎么办。这种场景下，你可以将他们一起提交。但是有一个更好的办法：单独暂存这些文件，然后分开提交。</p>
<p>让我们假设你对一个文件做了多个更改，然后想让这些更改分开提交。这时，我们用带-p的添加命令。</p>
<div class="highlight"><pre><span></span><code><span class="n">git</span><span class="w"> </span><span class="k">add</span><span class="w"> </span><span class="o">-</span><span class="n">p</span><span class="w"> </span><span class="o">[</span><span class="n">file_name</span><span class="o">]</span>
</code></pre></div>

<p>我们来试试这种用法。我添加了3个新行到file_name，但是我只想让第1行和第3行出现在我的提交里。让我们看看git diff的输出是什么样的。</p>
<p><img alt="Changes in repo" src="/data/attachment/album/201407/25/152501o1e42jzudqqvatov.png"></p>
<p>然后，我们看看带-p选项的add命令会发生什么。</p>
<p><img alt="Running add with -p" src="/data/attachment/album/201407/25/152501xowhsrhs5os8o8cs.png"></p>
<p>看起来Git认为所有的更改都是同一个目的的一部分，所以把他们分组到同一个块里。这时，你可以：</p>
<ul>
<li>输入 y 暂存块</li>
<li>输入 n 不暂存块</li>
<li>输入 e 手动编辑块</li>
<li>输入 d 退出或者跳转到下一个文件</li>
<li>输入 s 分割块</li>
</ul>
<p>在我们这个例子中，我们想把这个块分割成更小的部分，然后选择其中一些忽略另外一些。</p>
<p><img alt="Adding all hunks" src="/data/attachment/album/201407/25/152502i8oqqez9qelq89hd.png"></p>
<p>如你所见，我们已经逐个添加了第1和第3行，忽略了第2行。你可以看到库的状态并且进行一次提交。</p>
<p><img alt="Repository after selectively adding a file" src="/data/attachment/album/201407/25/152503y10h36hwh3g6ug60.png"></p>
<h3>7. 合并多个提交</h3>
<p>为了进行核查或者发起一个合并请求（这经常发生在开源项目里），对代码进行了修改提交。但在最后代码被接受之前，你也许会需要修改你的代码。于是你修改代码，但是下一次核查的时候又一次需要进行修改。不知不觉中，你就已经有了好几个提交。理论上你应该用rebase命令把他们合并起来。</p>
<div class="highlight"><pre><span></span><code><span class="n">git</span><span class="w"> </span><span class="n">rebase</span><span class="w"> </span><span class="o">-</span><span class="n">i</span><span class="w"> </span><span class="n">HEAD</span><span class="o">~[</span><span class="n">number_of_commits</span><span class="o">]</span>
</code></pre></div>

<p>如果你想合并最后的两次提交，你应该运行下面的命令。</p>
<div class="highlight"><pre><span></span><code>git rebase -i HEAD~2
</code></pre></div>

<p>一旦你运行这个命令，你将进入一个交互式界面，它将询问你想要合并哪些提交。你pick(拣选)最近的提交然后squash(合并)旧的提交。</p>
<p><img alt="Git squash interactive" src="/data/attachment/album/201407/25/152505mqp4h0rn0qyrrlnu.png"></p>
<p>接着你应该提供一个对新提交的说明。这个过程会重写你的提交历史。</p>
<p><img alt="Adding a commit message" src="/data/attachment/album/201407/25/152506c0bbw0xz39094vnb.png"></p>
<h3>8. 储藏没有提交的更改</h3>
<p>假设你正在修复一个bug或者添加一个特性，突然你被要求展示一下你的工作成果。你现在的工作还没有完成，不够进行一次提交。这时，git stash命令可以用来急救一下。Stash命令跟踪你所有的更改，然后把他们储藏起来以便以后使用。命令如下-</p>
<div class="highlight"><pre><span></span><code>git stash
</code></pre></div>

<p>可以多次储藏更改，查看储藏列表，你可以运行下面的命令：</p>
<div class="highlight"><pre><span></span><code>git stash list
</code></pre></div>

<p><img alt="Stash list" src="/data/attachment/album/201407/25/152507n5fn0pfsnv3lvpv2.png"></p>
<p>如果你想取消储藏，覆盖当前的更改，你可以通过下面的命令使用储藏：</p>
<div class="highlight"><pre><span></span><code>git stash apply
</code></pre></div>

<p>在最后的这个截图里，你可以看到每个储藏都有一个标识符，是一个唯一的数字（尽管在这里我们只有一个储藏）。如果你想使用某个储藏，你在apply命令后面加上这个唯一的标识符：</p>
<div class="highlight"><pre><span></span><code>git stash apply stash@{2}
</code></pre></div>

<p><img alt="After un-stashing changes" src="/data/attachment/album/201407/25/152508my1owq1wi0o54i1m.png"></p>
<h3>9. 检查丢失的提交</h3>
<p>尽管reflog是一种检查丢失提交的方法，大型的库里却不太实用。这个时候，应该用fsck（文件系统检查）命令。</p>
<div class="highlight"><pre><span></span><code>git fsck --lost-found
</code></pre></div>

<p><img alt="Git fsck results" src="/data/attachment/album/201407/25/152509v9ontu9t93889yuc.png"></p>
<p>这里你可以看到一个丢失的提交。你可以通过git show [commit_hash] 查看提交的更改或者通过运行git merge [commit_hash]命令进行恢复。</p>
<p>git fsck跟reflog命令相比有一个优点。假设你删除了一个远程分支，然后clone了这个库。用fsck命令你可以找到并且恢复这个删除的远程分支。</p>
<h3>10. 最佳选择</h3>
<p>之前我已经存记下了那些最优雅的Git命令。但是目前为止，cherry-pick命令是我最喜欢的Git命令，因为它直白的名字和实用的功能！</p>
<p>最简单的情况下，cherry-pick从另一个分支里选出单独的一个提交，然后合并到当前分支。如果你正并行工作在两个或者更多的分支上，你也许会发现一个存在于所有分支上的bug。如果你解决了一个分支上的这个bug，你可以拣选这个对应的提交应用到其他分支上，而不会弄乱其他文件或者提交。</p>
<p>让我们来考虑一个可以使用这个命令的场景。我有两个分支，我想拣选b20fd14: Cleaned junk这个提交到另一个分支上。</p>
<p><img alt="Before cherry pick" src="/data/attachment/album/201407/25/152510wicskwnd92svw9ez.png"></p>
<p>我切换到想要应用这个拣选出来的提交的分支，然后运行下面的命令：</p>
<div class="highlight"><pre><span></span><code><span class="n">git</span><span class="w"> </span><span class="n">cherry</span><span class="o">-</span><span class="n">pick</span><span class="w"> </span><span class="o">[</span><span class="n">commit_hash</span><span class="o">]</span>
</code></pre></div>

<p><img alt="After cherry pick" src="/data/attachment/album/201407/25/152511n7tjnt4jvhz070h7.png"></p>
<p>尽管这次我们很干净的用了cherry-pick命令，但你应该知道这个命令经常会引起冲突，所以请小心使用。</p>
<h3>总结</h3>
<p>到了这里，我们结束了这个能使你Git能力提升一个级别的列表。Git是最好的版本控制器，它能完成你能想象到的任何事情。所以，经常试着用Git挑战你自己。一不小心你就会学到很多新东西。</p>
    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>links</h2>
                        <ul>
                            <li><a href="https://getpelican.com/">Pelican</a></li>
                            <li><a href="https://www.python.org/">Python.org</a></li>
                            <li><a href="https://palletsprojects.com/p/jinja/">Jinja2</a></li>
                            <li><a href="#">You can modify those links in your config file</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>

                            <li><a href="#">You can add links in your config file</a></li>
                            <li><a href="#">Another social link</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a rel="nofollow" href="https://getpelican.com/">Pelican</a>, which takes great advantage of <a rel="nofollow" href="https://www.python.org/">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a rel="nofollow" href="https://www.smashingmagazine.com/2009/08/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>