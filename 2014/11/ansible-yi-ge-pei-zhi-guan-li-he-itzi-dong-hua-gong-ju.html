<!DOCTYPE html>
<html lang="zh">
<head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="generator" content="Pelican" />
        <title>Ansible ：一个配置管理和IT自动化工具</title>
        <link rel="stylesheet" href="/theme/css/main.css" />
        <meta name="description" content="Author: Nix Craft 今天我来谈谈 ansible，一个由 Python 编写的强大的配置管理解决方案。尽管市面上已经有很多可供选择的配置管理解决方 …" />
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">linux_cn</a></h1>
                <nav><ul>
                    <li><a href="/category/chuan-shan-jia-zhuan-fang">穿山甲专访</a></li>
                    <li><a href="/category/dai-ma-ying-xiong">代码英雄</a></li>
                    <li><a href="/category/fen-xiang">分享</a></li>
                    <li><a href="/category/guan-dian">观点</a></li>
                    <li><a href="/category/huo-dong">活动</a></li>
                    <li><a href="/category/ji-ke-man-hua">极客漫画</a></li>
                    <li><a href="/category/ji-zhu">技术</a></li>
                    <li><a href="/category/kai-yuan-zhi-hui">开源智慧</a></li>
                    <li><a href="/category/linux-fa-xing-ban">Linux 发行版</a></li>
                    <li><a href="/category/mei-ri-an-quan-zi-xun">每日安全资讯</a></li>
                    <li><a href="/category/misc">Misc</a></li>
                    <li><a href="/category/qu-kuai-lian">区块链</a></li>
                    <li><a href="/category/rong-qi-yu-yun">容器与云</a></li>
                    <li><a href="/category/ruan-jian-kai-fa">软件开发</a></li>
                    <li><a href="/category/shu-mei-pai">树莓派</a></li>
                    <li class="active"><a href="/category/xi-tong-yun-wei">系统运维</a></li>
                    <li><a href="/category/xin-wen">新闻</a></li>
                    <li><a href="/category/ying-he-guan-cha">硬核观察</a></li>
                    <li><a href="/category/zhi-ye-sheng-ya">职业生涯</a></li>
                    <li><a href="/category/zhong-jiang-ming-dan">中奖名单</a></li>
                    <li><a href="/category/zhuo-mian-ying-yong">桌面应用</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="/2014/11/ansible-yi-ge-pei-zhi-guan-li-he-itzi-dong-hua-gong-ju.html" rel="bookmark"
           title="Permalink to Ansible ：一个配置管理和IT自动化工具">Ansible ：一个配置管理和IT自动化工具</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2014-11-13T16:04:30+01:00">
                Published: Thu 13 November 2014
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/linux-fans-from-china.html">linux fans from china</a>
        </address>
<p>In <a href="/category/xi-tong-yun-wei">系统运维</a>.</p>

</footer><!-- /.post-info -->      <p>Author: Nix Craft</p>
<p><img alt="" src="/data/attachment/album/201411/13/160434wtgc5zv1ggh10qki.png"></p>
<p>今天我来谈谈 ansible，一个由 Python 编写的强大的配置管理解决方案。尽管市面上已经有很多可供选择的配置管理解决方案，但他们各有优劣，而 ansible 的特点就在于它的简洁。让 ansible 在主流的配置管理系统中与众不同的一点便是，它并不需要你在想要配置的每个节点上安装自己的组件。同时提供的一个优点在于，如果需要的话，你可以在不止一个地方控制你的整个基础架构。最后一点是它的正确性，或许这里有些争议，但是我认为在大多数时候这仍然可以作为它的一个优点。说得足够多了，让我们来着手在 RHEL/CentOS 和基于 Debian/Ubuntu 的系统中安装和配置 Ansible。</p>
<h3>准备工作</h3>
<ol>
<li>发行版：RHEL/CentOS/Debian/Ubuntu Linux</li>
<li>Jinja2：Python 的一个对设计师友好的现代模板语言</li>
<li>PyYAML：Python 的一个 YAML 编码/反编码函数库</li>
<li>paramiko：纯 Python 编写的 SSHv2 协议函数库 （译者注：原文对函数库名有拼写错误）</li>
<li>httplib2：一个功能全面的 HTTP 客户端函数库</li>
<li>本文中列出的绝大部分操作已经假设你将在 bash 或者其他任何现代的 shell 中以 root 用户执行。</li>
</ol>
<h3>Ansible 如何工作</h3>
<p>Ansible 工具并不使用守护进程，它也不需要任何额外的自定义安全架构，因此它的部署可以说是十分容易。你需要的全部东西便是 SSH 客户端和服务器了。</p>
<div class="highlight"><pre><span></span><code><span class="c"> </span><span class="nb">+-----------------+</span><span class="c">                    </span><span class="nb">+---------------+</span>
<span class="c"> |安装了 Ansible 的|       SSH          | 文件服务器1   |</span>
<span class="c"> |Linux/Unix 工作站|</span><span class="nv">&lt;</span><span class="nb">------------------</span><span class="nv">&gt;</span><span class="c">| 数据库服务器2 | 在本地或远程</span>
<span class="c"> </span><span class="nb">+-----------------+</span><span class="c">       模块         | 代理服务器3   | 数据中心的</span>
<span class="c">    192</span><span class="nt">.</span><span class="c">168</span><span class="nt">.</span><span class="c">1</span><span class="nt">.</span><span class="c">100                       </span><span class="nb">+---------------+</span><span class="c"> Unix/Linux 服务器</span>
</code></pre></div>

<p>其中：</p>
<ol>
<li>192.168.1.100 - 在你本地的工作站或服务器上安装 Ansible。</li>
<li>文件服务器1到代理服务器3 - 使用 192.168.1.100 和 Ansible 来自动管理所有的服务器。</li>
<li>SSH - 在 192.168.1.100 和本地/远程的服务器之间设置 SSH 密钥。</li>
</ol>
<h3>Ansible 安装教程</h3>
<p>ansible 的安装轻而易举，许多发行版的第三方软件仓库中都有现成的软件包，可以直接安装。其他简单的安装方法包括使用 pip 安装它，或者从 github 里获取最新的版本。若想使用你的软件包管理器安装，在<a href="http://www.cyberciti.biz/faq/fedora-sl-centos-redhat6-enable-epel-repo/">基于 RHEL/CentOS Linux 的系统里你很可能需要 EPEL 仓库</a>。</p>
<h4>在基于 RHEL/CentOS Linux 的系统中安装 ansible</h4>
<p>输入如下 <a href="http://www.cyberciti.biz/faq/rhel-centos-fedora-linux-yum-command-howto/">yum 命令</a>:</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>sudo<span class="w"> </span>yum<span class="w"> </span>install<span class="w"> </span>ansible
</code></pre></div>

<h4>在基于 Debian/Ubuntu Linux 的系统中安装 ansible</h4>
<p>输入如下 <a href="http://www.cyberciti.biz/tips/linux-debian-package-management-cheat-sheet.html">apt-get 命令</a>:</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>software-properties-common
$<span class="w"> </span>sudo<span class="w"> </span>apt-add-repository<span class="w"> </span>ppa:ansible/ansible
$<span class="w"> </span>sudo<span class="w"> </span>apt-get<span class="w"> </span>update
$<span class="w"> </span>sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>ansible
</code></pre></div>

<h4>使用 pip 安装 ansible</h4>
<p><a href="http://www.cyberciti.biz/faq/debian-ubuntu-centos-rhel-linux-install-pipclient/">pip 命令是一个安装和管理 Python 软件包的工具</a>，比如它能管理 Python Package Index 中的那些软件包。如下方式在 Linux 和类 Unix 系统中通用：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>sudo<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>ansible
</code></pre></div>

<h4>从源代码安装最新版本的 ansible</h4>
<p>你可以通过如下命令从 github 中安装最新版本：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>~
$<span class="w"> </span>git<span class="w"> </span>clone<span class="w"> </span>git://github.com/ansible/ansible.git
$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>./ansible
$<span class="w"> </span><span class="nb">source</span><span class="w"> </span>./hacking/env-setup
</code></pre></div>

<p>当你从一个 git checkout 中运行 ansible 的时候，请记住你每次用它之前都需要设置你的环境，或者你可以把这个设置过程加入你的 bash rc 文件中：</p>
<div class="highlight"><pre><span></span><code><span class="c1"># 加入 BASH RC</span>
<span class="o">$</span><span class="w"> </span><span class="n">echo</span><span class="w"> </span><span class="s2">&quot;export ANSIBLE_HOSTS=~/ansible_hosts&quot;</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="o">~/.</span><span class="n">bashrc</span>
<span class="o">$</span><span class="w"> </span><span class="n">echo</span><span class="w"> </span><span class="s2">&quot;source ~/ansible/hacking/env-setup&quot;</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="o">~/.</span><span class="n">bashrc</span>
</code></pre></div>

<p>ansible 的 hosts 文件包括了一系列它能操作的主机。默认情况下 ansible 通过路径 /etc/ansible/hosts 查找 hosts 文件，不过这个行为也是可以更改的，这样当你想操作不止一个 ansible 或者针对不同的数据中心的不同客户操作的时候也是很方便的。你可以通过命令行参数 -i 指定 hosts 文件：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>ansible<span class="w"> </span>all<span class="w"> </span>-m<span class="w"> </span>shell<span class="w"> </span>-a<span class="w"> </span><span class="s2">&quot;hostname&quot;</span><span class="w"> </span>--ask-pass<span class="w"> </span>-i<span class="w"> </span>/etc/some/other/dir/ansible_hosts
</code></pre></div>

<p>不过我更倾向于使用一个环境变量，这可以在你想要通过 source 一个不同的文件来切换工作目标的时候起到作用。这里的环境变量是 $ANSIBLE_HOSTS，可以这样设置：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span><span class="nb">export</span><span class="w"> </span><span class="nv">ANSIBLE_HOSTS</span><span class="o">=</span>~/ansible_hosts
</code></pre></div>

<p>一旦所有需要的组件都已经安装完毕，而且你也准备好了你的 hosts 文件，你就可以来试一试它了。为了快速测试，这里我把 127.0.0.1 写到了 ansible 的 hosts 文件里：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;127.0.0.1&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>~/ansible_hosts
</code></pre></div>

<p>现在来测试一个简单的 ping：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>ansible<span class="w"> </span>all<span class="w"> </span>-m<span class="w"> </span>ping
</code></pre></div>

<p>或者提示 ssh 密码：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>ansible<span class="w"> </span>all<span class="w"> </span>-m<span class="w"> </span>ping<span class="w"> </span>--ask-pass
</code></pre></div>

<p>我在刚开始的设置中遇到过几次问题，因此这里强烈推荐为 ansible 设置 SSH 公钥认证。不过在刚刚的测试中我们使用了 --ask-pass，在一些机器上你会需要<a href="http://www.cyberciti.biz/faq/noninteractive-shell-script-ssh-password-provider/">安装 sshpass</a> 或者像这样指定 -c paramiko：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>ansible<span class="w"> </span>all<span class="w"> </span>-m<span class="w"> </span>ping<span class="w"> </span>--ask-pass<span class="w"> </span>-c<span class="w"> </span>paramiko
</code></pre></div>

<p>当然你也可以<a href="http://www.cyberciti.biz/faq/noninteractive-shell-script-ssh-password-provider/">安装 sshpass</a>，然而 sshpass 并不总是在标准的仓库中提供，因此 paramiko 可能更为简单。</p>
<h3>设置 SSH 公钥认证</h3>
<p>于是我们有了一份配置，以及一些基础的其他东西。现在让我们来做一些实用的事情。ansible 的强大很大程度上体现在 playbooks 上，后者基本上就是一些写好的 ansible 脚本（大部分来说），不过在制作一个 playbook 之前，我们将先从一些一句话脚本开始。现在让我们创建和配置 SSH 公钥认证，以便省去 -c 和 --ask-pass 选项：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>ssh-keygen<span class="w"> </span>-t<span class="w"> </span>rsa
</code></pre></div>

<p>样例输出：</p>
<div class="highlight"><pre><span></span><code><span class="n">Generating</span><span class="w"> </span><span class="k">public</span><span class="o">/</span><span class="n">private</span><span class="w"> </span><span class="n">rsa</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="n">pair</span><span class="p">.</span>
<span class="n">Enter</span><span class="w"> </span><span class="k">file</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">which</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="k">save</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">mike</span><span class="o">/</span><span class="p">.</span><span class="n">ssh</span><span class="o">/</span><span class="n">id_rsa</span><span class="p">)</span><span class="err">:</span>
<span class="n">Enter</span><span class="w"> </span><span class="n">passphrase</span><span class="w"> </span><span class="p">(</span><span class="n">empty</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="k">no</span><span class="w"> </span><span class="n">passphrase</span><span class="p">)</span><span class="err">:</span>
<span class="n">Enter</span><span class="w"> </span><span class="n">same</span><span class="w"> </span><span class="n">passphrase</span><span class="w"> </span><span class="nl">again</span><span class="p">:</span>
<span class="n">Your</span><span class="w"> </span><span class="n">identification</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">been</span><span class="w"> </span><span class="n">saved</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">mike</span><span class="o">/</span><span class="p">.</span><span class="n">ssh</span><span class="o">/</span><span class="n">id_rsa</span><span class="p">.</span>
<span class="n">Your</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">been</span><span class="w"> </span><span class="n">saved</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">mike</span><span class="o">/</span><span class="p">.</span><span class="n">ssh</span><span class="o">/</span><span class="n">id_rsa</span><span class="p">.</span><span class="n">pub</span><span class="p">.</span>
<span class="n">The</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="n">fingerprint</span><span class="w"> </span><span class="k">is</span><span class="err">:</span>
<span class="mi">94</span><span class="err">:</span><span class="nl">a0</span><span class="p">:</span><span class="mi">19</span><span class="err">:</span><span class="mi">02</span><span class="err">:</span><span class="nl">ba</span><span class="p">:</span><span class="mi">25</span><span class="err">:</span><span class="mi">23</span><span class="err">:</span><span class="mi">7</span><span class="nl">f</span><span class="p">:</span><span class="nl">ee</span><span class="p">:</span><span class="mi">6</span><span class="nl">c</span><span class="p">:</span><span class="nl">fb</span><span class="p">:</span><span class="nl">e8</span><span class="p">:</span><span class="mi">38</span><span class="err">:</span><span class="nl">b4</span><span class="p">:</span><span class="nl">f2</span><span class="p">:</span><span class="mi">42</span><span class="w"> </span><span class="n">mike</span><span class="nv">@ultrabook</span><span class="p">.</span><span class="n">linuxdork</span><span class="p">.</span><span class="n">com</span>
<span class="n">The</span><span class="w"> </span><span class="k">key</span><span class="err">&#39;</span><span class="n">s</span><span class="w"> </span><span class="n">randomart</span><span class="w"> </span><span class="nc">image</span><span class="w"> </span><span class="k">is</span><span class="err">:</span>
<span class="o">+--[</span><span class="n"> RSA 2048</span><span class="o">]----+</span>
<span class="o">|</span><span class="p">...</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">.</span><span class="w">          </span><span class="o">|</span>
<span class="o">|</span><span class="p">.</span><span class="w">  </span><span class="p">.</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">.</span><span class="w">       </span><span class="o">|</span>
<span class="o">|=</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="n">o</span><span class="w">   </span><span class="n">o</span><span class="w">        </span><span class="o">|</span>
<span class="o">|</span><span class="p">.</span><span class="o">*</span><span class="w">     </span><span class="p">.</span><span class="w">         </span><span class="o">|</span>
<span class="o">|</span><span class="p">.</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="p">.</span><span class="w">   </span><span class="n">S</span><span class="w">        </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="n">E</span><span class="p">.</span><span class="n">o</span><span class="w">             </span><span class="o">|</span>
<span class="o">|</span><span class="p">..</span><span class="w"> </span><span class="p">..</span><span class="w">            </span><span class="o">|</span>
<span class="o">|</span><span class="n">o</span><span class="w"> </span><span class="n">o</span><span class="o">+</span><span class="p">..</span><span class="w">           </span><span class="o">|</span>
<span class="o">|</span><span class="w"> </span><span class="o">+</span><span class="n">o</span><span class="o">+*</span><span class="n">o</span><span class="p">.</span><span class="w">          </span><span class="o">|</span>
<span class="o">+</span><span class="c1">-----------------+</span>
</code></pre></div>

<p>现在显然有很多种方式来把它放到远程主机上应该的位置。不过既然我们正在使用 ansible，就用它来完成这个操作吧：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>ansible<span class="w"> </span>all<span class="w"> </span>-m<span class="w"> </span>copy<span class="w"> </span>-a<span class="w"> </span><span class="s2">&quot;src=/home/mike/.ssh/id_rsa.pub dest=/tmp/id_rsa.pub&quot;</span><span class="w"> </span>--ask-pass<span class="w"> </span>-c<span class="w"> </span>paramiko
</code></pre></div>

<p>样例输出：</p>
<div class="highlight"><pre><span></span><code>SSH password:
127.0.0.1 | success &gt;&gt; {
    &quot;changed&quot;: true,
    &quot;dest&quot;: &quot;/tmp/id_rsa.pub&quot;,
    &quot;gid&quot;: 100,
    &quot;group&quot;: &quot;users&quot;,
    &quot;md5sum&quot;: &quot;bafd3fce6b8a33cf1de415af432774b4&quot;,
    &quot;mode&quot;: &quot;0644&quot;,
    &quot;owner&quot;: &quot;mike&quot;,
    &quot;size&quot;: 410,
    &quot;src&quot;: &quot;/home/mike/.ansible/tmp/ansible-tmp-1407008170.46-208759459189201/source&quot;,
    &quot;state&quot;: &quot;file&quot;,
    &quot;uid&quot;: 1000
}
</code></pre></div>

<p>下一步，把公钥文件添加到远程服务器里。输入：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>ansible<span class="w"> </span>all<span class="w"> </span>-m<span class="w"> </span>shell<span class="w"> </span>-a<span class="w"> </span><span class="s2">&quot;cat /tmp/id_rsa.pub &gt;&gt; /root/.ssh/authorized_keys&quot;</span><span class="w"> </span>--ask-pass<span class="w"> </span>-c<span class="w"> </span>paramiko
</code></pre></div>

<p>样例输出：</p>
<div class="highlight"><pre><span></span><code>SSH password:
127.0.0.1 | FAILED | rc=1 &gt;&gt;
/bin/sh: /root/.ssh/authorized_keys: Permission denied
</code></pre></div>

<p>矮油，我们需要用 root 来执行这个命令，所以还是加上一个 -u 参数吧：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>ansible<span class="w"> </span>all<span class="w"> </span>-m<span class="w"> </span>shell<span class="w"> </span>-a<span class="w"> </span><span class="s2">&quot;cat /tmp/id_rsa.pub &gt;&gt; /root/.ssh/authorized_keys&quot;</span><span class="w"> </span>--ask-pass<span class="w"> </span>-c<span class="w"> </span>paramiko<span class="w"> </span>-u<span class="w"> </span>root
</code></pre></div>

<p>样例输出：</p>
<div class="highlight"><pre><span></span><code>SSH password:
127.0.0.1 | success | rc=0 &gt;&gt;
</code></pre></div>

<p>请注意，我刚才这是想要演示通过 ansible 来传输文件的操作。事实上 ansible 有一个更加方便的内置 SSH 密钥管理支持：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>ansible<span class="w"> </span>all<span class="w"> </span>-m<span class="w"> </span>authorized_key<span class="w"> </span>-a<span class="w"> </span><span class="s2">&quot;user=mike key=&#39;{{ lookup(&#39;file&#39;, &#39;/home/mike/.ssh/id_rsa.pub&#39;) }}&#39; path=/home/mike/.ssh/authorized_keys manage_dir=no&quot;</span><span class="w"> </span>--ask-pass<span class="w"> </span>-c<span class="w"> </span>paramiko
</code></pre></div>

<p>样例输出：</p>
<div class="highlight"><pre><span></span><code><span class="n">SSH</span><span class="w"> </span><span class="nl">password</span><span class="p">:</span>
<span class="mf">127.0.0.1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">success</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="err">{</span>
<span class="w">    </span><span class="ss">&quot;changed&quot;</span><span class="err">:</span><span class="w"> </span><span class="k">true</span><span class="p">,</span>
<span class="w">    </span><span class="ss">&quot;gid&quot;</span><span class="err">:</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span>
<span class="w">    </span><span class="ss">&quot;group&quot;</span><span class="err">:</span><span class="w"> </span><span class="ss">&quot;users&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="ss">&quot;key&quot;</span><span class="err">:</span><span class="w"> </span><span class="ss">&quot;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCq+Z8/usprXk0aCAPyP0TGylm2MKbmEsHePUOd7p5DO1QQTHak+9gwdoJJavy0yoUdi+C+autKjvuuS+vGb8+I+8mFNu5CvKiZzIpMjZvrZMhHRdNud7GuEanusTEJfi1pUd3NA2iXhl4a6S9a/4G2mKyf7QQSzI4Z5ddudUXd9yHmo9Yt48/ASOJLHIcYfSsswOm8ux1UnyeHqgpdIVONVFsKKuSNSvZBVl3bXzhkhjxz8RMiBGIubJDBuKwZqNSJkOlPWYN76btxMCDVm07O7vNChpf0cmWEfM3pXKPBq/UBxyG2MgoCGkIRGOtJ8UjC/daadBUuxg92/u01VNEB mike@ultrabook.linuxdork.com&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="ss">&quot;key_options&quot;</span><span class="err">:</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">    </span><span class="ss">&quot;keyfile&quot;</span><span class="err">:</span><span class="w"> </span><span class="ss">&quot;/home/mike/.ssh/authorized_keys&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="ss">&quot;manage_dir&quot;</span><span class="err">:</span><span class="w"> </span><span class="k">false</span><span class="p">,</span>
<span class="w">    </span><span class="ss">&quot;mode&quot;</span><span class="err">:</span><span class="w"> </span><span class="ss">&quot;0600&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="ss">&quot;owner&quot;</span><span class="err">:</span><span class="w"> </span><span class="ss">&quot;mike&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="ss">&quot;path&quot;</span><span class="err">:</span><span class="w"> </span><span class="ss">&quot;/home/mike/.ssh/authorized_keys&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="ss">&quot;size&quot;</span><span class="err">:</span><span class="w"> </span><span class="mi">410</span><span class="p">,</span>
<span class="w">    </span><span class="ss">&quot;state&quot;</span><span class="err">:</span><span class="w"> </span><span class="ss">&quot;file&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="ss">&quot;uid&quot;</span><span class="err">:</span><span class="w"> </span><span class="mi">1000</span><span class="p">,</span>
<span class="w">    </span><span class="ss">&quot;unique&quot;</span><span class="err">:</span><span class="w"> </span><span class="k">false</span><span class="p">,</span>
<span class="w">    </span><span class="ss">&quot;user&quot;</span><span class="err">:</span><span class="w"> </span><span class="ss">&quot;mike&quot;</span>
<span class="err">}</span>
</code></pre></div>

<p>现在这些密钥已经设置好了。我们来试着随便跑一个命令，比如 hostname，希望我们不会被提示要输入密码</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>ansible<span class="w"> </span>all<span class="w"> </span>-m<span class="w"> </span>shell<span class="w"> </span>-a<span class="w"> </span><span class="s2">&quot;hostname&quot;</span><span class="w"> </span>-u<span class="w"> </span>root
</code></pre></div>

<p>样例输出：</p>
<div class="highlight"><pre><span></span><code><span class="mf">127.0.0.1</span><span class="w"> </span><span class="err">|</span><span class="w"> </span><span class="n">success</span><span class="w"> </span><span class="err">|</span><span class="w"> </span><span class="n">rc</span><span class="o">=</span><span class="mf">0</span><span class="w"> </span><span class="o">&gt;&gt;</span>
</code></pre></div>

<p>成功！！！现在我们可以用 root 来执行命令，并且不会被输入密码的提示干扰了。我们现在可以轻易地配置任何在 ansible hosts 文件中的主机了。让我们把 /tmp 中的公钥文件删除：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>ansible<span class="w"> </span>all<span class="w"> </span>-m<span class="w"> </span>file<span class="w"> </span>-a<span class="w"> </span><span class="s2">&quot;dest=/tmp/id_rsa.pub state=absent&quot;</span><span class="w"> </span>-u<span class="w"> </span>root
</code></pre></div>

<p>样例输出：</p>
<div class="highlight"><pre><span></span><code><span class="mf">127.0.0.1</span><span class="w"> </span><span class="err">|</span><span class="w"> </span><span class="n">success</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="err">{</span>
<span class="w">    </span><span class="s">&quot;changed&quot;</span><span class="p">:</span><span class="w"> </span><span class="n">true</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;path&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/tmp/id_rsa.pub&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;state&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;absent&quot;</span>
<span class="err">}</span>
</code></pre></div>

<p>下面我们来做一些更复杂的事情，我要确定一些软件包已经安装了，并且已经是最新的版本：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>ansible<span class="w"> </span>all<span class="w"> </span>-m<span class="w"> </span>zypper<span class="w"> </span>-a<span class="w"> </span><span class="s2">&quot;name=apache2 state=latest&quot;</span><span class="w"> </span>-u<span class="w"> </span>root
</code></pre></div>

<p>样例输出：</p>
<div class="highlight"><pre><span></span><code><span class="mf">127.0.0.1</span><span class="w"> </span><span class="err">|</span><span class="w"> </span><span class="n">success</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="err">{</span>
<span class="w">    </span><span class="s">&quot;changed&quot;</span><span class="p">:</span><span class="w"> </span><span class="n">false</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;apache2&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;state&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;latest&quot;</span>
<span class="err">}</span>
</code></pre></div>

<p>很好，我们刚才放在 /tmp 中的公钥文件已经消失了，而且我们已经安装好了最新版的 apache。下面我们来看看前面命令中的 -m zypper，一个让 ansible 非常灵活，并且给了 playbooks 更多能力的功能。如果你不使用 openSuse 或者 Suse enterprise 你可能还不熟悉 zypper, 它基本上就是 suse 世界中相当于 yum 的存在。在上面所有的例子中，我的 hosts 文件中都只有一台机器。除了最后一个命令外，其他所有命令都应该在任何标准的 *nix 系统和标准的 ssh 配置中使用，这造成了一个问题。如果我们想要同时管理多种不同的机器呢？这便是 playbooks 和 ansible 的可配置性闪闪发光的地方了。首先我们来少许修改一下我们的 hosts 文件：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>cat<span class="w"> </span>~/ansible_hosts
</code></pre></div>

<p>样例输出：</p>
<div class="highlight"><pre><span></span><code><span class="k">[RHELBased]</span>
<span class="na">10.50.1.33</span>
<span class="na">10.50.1.47</span>

<span class="k">[SUSEBased]</span>
<span class="na">127.0.0.1</span>
</code></pre></div>

<p>首先，我们创建了一些分组的服务器，并且给了他们一些有意义的标签。然后我们来创建一个为不同类型的服务器执行不同操作的 playbook。你可能已经发现这个 yaml 的数据结构和我们之前运行的命令行语句中的相似性了。简单来说，-m 是一个模块，而 -a 用来提供模块参数。在 YAML 表示中你可以先指定模块，然后插入一个冒号 :，最后指定参数。</p>
<div class="highlight"><pre><span></span><code><span class="x">- hosts: SUSEBased</span>
<span class="x">  remote_user: mike</span>
<span class="x">  sudo: yes</span>
<span class="x">  tasks:</span>
<span class="x">    - authorized_key: user=root key=&quot;</span><span class="cp">{{</span> <span class="nv">lookup</span><span class="o">(</span><span class="s1">&#39;file&#39;</span><span class="o">,</span> <span class="s1">&#39;/home/mike/.ssh/id_rsa.pub&#39;</span><span class="o">)</span> <span class="cp">}}</span><span class="x">&quot; path=/root/.ssh/authorized_keys manage_dir=no</span>
<span class="x">- hosts: RHELBased</span>
<span class="x">  remote_user: mdonlon</span>
<span class="x">  sudo: yes</span>
<span class="x">  tasks:</span>
<span class="x">    - authorized_key: user=root key=&quot;</span><span class="cp">{{</span> <span class="nv">lookup</span><span class="o">(</span><span class="s1">&#39;file&#39;</span><span class="o">,</span> <span class="s1">&#39;/home/mike/.ssh/id_rsa.pub&#39;</span><span class="o">)</span> <span class="cp">}}</span><span class="x">&quot; path=/root/.ssh/authorized_keys manage_dir=no</span>
</code></pre></div>

<p>除此之外还有很多可以做的事情，比如在启动的时候把公钥配置好，或者引入其他的流程来让你按需配置一些机器。不过只要 SSH 被配置成接受密码登陆，这些几乎可以用在所有的流程中。在你准备开始写太多 playbook 之前，另一个值得考虑的事情是，代码管理可以有效节省你的时间。机器需要不断变化，然而你并不需要在每次机器发生变化时都重新写一个 playbook，只需要更新相关的部分并提交这些修改。与此相关的另一个好处是，如同我之前所述，你可以从不同的地方管理你的整个基础结构。你只需要将你的 playbook 仓库 git clone 到新的机器上，就完成了管理所有东西的全部设置流程。</p>
<h3>现实中的 ansible 例子</h3>
<p>我知道很多用户经常使用 pastebin 这样的服务，以及很多公司基于显而易见的理由配置了他们内部使用的类似东西。最近，我遇到了一个叫做 showterm 的程序，巧合之下我被一个客户要求配置它用于内部使用。这里我不打算赘述这个应用程序的细节，不过如果你感兴趣的话，你可以使用 Google 搜索 showterm。作为一个合理的现实中的例子，我将会试图配置一个 showterm 服务器，并且配置使用它所需要的客户端应用程序。在这个过程中我们还需要一个数据库服务器。现在我们从配置客户端开始：</p>
<div class="highlight"><pre><span></span><code><span class="o">-</span><span class="w"> </span><span class="n">hosts</span><span class="p">:</span><span class="w"> </span><span class="n">showtermServers</span>
<span class="w">  </span><span class="n">remote_user</span><span class="p">:</span><span class="w"> </span><span class="n">root</span>
<span class="w">  </span><span class="n">tasks</span><span class="p">:</span>
<span class="w">    </span><span class="o">-</span><span class="w"> </span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="n">ensure</span><span class="w"> </span><span class="n">packages</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">installed</span>
<span class="w">      </span><span class="n">yum</span><span class="p">:</span><span class="w"> </span><span class="n">name</span><span class="o">=</span><span class="p">{{</span><span class="n">item</span><span class="p">}}</span><span class="w"> </span><span class="n">state</span><span class="o">=</span><span class="n">latest</span>
<span class="w">      </span><span class="n">with_items</span><span class="p">:</span>
<span class="w">        </span><span class="o">-</span><span class="w"> </span><span class="n">postgresql</span>
<span class="w">        </span><span class="o">-</span><span class="w"> </span><span class="n">postgresql</span><span class="o">-</span><span class="n">server</span>
<span class="w">        </span><span class="o">-</span><span class="w"> </span><span class="n">postgresql</span><span class="o">-</span><span class="n">devel</span>
<span class="w">        </span><span class="o">-</span><span class="w"> </span><span class="n">python</span><span class="o">-</span><span class="n">psycopg2</span>
<span class="w">        </span><span class="o">-</span><span class="w"> </span><span class="n">git</span>
<span class="w">        </span><span class="o">-</span><span class="w"> </span><span class="n">ruby21</span>
<span class="w">        </span><span class="o">-</span><span class="w"> </span><span class="n">ruby21</span><span class="o">-</span><span class="n">passenger</span>
<span class="w">    </span><span class="o">-</span><span class="w"> </span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="n">showterm</span><span class="w"> </span><span class="n">server</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">github</span>
<span class="w">      </span><span class="n">git</span><span class="p">:</span><span class="w"> </span><span class="n">repo</span><span class="o">=</span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">ConradIrwin</span><span class="o">/</span><span class="n">showterm</span><span class="o">.</span><span class="n">io</span><span class="w"> </span><span class="n">dest</span><span class="o">=/</span><span class="n">root</span><span class="o">/</span><span class="n">showterm</span>
<span class="w">    </span><span class="o">-</span><span class="w"> </span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="n">Initdb</span>
<span class="w">      </span><span class="n">command</span><span class="p">:</span><span class="w"> </span><span class="n">service</span><span class="w"> </span><span class="n">postgresql</span><span class="w"> </span><span class="n">initdb</span>
<span class="w">               </span><span class="n">creates</span><span class="o">=/</span><span class="k">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">pgsql</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">postgresql</span><span class="o">.</span><span class="n">conf</span>

<span class="w">    </span><span class="o">-</span><span class="w"> </span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="n">Start</span><span class="w"> </span><span class="n">PostgreSQL</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">enable</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">boot</span>
<span class="w">      </span><span class="n">service</span><span class="p">:</span><span class="w"> </span><span class="n">name</span><span class="o">=</span><span class="n">postgresql</span>
<span class="w">               </span><span class="n">enabled</span><span class="o">=</span><span class="n">yes</span>
<span class="w">               </span><span class="n">state</span><span class="o">=</span><span class="n">started</span>
<span class="w">    </span><span class="o">-</span><span class="w"> </span><span class="n">gem</span><span class="p">:</span><span class="w"> </span><span class="n">name</span><span class="o">=</span><span class="n">pg</span><span class="w"> </span><span class="n">state</span><span class="o">=</span><span class="n">latest</span><span class="w"> </span><span class="n">user_install</span><span class="o">=</span><span class="n">no</span>
<span class="w">  </span><span class="n">handlers</span><span class="p">:</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="n">restart</span><span class="w"> </span><span class="n">postgresql</span>
<span class="w">     </span><span class="n">service</span><span class="p">:</span><span class="w"> </span><span class="n">name</span><span class="o">=</span><span class="n">postgresql</span><span class="w"> </span><span class="n">state</span><span class="o">=</span><span class="n">restarted</span>

<span class="o">-</span><span class="w"> </span><span class="n">hosts</span><span class="p">:</span><span class="w"> </span><span class="n">showtermServers</span>
<span class="w">  </span><span class="n">remote_user</span><span class="p">:</span><span class="w"> </span><span class="n">root</span>
<span class="w">  </span><span class="n">sudo</span><span class="p">:</span><span class="w"> </span><span class="n">yes</span>
<span class="w">  </span><span class="n">sudo_user</span><span class="p">:</span><span class="w"> </span><span class="n">postgres</span>
<span class="w">  </span><span class="n">vars</span><span class="p">:</span>
<span class="w">    </span><span class="n">dbname</span><span class="p">:</span><span class="w"> </span><span class="n">showterm</span>
<span class="w">    </span><span class="n">dbuser</span><span class="p">:</span><span class="w"> </span><span class="n">showterm</span>
<span class="w">    </span><span class="n">dbpassword</span><span class="p">:</span><span class="w"> </span><span class="n">showtermpassword</span>
<span class="w">  </span><span class="n">tasks</span><span class="p">:</span>
<span class="w">    </span><span class="o">-</span><span class="w"> </span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="n">create</span><span class="w"> </span><span class="n">db</span>
<span class="w">      </span><span class="n">postgresql_db</span><span class="p">:</span><span class="w"> </span><span class="n">name</span><span class="o">=</span><span class="p">{{</span><span class="n">dbname</span><span class="p">}}</span>

<span class="w">    </span><span class="o">-</span><span class="w"> </span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="n">create</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">ALL</span><span class="w"> </span><span class="n">priv</span>
<span class="w">      </span><span class="n">postgresql_user</span><span class="p">:</span><span class="w"> </span><span class="n">db</span><span class="o">=</span><span class="p">{{</span><span class="n">dbname</span><span class="p">}}</span><span class="w"> </span><span class="n">name</span><span class="o">=</span><span class="p">{{</span><span class="n">dbuser</span><span class="p">}}</span><span class="w"> </span><span class="n">password</span><span class="o">=</span><span class="p">{{</span><span class="n">dbpassword</span><span class="p">}}</span><span class="w"> </span><span class="n">priv</span><span class="o">=</span><span class="n">ALL</span>
<span class="o">-</span><span class="w"> </span><span class="n">hosts</span><span class="p">:</span><span class="w"> </span><span class="n">showtermServers</span>
<span class="w">  </span><span class="n">remote_user</span><span class="p">:</span><span class="w"> </span><span class="n">root</span>
<span class="w">  </span><span class="n">tasks</span><span class="p">:</span>
<span class="w">    </span><span class="o">-</span><span class="w"> </span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="n">database</span><span class="o">.</span><span class="n">yml</span>
<span class="w">      </span><span class="n">template</span><span class="p">:</span><span class="w"> </span><span class="n">src</span><span class="o">=</span><span class="n">database</span><span class="o">.</span><span class="n">yml</span><span class="w"> </span><span class="n">dest</span><span class="o">=/</span><span class="n">root</span><span class="o">/</span><span class="n">showterm</span><span class="o">/</span><span class="n">config</span><span class="o">/</span><span class="n">database</span><span class="o">.</span><span class="n">yml</span>
<span class="o">-</span><span class="w"> </span><span class="n">hosts</span><span class="p">:</span><span class="w"> </span><span class="n">showtermServers</span>
<span class="w">  </span><span class="n">remote_user</span><span class="p">:</span><span class="w"> </span><span class="n">root</span>
<span class="w">  </span><span class="n">tasks</span><span class="p">:</span>
<span class="w">    </span><span class="o">-</span><span class="w"> </span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">bundle</span><span class="w"> </span><span class="n">install</span>
<span class="w">      </span><span class="n">shell</span><span class="p">:</span><span class="w"> </span><span class="n">bundle</span><span class="w"> </span><span class="n">install</span>
<span class="w">      </span><span class="n">args</span><span class="p">:</span>
<span class="w">        </span><span class="n">chdir</span><span class="p">:</span><span class="w"> </span><span class="o">/</span><span class="n">root</span><span class="o">/</span><span class="n">showterm</span>
<span class="o">-</span><span class="w"> </span><span class="n">hosts</span><span class="p">:</span><span class="w"> </span><span class="n">showtermServers</span>
<span class="w">  </span><span class="n">remote_user</span><span class="p">:</span><span class="w"> </span><span class="n">root</span>
<span class="w">  </span><span class="n">tasks</span><span class="p">:</span>
<span class="w">    </span><span class="o">-</span><span class="w"> </span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">rake</span><span class="w"> </span><span class="n">db</span><span class="w"> </span><span class="n">tasks</span>
<span class="w">      </span><span class="n">shell</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;bundle exec rake db:create db:migrate db:seed&#39;</span>
<span class="w">      </span><span class="n">args</span><span class="p">:</span>
<span class="w">        </span><span class="n">chdir</span><span class="p">:</span><span class="w"> </span><span class="o">/</span><span class="n">root</span><span class="o">/</span><span class="n">showterm</span>
<span class="o">-</span><span class="w"> </span><span class="n">hosts</span><span class="p">:</span><span class="w"> </span><span class="n">showtermServers</span>
<span class="w">  </span><span class="n">remote_user</span><span class="p">:</span><span class="w"> </span><span class="n">root</span>
<span class="w">  </span><span class="n">tasks</span><span class="p">:</span>
<span class="w">    </span><span class="o">-</span><span class="w"> </span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="n">apache</span><span class="w"> </span><span class="n">config</span>
<span class="w">      </span><span class="n">template</span><span class="p">:</span><span class="w"> </span><span class="n">src</span><span class="o">=</span><span class="n">showterm</span><span class="o">.</span><span class="n">conf</span><span class="w"> </span><span class="n">dest</span><span class="o">=/</span><span class="n">etc</span><span class="o">/</span><span class="n">httpd</span><span class="o">/</span><span class="n">conf</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">showterm</span><span class="o">.</span><span class="n">conf</span>
</code></pre></div>

<p>还凑合。请注意，从某种意义上来说这是一个任意选择的程序，然而我们现在已经可以持续地在任意数量的机器上部署它了，这便是配置管理的好处。此外，在大多数情况下这里的定义语法几乎是不言而喻的，wiki 页面也就不需要加入太多细节了。当然在我的观点里，一个有太多细节的 wiki 页面绝不会是一件坏事。</p>
<h3>扩展配置</h3>
<p>我们并没有涉及到这里所有的细节。Ansible 有许多选项可以用来配置你的系统。你可以在你的 hosts 文件中内嵌变量，而 ansible 将会把它们应用到远程节点。如：</p>
<div class="highlight"><pre><span></span><code><span class="k">[RHELBased]</span>
<span class="na">10.50.1.33  http_port</span><span class="o">=</span><span class="s">443</span>
<span class="na">10.50.1.47  http_port</span><span class="o">=</span><span class="s">80  ansible_ssh_user=mdonlon</span>

<span class="k">[SUSEBased]</span>
<span class="na">127.0.0.1  http_port</span><span class="o">=</span><span class="s">443</span>
</code></pre></div>

<p>尽管这对于快速配置来说已经非常方便，你还可以将变量分成存放在 yaml 格式的多个文件中。在你的 hosts 文件路径里，你可以创建两个子目录 group<em>vars 和 host</em>vars。在这些路径里放置的任何文件，只要能对得上一个主机分组的名字，或者你的 hosts 文件中的一个主机名，它们都会在运行时被插入进来。所以前面的一个例子将会变成这样：</p>
<div class="highlight"><pre><span></span><code><span class="n">ultrabook</span><span class="p">:</span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">ansible</span><span class="w"> </span><span class="c1"># pwd</span>
<span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">ansible</span>
<span class="n">ultrabook</span><span class="p">:</span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">ansible</span><span class="w"> </span><span class="c1"># tree</span>
<span class="o">.</span>
<span class="err">├──</span><span class="w"> </span><span class="n">group_vars</span>
<span class="err">│</span><span class="w">   </span><span class="err">├──</span><span class="w"> </span><span class="n">RHELBased</span>
<span class="err">│</span><span class="w">   </span><span class="err">└──</span><span class="w"> </span><span class="n">SUSEBased</span>
<span class="err">├──</span><span class="w"> </span><span class="n">hosts</span>
<span class="err">└──</span><span class="w"> </span><span class="n">host_vars</span>
<span class="err">├──</span><span class="w"> </span><span class="mf">10.50</span><span class="o">.</span><span class="mf">1.33</span>
<span class="err">└──</span><span class="w"> </span><span class="mf">10.50</span><span class="o">.</span><span class="mf">1.47</span>
</code></pre></div>

<p>```
[SUSEBased]
127.0.0.1
ultrabook:/etc/ansible # cat group_vars/RHELBased
ultrabook:/etc/ansible # cat group_vars/SUSEBased
http_port: 443
ultrabook:/etc/ansible # cat host_vars/10.50.1.47</p>
<p>via: <a href="http://www.cyberciti.biz/python-tutorials/linux-tutorial-install-ansible-configuration-management-and-it-automation-tool/">http://www.cyberciti.biz/python-tutorials/linux-tutorial-install-ansible-configuration-management-and-it-automation-tool/</a></p>
<p>作者：<a href="http://www.cyberciti.biz/tips/about-us">Nix Craft</a> 译者：<a href="https://github.com/felixonmars">felixonmars</a> 校对：<a href="https://github.com/wxy">wxy</a></p>
<p>本文由 <a href="https://github.com/LCTT/TranslateProject">LCTT</a> 原创翻译，<a href="http://linux.cn/">Linux中国</a> 荣誉推出</p>
    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>links</h2>
                        <ul>
                            <li><a href="https://getpelican.com/">Pelican</a></li>
                            <li><a href="https://www.python.org/">Python.org</a></li>
                            <li><a href="https://palletsprojects.com/p/jinja/">Jinja2</a></li>
                            <li><a href="#">You can modify those links in your config file</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>

                            <li><a href="#">You can add links in your config file</a></li>
                            <li><a href="#">Another social link</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a rel="nofollow" href="https://getpelican.com/">Pelican</a>, which takes great advantage of <a rel="nofollow" href="https://www.python.org/">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a rel="nofollow" href="https://www.smashingmagazine.com/2009/08/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>