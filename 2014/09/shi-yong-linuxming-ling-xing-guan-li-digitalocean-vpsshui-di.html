<!DOCTYPE html>
<html lang="zh">
<head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="generator" content="Pelican" />
        <title>使用Linux命令行管理DigitalOcean VPS水滴</title>
        <link rel="stylesheet" href="/theme/css/main.css" />
        <meta name="description" content="Author: '' DigitalOcean是云VPS主机市场中最炙手可热的新生儿。虽然没有提供像Amazon之类一样的综合服务业务，但DigitalOcean定位于中小型企业和开发者，已经成为基于Linux的最佳云VPS服务的强有力竞争者，这都得归功于它们具有竞争力的价格和用户友好的管理界面。 不管 …" />
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">linux_cn</a></h1>
                <nav><ul>
                    <li><a href="/category/chuan-shan-jia-zhuan-fang">穿山甲专访</a></li>
                    <li><a href="/category/dai-ma-ying-xiong">代码英雄</a></li>
                    <li><a href="/category/fen-xiang">分享</a></li>
                    <li><a href="/category/guan-dian">观点</a></li>
                    <li><a href="/category/huo-dong">活动</a></li>
                    <li><a href="/category/ji-ke-man-hua">极客漫画</a></li>
                    <li class="active"><a href="/category/ji-zhu">技术</a></li>
                    <li><a href="/category/kai-yuan-zhi-hui">开源智慧</a></li>
                    <li><a href="/category/linux-fa-xing-ban">Linux 发行版</a></li>
                    <li><a href="/category/mei-ri-an-quan-zi-xun">每日安全资讯</a></li>
                    <li><a href="/category/misc">Misc</a></li>
                    <li><a href="/category/qu-kuai-lian">区块链</a></li>
                    <li><a href="/category/rong-qi-yu-yun">容器与云</a></li>
                    <li><a href="/category/ruan-jian-kai-fa">软件开发</a></li>
                    <li><a href="/category/shu-mei-pai">树莓派</a></li>
                    <li><a href="/category/xi-tong-yun-wei">系统运维</a></li>
                    <li><a href="/category/xin-wen">新闻</a></li>
                    <li><a href="/category/ying-he-guan-cha">硬核观察</a></li>
                    <li><a href="/category/zhi-ye-sheng-ya">职业生涯</a></li>
                    <li><a href="/category/zhong-jiang-ming-dan">中奖名单</a></li>
                    <li><a href="/category/zhuo-mian-ying-yong">桌面应用</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="/2014/09/shi-yong-linuxming-ling-xing-guan-li-digitalocean-vpsshui-di.html" rel="bookmark"
           title="Permalink to 使用Linux命令行管理DigitalOcean VPS水滴">使用Linux命令行管理DigitalOcean VPS水滴</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2014-09-03T17:38:00+02:00">
                Published: Wed 03 September 2014
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/linux-fans-from-china.html">linux fans from china</a>
        </address>
<p>In <a href="/category/ji-zhu">技术</a>.</p>

</footer><!-- /.post-info -->      <p>Author: ''</p>
<p><a href="http://xmodulo.com/go/digitalocean">DigitalOcean</a>是云VPS主机市场中最炙手可热的新生儿。虽然没有提供像Amazon之类一样的综合服务业务，但DigitalOcean定位于中小型企业和开发者，已经成为基于Linux的最佳云VPS服务的强有力竞争者，这都得归功于它们具有竞争力的价格和用户友好的管理界面。</p>
<p><a href="https://camo.githubusercontent.com/8dfe323ab3bd63de9909fdc59fbdb303a7c1fab2/68747470733a2f2f6661726d342e737461746963666c69636b722e636f6d2f333834312f31343530313632373530305f326566323735616331635f7a2e6a7067"><img alt="" src="https://camo.githubusercontent.com/8dfe323ab3bd63de9909fdc59fbdb303a7c1fab2/68747470733a2f2f6661726d342e737461746963666c69636b722e636f6d2f333834312f31343530313632373530305f326566323735616331635f7a2e6a7067"></a></p>
<p>不管什么时候，当你需要一个面向网络的服务器用于你的个人项目，你都可以全速开动一个“水滴”（<a href="http://xmodulo.com/go/digitalocean">DigitalOcean</a>中VPS实例的昵称），也可以在你不需要时杀掉它，没必要为了让你的VPS保持运作而烧光了你的钱袋。尽管DigitalOcean基于网络的管理界面已经十分高效，但对于那些命令行界面的死忠派，它还是提供了基于命令行界面的水滴管理工具，它叫<a href="https://github.com/pearkes/tugboat">tugboat</a>。多亏了这个命令行工具，所有复杂的水滴管理任务都可以简单地转变成一个脚本来完成。</p>
<p>在本文中，我打算讲述<strong>怎样使用tugboat来从命令行对DigitalOcean水滴进行管理</strong>。</p>
<h3>在Linux上安装tugboat</h3>
<p>在Debian，Ubuntu或者Linux Mint上安装tugboat：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>ruby-dev
$<span class="w"> </span>sudo<span class="w"> </span>gem<span class="w"> </span>install<span class="w"> </span>tugboat<span class="w"> </span>
</code></pre></div>

<p>在Fedora上安装tugboat：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>sudo<span class="w"> </span>yum<span class="w"> </span>install<span class="w"> </span>ruby-devel
$<span class="w"> </span>sudo<span class="w"> </span>gem<span class="w"> </span>install<span class="w"> </span>tugboat<span class="w"> </span>
</code></pre></div>

<p>要在CentOS上安装tugboat，首先<a href="http://ask.xmodulo.com/upgrade-ruby-centos.html">安装或升级到最新的Ruby</a>，因为在CentOS 6.5以及更早的版本上，默认的Ruby不满足Tugboat所需的最小版本（1.9及更高版本）。安装Ruby 1.9及更高版本后，请按如下方式安装tugboat。</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>sudo<span class="w"> </span>gem<span class="w"> </span>install<span class="w"> </span>tugboat<span class="w"> </span>
</code></pre></div>

<h3>tugboat首次使用配置</h3>
<p>在安装完后，就该进行一次配置，其中包括授权tugboat访问DigitalOcean帐号。</p>
<p>转到<a href="https://cloud.digitalocean.com/api_access">https://cloud.digitalocean.com/api_access</a>，并创建新的API密钥，记录客户ID和API密钥。</p>
<p><a href="https://camo.githubusercontent.com/9d49bd5c554296237e97ed313f70a1c3b58d9173/68747470733a2f2f6661726d342e737461746963666c69636b722e636f6d2f333833362f31343638383239393231355f666432383261303134325f7a2e6a7067"><img alt="" src="https://camo.githubusercontent.com/9d49bd5c554296237e97ed313f70a1c3b58d9173/68747470733a2f2f6661726d342e737461746963666c69636b722e636f6d2f333833362f31343638383239393231355f666432383261303134325f7a2e6a7067"></a></p>
<p>通过运行以下命令来启动授权过程：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>tugboat<span class="w"> </span>authorize<span class="w"> </span>
</code></pre></div>

<p>在提示你输入客户ID和API密钥时，请输入。它会询问几个其它问题，目前你可以接受默认的回答。我们将会在后面自定义默认设置。</p>
<p><a href="https://www.flickr.com/photos/xmodulo/14685122101/"><img alt="" src="https://camo.githubusercontent.com/b3b1ce86ffda386af6766df4144292a37b581f7e/68747470733a2f2f6661726d362e737461746963666c69636b722e636f6d2f353539362f31343638353132323130315f646261353066633836625f7a2e6a7067"></a></p>
<p>现在，让我们自定义默认水滴设置，以反映你典型的使用状况。要做到这一点，首先检查水滴提供的可用设置项（如，可用的镜像、区域、大小）。</p>
<p>运行以下命令，它会列出可用的水滴镜像。选取使用一个默认镜像，并记录相关的ID。</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>tugboat<span class="w"> </span>images<span class="w"> </span>--global<span class="w"> </span>
</code></pre></div>

<p><a href="https://camo.githubusercontent.com/2478dee018a4e938ff91aae9bc5284dc001878aa/68747470733a2f2f6661726d332e737461746963666c69636b722e636f6d2f323930302f31343638383239393137355f653737653734666131655f7a2e6a7067"><img alt="" src="https://camo.githubusercontent.com/2478dee018a4e938ff91aae9bc5284dc001878aa/68747470733a2f2f6661726d332e737461746963666c69636b722e636f6d2f323930302f31343638383239393137355f653737653734666131655f7a2e6a7067"></a></p>
<p>类似，从可用区域中选取一个默认的地理位置：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>tugboat<span class="w"> </span>regions
</code></pre></div>

<p>同时，从可用的RAM大小中选择一个默认的水滴大小：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>tugboat<span class="w"> </span>sizes<span class="w"> </span>
</code></pre></div>

<p><a href="https://camo.githubusercontent.com/3fdc0a4378973b04c89e499e3b30f22bd470439e/68747470733a2f2f6661726d342e737461746963666c69636b722e636f6d2f333835382f31343530313636313233385f343330346538626466625f6f2e706e67"><img alt="" src="https://camo.githubusercontent.com/3fdc0a4378973b04c89e499e3b30f22bd470439e/68747470733a2f2f6661726d342e737461746963666c69636b722e636f6d2f333835382f31343530313636313233385f343330346538626466625f6f2e706e67"></a></p>
<p>现在，把你的默认选择放到~/.tugboat中。例如，我在这里自定义了默认设置：区域在纽约，系统是Ubuntu 14.04，内存512MB。如果你想要通过密钥验证启用SSH，设置“ssh_user”为root，这个我很快会讲到。</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>vi<span class="w"> </span>~/.tugboat<span class="w"> </span>
</code></pre></div>

<p>authentication:
  client_key: XXXXXXXXXXXXXXXXXXX
  api_key: XXXXXXXXXXXXXXXXXXXX
ssh:
  ssh_user: root
  ssh_key_path: /home/dev/.ssh/id_rsa
  ssh_port: '22'
defaults:
  region: '4'
  image: '3240036'
  size: '66'
  ssh_key: ''
  private_networking: 'false'
  backups_enabled: 'false'</p>
<div class="highlight"><pre><span></span><code><span class="err">###</span><span class="w"> </span><span class="n">创建并添加SSH密钥到DigitalOcean</span>


<span class="n">要访问水滴实例</span><span class="err">，</span><span class="n">一个安全的方式是通过</span><span class="o">[</span><span class="n">密钥验证</span><span class="o">]</span><span class="p">(</span><span class="nl">http</span><span class="p">:</span><span class="o">//</span><span class="n">xmodulo</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="mi">2012</span><span class="o">/</span><span class="mi">04</span><span class="o">/</span><span class="n">how</span><span class="o">-</span><span class="k">to</span><span class="o">-</span><span class="n">enable</span><span class="o">-</span><span class="n">ssh</span><span class="o">-</span><span class="n">login</span><span class="o">-</span><span class="k">without</span><span class="p">.</span><span class="n">html</span><span class="p">)</span><span class="n">的SSH连接到该实例</span><span class="err">。</span>


<span class="n">事实上</span><span class="err">，</span><span class="n">你可以通过使用</span><span class="o">[</span><span class="n">DigitalOcean</span><span class="o">]</span><span class="p">(</span><span class="nl">http</span><span class="p">:</span><span class="o">//</span><span class="n">xmodulo</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="k">go</span><span class="o">/</span><span class="n">digitalocean</span><span class="p">)</span><span class="n">来注册SSH公钥</span><span class="err">，</span><span class="n">为你的水滴实现自动启用密钥验证</span><span class="err">。</span><span class="n">下面告诉你怎么做</span><span class="err">。</span>


<span class="n">首先</span><span class="err">，</span><span class="n">生成一个公</span><span class="o">/</span><span class="n">私密钥对</span><span class="err">（</span><span class="n">如果你还没有</span><span class="err">）。</span>
</code></pre></div>

<p>$ ssh-keygen -t rsa -C "your@emailaddress.com"</p>
<div class="highlight"><pre><span></span><code>假设生成的密钥对由~/.ssh/id\_rsa（私钥）和~/.ssh/id\_rsa.pub（公钥）构成，去将你的公钥上传吧，命令如下：
</code></pre></div>

<p>$ tugboat add-key [name-of-your-key] </p>
<div class="highlight"><pre><span></span><code>你可以任意给你的密钥命名（如，“my-default-key”）。当出现提示时，输入公钥路径（如，/home/user/.ssh/id\_rsa.pub）。在密钥上传完成后，运行以下命令来验证密钥是否正确添加：
</code></pre></div>

<p>$ tugboat keys </p>
<div class="highlight"><pre><span></span><code><span class="o">[</span><span class="n">![</span><span class="o">]</span><span class="p">(</span><span class="nl">https</span><span class="p">:</span><span class="o">//</span><span class="n">camo</span><span class="p">.</span><span class="n">githubusercontent</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="mi">83220</span><span class="n">ff178dff29fb42ff5782bcf336be23b80bd</span><span class="o">/</span><span class="mi">68747470733</span><span class="n">a2f2f6661726d342e737461746963666c69636b722e636f6d2f333836392f31343530313835333339375f336433663433363562315f7a2e6a7067</span><span class="p">)</span><span class="err">]</span><span class="p">(</span><span class="nl">https</span><span class="p">:</span><span class="o">//</span><span class="n">camo</span><span class="p">.</span><span class="n">githubusercontent</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="mi">83220</span><span class="n">ff178dff29fb42ff5782bcf336be23b80bd</span><span class="o">/</span><span class="mi">68747470733</span><span class="n">a2f2f6661726d342e737461746963666c69636b722e636f6d2f333836392f31343530313835333339375f336433663433363562315f7a2e6a7067</span><span class="p">)</span>


<span class="n">密钥也应该出现在DigitalOcean的</span><span class="o">[</span><span class="n">SSH密钥页</span><span class="o">]</span><span class="p">(</span><span class="nl">https</span><span class="p">:</span><span class="o">//</span><span class="n">cloud</span><span class="p">.</span><span class="n">digitalocean</span><span class="p">.</span><span class="n">com</span><span class="o">/</span><span class="n">ssh_keys</span><span class="p">)</span><span class="err">。</span><span class="n">如果你想要密钥自动使用到水滴中</span><span class="err">，</span><span class="n">添加密钥ID到</span><span class="o">~/</span><span class="p">.</span><span class="n">tugboat中</span><span class="err">。</span>
</code></pre></div>

<p>ssh_key: '182710'</p>
<div class="highlight"><pre><span></span><code>### Tugboat的基本用法


这里列出了tugboat命令行的一些基本使用情况。


1. 使用默认设置创建新水滴。
</code></pre></div>

<p>$ tugboat create</p>
<div class="highlight"><pre><span></span><code><span class="mf">2.</span><span class="w"> </span><span class="n">列出所有活动水滴</span><span class="err">。</span>
</code></pre></div>

<p>$ tugboat droplets</p>
<div class="highlight"><pre><span></span><code><span class="mf">3.</span><span class="w"> </span><span class="n">显示水滴的信息</span><span class="err">。</span>
</code></pre></div>

<p>$ tugboat info</p>
<div class="highlight"><pre><span></span><code>[![](https://camo.githubusercontent.com/072f24ab8b997de2a447ccbcad0a7d1dbeb881dd/68747470733a2f2f6661726d362e737461746963666c69636b722e636f6d2f353539332f31343530313632373434305f353833353530366432615f7a2e6a7067)](https://www.flickr.com/photos/xmodulo/14501627440/)


1. 关闭水滴，并移除镜像。
</code></pre></div>

<p>$ tugboat destroy</p>
<div class="highlight"><pre><span></span><code><span class="mf">2.</span><span class="w"> </span><span class="n">关闭水滴</span><span class="err">，</span><span class="n">但保持镜像</span>
</code></pre></div>

<p>$ tugboat halt</p>
<div class="highlight"><pre><span></span><code><span class="mf">3.</span><span class="w"> </span><span class="n">为水滴创建快照</span><span class="err">，</span><span class="n">水滴必须先关闭</span><span class="err">。</span>
</code></pre></div>

<p>$ tugboat snapshot</p>
<div class="highlight"><pre><span></span><code><span class="mf">4.</span><span class="w"> </span><span class="n">调整水滴大小</span><span class="err">（</span><span class="n">增加或减少RAM大小</span><span class="err">），</span><span class="n">水滴必须先关闭</span><span class="err">。</span>
</code></pre></div>

<p>$ tugboat resize -s</p>
<div class="highlight"><pre><span></span><code> 如果你想要了解特定命令的更多选项，运行：
</code></pre></div>

<p>$ tugboat help <command> </p>
<div class="highlight"><pre><span></span><code>[![](https://camo.githubusercontent.com/c09480574cc9ce3fa84740423f2d52e279f365b4/68747470733a2f2f6661726d342e737461746963666c69636b722e636f6d2f333930302f31343638383031333332325f346661363038306335655f7a2e6a7067)](https://camo.githubusercontent.com/c09480574cc9ce3fa84740423f2d52e279f365b4/68747470733a2f2f6661726d342e737461746963666c69636b722e636f6d2f333930302f31343638383031333332325f346661363038306335655f7a2e6a7067)


### 排障


1. 当我运行tugboat命令时，它出现以下错误。
</code></pre></div>

<p>/usr/lib/ruby/site_ruby/1.8/rubygems/custom_require.rb:31:in `gem_original_require': /usr/lib/ruby/gems/1.8/gems/tugboat-0.2.0/lib/tugboat/cli.rb:12: syntax error, unexpected ':', expecting kEND (SyntaxError)</p>
<div class="highlight"><pre><span></span><code>Tugboat要求Ruby 1.9及更高版本，你需要升级Ruby来解决该问题。对于CentOS，请参考[此教程](http://ask.xmodulo.com/upgrade-ruby-centos.html)
2. 当我试着用gem来安装Tugboat时，出现了下面的错误。
</code></pre></div>

<p>/usr/local/share/ruby/site_ruby/rubygems/core_ext/kernel_require.rb:55:in `require': cannot load such file -- json/pure (LoadError)</p>
<div class="highlight"><pre><span></span><code> 安装以下gem来修复该问题。
</code></pre></div>

<p>$ sudo gem install json_pure </p>
<p>```</p>
    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>links</h2>
                        <ul>
                            <li><a href="https://getpelican.com/">Pelican</a></li>
                            <li><a href="https://www.python.org/">Python.org</a></li>
                            <li><a href="https://palletsprojects.com/p/jinja/">Jinja2</a></li>
                            <li><a href="#">You can modify those links in your config file</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>

                            <li><a href="#">You can add links in your config file</a></li>
                            <li><a href="#">Another social link</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a rel="nofollow" href="https://getpelican.com/">Pelican</a>, which takes great advantage of <a rel="nofollow" href="https://www.python.org/">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a rel="nofollow" href="https://www.smashingmagazine.com/2009/08/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>