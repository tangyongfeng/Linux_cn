<!DOCTYPE html>
<html lang="zh">
<head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="generator" content="Pelican" />
        <title>Linux 下 SSH 命令实例指南</title>
        <link rel="stylesheet" href="/theme/css/main.css" />
        <meta name="description" content="Author: '' 如果你已经在IT圈内混久了, 应该对 SSH 这个了不起的工具及其安全特性有所耳闻吧. 本教程可以让你在短时间内掌握通过 SSH 安全 …" />
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">linux_cn</a></h1>
                <nav><ul>
                    <li><a href="/category/chuan-shan-jia-zhuan-fang">穿山甲专访</a></li>
                    <li><a href="/category/dai-ma-ying-xiong">代码英雄</a></li>
                    <li><a href="/category/fen-xiang">分享</a></li>
                    <li><a href="/category/guan-dian">观点</a></li>
                    <li><a href="/category/huo-dong">活动</a></li>
                    <li><a href="/category/ji-ke-man-hua">极客漫画</a></li>
                    <li class="active"><a href="/category/ji-zhu">技术</a></li>
                    <li><a href="/category/kai-yuan-zhi-hui">开源智慧</a></li>
                    <li><a href="/category/linux-fa-xing-ban">Linux 发行版</a></li>
                    <li><a href="/category/mei-ri-an-quan-zi-xun">每日安全资讯</a></li>
                    <li><a href="/category/misc">Misc</a></li>
                    <li><a href="/category/qu-kuai-lian">区块链</a></li>
                    <li><a href="/category/rong-qi-yu-yun">容器与云</a></li>
                    <li><a href="/category/ruan-jian-kai-fa">软件开发</a></li>
                    <li><a href="/category/shu-mei-pai">树莓派</a></li>
                    <li><a href="/category/xi-tong-yun-wei">系统运维</a></li>
                    <li><a href="/category/xin-wen">新闻</a></li>
                    <li><a href="/category/ying-he-guan-cha">硬核观察</a></li>
                    <li><a href="/category/zhi-ye-sheng-ya">职业生涯</a></li>
                    <li><a href="/category/zhong-jiang-ming-dan">中奖名单</a></li>
                    <li><a href="/category/zhuo-mian-ying-yong">桌面应用</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="/2014/09/linux-xia-ssh-ming-ling-shi-li-zhi-nan.html" rel="bookmark"
           title="Permalink to Linux 下 SSH 命令实例指南">Linux 下 SSH 命令实例指南</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2014-09-19T11:21:10+02:00">
                Published: Fri 19 September 2014
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/linux-fans-from-china.html">linux fans from china</a>
        </address>
<p>In <a href="/category/ji-zhu">技术</a>.</p>

</footer><!-- /.post-info -->      <p>Author: ''</p>
<p>如果你已经在IT圈内混久了, 应该对 SSH 这个了不起的工具及其安全特性有所耳闻吧. 本教程可以让你在短时间内掌握通过 SSH 安全便利地连接到远程计算机的技术.</p>
<p>如果你对 SSH 还没什么概念, 可以先访问 <a href="http://en.wikipedia.org/wiki/Secure_Shell">维基百科</a> 进行了解.</p>
<p><img alt="" src="/data/attachment/album/201409/19/111947i1cwfxw266wtizcj.jpg"></p>
<h3>基本用法</h3>
<p>最简单的 SSH 命令只需要指定用户名和主机名参数即可. 主机名可以是 IP 地址或者域名. 命令格式如下:</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>ssh<span class="w"> </span>user@hostname
</code></pre></div>

<p>比如要在我的局域网内登录一个树莓派系统, 只需要简单的在命令行输入如下命令:</p>
<div class="highlight"><pre><span></span><code><span class="n">$</span><span class="w"> </span><span class="n">ssh</span><span class="w"> </span><span class="n">pi</span><span class="mf">@10.42.0.47</span>
</code></pre></div>

<p>命令中的 pi 和 10.42.0.47 分别是我的树莓派系统的用户名和局域网 IP 地址. 实际使用时主机名需要改成你的目标主机(局域网内或者远程)的 IP 地址.</p>
<p><a href="https://camo.githubusercontent.com/1e43983e7bac8f1f42b6d584925a7e061d0e4065/687474703a2f2f6c696e6f786964652e636f6d2f77702d636f6e74656e742f75706c6f6164732f323031342f30382f62617369632d7373682e706e67"><img alt="basic ssh" src="https://camo.githubusercontent.com/1e43983e7bac8f1f42b6d584925a7e061d0e4065/687474703a2f2f6c696e6f786964652e636f6d2f77702d636f6e74656e742f75706c6f6164732f323031342f30382f62617369632d7373682e706e67"></a></p>
<p>如果你能够成功登陆, 那么下面的内容对你来说就轻而易举了.</p>
<h3>使用其他端口</h3>
<p>SSH 默认连接到目标主机的 22 端口上,但是由于各种原因你可能需要连接到其他端口.</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>ssh<span class="w"> </span>-p<span class="w"> </span><span class="m">10022</span><span class="w"> </span>user@hostname
</code></pre></div>

<p>如上命令就是通过添加参数 -p 指定端口号为 10022.</p>
<h3>远程执行命令</h3>
<p>有时在远程主机执行一条命令并显示到本地, 然后继续本地工作是很方便的. SSH 就能满足这个需求:</p>
<div class="highlight"><pre><span></span><code><span class="n">$</span><span class="w"> </span><span class="n">ssh</span><span class="w"> </span><span class="n">pi</span><span class="mf">@10.42.0.47</span><span class="w"> </span><span class="n">ls</span><span class="w"> </span><span class="o">-</span><span class="n">l</span>
</code></pre></div>

<p>比如上面这个命令就会枚举远程主机的主目录内容并在本地显示. 是不是很酷? 你可以尝试下其他命令看看.</p>
<p><a href="https://camo.githubusercontent.com/c903546aabf7fbc3bb801a2272e596ea71cb205c/687474703a2f2f6c696e6f786964652e636f6d2f77702d636f6e74656e742f75706c6f6164732f323031342f30382f72656d6f74652d636f6d6d616e642e706e67"><img alt="remote command" src="https://camo.githubusercontent.com/c903546aabf7fbc3bb801a2272e596ea71cb205c/687474703a2f2f6c696e6f786964652e636f6d2f77702d636f6e74656e742f75706c6f6164732f323031342f30382f72656d6f74652d636f6d6d616e642e706e67"></a></p>
<h3>挂载远程文件系统</h3>
<p>另外一个很赞的基于 SSH 的工具叫 sshfs. sshfs 可以让你在本地直接挂载远程主机的文件系统.</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>sshfs<span class="w"> </span>-o<span class="w"> </span><span class="nv">idmap</span><span class="o">=</span>user<span class="w"> </span>user@hostname:/home/user<span class="w"> </span>~/Remote
</code></pre></div>

<p>比如下面这条命令:</p>
<div class="highlight"><pre><span></span><code><span class="n">$</span><span class="w"> </span><span class="n">sshfs</span><span class="w"> </span><span class="o">-</span><span class="n">o</span><span class="w"> </span><span class="n">idmap</span><span class="o">=</span><span class="n">user</span><span class="w"> </span><span class="n">pi</span><span class="mf">@10.42.0.47</span><span class="o">:/</span><span class="n">home</span><span class="o">/</span><span class="n">pi</span><span class="w"> </span><span class="o">~/</span><span class="n">Pi</span>
</code></pre></div>

<p>该命令就将远程主机 pi 用户的主目录挂载到本地主目录下的 Pi 文件夹.</p>
<p>要详细了解可以参考 <a href="http://linoxide.com/how-tos/sshfs-mount-remote-directories/">sshfs 教程</a>.</p>
<h3>X11 图形界面</h3>
<p>假如现在你想要在远程主机运行一个图形界面的程序, SSH 已经帮你想到了! 用前面提到的 SSH 基本命令加上参数 -X 连接到远程主机即可开启 X11 转发功能. 登录后你可能觉得没什么差别, 但是当你运行一个图形界面程序后就会发现其中的不同的.</p>
<div class="highlight"><pre><span></span><code><span class="n">$</span><span class="w"> </span><span class="n">ssh</span><span class="w"> </span><span class="o">-</span><span class="n">X</span><span class="w"> </span><span class="n">pi</span><span class="mf">@10.42.0.47</span>

<span class="n">$</span><span class="w"> </span><span class="n">pistore</span>
</code></pre></div>

<p>如果你想在运行图形界面程序的同时做些别的事情, 只需要简单地在命令末尾加一个 &amp; 符号.</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>pistore<span class="p">&amp;</span>
</code></pre></div>

<p><a href="https://camo.githubusercontent.com/d715e18be2f1f129dbbf9a15b746b5dd9e47abf8/687474703a2f2f6c696e6f786964652e636f6d2f77702d636f6e74656e742f75706c6f6164732f323031342f30382f5831312d666f7277617264696e672e706e67"><img alt="X11 forwarding" src="https://camo.githubusercontent.com/d715e18be2f1f129dbbf9a15b746b5dd9e47abf8/687474703a2f2f6c696e6f786964652e636f6d2f77702d636f6e74656e742f75706c6f6164732f323031342f30382f5831312d666f7277617264696e672e706e67"></a></p>
<h3>转义字符</h3>
<p>SSH 提供了多样的转义字符功能. 用 SSH 连接到任意一台远程主机然后输入 ~? 你就可以看到支持的转义字符和功能说明列表. 以下例子展示了 <strong>~#</strong> 和 <strong>~C</strong> 的效果.</p>
<p><a href="https://camo.githubusercontent.com/ddd855602a65b0186b86f9ef51005fc3f2af8072/687474703a2f2f6c696e6f786964652e636f6d2f77702d636f6e74656e742f75706c6f6164732f323031342f30382f6573636170652d73657175656e6365732e706e67"><img alt="escape sequences" src="https://camo.githubusercontent.com/ddd855602a65b0186b86f9ef51005fc3f2af8072/687474703a2f2f6c696e6f786964652e636f6d2f77702d636f6e74656e742f75706c6f6164732f323031342f30382f6573636170652d73657175656e6365732e706e67"></a></p>
<h3>配置 SSH</h3>
<p>如果你需要改变 SSH 的配置, 请用你喜好的文本编辑器打开 <strong>/etc/ssh/sshd_config</strong> 进行编辑. 比如你想改变登陆的标语, 在配置文件中找到下面这行:</p>
<div class="highlight"><pre><span></span><code>#Banner none
</code></pre></div>

<p>删除 # 字符(取消该行的注释), 将 none 替换为包含你期望显示内容的文件地址. 修改后该行应该类似这样:</p>
<div class="highlight"><pre><span></span><code>Banner /etc/issue
</code></pre></div>

<p>在配置文件 <strong>/etc/ssh/sshd_config</strong> 中你还可以找到端口号, 空闲超时时间等配置项. 配置项大都比较容易理解, 但是保险起见在你修改一些不是很确定的配置项时最好参考下 SSH 的帮助文档.</p>
<h3>构建 ssh 密钥对</h3>
<p>运行以下命令创建密钥对:</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>ssh-keygen<span class="w"> </span>-t<span class="w"> </span>dsa
</code></pre></div>

<p>此命令会要求你输入密码(可以留空), 然后就会生成密钥并会显示一张该密钥对应的随机图.</p>
<p><a href="https://camo.githubusercontent.com/0390da4566f00cdd946e2e2b7468cffdf20ce333/687474703a2f2f6c696e6f786964652e636f6d2f77702d636f6e74656e742f75706c6f6164732f323031342f30382f67656e65726174652d6b65792d706169722e706e67"><img alt="generate key pair" src="https://camo.githubusercontent.com/0390da4566f00cdd946e2e2b7468cffdf20ce333/687474703a2f2f6c696e6f786964652e636f6d2f77702d636f6e74656e742f75706c6f6164732f323031342f30382f67656e65726174652d6b65792d706169722e706e67"></a></p>
<h3>寻找主机密钥</h3>
<p>在你准备添加密钥之前不妨先用以下命令看看是否已经添加了对应主机的密钥了.</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>ssh-keygen<span class="w"> </span>-F<span class="w"> </span><span class="m">10</span>.42.0.47
</code></pre></div>

<p><a href="https://camo.githubusercontent.com/6d28a8efb78372999be68dc92e7b1f627688f9b9/687474703a2f2f6c696e6f786964652e636f6d2f77702d636f6e74656e742f75706c6f6164732f323031342f30382f66696e642d686f73746b65792e706e67"><img alt="find hostkey" src="https://camo.githubusercontent.com/6d28a8efb78372999be68dc92e7b1f627688f9b9/687474703a2f2f6c696e6f786964652e636f6d2f77702d636f6e74656e742f75706c6f6164732f323031342f30382f66696e642d686f73746b65792e706e67"></a></p>
<h3>删除主机密钥</h3>
<p>某些情况下, 比如主机地址更改或者不再使用某个密钥, 你就可能需要删除某个密钥.</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>ssh-keygen<span class="w"> </span>-R<span class="w"> </span><span class="m">10</span>.42.0.47
</code></pre></div>

<p>用以上命令就可删除. 这比手动在 <strong>~/.ssh/known_hosts</strong> 文件中删除要方便很多.</p>
<p><a href="https://camo.githubusercontent.com/24b1022ed842b3bc5f44253f0a48ae81991188ab/687474703a2f2f6c696e6f786964652e636f6d2f77702d636f6e74656e742f75706c6f6164732f323031342f30382f72656d6f76652d686f73746b65792e706e67"><img alt="remove hostkey" src="https://camo.githubusercontent.com/24b1022ed842b3bc5f44253f0a48ae81991188ab/687474703a2f2f6c696e6f786964652e636f6d2f77702d636f6e74656e742f75706c6f6164732f323031342f30382f72656d6f76652d686f73746b65792e706e67"></a></p>
<h3>总结</h3>
<p>通过以上的内容你应该可以轻松使用 SSH 了. SSH 还有很多功能值得你去发掘, 这就要看你的想象力了。</p>
    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>links</h2>
                        <ul>
                            <li><a href="https://getpelican.com/">Pelican</a></li>
                            <li><a href="https://www.python.org/">Python.org</a></li>
                            <li><a href="https://palletsprojects.com/p/jinja/">Jinja2</a></li>
                            <li><a href="#">You can modify those links in your config file</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>

                            <li><a href="#">You can add links in your config file</a></li>
                            <li><a href="#">Another social link</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a rel="nofollow" href="https://getpelican.com/">Pelican</a>, which takes great advantage of <a rel="nofollow" href="https://www.python.org/">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a rel="nofollow" href="https://www.smashingmagazine.com/2009/08/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>