<!DOCTYPE html>
<html lang="zh">
<head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="generator" content="Pelican" />
        <title>如何在 Ubuntu 上使用 Grafana 监控 Docker</title>
        <link rel="stylesheet" href="/theme/css/main.css" />
        <meta name="description" content="Author: Saheetha Shameer Grafana 是一个有着丰富指标的开源控制面板。在可视化大规模测量数据的时候是非常有用的。根据不同的指标数据，它 …" />
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">linux_cn</a></h1>
                <nav><ul>
                    <li><a href="/category/chuan-shan-jia-zhuan-fang">穿山甲专访</a></li>
                    <li><a href="/category/dai-ma-ying-xiong">代码英雄</a></li>
                    <li><a href="/category/fen-xiang">分享</a></li>
                    <li><a href="/category/guan-dian">观点</a></li>
                    <li><a href="/category/huo-dong">活动</a></li>
                    <li><a href="/category/ji-ke-man-hua">极客漫画</a></li>
                    <li><a href="/category/ji-zhu">技术</a></li>
                    <li><a href="/category/kai-yuan-zhi-hui">开源智慧</a></li>
                    <li><a href="/category/linux-fa-xing-ban">Linux 发行版</a></li>
                    <li><a href="/category/mei-ri-an-quan-zi-xun">每日安全资讯</a></li>
                    <li><a href="/category/misc">Misc</a></li>
                    <li><a href="/category/qu-kuai-lian">区块链</a></li>
                    <li><a href="/category/rong-qi-yu-yun">容器与云</a></li>
                    <li><a href="/category/ruan-jian-kai-fa">软件开发</a></li>
                    <li><a href="/category/shu-mei-pai">树莓派</a></li>
                    <li class="active"><a href="/category/xi-tong-yun-wei">系统运维</a></li>
                    <li><a href="/category/xin-wen">新闻</a></li>
                    <li><a href="/category/ying-he-guan-cha">硬核观察</a></li>
                    <li><a href="/category/zhi-ye-sheng-ya">职业生涯</a></li>
                    <li><a href="/category/zhong-jiang-ming-dan">中奖名单</a></li>
                    <li><a href="/category/zhuo-mian-ying-yong">桌面应用</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="/2016/11/ru-he-zai-ubuntu-shang-shi-yong-grafana-jian-kong-docker.html" rel="bookmark"
           title="Permalink to 如何在 Ubuntu 上使用 Grafana 监控 Docker">如何在 Ubuntu 上使用 Grafana 监控 Docker</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2016-11-03T10:43:00+01:00">
                Published: Thu 03 November 2016
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/linux-fans-from-china.html">linux fans from china</a>
        </address>
<p>In <a href="/category/xi-tong-yun-wei">系统运维</a>.</p>

</footer><!-- /.post-info -->      <p>Author: Saheetha Shameer</p>
<p>Grafana 是一个有着丰富指标的开源控制面板。在可视化大规模测量数据的时候是非常有用的。根据不同的指标数据，它提供了一个强大、优雅的来创建、分享和浏览数据的方式。</p>
<p>它提供了丰富多样、灵活的图形选项。此外，针对<ruby> 数据源 <rp>  （ </rp> <rt>  Data Source </rt> <rp>  ） </rp></ruby>，它支持许多不同的存储后端。每个数据源都有针对特定数据源的特性和功能所定制的查询编辑器。Grafana 提供了对下述数据源的正式支持：Graphite、InfluxDB、OpenTSDB、 Prometheus、Elasticsearch 和 Cloudwatch。</p>
<p>每个数据源的查询语言和能力显然是不同的，你可以将来自多个数据源的数据混合到一个单一的仪表盘上，但每个<ruby> 面板 <rp>  （ </rp> <rt>  Panel </rt> <rp>  ） </rp></ruby>被绑定到属于一个特定<ruby> 组织 <rp>  （ </rp> <rt>  Organization </rt> <rp>  ） </rp></ruby>的特定数据源上。它支持验证登录和基于角色的访问控制方案。它是作为一个独立软件部署，使用 Go 和 JavaScript 编写的。</p>
<p><img alt="" src="/data/attachment/album/201611/03/095645ok0uehrwdehr4eeu.jpg"></p>
<p>在这篇文章，我将讲解如何在 Ubuntu 16.04 上安装 Grafana 并使用这个软件配置 Docker 监控。</p>
<h3>先决条件</h3>
<ul>
<li>安装好 Docker 的服务器</li>
</ul>
<h3>安装 Grafana</h3>
<p>我们可以在 Docker 中构建我们的 Grafana。 有一个官方提供的 Grafana Docker 镜像。请运行下述命令来构建Grafana 容器。</p>
<div class="highlight"><pre><span></span><code><span class="n">root</span><span class="err">@</span><span class="n">ubuntu</span><span class="p">:</span><span class="o">~</span><span class="c1"># docker run -i -p 3000:3000 grafana/grafana</span>

<span class="n">Unable</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">find</span><span class="w"> </span><span class="n">image</span><span class="w"> </span><span class="s1">&#39;grafana/grafana:latest&#39;</span><span class="w"> </span><span class="n">locally</span>
<span class="n">latest</span><span class="p">:</span><span class="w"> </span><span class="n">Pulling</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">grafana</span><span class="o">/</span><span class="n">grafana</span>
<span class="mi">5</span><span class="n">c90d4a2d1a8</span><span class="p">:</span><span class="w"> </span><span class="n">Pull</span><span class="w"> </span><span class="n">complete</span>
<span class="n">b1a9a0b6158e</span><span class="p">:</span><span class="w"> </span><span class="n">Pull</span><span class="w"> </span><span class="n">complete</span>
<span class="n">acb23b0d58de</span><span class="p">:</span><span class="w"> </span><span class="n">Pull</span><span class="w"> </span><span class="n">complete</span>
<span class="n">Digest</span><span class="p">:</span><span class="w"> </span><span class="n">sha256</span><span class="p">:</span><span class="mi">34</span><span class="n">ca2f9c7986cb2d115eea373083f7150a2b9b753210546d14477e2276074ae1</span>
<span class="n">Status</span><span class="p">:</span><span class="w"> </span><span class="n">Downloaded</span><span class="w"> </span><span class="n">newer</span><span class="w"> </span><span class="n">image</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">grafana</span><span class="o">/</span><span class="n">grafana</span><span class="p">:</span><span class="n">latest</span>
<span class="n">t</span><span class="o">=</span><span class="mi">2016</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">27</span><span class="n">T15</span><span class="p">:</span><span class="mi">20</span><span class="p">:</span><span class="mi">19</span><span class="o">+</span><span class="mi">0000</span><span class="w"> </span><span class="n">lvl</span><span class="o">=</span><span class="n">info</span><span class="w"> </span><span class="n">msg</span><span class="o">=</span><span class="s2">&quot;Starting Grafana&quot;</span><span class="w"> </span><span class="n">logger</span><span class="o">=</span><span class="n">main</span><span class="w"> </span><span class="n">version</span><span class="o">=</span><span class="mf">3.1</span><span class="o">.</span><span class="mi">0</span><span class="w"> </span><span class="n">commit</span><span class="o">=</span><span class="n">v3</span><span class="o">.</span><span class="mf">1.0</span><span class="w"> </span><span class="n">compiled</span><span class="o">=</span><span class="mi">2016</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">12</span><span class="n">T06</span><span class="p">:</span><span class="mi">42</span><span class="p">:</span><span class="mi">28</span><span class="o">+</span><span class="mi">0000</span>
<span class="n">t</span><span class="o">=</span><span class="mi">2016</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">27</span><span class="n">T15</span><span class="p">:</span><span class="mi">20</span><span class="p">:</span><span class="mi">19</span><span class="o">+</span><span class="mi">0000</span><span class="w"> </span><span class="n">lvl</span><span class="o">=</span><span class="n">info</span><span class="w"> </span><span class="n">msg</span><span class="o">=</span><span class="s2">&quot;Config loaded from&quot;</span><span class="w"> </span><span class="n">logger</span><span class="o">=</span><span class="n">settings</span><span class="w"> </span><span class="n">file</span><span class="o">=/</span><span class="n">usr</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">grafana</span><span class="o">/</span><span class="n">conf</span><span class="o">/</span><span class="n">defaults</span><span class="o">.</span><span class="n">ini</span>
<span class="n">t</span><span class="o">=</span><span class="mi">2016</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">27</span><span class="n">T15</span><span class="p">:</span><span class="mi">20</span><span class="p">:</span><span class="mi">19</span><span class="o">+</span><span class="mi">0000</span><span class="w"> </span><span class="n">lvl</span><span class="o">=</span><span class="n">info</span><span class="w"> </span><span class="n">msg</span><span class="o">=</span><span class="s2">&quot;Config loaded from&quot;</span><span class="w"> </span><span class="n">logger</span><span class="o">=</span><span class="n">settings</span><span class="w"> </span><span class="n">file</span><span class="o">=/</span><span class="n">etc</span><span class="o">/</span><span class="n">grafana</span><span class="o">/</span><span class="n">grafana</span><span class="o">.</span><span class="n">ini</span>
<span class="n">t</span><span class="o">=</span><span class="mi">2016</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">27</span><span class="n">T15</span><span class="p">:</span><span class="mi">20</span><span class="p">:</span><span class="mi">19</span><span class="o">+</span><span class="mi">0000</span><span class="w"> </span><span class="n">lvl</span><span class="o">=</span><span class="n">info</span><span class="w"> </span><span class="n">msg</span><span class="o">=</span><span class="s2">&quot;Config overriden from command line&quot;</span><span class="w"> </span><span class="n">logger</span><span class="o">=</span><span class="n">settings</span><span class="w"> </span><span class="n">arg</span><span class="o">=</span><span class="s2">&quot;default.paths.data=/var/lib/grafana&quot;</span>
<span class="n">t</span><span class="o">=</span><span class="mi">2016</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">27</span><span class="n">T15</span><span class="p">:</span><span class="mi">20</span><span class="p">:</span><span class="mi">19</span><span class="o">+</span><span class="mi">0000</span><span class="w"> </span><span class="n">lvl</span><span class="o">=</span><span class="n">info</span><span class="w"> </span><span class="n">msg</span><span class="o">=</span><span class="s2">&quot;Config overriden from command line&quot;</span><span class="w"> </span><span class="n">logger</span><span class="o">=</span><span class="n">settings</span><span class="w"> </span><span class="n">arg</span><span class="o">=</span><span class="s2">&quot;default.paths.logs=/var/log/grafana&quot;</span>
<span class="n">t</span><span class="o">=</span><span class="mi">2016</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">27</span><span class="n">T15</span><span class="p">:</span><span class="mi">20</span><span class="p">:</span><span class="mi">19</span><span class="o">+</span><span class="mi">0000</span><span class="w"> </span><span class="n">lvl</span><span class="o">=</span><span class="n">info</span><span class="w"> </span><span class="n">msg</span><span class="o">=</span><span class="s2">&quot;Config overriden from command line&quot;</span><span class="w"> </span><span class="n">logger</span><span class="o">=</span><span class="n">settings</span><span class="w"> </span><span class="n">arg</span><span class="o">=</span><span class="s2">&quot;default.paths.plugins=/var/lib/grafana/plugins&quot;</span>
<span class="n">t</span><span class="o">=</span><span class="mi">2016</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">27</span><span class="n">T15</span><span class="p">:</span><span class="mi">20</span><span class="p">:</span><span class="mi">19</span><span class="o">+</span><span class="mi">0000</span><span class="w"> </span><span class="n">lvl</span><span class="o">=</span><span class="n">info</span><span class="w"> </span><span class="n">msg</span><span class="o">=</span><span class="s2">&quot;Path Home&quot;</span><span class="w"> </span><span class="n">logger</span><span class="o">=</span><span class="n">settings</span><span class="w"> </span><span class="n">path</span><span class="o">=/</span><span class="n">usr</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">grafana</span>
<span class="n">t</span><span class="o">=</span><span class="mi">2016</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">27</span><span class="n">T15</span><span class="p">:</span><span class="mi">20</span><span class="p">:</span><span class="mi">19</span><span class="o">+</span><span class="mi">0000</span><span class="w"> </span><span class="n">lvl</span><span class="o">=</span><span class="n">info</span><span class="w"> </span><span class="n">msg</span><span class="o">=</span><span class="s2">&quot;Path Data&quot;</span><span class="w"> </span><span class="n">logger</span><span class="o">=</span><span class="n">settings</span><span class="w"> </span><span class="n">path</span><span class="o">=/</span><span class="k">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">grafana</span>
<span class="n">t</span><span class="o">=</span><span class="mi">2016</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">27</span><span class="n">T15</span><span class="p">:</span><span class="mi">20</span><span class="p">:</span><span class="mi">19</span><span class="o">+</span><span class="mi">0000</span><span class="w"> </span><span class="n">lvl</span><span class="o">=</span><span class="n">info</span><span class="w"> </span><span class="n">msg</span><span class="o">=</span><span class="s2">&quot;Path Logs&quot;</span><span class="w"> </span><span class="n">logger</span><span class="o">=</span><span class="n">settings</span><span class="w"> </span><span class="n">path</span><span class="o">=/</span><span class="k">var</span><span class="o">/</span><span class="nb">log</span><span class="o">/</span><span class="n">grafana</span>
<span class="n">t</span><span class="o">=</span><span class="mi">2016</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">27</span><span class="n">T15</span><span class="p">:</span><span class="mi">20</span><span class="p">:</span><span class="mi">19</span><span class="o">+</span><span class="mi">0000</span><span class="w"> </span><span class="n">lvl</span><span class="o">=</span><span class="n">info</span><span class="w"> </span><span class="n">msg</span><span class="o">=</span><span class="s2">&quot;Path Plugins&quot;</span><span class="w"> </span><span class="n">logger</span><span class="o">=</span><span class="n">settings</span><span class="w"> </span><span class="n">path</span><span class="o">=/</span><span class="k">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">grafana</span><span class="o">/</span><span class="n">plugins</span>
<span class="n">t</span><span class="o">=</span><span class="mi">2016</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">27</span><span class="n">T15</span><span class="p">:</span><span class="mi">20</span><span class="p">:</span><span class="mi">19</span><span class="o">+</span><span class="mi">0000</span><span class="w"> </span><span class="n">lvl</span><span class="o">=</span><span class="n">info</span><span class="w"> </span><span class="n">msg</span><span class="o">=</span><span class="s2">&quot;Initializing DB&quot;</span><span class="w"> </span><span class="n">logger</span><span class="o">=</span><span class="n">sqlstore</span><span class="w"> </span><span class="n">dbtype</span><span class="o">=</span><span class="n">sqlite3</span>

<span class="n">t</span><span class="o">=</span><span class="mi">2016</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">27</span><span class="n">T15</span><span class="p">:</span><span class="mi">20</span><span class="p">:</span><span class="mi">20</span><span class="o">+</span><span class="mi">0000</span><span class="w"> </span><span class="n">lvl</span><span class="o">=</span><span class="n">info</span><span class="w"> </span><span class="n">msg</span><span class="o">=</span><span class="s2">&quot;Executing migration&quot;</span><span class="w"> </span><span class="n">logger</span><span class="o">=</span><span class="n">migrator</span><span class="w"> </span><span class="n">id</span><span class="o">=</span><span class="s2">&quot;create playlist table v2&quot;</span>
<span class="n">t</span><span class="o">=</span><span class="mi">2016</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">27</span><span class="n">T15</span><span class="p">:</span><span class="mi">20</span><span class="p">:</span><span class="mi">20</span><span class="o">+</span><span class="mi">0000</span><span class="w"> </span><span class="n">lvl</span><span class="o">=</span><span class="n">info</span><span class="w"> </span><span class="n">msg</span><span class="o">=</span><span class="s2">&quot;Executing migration&quot;</span><span class="w"> </span><span class="n">logger</span><span class="o">=</span><span class="n">migrator</span><span class="w"> </span><span class="n">id</span><span class="o">=</span><span class="s2">&quot;create playlist item table v2&quot;</span>
<span class="n">t</span><span class="o">=</span><span class="mi">2016</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">27</span><span class="n">T15</span><span class="p">:</span><span class="mi">20</span><span class="p">:</span><span class="mi">20</span><span class="o">+</span><span class="mi">0000</span><span class="w"> </span><span class="n">lvl</span><span class="o">=</span><span class="n">info</span><span class="w"> </span><span class="n">msg</span><span class="o">=</span><span class="s2">&quot;Executing migration&quot;</span><span class="w"> </span><span class="n">logger</span><span class="o">=</span><span class="n">migrator</span><span class="w"> </span><span class="n">id</span><span class="o">=</span><span class="s2">&quot;drop preferences table v2&quot;</span>
<span class="n">t</span><span class="o">=</span><span class="mi">2016</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">27</span><span class="n">T15</span><span class="p">:</span><span class="mi">20</span><span class="p">:</span><span class="mi">20</span><span class="o">+</span><span class="mi">0000</span><span class="w"> </span><span class="n">lvl</span><span class="o">=</span><span class="n">info</span><span class="w"> </span><span class="n">msg</span><span class="o">=</span><span class="s2">&quot;Executing migration&quot;</span><span class="w"> </span><span class="n">logger</span><span class="o">=</span><span class="n">migrator</span><span class="w"> </span><span class="n">id</span><span class="o">=</span><span class="s2">&quot;drop preferences table v3&quot;</span>
<span class="n">t</span><span class="o">=</span><span class="mi">2016</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">27</span><span class="n">T15</span><span class="p">:</span><span class="mi">20</span><span class="p">:</span><span class="mi">20</span><span class="o">+</span><span class="mi">0000</span><span class="w"> </span><span class="n">lvl</span><span class="o">=</span><span class="n">info</span><span class="w"> </span><span class="n">msg</span><span class="o">=</span><span class="s2">&quot;Executing migration&quot;</span><span class="w"> </span><span class="n">logger</span><span class="o">=</span><span class="n">migrator</span><span class="w"> </span><span class="n">id</span><span class="o">=</span><span class="s2">&quot;create preferences table v3&quot;</span>
<span class="n">t</span><span class="o">=</span><span class="mi">2016</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">27</span><span class="n">T15</span><span class="p">:</span><span class="mi">20</span><span class="p">:</span><span class="mi">20</span><span class="o">+</span><span class="mi">0000</span><span class="w"> </span><span class="n">lvl</span><span class="o">=</span><span class="n">info</span><span class="w"> </span><span class="n">msg</span><span class="o">=</span><span class="s2">&quot;Created default admin user: [admin]&quot;</span>
<span class="n">t</span><span class="o">=</span><span class="mi">2016</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">27</span><span class="n">T15</span><span class="p">:</span><span class="mi">20</span><span class="p">:</span><span class="mi">20</span><span class="o">+</span><span class="mi">0000</span><span class="w"> </span><span class="n">lvl</span><span class="o">=</span><span class="n">info</span><span class="w"> </span><span class="n">msg</span><span class="o">=</span><span class="s2">&quot;Starting plugin search&quot;</span><span class="w"> </span><span class="n">logger</span><span class="o">=</span><span class="n">plugins</span>
<span class="n">t</span><span class="o">=</span><span class="mi">2016</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">27</span><span class="n">T15</span><span class="p">:</span><span class="mi">20</span><span class="p">:</span><span class="mi">20</span><span class="o">+</span><span class="mi">0000</span><span class="w"> </span><span class="n">lvl</span><span class="o">=</span><span class="n">info</span><span class="w"> </span><span class="n">msg</span><span class="o">=</span><span class="s2">&quot;Server Listening&quot;</span><span class="w"> </span><span class="n">logger</span><span class="o">=</span><span class="n">server</span><span class="w"> </span><span class="n">address</span><span class="o">=</span><span class="mf">0.0</span><span class="o">.</span><span class="mf">0.0</span><span class="p">:</span><span class="mi">3000</span><span class="w"> </span><span class="n">protocol</span><span class="o">=</span><span class="n">http</span><span class="w"> </span><span class="n">subUrl</span><span class="o">=</span>
</code></pre></div>

<p>我们可以通过运行此命令确认 Grafana 容器的工作状态 <code>docker ps -a</code> 或通过这个URL访问 <code>http://Docker IP:3000</code>。</p>
<p>所有的 Grafana 配置设置都使用环境变量定义，在使用容器技术时这个是非常有用的。Grafana 配置文件路径为 <code>/etc/grafana/grafana.ini</code>。</p>
<h3>理解配置项</h3>
<p>Grafana 可以在它的 ini 配置文件中指定几个配置选项，或可以使用前面提到的环境变量来指定。</p>
<h4>配置文件位置</h4>
<p>通常配置文件路径：</p>
<ul>
<li>默认配置文件路径 : <code>$WORKING_DIR/conf/defaults.ini</code></li>
<li>自定义配置文件路径 : <code>$WORKING_DIR/conf/custom.ini</code></li>
</ul>
<p>PS：当你使用 deb、rpm 或 docker 镜像安装 Grafana 时，你的配置文件在 <code>/etc/grafana/grafana.ini</code>。</p>
<h4>理解配置变量</h4>
<p>现在我们看一些配置文件中的变量：</p>
<ul>
<li><code>instance_name</code>：这是 Grafana 服务器实例的名字。默认值从 <code>${HOSTNAME}</code> 获取，其值是环境变量<code>HOSTNAME</code>，如果该变量为空或不存在，Grafana 将会尝试使用系统调用来获取机器名。</li>
<li><code>[paths]</code>：这些路径通常都是在 init.d 脚本或 systemd service 文件中通过命令行指定。<ul>
<li><code>data</code>：这个是 Grafana 存储 sqlite3 数据库（如果使用）、基于文件的会话（如果使用），和其他数据的路径。</li>
<li><code>logs</code>：这个是 Grafana 存储日志的路径。</li>
</ul>
</li>
<li><code>[server]</code><ul>
<li><code>http_addr</code>：应用监听的 IP 地址，如果为空，则监听所有的接口。</li>
<li><code>http_port</code>：应用监听的端口，默认是 3000，你可以使用下面的命令将你的 80 端口重定向到 3000 端口：<code>$iptables -t nat -A PREROUTING -p tcp --dport 80 -j REDIRECT --to-port 3000</code></li>
<li><code>root_url</code> : 这个 URL 用于从浏览器访问 Grafana 。</li>
<li><code>cert_file</code> : 证书文件的路径（如果协议是 HTTPS）。</li>
<li><code>cert_key</code> : 证书密钥文件的路径（如果协议是 HTTPS）。</li>
</ul>
</li>
<li><code>[database]</code>：Grafana 使用数据库来存储用户和仪表盘以及其他信息，默认配置为使用内嵌在 Grafana 主二进制文件中的 SQLite3。<ul>
<li><code>type</code>：你可以根据你的需求选择 MySQL、Postgres、SQLite3。</li>
<li><code>path</code>：仅用于选择 SQLite3 数据库时，这个是数据库所存储的路径。</li>
<li><code>host</code>：仅适用 MySQL 或者 Postgres。它包括 IP 地址或主机名以及端口。例如，Grafana 和 MySQL 运行在同一台主机上设置如： <code>host = 127.0.0.1:3306</code>。</li>
<li><code>name</code>：Grafana 数据库的名称，把它设置为 Grafana 或其它名称。</li>
<li><code>user</code>：数据库用户（不适用于 SQLite3）。</li>
<li><code>password</code>：数据库用户密码（不适用于 SQLite3）。</li>
<li><code>ssl_mode</code>：对于 Postgres，使用 <code>disable</code>，<code>require</code>，或 <code>verify-full</code> 等值。对于 MySQL，使用 <code>true</code>，<code>false</code>，或 <code>skip-verify</code>。</li>
<li><code>ca_cert_path</code>：（只适用于 MySQL）CA 证书文件路径，在多数 Linux 系统中，证书可以在 <code>/etc/ssl/certs</code> 找到。</li>
<li><code>client_key_path</code>：（只适用于 MySQL）客户端密钥的路径，只在服务端需要用户端验证时使用。</li>
<li><code>client_cert_path</code>：（只适用于 MySQL）客户端证书的路径，只在服务端需要用户端验证时使用。</li>
<li><code>server_cert_name</code>：（只适用于 MySQL）MySQL 服务端使用的证书的通用名称字段。如果 <code>ssl_mode</code> 设置为 <code>skip-verify</code> 时可以不设置。</li>
</ul>
</li>
<li><code>[security]</code><ul>
<li><code>admin_user</code>：这个是 Grafana 默认的管理员用户的用户名，默认设置为 admin。</li>
<li><code>admin_password</code>：这个是 Grafana 默认的管理员用户的密码，在第一次运行时设置，默认为 admin。</li>
<li><code>login_remember_days</code>：保持登录/记住我的持续天数。</li>
<li><code>secret_key</code>：用于保持登录/记住我的 cookies 的签名。</li>
</ul>
</li>
</ul>
<h3>设置监控的重要组件</h3>
<p>我们可以使用下面的组件来创建我们的 Docker 监控系统。</p>
<ul>
<li><code>cAdvisor</code>：它被称为 Container Advisor。它给用户提供了一个资源利用和性能特征的解读。它会收集、聚合、处理、导出运行中的容器的信息。你可以通过<a href="https://github.com/google/cadvisor">这个文档</a>了解更多。</li>
<li><code>InfluxDB</code>：这是一个包含了时间序列、度量和分析数据库。我们使用这个数据源来设置我们的监控。cAdvisor 只展示实时信息，并不保存这些度量信息。Influx Db 帮助保存 cAdvisor 提供的监控数据，以展示非某一时段的数据。</li>
<li><code>Grafana Dashboard</code>：它可以帮助我们在视觉上整合所有的信息。这个强大的仪表盘使我们能够针对 InfluxDB 数据存储进行查询并将他们放在一个布局合理好看的图表中。</li>
</ul>
<h3>Docker 监控的安装</h3>
<p>我们需要一步一步的在我们的 Docker 系统中安装以下每一个组件：</p>
<h4>安装 InfluxDB</h4>
<p>我们可以使用这个命令来拉取 InfluxDB 镜像，并部署了 influxDB 容器。</p>
<div class="highlight"><pre><span></span><code><span class="n">root</span><span class="err">@</span><span class="n">ubuntu</span><span class="p">:</span><span class="o">~</span><span class="c1"># docker run -d -p 8083:8083 -p 8086:8086 --expose 8090 --expose 8099 -e PRE_CREATE_DB=cadvisor --name influxsrv tutum/influxdb:0.8.8</span>
<span class="n">Unable</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">find</span><span class="w"> </span><span class="n">image</span><span class="w"> </span><span class="s1">&#39;tutum/influxdb:0.8.8&#39;</span><span class="w"> </span><span class="n">locally</span>
<span class="mf">0.8</span><span class="o">.</span><span class="mi">8</span><span class="p">:</span><span class="w"> </span><span class="n">Pulling</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">tutum</span><span class="o">/</span><span class="n">influxdb</span>
<span class="n">a3ed95caeb02</span><span class="p">:</span><span class="w"> </span><span class="n">Already</span><span class="w"> </span><span class="n">exists</span>
<span class="mi">23</span><span class="n">efb549476f</span><span class="p">:</span><span class="w"> </span><span class="n">Already</span><span class="w"> </span><span class="n">exists</span>
<span class="n">aa2f8df21433</span><span class="p">:</span><span class="w"> </span><span class="n">Already</span><span class="w"> </span><span class="n">exists</span>
<span class="n">ef072d3c9b41</span><span class="p">:</span><span class="w"> </span><span class="n">Already</span><span class="w"> </span><span class="n">exists</span>
<span class="n">c9f371853f28</span><span class="p">:</span><span class="w"> </span><span class="n">Already</span><span class="w"> </span><span class="n">exists</span>
<span class="n">a248b0871c3c</span><span class="p">:</span><span class="w"> </span><span class="n">Already</span><span class="w"> </span><span class="n">exists</span>
<span class="mi">749</span><span class="n">db6d368d0</span><span class="p">:</span><span class="w"> </span><span class="n">Already</span><span class="w"> </span><span class="n">exists</span>
<span class="mi">7</span><span class="n">d7c7d923e63</span><span class="p">:</span><span class="w"> </span><span class="n">Pull</span><span class="w"> </span><span class="n">complete</span>
<span class="n">e47cc7808961</span><span class="p">:</span><span class="w"> </span><span class="n">Pull</span><span class="w"> </span><span class="n">complete</span>
<span class="mi">1743</span><span class="n">b6eeb23f</span><span class="p">:</span><span class="w"> </span><span class="n">Pull</span><span class="w"> </span><span class="n">complete</span>
<span class="n">Digest</span><span class="p">:</span><span class="w"> </span><span class="n">sha256</span><span class="p">:</span><span class="mi">8494</span><span class="n">b31289b4dbc1d5b444e344ab1dda3e18b07f80517c3f9aae7d18133c0c42</span>
<span class="n">Status</span><span class="p">:</span><span class="w"> </span><span class="n">Downloaded</span><span class="w"> </span><span class="n">newer</span><span class="w"> </span><span class="n">image</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">tutum</span><span class="o">/</span><span class="n">influxdb</span><span class="p">:</span><span class="mf">0.8</span><span class="o">.</span><span class="mi">8</span>
<span class="n">d3b6f7789e0d1d01fa4e0aacdb636c221421107d1df96808ecbe8e241ceb1823</span>

<span class="w">    </span><span class="o">-</span><span class="n">p</span><span class="w"> </span><span class="mi">8083</span><span class="p">:</span><span class="mi">8083</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="n">interface</span><span class="p">,</span><span class="w"> </span><span class="nb">log</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">username</span><span class="o">-</span><span class="n">admin</span><span class="p">,</span><span class="w"> </span><span class="k">pass</span><span class="o">-</span><span class="n">admin</span>
<span class="w">    </span><span class="o">-</span><span class="n">p</span><span class="w"> </span><span class="mi">8086</span><span class="p">:</span><span class="mi">8086</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">interaction</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">other</span><span class="w"> </span><span class="n">application</span>
<span class="w">    </span><span class="o">--</span><span class="n">name</span><span class="w"> </span><span class="n">influxsrv</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">container</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="n">influxsrv</span><span class="p">,</span><span class="w"> </span><span class="n">use</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">cAdvisor</span><span class="w"> </span><span class="n">link</span><span class="w"> </span><span class="n">it</span><span class="o">.</span>
</code></pre></div>

<p>你可以测试 InfluxDB 是否安装好，通过访问这个 URL <code>http://你的 IP 地址:8083</code>，用户名和密码都是 ”root“。</p>
<p><img alt="InfluxDB Administration 2016-08-01 14-10-08" src="/data/attachment/album/201611/03/095728jjvtvuvvrluckvjb.png"></p>
<p>我们可以在这个界面上创建我们所需的数据库。</p>
<p><img alt="createDB influx" src="/data/attachment/album/201611/03/095729gcgzg7jboivgjo7b.png"></p>
<h4>安装 cAdvisor</h4>
<p>我们的下一个步骤是安装 cAdvisor 容器，并将其链接到 InfluxDB 容器。你可以使用此命令来创建它。</p>
<div class="highlight"><pre><span></span><code><span class="n">root</span><span class="err">@</span><span class="n">ubuntu</span><span class="p">:</span><span class="o">~</span><span class="c1"># docker run --volume=/:/rootfs:ro --volume=/var/run:/var/run:rw --volume=/sys:/sys:ro --volume=/var/lib/docker/:/var/lib/docker:ro --publish=8080:8080 --detach=true --link influxsrv:influxsrv --name=cadvisor google/cadvisor:latest -storage_driver_db=cadvisor -storage_driver_host=influxsrv:8086</span>
<span class="n">Unable</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">find</span><span class="w"> </span><span class="n">image</span><span class="w"> </span><span class="s1">&#39;google/cadvisor:latest&#39;</span><span class="w"> </span><span class="n">locally</span>
<span class="n">latest</span><span class="p">:</span><span class="w"> </span><span class="n">Pulling</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">google</span><span class="o">/</span><span class="n">cadvisor</span>
<span class="mi">09</span><span class="n">d0220f4043</span><span class="p">:</span><span class="w"> </span><span class="n">Pull</span><span class="w"> </span><span class="n">complete</span>
<span class="mi">151807</span><span class="n">d34af9</span><span class="p">:</span><span class="w"> </span><span class="n">Pull</span><span class="w"> </span><span class="n">complete</span>
<span class="mi">14</span><span class="n">cd28dce332</span><span class="p">:</span><span class="w"> </span><span class="n">Pull</span><span class="w"> </span><span class="n">complete</span>
<span class="n">Digest</span><span class="p">:</span><span class="w"> </span><span class="n">sha256</span><span class="p">:</span><span class="mi">8364</span><span class="n">c7ab7f56a087b757a304f9376c3527c8c60c848f82b66dd728980222bd2f</span>
<span class="n">Status</span><span class="p">:</span><span class="w"> </span><span class="n">Downloaded</span><span class="w"> </span><span class="n">newer</span><span class="w"> </span><span class="n">image</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">google</span><span class="o">/</span><span class="n">cadvisor</span><span class="p">:</span><span class="n">latest</span>
<span class="mi">3</span><span class="n">bfdf7fdc83872485acb06666a686719983a1172ac49895cd2a260deb1cdde29</span>
<span class="n">root</span><span class="err">@</span><span class="n">ubuntu</span><span class="p">:</span><span class="o">~</span><span class="c1">#</span>

<span class="w">    </span><span class="o">--</span><span class="n">publish</span><span class="o">=</span><span class="mi">8080</span><span class="p">:</span><span class="mi">8080</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="n">interface</span>
<span class="w">    </span><span class="o">--</span><span class="n">link</span><span class="o">=</span><span class="n">influxsrv</span><span class="p">:</span><span class="n">influxsrv</span><span class="p">:</span><span class="w"> </span><span class="n">link</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">container</span><span class="w"> </span><span class="n">influxsrv</span>
<span class="w">    </span><span class="o">-</span><span class="n">storage_driver</span><span class="o">=</span><span class="n">influxdb</span><span class="p">:</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">storage</span><span class="w"> </span><span class="n">driver</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">InfluxDB</span>
<span class="w">    </span><span class="n">Specify</span><span class="w"> </span><span class="n">what</span><span class="w"> </span><span class="n">InfluxDB</span><span class="w"> </span><span class="n">instance</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">push</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="n">to</span><span class="p">:</span>
<span class="w">    </span><span class="o">-</span><span class="n">storage_driver_host</span><span class="o">=</span><span class="n">influxsrv</span><span class="p">:</span><span class="mi">8086</span><span class="p">:</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">ip</span><span class="p">:</span><span class="n">port</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">database</span><span class="o">.</span><span class="w"> </span><span class="n">Default</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="err">‘</span><span class="n">localhost</span><span class="p">:</span><span class="mi">8086</span><span class="err">’</span>
<span class="w">    </span><span class="o">-</span><span class="n">storage_driver_db</span><span class="o">=</span><span class="n">cadvisor</span><span class="p">:</span><span class="w"> </span><span class="n">database</span><span class="w"> </span><span class="n">name</span><span class="o">.</span><span class="w"> </span><span class="n">Uses</span><span class="w"> </span><span class="n">db</span><span class="w"> </span><span class="err">‘</span><span class="n">cadvisor</span><span class="err">’</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">default</span>
</code></pre></div>

<p>你可以通过访问这个地址来测试安装 cAdvisor 是否正常 <code>http://你的 IP 地址:8080</code>。 这将为你的 Docker 主机和容器提供统计信息。</p>
<p><img alt="cAdvisor - Docker Containers 2016-08-01 14-24-18" src="/data/attachment/album/201611/03/095730mc4y0lb3qjiv6y4v.png"></p>
<h4>安装 Grafana 控制面板</h4>
<p>最后，我们需要安装 Grafana 仪表板并连接到 InfluxDB，你可以执行下面的命令来设置它。</p>
<div class="highlight"><pre><span></span><code><span class="n">root</span><span class="nv">@ubuntu</span><span class="err">:</span><span class="o">~</span><span class="err">#</span><span class="w"> </span><span class="n">docker</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="o">-</span><span class="n">d</span><span class="w"> </span><span class="o">-</span><span class="n">p</span><span class="w"> </span><span class="mi">3000</span><span class="err">:</span><span class="mi">3000</span><span class="w"> </span><span class="o">-</span><span class="n">e</span><span class="w"> </span><span class="n">INFLUXDB_HOST</span><span class="o">=</span><span class="n">localhost</span><span class="w"> </span><span class="o">-</span><span class="n">e</span><span class="w"> </span><span class="n">INFLUXDB_PORT</span><span class="o">=</span><span class="mi">8086</span><span class="w"> </span><span class="o">-</span><span class="n">e</span><span class="w"> </span><span class="n">INFLUXDB_NAME</span><span class="o">=</span><span class="n">cadvisor</span><span class="w"> </span><span class="o">-</span><span class="n">e</span><span class="w"> </span><span class="n">INFLUXDB_USER</span><span class="o">=</span><span class="n">root</span><span class="w"> </span><span class="o">-</span><span class="n">e</span><span class="w"> </span><span class="n">INFLUXDB_PASS</span><span class="o">=</span><span class="n">root</span><span class="w"> </span><span class="o">--</span><span class="n">link</span><span class="w"> </span><span class="nl">influxsrv</span><span class="p">:</span><span class="n">influxsrv</span><span class="w"> </span><span class="o">--</span><span class="n">name</span><span class="w"> </span><span class="n">grafana</span><span class="w"> </span><span class="n">grafana</span><span class="o">/</span><span class="n">grafana</span>
<span class="n">f3b7598529202b110e4e6b998dca6b6e60e8608d75dcfe0d2b09ae408f43684a</span>
</code></pre></div>

<p>现在我们可以登录 Grafana 来配置数据源. 访问 <code>http://你的 IP 地址:3000</code> 或 <code>http://你的 IP 地址</code>（如果你在前面做了端口映射的话）:</p>
<ul>
<li>用户名 - admin</li>
<li>密码 - admin</li>
</ul>
<p>一旦我们安装好了 Grafana，我们可以连接 InfluxDB。登录到仪表盘并且点击面板左上方角落的 Grafana 图标（那个火球）。点击<ruby> 数据源 <rp>  （ </rp> <rt>  Data Sources </rt> <rp>  ） </rp></ruby>来配置。</p>
<p><img alt="addingdatabsource" src="/data/attachment/album/201611/03/095731jo3nll2p1ssk5lnb.png"></p>
<p>现在你可以添加新的<ruby> 图形 <rp>  （ </rp> <rt>  Graph </rt> <rp>  ） </rp></ruby>到我们默认的数据源 InfluxDB。</p>
<p><img alt="panelgraph" src="/data/attachment/album/201611/03/095732i9ht99q6ey8j19ri.png"></p>
<p>我们可以通过在<ruby> 测量 <rp>  （ </rp> <rt>  Metric </rt> <rp>  ） </rp></ruby>页面编辑和调整我们的查询以调整我们的图形。</p>
<p><img alt="Grafana - Grafana Dashboard 2016-08-01 14-53-40" src="/data/attachment/album/201611/03/095732mx2zoifp1ptop2oo.png"></p>
<p><img alt="Grafana - Grafana Dashboard" src="/data/attachment/album/201611/03/095733qitcr9bzi77up599.png"></p>
<p>关于 Docker 监控，你可用<a href="https://github.com/vegasbrianc/docker-monitoring">从此了解</a>更多信息。 感谢你的阅读。我希望你可以留下有价值的建议和评论。希望你有个美好的一天。</p>
    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>links</h2>
                        <ul>
                            <li><a href="https://getpelican.com/">Pelican</a></li>
                            <li><a href="https://www.python.org/">Python.org</a></li>
                            <li><a href="https://palletsprojects.com/p/jinja/">Jinja2</a></li>
                            <li><a href="#">You can modify those links in your config file</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>

                            <li><a href="#">You can add links in your config file</a></li>
                            <li><a href="#">Another social link</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a rel="nofollow" href="https://getpelican.com/">Pelican</a>, which takes great advantage of <a rel="nofollow" href="https://www.python.org/">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a rel="nofollow" href="https://www.smashingmagazine.com/2009/08/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>