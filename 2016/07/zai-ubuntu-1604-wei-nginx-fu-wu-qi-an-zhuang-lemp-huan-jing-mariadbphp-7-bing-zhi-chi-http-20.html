<!DOCTYPE html>
<html lang="zh">
<head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="generator" content="Pelican" />
        <title>在 Ubuntu 16.04 为 Nginx 服务器安装 LEMP 环境（MariaDB，PHP 7 并支持 HTTP 2.0）</title>
        <link rel="stylesheet" href="/theme/css/main.css" />
        <meta name="description" content="Author: Matei Cezar LEMP 是个缩写，代表一组软件包（L：Linux OS，E：Nginx 网络服务器，M：MySQL/MariaDB 数据库和 P：PHP 服务端动态编程语言)，它被用来搭建动 …" />
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">linux_cn</a></h1>
                <nav><ul>
                    <li><a href="/category/chuan-shan-jia-zhuan-fang">穿山甲专访</a></li>
                    <li><a href="/category/dai-ma-ying-xiong">代码英雄</a></li>
                    <li><a href="/category/fen-xiang">分享</a></li>
                    <li><a href="/category/guan-dian">观点</a></li>
                    <li><a href="/category/huo-dong">活动</a></li>
                    <li><a href="/category/ji-ke-man-hua">极客漫画</a></li>
                    <li><a href="/category/ji-zhu">技术</a></li>
                    <li><a href="/category/kai-yuan-zhi-hui">开源智慧</a></li>
                    <li><a href="/category/linux-fa-xing-ban">Linux 发行版</a></li>
                    <li><a href="/category/mei-ri-an-quan-zi-xun">每日安全资讯</a></li>
                    <li><a href="/category/misc">Misc</a></li>
                    <li><a href="/category/qu-kuai-lian">区块链</a></li>
                    <li><a href="/category/rong-qi-yu-yun">容器与云</a></li>
                    <li><a href="/category/ruan-jian-kai-fa">软件开发</a></li>
                    <li><a href="/category/shu-mei-pai">树莓派</a></li>
                    <li class="active"><a href="/category/xi-tong-yun-wei">系统运维</a></li>
                    <li><a href="/category/xin-wen">新闻</a></li>
                    <li><a href="/category/ying-he-guan-cha">硬核观察</a></li>
                    <li><a href="/category/zhi-ye-sheng-ya">职业生涯</a></li>
                    <li><a href="/category/zhong-jiang-ming-dan">中奖名单</a></li>
                    <li><a href="/category/zhuo-mian-ying-yong">桌面应用</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="/2016/07/zai-ubuntu-1604-wei-nginx-fu-wu-qi-an-zhuang-lemp-huan-jing-mariadbphp-7-bing-zhi-chi-http-20.html" rel="bookmark"
           title="Permalink to 在 Ubuntu 16.04 为 Nginx 服务器安装 LEMP 环境（MariaDB，PHP 7 并支持 HTTP 2.0）">在 Ubuntu 16.04 为 Nginx 服务器安装 LEMP 环境（MariaDB，PHP 7 并支持 HTTP 2.0）</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2016-07-08T09:56:00+02:00">
                Published: Fri 08 July 2016
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/linux-fans-from-china.html">linux fans from china</a>
        </address>
<p>In <a href="/category/xi-tong-yun-wei">系统运维</a>.</p>

</footer><!-- /.post-info -->      <p>Author: Matei Cezar</p>
<p>LEMP 是个缩写，代表一组软件包（L：Linux OS，E：Nginx 网络服务器，M：MySQL/MariaDB 数据库和 P：PHP 服务端动态编程语言)，它被用来搭建动态的网络应用和网页。</p>
<p>（LCTT 译注：为何采用 LEMP 而不是 LNMP 的缩写？据 <a href="https://lemp.io/">https://lemp.io/</a> 的解释：Nginx 的发音是 Engine-X，重要的发音而不是首字母，而且 LEMP 实际上是可读的，而 LNMP 看起来只是字母表。）</p>
<p><img alt="" src="/data/attachment/album/201607/07/230043xr8zr0ftkr0mw1ft.png"></p>
<p><em>在 Ubuntu 16.04 安装 Nginx 以及 MariaDB，PHP7 并且支持 HTTP 2.0</em></p>
<p>这篇教程会教你怎么在 Ubuntu 16.04 的服务器上安装 LEMP （Nginx 和 MariaDB 以及 PHP7）。</p>
<p><strong>前置准备</strong></p>
<ul>
<li><a href="http://www.tecmint.com/installation-of-ubuntu-16-04-server-edition/">安装 Ubuntu 16.04 服务器版本</a></li>
</ul>
<h3>步骤 1：安装 Nginx 服务器</h3>
<p>1、Nginx 是一个先进的、资源优化的 Web 服务器程序，用来向因特网上的访客展示网页。我们从 Nginx 服务器的安装开始介绍，使用 <a href="http://www.tecmint.com/apt-advanced-package-command-examples-in-ubuntu/">apt 命令</a> 从 Ubuntu 的官方软件仓库中获取 Nginx 程序。</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>nginx
</code></pre></div>

<p><img alt="" src="/data/attachment/album/201607/07/230043gm05lpsdfssvslzs.png"></p>
<p><em>在 Ubuntu 16.04 安装 Nginx</em></p>
<p>2、 然后输入 <a href="http://www.tecmint.com/20-netstat-commands-for-linux-network-management/">netstat</a> 和 <a href="http://www.tecmint.com/manage-services-using-systemd-and-systemctl-in-linux/">systemctl</a> 命令，确认 Nginx 进程已经启动并且绑定在 80 端口。</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>netstat<span class="w"> </span>-tlpn
</code></pre></div>

<p><img alt="" src="/data/attachment/album/201607/07/230044jkviivhuu5ik44kz.png"></p>
<p><em>检查 Nginx 网络端口连接</em></p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>sudo<span class="w"> </span>systemctl<span class="w"> </span>status<span class="w"> </span>nginx.service
</code></pre></div>

<p><img alt="" src="/data/attachment/album/201607/07/230044pgkkzkpkrpww8bwq.png"></p>
<p><em>检查 Nginx 服务状态</em></p>
<p>当你确认服务进程已经启动了，你可以打开一个浏览器，使用 HTTP 协议访问你的服务器 IP 地址或者域名，浏览 Nginx 的默认网页。</p>
<div class="highlight"><pre><span></span><code>http://IP-Address
</code></pre></div>

<p><img alt="" src="/data/attachment/album/201607/07/230045bey5ccllsbrlry8l.png"></p>
<p><em>验证 Nginx 网页</em></p>
<h3>步骤 2：启用 Nginx HTTP/2.0 协议</h3>
<p>3、 对 HTTP/2.0 协议的支持默认包含在 Ubuntu 16.04 最新发行版的 Nginx 二进制文件中了，它只能通过 SSL 连接并且保证加载网页的速度有巨大提升。</p>
<p>要启用Nginx 的这个协议，首先找到 Nginx 提供的网站配置文件，输入下面这个命令备份配置文件。</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>/etc/nginx/sites-available/
$<span class="w"> </span>sudo<span class="w"> </span>mv<span class="w"> </span>default<span class="w"> </span>default.backup
</code></pre></div>

<p><img alt="" src="/data/attachment/album/201607/07/230045loqhtazpzqpoq8am.png"></p>
<p><em>备份 Nginx 的网站配置文件</em></p>
<p>4、然后，用文本编辑器新建一个默认文件，输入以下内容：</p>
<div class="highlight"><pre><span></span><code><span class="n">server</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">listen</span><span class="w"> </span><span class="mi">443</span><span class="w"> </span><span class="n">ssl</span><span class="w"> </span><span class="n">http2</span><span class="w"> </span><span class="n">default_server</span><span class="p">;</span>
<span class="w">        </span><span class="n">listen</span><span class="w"> </span><span class="p">[::]:</span><span class="mi">443</span><span class="w"> </span><span class="n">ssl</span><span class="w"> </span><span class="n">http2</span><span class="w"> </span><span class="n">default_server</span><span class="p">;</span>

<span class="w">        </span><span class="n">root</span><span class="w"> </span><span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">www</span><span class="o">/</span><span class="n">html</span><span class="p">;</span>

<span class="w">        </span><span class="n">index</span><span class="w"> </span><span class="n">index</span><span class="o">.</span><span class="n">html</span><span class="w"> </span><span class="n">index</span><span class="o">.</span><span class="n">htm</span><span class="w"> </span><span class="n">index</span><span class="o">.</span><span class="n">php</span><span class="p">;</span>

<span class="w">        </span><span class="n">server_name</span><span class="w"> </span><span class="mf">192.168</span><span class="o">.</span><span class="mf">1.13</span><span class="p">;</span>

<span class="w">        </span><span class="n">location</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">try_files</span><span class="w"> </span><span class="o">$</span><span class="n">uri</span><span class="w"> </span><span class="o">$</span><span class="n">uri</span><span class="o">/</span><span class="w"> </span><span class="o">=</span><span class="mi">404</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="n">ssl_certificate</span><span class="w"> </span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">nginx</span><span class="o">/</span><span class="n">ssl</span><span class="o">/</span><span class="n">nginx</span><span class="o">.</span><span class="n">crt</span><span class="p">;</span>
<span class="w">        </span><span class="n">ssl_certificate_key</span><span class="w"> </span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">nginx</span><span class="o">/</span><span class="n">ssl</span><span class="o">/</span><span class="n">nginx</span><span class="o">.</span><span class="n">key</span><span class="p">;</span>

<span class="w">        </span><span class="n">ssl_protocols</span><span class="w"> </span><span class="n">TLSv1</span><span class="w"> </span><span class="n">TLSv1</span><span class="o">.</span><span class="mi">1</span><span class="w"> </span><span class="n">TLSv1</span><span class="o">.</span><span class="mi">2</span><span class="p">;</span>
<span class="w">        </span><span class="n">ssl_prefer_server_ciphers</span><span class="w"> </span><span class="n">on</span><span class="p">;</span>
<span class="w">        </span><span class="n">ssl_ciphers</span><span class="w"> </span><span class="n">EECDH</span><span class="o">+</span><span class="n">CHACHA20</span><span class="p">:</span><span class="n">EECDH</span><span class="o">+</span><span class="n">AES128</span><span class="p">:</span><span class="n">RSA</span><span class="o">+</span><span class="n">AES128</span><span class="p">:</span><span class="n">EECDH</span><span class="o">+</span><span class="n">AES256</span><span class="p">:</span><span class="n">RSA</span><span class="o">+</span><span class="n">AES256</span><span class="p">:</span><span class="n">EECDH</span><span class="o">+</span><span class="mi">3</span><span class="n">DES</span><span class="p">:</span><span class="n">RSA</span><span class="o">+</span><span class="mi">3</span><span class="n">DES</span><span class="p">:</span><span class="o">!</span><span class="n">MD5</span><span class="p">;</span>
<span class="w">        </span><span class="n">ssl_dhparam</span><span class="w">  </span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">nginx</span><span class="o">/</span><span class="n">ssl</span><span class="o">/</span><span class="n">dhparam</span><span class="o">.</span><span class="n">pem</span><span class="p">;</span>
<span class="w">        </span><span class="n">ssl_session_cache</span><span class="w"> </span><span class="n">shared</span><span class="p">:</span><span class="n">SSL</span><span class="p">:</span><span class="mi">20</span><span class="n">m</span><span class="p">;</span>
<span class="w">        </span><span class="n">ssl_session_timeout</span><span class="w"> </span><span class="mi">180</span><span class="n">m</span><span class="p">;</span>
<span class="w">        </span><span class="n">resolver</span><span class="w"> </span><span class="mf">8.8</span><span class="o">.</span><span class="mf">8.8</span><span class="w"> </span><span class="mf">8.8</span><span class="o">.</span><span class="mf">4.4</span><span class="p">;</span>
<span class="w">        </span><span class="n">add_header</span><span class="w"> </span><span class="n">Strict</span><span class="o">-</span><span class="n">Transport</span><span class="o">-</span><span class="n">Security</span><span class="w"> </span><span class="s2">&quot;max-age=31536000;</span>
<span class="w">        </span><span class="c1">#includeSubDomains&quot; always;</span>


<span class="w">        </span><span class="n">location</span><span class="w"> </span><span class="o">~</span><span class="w"> </span>\<span class="o">.</span><span class="n">php</span><span class="o">$</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">include</span><span class="w"> </span><span class="n">snippets</span><span class="o">/</span><span class="n">fastcgi</span><span class="o">-</span><span class="n">php</span><span class="o">.</span><span class="n">conf</span><span class="p">;</span>
<span class="w">                </span><span class="n">fastcgi_pass</span><span class="w"> </span><span class="n">unix</span><span class="p">:</span><span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">php</span><span class="o">/</span><span class="n">php7</span><span class="o">.</span><span class="mi">0</span><span class="o">-</span><span class="n">fpm</span><span class="o">.</span><span class="n">sock</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="n">location</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="o">/</span>\<span class="o">.</span><span class="n">ht</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">deny</span><span class="w"> </span><span class="n">all</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="p">}</span>

<span class="n">server</span><span class="w"> </span><span class="p">{</span>
<span class="w">       </span><span class="n">listen</span><span class="w">         </span><span class="mi">80</span><span class="p">;</span>
<span class="w">       </span><span class="n">listen</span><span class="w">    </span><span class="p">[::]:</span><span class="mi">80</span><span class="p">;</span>
<span class="w">       </span><span class="n">server_name</span><span class="w">    </span><span class="mf">192.168</span><span class="o">.</span><span class="mf">1.13</span><span class="p">;</span>
<span class="w">       </span><span class="k">return</span><span class="w">         </span><span class="mi">301</span><span class="w"> </span><span class="n">https</span><span class="p">:</span><span class="o">//$</span><span class="n">server_name</span><span class="o">$</span><span class="n">request_uri</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

<p><img alt="" src="/data/attachment/album/201607/07/230046mmrrtr3mhukm3y11.png"></p>
<p><em>启用 Nginx HTTP 2 协议</em></p>
<p>上面的配置片段向所有的 SSL 监听指令中添加 http2 参数来启用 <code>HTTP/2.0</code>。</p>
<p>上述添加到服务器配置的最后一段，是用来将所有非 SSL 的流量重定向到 SSL/TLS 默认主机。然后用你主机的 IP 地址或者 DNS 记录（最好用 FQDN 名称）替换掉 <code>server_name</code> 选项的参数。</p>
<p>5、 当你按照以上步骤编辑完 Nginx 的默认配置文件之后，用下面这些命令来生成、查看 SSL 证书和密钥。</p>
<p>用你自定义的设置完成证书的制作，注意 Common Name 设置成和你的 DNS FQDN 记录或者服务器 IP 地址相匹配。</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>sudo<span class="w"> </span>mkdir<span class="w"> </span>/etc/nginx/ssl
$<span class="w"> </span>sudo<span class="w"> </span>openssl<span class="w"> </span>req<span class="w"> </span>-x509<span class="w"> </span>-nodes<span class="w"> </span>-days<span class="w"> </span><span class="m">365</span><span class="w"> </span>-newkey<span class="w"> </span>rsa:2048<span class="w"> </span>-keyout<span class="w"> </span>/etc/nginx/ssl/nginx.key<span class="w"> </span>-out<span class="w"> </span>/etc/nginx/ssl/nginx.crt
$<span class="w"> </span>ls<span class="w"> </span>/etc/nginx/ssl/
</code></pre></div>

<p><img alt="" src="/data/attachment/album/201607/07/230046gvtx7vym607u4dot.png"></p>
<p><em>生成 Nginx 的 SSL 证书和密钥</em></p>
<p>6、 通过输入以下命令使用一个强 DH 加密算法，这会修改之前的配置文件 <code>ssl_dhparam</code> 所配置的文件。</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>sudo<span class="w"> </span>openssl<span class="w"> </span>dhparam<span class="w"> </span>-out<span class="w"> </span>/etc/nginx/ssl/dhparam.pem<span class="w"> </span><span class="m">2048</span>
</code></pre></div>

<p><img alt="" src="/data/attachment/album/201607/07/230047uf5nr0ns5rbq07sf.png"></p>
<p><em>创建 Diffie-Hellman 密钥</em></p>
<p>7、 当 <code>Diffie-Hellman</code> 密钥生成之后，验证 Nginx 的配置文件是否正确、能否被 Nginx 网络服务程序应用。然后运行以下命令重启守护进程来观察有什么变化。</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>sudo<span class="w"> </span>nginx<span class="w"> </span>-t
$<span class="w"> </span>sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>nginx.service
</code></pre></div>

<p><img alt="" src="/data/attachment/album/201607/07/230047kymjv2d2hytk71ud.png"></p>
<p><em>检查 Nginx 的配置</em></p>
<p>8、 键入下面的命令来测试 Nginx 使用的是 HTTP/2.0 协议。看到协议中有 <code>h2</code> 的话，表明 Nginx 已经成功配置使用 HTTP/2.0 协议。所有最新的浏览器默认都能够支持这个协议。</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>openssl<span class="w"> </span>s_client<span class="w"> </span>-connect<span class="w"> </span>localhost:443<span class="w"> </span>-nextprotoneg<span class="w"> </span><span class="s1">&#39;&#39;</span>
</code></pre></div>

<p><img alt="" src="/data/attachment/album/201607/07/230048kr9qppbndb3tnccz.png"></p>
<p><em>测试 Nginx HTTP 2.0 协议</em></p>
<h3>第 3 步：安装 PHP 7 解释器</h3>
<p>通过 FastCGI 进程管理程序的协助，Nginx 能够使用 PHP 动态语言解释器生成动态网络内容。FastCGI 能够从 Ubuntu 官方仓库中安装 php-fpm 二进制包来获取。</p>
<p>9、 在你的服务器控制台里输入下面的命令来获取 PHP7.0 和扩展包，这能够让 PHP 与 Nginx 网络服务进程通信。</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>php7.0<span class="w"> </span>php7.0-fpm<span class="w"> </span>
</code></pre></div>

<p><img alt="" src="/data/attachment/album/201607/07/230048v0200z5c3ljzfpy3.png"></p>
<p><em>安装 PHP 7 以及 PHP-FPM</em></p>
<p>10、 当 PHP7.0 解释器安装成功后，输入以下命令启动或者检查 php7.0-fpm 守护进程：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>sudo<span class="w"> </span>systemctl<span class="w"> </span>start<span class="w"> </span>php7.0-fpm
$<span class="w"> </span>sudo<span class="w"> </span>systemctl<span class="w"> </span>status<span class="w"> </span>php7.0-fpm
</code></pre></div>

<p><img alt="" src="/data/attachment/album/201607/07/230049yzd006jwwpmzbhiz.png"></p>
<p><em>开启、验证 php-fpm 服务</em></p>
<p>11、 当前的 Nginx 配置文件已经配置了使用 PHP FPM 来提供动态内容。</p>
<p>下面给出的这部分服务器配置让 Nginx 能够使用 PHP 解释器，所以不需要对 Nginx 配置文件作别的修改。</p>
<div class="highlight"><pre><span></span><code><span class="nt">location</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="err">\</span><span class="p">.</span><span class="nc">php</span><span class="o">$</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="err">include</span><span class="w"> </span><span class="err">snippets/fastcgi-php.conf</span><span class="p">;</span>
<span class="w">                </span><span class="err">fastcgi_pass</span><span class="w"> </span><span class="n">unix</span><span class="p">:</span><span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">php</span><span class="o">/</span><span class="n">php7</span><span class="mf">.0</span><span class="o">-</span><span class="n">fpm</span><span class="o">.</span><span class="n">sock</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
</code></pre></div>

<p>下面是的截图是 Nginx 默认配置文件的内容。你可能需要对其中的代码进行修改或者取消注释。</p>
<p><img alt="" src="/data/attachment/album/201607/07/230049k8evira3qj233aci.png"></p>
<p><em>启用 PHP FastCGI</em></p>
<p>12、 要测试启用了 PHP-FPM 的 Nginx 服务器，用下面的命令创建一个 PHP 测试配置文件 <code>info.php</code>。接着用 <code>http://IP_or domain/info.php</code> 这个网址来查看配置。</p>
<div class="highlight"><pre><span></span><code><span class="nx">$</span><span class="w"> </span><span class="nx">sudo</span><span class="w"> </span><span class="nx">su</span><span class="w"> </span><span class="o">-</span><span class="nx">c</span><span class="w"> </span><span class="s1">&#39;echo &quot;</span><span class="cp">&lt;?php</span> <span class="nb">phpinfo</span><span class="p">();</span> <span class="cp">?&gt;</span><span class="s1">&quot; |tee /var/www/html/info.php&#39;</span>
</code></pre></div>

<p><img alt="" src="/data/attachment/album/201607/07/230050u4cm9l4hd2l7kk9b.png"></p>
<p><em>创建 PHP Info 文件</em></p>
<p><img alt="" src="/data/attachment/album/201607/07/230050zsezzees3zesfvss.png"></p>
<p><em>检查 PHP FastCGI 的信息</em></p>
<p>检查服务器是否宣告支持 HTTP/2.0 协议，定位到 PHP 变量区域中的 <code>$_SERVER[‘SERVER_PROTOCOL’]</code> 就像下面这张截图一样。</p>
<p><img alt="" src="/data/attachment/album/201607/07/230051t52vgeynw22pngwp.png"></p>
<p><em>检查 HTTP2.0 协议信息</em></p>
<p>13、 为了安装其它的 PHP7.0 模块，使用 <code>apt search php7.0</code> 命令查找 php 的模块然后安装。</p>
<p>如果你想要 <a href="http://www.tecmint.com/install-wordpress-using-lamp-or-lemp-on-rhel-centos-fedora/">安装 WordPress</a> 或者别的 CMS，需要安装以下的 PHP 模块，这些模块迟早有用。</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>php7.0-mcrypt<span class="w"> </span>php7.0-mbstring
</code></pre></div>

<p><img alt="" src="/data/attachment/album/201607/07/230052z14f9h84yk69f7xk.png"></p>
<p><em>安装 PHP 7 模块</em></p>
<p>14、 要注册这些额外的 PHP 模块，输入下面的命令重启 PHP-FPM 守护进程。</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>php7.0-fpm.service
</code></pre></div>

<h3>第 4 步：安装 MariaDB 数据库</h3>
<p>15、 最后，我们需要 MariaDB 数据库来存储、管理网站数据，才算完成 LEMP 的搭建。</p>
<p>运行下面的命令安装 MariaDB 数据库管理系统，重启 PHP-FPM 服务以便使用 MySQL 模块与数据库通信。</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>mariadb-server<span class="w"> </span>mariadb-client<span class="w"> </span>php7.0-mysql
$<span class="w"> </span>sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>php7.0-fpm.service
</code></pre></div>

<p><img alt="" src="/data/attachment/album/201607/07/230052tjeltllbjzbjfpzl.png"></p>
<p><em>安装 MariaDB</em></p>
<p>16、 为了安全加固 MariaDB，运行来自 Ubuntu 软件仓库中的二进制包提供的安全脚本，这会询问你设置一个 root 密码，移除匿名用户，禁用 root 用户远程登录，移除测试数据库。</p>
<p>输入下面的命令运行脚本，并且确认所有的选择。参照下面的截图。</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>sudo<span class="w"> </span>mysql_secure_installation
</code></pre></div>

<p><img alt="" src="/data/attachment/album/201607/07/230053tcessy7stibb1bzf.png"></p>
<p><em>MariaDB 的安全安装</em></p>
<p>17、 配置 MariaDB 以便普通用户能够不使用系统的 sudo 权限来访问数据库。用 root 用户权限打开 MySQL 命令行界面，运行下面的命令：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>sudo<span class="w"> </span>mysql<span class="w"> </span>
MariaDB&gt;<span class="w"> </span>use<span class="w"> </span>mysql<span class="p">;</span>
MariaDB&gt;<span class="w"> </span>update<span class="w"> </span>user<span class="w"> </span><span class="nb">set</span><span class="w"> </span><span class="nv">plugin</span><span class="o">=</span>’‘<span class="w"> </span>where<span class="w"> </span><span class="nv">User</span><span class="o">=</span>’root’<span class="p">;</span>
MariaDB&gt;<span class="w"> </span>flush<span class="w"> </span>privileges<span class="p">;</span>
MariaDB&gt;<span class="w"> </span><span class="nb">exit</span>
</code></pre></div>

<p><img alt="" src="/data/attachment/album/201607/07/230054vu9jwx9mj3qemj9k.png"></p>
<p><em>MariaDB 的用户权限</em></p>
<p>最后通过执行以下命令登录到 MariaDB 数据库，就可以不需要 root 权限而执行任意数据库内的命令：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>mysql<span class="w"> </span>-u<span class="w"> </span>root<span class="w"> </span>-p<span class="w"> </span>-e<span class="w"> </span><span class="s1">&#39;show databases&#39;</span>
</code></pre></div>

<p><img alt="" src="/data/attachment/album/201607/07/230055yzvu8ava8d9snaaa.png"></p>
<p><em>查看 MariaDB 数据库</em></p>
<p>好了！现在你拥有了配置在 <strong>Ubuntu 16.04</strong> 服务器上的 <strong>LEMP</strong> 环境，你能够部署能够与数据库交互的复杂动态网络应用。</p>
    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>links</h2>
                        <ul>
                            <li><a href="https://getpelican.com/">Pelican</a></li>
                            <li><a href="https://www.python.org/">Python.org</a></li>
                            <li><a href="https://palletsprojects.com/p/jinja/">Jinja2</a></li>
                            <li><a href="#">You can modify those links in your config file</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>

                            <li><a href="#">You can add links in your config file</a></li>
                            <li><a href="#">Another social link</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a rel="nofollow" href="https://getpelican.com/">Pelican</a>, which takes great advantage of <a rel="nofollow" href="https://www.python.org/">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a rel="nofollow" href="https://www.smashingmagazine.com/2009/08/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>