<!DOCTYPE html>
<html lang="zh">
<head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="generator" content="Pelican" />
        <title>在 Ubuntu 15.10 上为单个网卡设置多个 IP 地址</title>
        <link rel="stylesheet" href="/theme/css/main.css" />
        <meta name="description" content="Author: SK 有时候你可能想在你的网卡上使用多个 IP 地址。遇到这种情况你会怎么办呢？买一个新的网卡并分配一个新的 IP？不 …" />
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">linux_cn</a></h1>
                <nav><ul>
                    <li><a href="/category/chuan-shan-jia-zhuan-fang">穿山甲专访</a></li>
                    <li><a href="/category/dai-ma-ying-xiong">代码英雄</a></li>
                    <li><a href="/category/fen-xiang">分享</a></li>
                    <li><a href="/category/guan-dian">观点</a></li>
                    <li><a href="/category/huo-dong">活动</a></li>
                    <li><a href="/category/ji-ke-man-hua">极客漫画</a></li>
                    <li><a href="/category/ji-zhu">技术</a></li>
                    <li><a href="/category/kai-yuan-zhi-hui">开源智慧</a></li>
                    <li><a href="/category/linux-fa-xing-ban">Linux 发行版</a></li>
                    <li><a href="/category/mei-ri-an-quan-zi-xun">每日安全资讯</a></li>
                    <li><a href="/category/misc">Misc</a></li>
                    <li><a href="/category/qu-kuai-lian">区块链</a></li>
                    <li><a href="/category/rong-qi-yu-yun">容器与云</a></li>
                    <li><a href="/category/ruan-jian-kai-fa">软件开发</a></li>
                    <li><a href="/category/shu-mei-pai">树莓派</a></li>
                    <li class="active"><a href="/category/xi-tong-yun-wei">系统运维</a></li>
                    <li><a href="/category/xin-wen">新闻</a></li>
                    <li><a href="/category/ying-he-guan-cha">硬核观察</a></li>
                    <li><a href="/category/zhi-ye-sheng-ya">职业生涯</a></li>
                    <li><a href="/category/zhong-jiang-ming-dan">中奖名单</a></li>
                    <li><a href="/category/zhuo-mian-ying-yong">桌面应用</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="/2016/01/zai-ubuntu-1510-shang-wei-dan-ge-wang-qia-she-zhi-duo-ge-ip-di-zhi.html" rel="bookmark"
           title="Permalink to 在 Ubuntu 15.10 上为单个网卡设置多个 IP 地址">在 Ubuntu 15.10 上为单个网卡设置多个 IP 地址</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2016-01-07T08:33:00+01:00">
                Published: Thu 07 January 2016
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/linux-fans-from-china.html">linux fans from china</a>
        </address>
<p>In <a href="/category/xi-tong-yun-wei">系统运维</a>.</p>

</footer><!-- /.post-info -->      <p>Author: SK</p>
<p>有时候你可能想在你的网卡上使用多个 IP 地址。遇到这种情况你会怎么办呢？买一个新的网卡并分配一个新的 IP？不，没有这个必要（至少在小型网络中）。现在我们可以在 Ubuntu 系统中为一个网卡分配多个 IP 地址。想知道怎么做到的？跟着我往下看，其实并不难。</p>
<p>这个方法也适用于 Debian 以及它的衍生版本。</p>
<p><img alt="" src="/data/attachment/album/201601/05/223804s9mmmz1f22917qvk.jpg"></p>
<h3>临时添加 IP 地址</h3>
<p>首先，让我们找到网卡的 IP 地址。在我的 Ubuntu 15.10 服务器版中，我只使用了一个网卡。</p>
<p>运行下面的命令找到 IP 地址：</p>
<div class="highlight"><pre><span></span><code><span class="nx">sudo</span><span class="w"> </span><span class="nx">ip</span><span class="w"> </span><span class="kd">addr</span>
</code></pre></div>

<p><strong>样例输出：</strong></p>
<div class="highlight"><pre><span></span><code><span class="mi">1</span><span class="o">:</span><span class="w"> </span><span class="n">lo</span><span class="o">:</span><span class="w"> </span><span class="o">&lt;</span><span class="n">LOOPBACK</span><span class="o">,</span><span class="n">UP</span><span class="o">,</span><span class="n">LOWER_UP</span><span class="o">&gt;</span><span class="w"> </span><span class="n">mtu</span><span class="w"> </span><span class="mi">65536</span><span class="w"> </span><span class="n">qdisc</span><span class="w"> </span><span class="n">noqueue</span><span class="w"> </span><span class="n">state</span><span class="w"> </span><span class="n">UNKNOWN</span><span class="w"> </span><span class="n">group</span><span class="w"> </span><span class="k">default</span><span class="w"> </span>
<span class="n">link</span><span class="o">/</span><span class="n">loopback</span><span class="w"> </span><span class="mi">00</span><span class="o">:</span><span class="mi">00</span><span class="o">:</span><span class="mi">00</span><span class="o">:</span><span class="mi">00</span><span class="o">:</span><span class="mi">00</span><span class="o">:</span><span class="mi">00</span><span class="w"> </span><span class="n">brd</span><span class="w"> </span><span class="mi">00</span><span class="o">:</span><span class="mi">00</span><span class="o">:</span><span class="mi">00</span><span class="o">:</span><span class="mi">00</span><span class="o">:</span><span class="mi">00</span><span class="o">:</span><span class="mi">00</span>
<span class="n">inet</span><span class="w"> </span><span class="mf">127.0</span><span class="o">.</span><span class="mf">0.1</span><span class="o">/</span><span class="mi">8</span><span class="w"> </span><span class="n">scope</span><span class="w"> </span><span class="n">host</span><span class="w"> </span><span class="n">lo</span>
<span class="n">valid_lft</span><span class="w"> </span><span class="n">forever</span><span class="w"> </span><span class="n">preferred_lft</span><span class="w"> </span><span class="n">forever</span>
<span class="n">inet6</span><span class="w"> </span><span class="o">::</span><span class="mi">1</span><span class="o">/</span><span class="mi">128</span><span class="w"> </span><span class="n">scope</span><span class="w"> </span><span class="n">host</span><span class="w"> </span>
<span class="n">valid_lft</span><span class="w"> </span><span class="n">forever</span><span class="w"> </span><span class="n">preferred_lft</span><span class="w"> </span><span class="n">forever</span>
<span class="mi">2</span><span class="o">:</span><span class="w"> </span><span class="n">enp0s3</span><span class="o">:</span><span class="w"> </span><span class="o">&lt;</span><span class="n">BROADCAST</span><span class="o">,</span><span class="n">MULTICAST</span><span class="o">,</span><span class="n">UP</span><span class="o">,</span><span class="n">LOWER_UP</span><span class="o">&gt;</span><span class="w"> </span><span class="n">mtu</span><span class="w"> </span><span class="mi">1500</span><span class="w"> </span><span class="n">qdisc</span><span class="w"> </span><span class="n">pfifo_fast</span><span class="w"> </span><span class="n">state</span><span class="w"> </span><span class="n">UP</span><span class="w"> </span><span class="n">group</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="n">qlen</span><span class="w"> </span><span class="mi">1000</span>
<span class="n">link</span><span class="o">/</span><span class="n">ether</span><span class="w"> </span><span class="mi">08</span><span class="o">:</span><span class="mi">00</span><span class="o">:</span><span class="mi">27</span><span class="o">:</span><span class="mi">2</span><span class="n">a</span><span class="o">:</span><span class="mi">03</span><span class="o">:</span><span class="mi">4</span><span class="n">b</span><span class="w"> </span><span class="n">brd</span><span class="w"> </span><span class="n">ff</span><span class="o">:</span><span class="n">ff</span><span class="o">:</span><span class="n">ff</span><span class="o">:</span><span class="n">ff</span><span class="o">:</span><span class="n">ff</span><span class="o">:</span><span class="n">ff</span>
<span class="n">inet</span><span class="w"> </span><span class="mf">192.168</span><span class="o">.</span><span class="mf">1.103</span><span class="o">/</span><span class="mi">24</span><span class="w"> </span><span class="n">brd</span><span class="w"> </span><span class="mf">192.168</span><span class="o">.</span><span class="mf">1.255</span><span class="w"> </span><span class="n">scope</span><span class="w"> </span><span class="n">global</span><span class="w"> </span><span class="n">enp0s3</span>
<span class="n">valid_lft</span><span class="w"> </span><span class="n">forever</span><span class="w"> </span><span class="n">preferred_lft</span><span class="w"> </span><span class="n">forever</span>
<span class="n">inet6</span><span class="w"> </span><span class="n">fe80</span><span class="o">::</span><span class="n">a00</span><span class="o">:</span><span class="mi">27</span><span class="n">ff</span><span class="o">:</span><span class="n">fe2a</span><span class="o">:</span><span class="mi">34</span><span class="n">e</span><span class="o">/</span><span class="mi">64</span><span class="w"> </span><span class="n">scope</span><span class="w"> </span><span class="n">link</span><span class="w"> </span>
<span class="n">valid_lft</span><span class="w"> </span><span class="n">forever</span><span class="w"> </span><span class="n">preferred_lft</span><span class="w"> </span><span class="n">forever</span>
</code></pre></div>

<p>或</p>
<div class="highlight"><pre><span></span><code>sudo ifconfig
</code></pre></div>

<p><strong>样例输出：</strong></p>
<div class="highlight"><pre><span></span><code><span class="nx">enp0s3</span><span class="w"> </span><span class="nx">Link</span><span class="w"> </span><span class="nx">encap</span><span class="p">:</span><span class="nx">Ethernet</span><span class="w"> </span><span class="nx">HWaddr</span><span class="w"> </span><span class="mi">08</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">27</span><span class="p">:</span><span class="mi">2</span><span class="nx">a</span><span class="p">:</span><span class="mi">03</span><span class="p">:</span><span class="mi">4</span><span class="nx">b</span><span class="w"> </span>
<span class="nx">inet</span><span class="w"> </span><span class="kd">addr</span><span class="p">:</span><span class="m m-Double">192.168.1.103</span><span class="w"> </span><span class="nx">Bcast</span><span class="p">:</span><span class="m m-Double">192.168.1.255</span><span class="w"> </span><span class="nx">Mask</span><span class="p">:</span><span class="m m-Double">255.255.255.0</span>
<span class="nx">inet6</span><span class="w"> </span><span class="kd">addr</span><span class="p">:</span><span class="w"> </span><span class="nx">fe80</span><span class="o">::</span><span class="nx">a00</span><span class="p">:</span><span class="mi">27</span><span class="nx">ff</span><span class="p">:</span><span class="nx">fe2a</span><span class="p">:</span><span class="mi">34</span><span class="nx">e</span><span class="o">/</span><span class="mi">64</span><span class="w"> </span><span class="nx">Scope</span><span class="p">:</span><span class="nx">Link</span>
<span class="nx">UP</span><span class="w"> </span><span class="nx">BROADCAST</span><span class="w"> </span><span class="nx">RUNNING</span><span class="w"> </span><span class="nx">MULTICAST</span><span class="w"> </span><span class="nx">MTU</span><span class="p">:</span><span class="mi">1500</span><span class="w"> </span><span class="nx">Metric</span><span class="p">:</span><span class="mi">1</span>
<span class="nx">RX</span><span class="w"> </span><span class="nx">packets</span><span class="p">:</span><span class="mi">186</span><span class="w"> </span><span class="nx">errors</span><span class="p">:</span><span class="mi">0</span><span class="w"> </span><span class="nx">dropped</span><span class="p">:</span><span class="mi">0</span><span class="w"> </span><span class="nx">overruns</span><span class="p">:</span><span class="mi">0</span><span class="w"> </span><span class="nx">frame</span><span class="p">:</span><span class="mi">0</span>
<span class="nx">TX</span><span class="w"> </span><span class="nx">packets</span><span class="p">:</span><span class="mi">70</span><span class="w"> </span><span class="nx">errors</span><span class="p">:</span><span class="mi">0</span><span class="w"> </span><span class="nx">dropped</span><span class="p">:</span><span class="mi">0</span><span class="w"> </span><span class="nx">overruns</span><span class="p">:</span><span class="mi">0</span><span class="w"> </span><span class="nx">carrier</span><span class="p">:</span><span class="mi">0</span>
<span class="nx">collisions</span><span class="p">:</span><span class="mi">0</span><span class="w"> </span><span class="nx">txqueuelen</span><span class="p">:</span><span class="mi">1000</span><span class="w"> </span>
<span class="nx">RX</span><span class="w"> </span><span class="nx">bytes</span><span class="p">:</span><span class="mi">21872</span><span class="w"> </span><span class="p">(</span><span class="m m-Double">21.8</span><span class="w"> </span><span class="nx">KB</span><span class="p">)</span><span class="w"> </span><span class="nx">TX</span><span class="w"> </span><span class="nx">bytes</span><span class="p">:</span><span class="mi">9666</span><span class="w"> </span><span class="p">(</span><span class="m m-Double">9.6</span><span class="w"> </span><span class="nx">KB</span><span class="p">)</span>
<span class="nx">lo</span><span class="w"> </span><span class="nx">Link</span><span class="w"> </span><span class="nx">encap</span><span class="p">:</span><span class="nx">Local</span><span class="w"> </span><span class="nx">Loopback</span><span class="w"> </span>
<span class="nx">inet</span><span class="w"> </span><span class="kd">addr</span><span class="p">:</span><span class="m m-Double">127.0.0.1</span><span class="w"> </span><span class="nx">Mask</span><span class="p">:</span><span class="m m-Double">255.0.0.0</span>
<span class="nx">inet6</span><span class="w"> </span><span class="kd">addr</span><span class="p">:</span><span class="w"> </span><span class="o">::</span><span class="mi">1</span><span class="o">/</span><span class="mi">128</span><span class="w"> </span><span class="nx">Scope</span><span class="p">:</span><span class="nx">Host</span>
<span class="nx">UP</span><span class="w"> </span><span class="nx">LOOPBACK</span><span class="w"> </span><span class="nx">RUNNING</span><span class="w"> </span><span class="nx">MTU</span><span class="p">:</span><span class="mi">65536</span><span class="w"> </span><span class="nx">Metric</span><span class="p">:</span><span class="mi">1</span>
<span class="nx">RX</span><span class="w"> </span><span class="nx">packets</span><span class="p">:</span><span class="mi">217</span><span class="w"> </span><span class="nx">errors</span><span class="p">:</span><span class="mi">0</span><span class="w"> </span><span class="nx">dropped</span><span class="p">:</span><span class="mi">0</span><span class="w"> </span><span class="nx">overruns</span><span class="p">:</span><span class="mi">0</span><span class="w"> </span><span class="nx">frame</span><span class="p">:</span><span class="mi">0</span>
<span class="nx">TX</span><span class="w"> </span><span class="nx">packets</span><span class="p">:</span><span class="mi">217</span><span class="w"> </span><span class="nx">errors</span><span class="p">:</span><span class="mi">0</span><span class="w"> </span><span class="nx">dropped</span><span class="p">:</span><span class="mi">0</span><span class="w"> </span><span class="nx">overruns</span><span class="p">:</span><span class="mi">0</span><span class="w"> </span><span class="nx">carrier</span><span class="p">:</span><span class="mi">0</span>
<span class="nx">collisions</span><span class="p">:</span><span class="mi">0</span><span class="w"> </span><span class="nx">txqueuelen</span><span class="p">:</span><span class="mi">0</span><span class="w"> </span>
<span class="nx">RX</span><span class="w"> </span><span class="nx">bytes</span><span class="p">:</span><span class="mi">38793</span><span class="w"> </span><span class="p">(</span><span class="m m-Double">38.7</span><span class="w"> </span><span class="nx">KB</span><span class="p">)</span><span class="w"> </span><span class="nx">TX</span><span class="w"> </span><span class="nx">bytes</span><span class="p">:</span><span class="mi">38793</span><span class="w"> </span><span class="p">(</span><span class="m m-Double">38.7</span><span class="w"> </span><span class="nx">KB</span><span class="p">)</span>
</code></pre></div>

<p>正如你在上面输出中看到的，我的网卡名称是 <strong>enp0s3</strong>，它的 IP 地址是 <strong>192.168.1.103</strong>。</p>
<p>现在让我们来为网卡添加一个新的 IP 地址，例如说 <strong>192.168.1.104</strong>。</p>
<p>打开你的终端并运行下面的命令添加额外的 IP。</p>
<div class="highlight"><pre><span></span><code><span class="nx">sudo</span><span class="w"> </span><span class="nx">ip</span><span class="w"> </span><span class="kd">addr</span><span class="w"> </span><span class="nx">add</span><span class="w"> </span><span class="m m-Double">192.168.1.104</span><span class="o">/</span><span class="mi">24</span><span class="w"> </span><span class="nx">dev</span><span class="w"> </span><span class="nx">enp0s3</span>
</code></pre></div>

<p>用命令检查是否启用了新的 IP：</p>
<div class="highlight"><pre><span></span><code><span class="nx">sudo</span><span class="w"> </span><span class="nx">ip</span><span class="w"> </span><span class="nx">address</span><span class="w"> </span><span class="nx">show</span><span class="w"> </span><span class="nx">enp0s3</span>
</code></pre></div>

<p><strong>样例输出：</strong></p>
<div class="highlight"><pre><span></span><code><span class="mi">2</span><span class="o">:</span><span class="w"> </span><span class="n">enp0s3</span><span class="o">:</span><span class="w"> </span><span class="o">&lt;</span><span class="n">BROADCAST</span><span class="o">,</span><span class="n">MULTICAST</span><span class="o">,</span><span class="n">UP</span><span class="o">,</span><span class="n">LOWER_UP</span><span class="o">&gt;</span><span class="w"> </span><span class="n">mtu</span><span class="w"> </span><span class="mi">1500</span><span class="w"> </span><span class="n">qdisc</span><span class="w"> </span><span class="n">pfifo_fast</span><span class="w"> </span><span class="n">state</span><span class="w"> </span><span class="n">UP</span><span class="w"> </span><span class="n">group</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="n">qlen</span><span class="w"> </span><span class="mi">1000</span>
<span class="n">link</span><span class="o">/</span><span class="n">ether</span><span class="w"> </span><span class="mi">08</span><span class="o">:</span><span class="mi">00</span><span class="o">:</span><span class="mi">27</span><span class="o">:</span><span class="mi">2</span><span class="n">a</span><span class="o">:</span><span class="mi">03</span><span class="o">:</span><span class="mi">4</span><span class="n">e</span><span class="w"> </span><span class="n">brd</span><span class="w"> </span><span class="n">ff</span><span class="o">:</span><span class="n">ff</span><span class="o">:</span><span class="n">ff</span><span class="o">:</span><span class="n">ff</span><span class="o">:</span><span class="n">ff</span><span class="o">:</span><span class="n">ff</span>
<span class="n">inet</span><span class="w"> </span><span class="mf">192.168</span><span class="o">.</span><span class="mf">1.103</span><span class="o">/</span><span class="mi">24</span><span class="w"> </span><span class="n">brd</span><span class="w"> </span><span class="mf">192.168</span><span class="o">.</span><span class="mf">1.255</span><span class="w"> </span><span class="n">scope</span><span class="w"> </span><span class="n">global</span><span class="w"> </span><span class="n">enp0s3</span>
<span class="n">valid_lft</span><span class="w"> </span><span class="n">forever</span><span class="w"> </span><span class="n">preferred_lft</span><span class="w"> </span><span class="n">forever</span>
<span class="n">inet</span><span class="w"> </span><span class="mf">192.168</span><span class="o">.</span><span class="mf">1.104</span><span class="o">/</span><span class="mi">24</span><span class="w"> </span><span class="n">scope</span><span class="w"> </span><span class="n">global</span><span class="w"> </span><span class="n">secondary</span><span class="w"> </span><span class="n">enp0s3</span>
<span class="n">valid_lft</span><span class="w"> </span><span class="n">forever</span><span class="w"> </span><span class="n">preferred_lft</span><span class="w"> </span><span class="n">forever</span>
<span class="n">inet6</span><span class="w"> </span><span class="n">fe80</span><span class="o">::</span><span class="n">a00</span><span class="o">:</span><span class="mi">27</span><span class="n">ff</span><span class="o">:</span><span class="n">fe2a</span><span class="o">:</span><span class="mi">34</span><span class="n">e</span><span class="o">/</span><span class="mi">64</span><span class="w"> </span><span class="n">scope</span><span class="w"> </span><span class="n">link</span><span class="w"> </span>
<span class="n">valid_lft</span><span class="w"> </span><span class="n">forever</span><span class="w"> </span><span class="n">preferred_lft</span><span class="w"> </span><span class="n">forever</span>
</code></pre></div>

<p>类似地，你可以添加任意数量的 IP 地址，只要你想要。</p>
<p>让我们 ping 一下这个 IP 地址验证一下。</p>
<div class="highlight"><pre><span></span><code>sudo ping 192.168.1.104
</code></pre></div>

<p><strong>样例输出</strong></p>
<div class="highlight"><pre><span></span><code>PING 192.168.1.104 (192.168.1.104) 56(84) bytes of data.
64 bytes from 192.168.1.104: icmp_seq=1 ttl=64 time=0.901 ms
64 bytes from 192.168.1.104: icmp_seq=2 ttl=64 time=0.571 ms
64 bytes from 192.168.1.104: icmp_seq=3 ttl=64 time=0.521 ms
64 bytes from 192.168.1.104: icmp_seq=4 ttl=64 time=0.524 ms
</code></pre></div>

<p>好极了，它能工作！</p>
<p>要删除 IP，只需要运行：</p>
<div class="highlight"><pre><span></span><code><span class="nx">sudo</span><span class="w"> </span><span class="nx">ip</span><span class="w"> </span><span class="kd">addr</span><span class="w"> </span><span class="nx">del</span><span class="w"> </span><span class="m m-Double">192.168.1.104</span><span class="o">/</span><span class="mi">24</span><span class="w"> </span><span class="nx">dev</span><span class="w"> </span><span class="nx">enp0s3</span>
</code></pre></div>

<p>再检查一下是否删除了 IP。</p>
<div class="highlight"><pre><span></span><code><span class="nx">sudo</span><span class="w"> </span><span class="nx">ip</span><span class="w"> </span><span class="nx">address</span><span class="w"> </span><span class="nx">show</span><span class="w"> </span><span class="nx">enp0s3</span>
</code></pre></div>

<p><strong>样例输出：</strong></p>
<div class="highlight"><pre><span></span><code><span class="mi">2</span><span class="o">:</span><span class="w"> </span><span class="n">enp0s3</span><span class="o">:</span><span class="w"> </span><span class="o">&lt;</span><span class="n">BROADCAST</span><span class="o">,</span><span class="n">MULTICAST</span><span class="o">,</span><span class="n">UP</span><span class="o">,</span><span class="n">LOWER_UP</span><span class="o">&gt;</span><span class="w"> </span><span class="n">mtu</span><span class="w"> </span><span class="mi">1500</span><span class="w"> </span><span class="n">qdisc</span><span class="w"> </span><span class="n">pfifo_fast</span><span class="w"> </span><span class="n">state</span><span class="w"> </span><span class="n">UP</span><span class="w"> </span><span class="n">group</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="n">qlen</span><span class="w"> </span><span class="mi">1000</span>
<span class="n">link</span><span class="o">/</span><span class="n">ether</span><span class="w"> </span><span class="mi">08</span><span class="o">:</span><span class="mi">00</span><span class="o">:</span><span class="mi">27</span><span class="o">:</span><span class="mi">2</span><span class="n">a</span><span class="o">:</span><span class="mi">03</span><span class="o">:</span><span class="mi">4</span><span class="n">e</span><span class="w"> </span><span class="n">brd</span><span class="w"> </span><span class="n">ff</span><span class="o">:</span><span class="n">ff</span><span class="o">:</span><span class="n">ff</span><span class="o">:</span><span class="n">ff</span><span class="o">:</span><span class="n">ff</span><span class="o">:</span><span class="n">ff</span>
<span class="n">inet</span><span class="w"> </span><span class="mf">192.168</span><span class="o">.</span><span class="mf">1.103</span><span class="o">/</span><span class="mi">24</span><span class="w"> </span><span class="n">brd</span><span class="w"> </span><span class="mf">192.168</span><span class="o">.</span><span class="mf">1.255</span><span class="w"> </span><span class="n">scope</span><span class="w"> </span><span class="n">global</span><span class="w"> </span><span class="n">enp0s3</span>
<span class="n">valid_lft</span><span class="w"> </span><span class="n">forever</span><span class="w"> </span><span class="n">preferred_lft</span><span class="w"> </span><span class="n">forever</span>
<span class="n">inet6</span><span class="w"> </span><span class="n">fe80</span><span class="o">::</span><span class="n">a00</span><span class="o">:</span><span class="mi">27</span><span class="n">ff</span><span class="o">:</span><span class="n">fe2a</span><span class="o">:</span><span class="mi">34</span><span class="n">e</span><span class="o">/</span><span class="mi">64</span><span class="w"> </span><span class="n">scope</span><span class="w"> </span><span class="n">link</span><span class="w"> </span>
<span class="n">valid_lft</span><span class="w"> </span><span class="n">forever</span><span class="w"> </span><span class="n">preferred_lft</span><span class="w"> </span><span class="n">forever</span>
</code></pre></div>

<p>可以看到已经没有了！！</p>
<p>正如你所知，重启系统后这些设置会失效。那么怎么设置才能永久有效呢？这也很简单。</p>
<h3>添加永久 IP 地址</h3>
<p>Ubuntu 系统的网卡配置文件是 <strong>/etc/network/interfaces</strong>。</p>
<p>让我们来看看上面文件的具体内容。</p>
<div class="highlight"><pre><span></span><code>sudo cat /etc/network/interfaces
</code></pre></div>

<p><strong>输出样例：</strong></p>
<div class="highlight"><pre><span></span><code><span class="gh">#</span> This file describes the network interfaces available on your system
<span class="gh">#</span> and how to activate them. For more information, see interfaces(5).
source /etc/network/interfaces.d/*
<span class="gh">#</span> The loopback network interface
auto lo
iface lo inet loopback
<span class="gh">#</span> The primary network interface
auto enp0s3
iface enp0s3 inet dhcp
</code></pre></div>

<p>正如你在上面输出中看到的，网卡启用了 DHCP。</p>
<p>现在，让我们来分配一个额外的地址，例如 <strong>192.168.1.104/24</strong>。</p>
<p>编辑 <strong>/etc/network/interfaces</strong>：</p>
<div class="highlight"><pre><span></span><code>sudo nano /etc/network/interfaces
</code></pre></div>

<p>如下添加额外的 IP 地址。</p>
<div class="highlight"><pre><span></span><code><span class="err">#</span><span class="w"> </span><span class="nx">This</span><span class="w"> </span><span class="nx">file</span><span class="w"> </span><span class="nx">describes</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">network</span><span class="w"> </span><span class="nx">interfaces</span><span class="w"> </span><span class="nx">available</span><span class="w"> </span><span class="nx">on</span><span class="w"> </span><span class="nx">your</span><span class="w"> </span><span class="nx">system</span>
<span class="err">#</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="nx">how</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">activate</span><span class="w"> </span><span class="nx">them</span><span class="p">.</span><span class="w"> </span><span class="nx">For</span><span class="w"> </span><span class="nx">more</span><span class="w"> </span><span class="nx">information</span><span class="p">,</span><span class="w"> </span><span class="nx">see</span><span class="w"> </span><span class="nx">interfaces</span><span class="p">(</span><span class="mi">5</span><span class="p">).</span>
<span class="nx">source</span><span class="w"> </span><span class="o">/</span><span class="nx">etc</span><span class="o">/</span><span class="nx">network</span><span class="o">/</span><span class="nx">interfaces</span><span class="p">.</span><span class="nx">d</span><span class="o">/*</span>
<span class="err">#</span><span class="w"> </span><span class="nx">The</span><span class="w"> </span><span class="nx">loopback</span><span class="w"> </span><span class="nx">network</span><span class="w"> </span><span class="kd">interface</span>
<span class="kt">auto</span><span class="w"> </span><span class="nx">lo</span>
<span class="nx">iface</span><span class="w"> </span><span class="nx">lo</span><span class="w"> </span><span class="nx">inet</span><span class="w"> </span><span class="nx">loopback</span>
<span class="err">#</span><span class="w"> </span><span class="nx">The</span><span class="w"> </span><span class="nx">primary</span><span class="w"> </span><span class="nx">network</span><span class="w"> </span><span class="kd">interface</span>
<span class="kt">auto</span><span class="w"> </span><span class="nx">enp0s3</span>
<span class="nx">iface</span><span class="w"> </span><span class="nx">enp0s3</span><span class="w"> </span><span class="nx">inet</span><span class="w"> </span><span class="nx">dhcp</span>
<span class="nx">iface</span><span class="w"> </span><span class="nx">enp0s3</span><span class="w"> </span><span class="nx">inet</span><span class="w"> </span><span class="nx">static</span>
<span class="w"> </span><span class="nx">address</span><span class="w"> </span><span class="m m-Double">192.168.1.104</span><span class="o">/</span><span class="mi">24</span>
</code></pre></div>

<p>保存并关闭文件。</p>
<p>运行下面的命令使更改无需重启即生效。</p>
<div class="highlight"><pre><span></span><code>sudo ifdown enp0s3 &amp;&amp; sudo ifup enp0s3
</code></pre></div>

<p><strong>样例输出：</strong></p>
<div class="highlight"><pre><span></span><code><span class="nv">Killed</span><span class="w"> </span><span class="nv">old</span><span class="w"> </span><span class="nv">client</span><span class="w"> </span><span class="nv">process</span>
<span class="nv">Internet</span><span class="w"> </span><span class="nv">Systems</span><span class="w"> </span><span class="nv">Consortium</span><span class="w"> </span><span class="nv">DHCP</span><span class="w"> </span><span class="nv">Client</span><span class="w"> </span><span class="mi">4</span>.<span class="mi">3</span>.<span class="mi">1</span>
<span class="nv">Copyright</span><span class="w"> </span><span class="mi">2004</span><span class="o">-</span><span class="mi">2014</span><span class="w"> </span><span class="nv">Internet</span><span class="w"> </span><span class="nv">Systems</span><span class="w"> </span><span class="nv">Consortium</span>.
<span class="nv">All</span><span class="w"> </span><span class="nv">rights</span><span class="w"> </span><span class="nv">reserved</span>.
<span class="k">For</span><span class="w"> </span><span class="nv">info</span>,<span class="w"> </span><span class="nv">please</span><span class="w"> </span><span class="nv">visit</span><span class="w"> </span><span class="nv">https</span>:<span class="o">//</span><span class="nv">www</span>.<span class="nv">isc</span>.<span class="nv">org</span><span class="o">/</span><span class="nv">software</span><span class="o">/</span><span class="nv">dhcp</span><span class="o">/</span>
<span class="nv">Listening</span><span class="w"> </span><span class="nv">on</span><span class="w"> </span><span class="nv">LPF</span><span class="o">/</span><span class="nv">enp0s3</span><span class="o">/</span><span class="mi">08</span>:<span class="mi">00</span>:<span class="mi">27</span>:<span class="mi">2</span><span class="nv">a</span>:<span class="mi">03</span>:<span class="mi">4</span><span class="nv">e</span>
<span class="nv">Sending</span><span class="w"> </span><span class="nv">on</span><span class="w"> </span><span class="nv">LPF</span><span class="o">/</span><span class="nv">enp0s3</span><span class="o">/</span><span class="mi">08</span>:<span class="mi">00</span>:<span class="mi">27</span>:<span class="mi">2</span><span class="nv">a</span>:<span class="mi">03</span>:<span class="mi">4</span><span class="nv">e</span>
<span class="nv">Sending</span><span class="w"> </span><span class="nv">on</span><span class="w"> </span><span class="nv">Socket</span><span class="o">/</span><span class="nv">fallback</span>
<span class="nv">DHCPRELEASE</span><span class="w"> </span><span class="nv">on</span><span class="w"> </span><span class="nv">enp0s3</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="mi">192</span>.<span class="mi">168</span>.<span class="mi">1</span>.<span class="mi">1</span><span class="w"> </span><span class="nv">port</span><span class="w"> </span><span class="mi">67</span><span class="w"> </span><span class="ss">(</span><span class="nv">xid</span><span class="o">=</span><span class="mi">0</span><span class="nv">x225f35</span><span class="ss">)</span>
<span class="nv">Internet</span><span class="w"> </span><span class="nv">Systems</span><span class="w"> </span><span class="nv">Consortium</span><span class="w"> </span><span class="nv">DHCP</span><span class="w"> </span><span class="nv">Client</span><span class="w"> </span><span class="mi">4</span>.<span class="mi">3</span>.<span class="mi">1</span>
<span class="nv">Copyright</span><span class="w"> </span><span class="mi">2004</span><span class="o">-</span><span class="mi">2014</span><span class="w"> </span><span class="nv">Internet</span><span class="w"> </span><span class="nv">Systems</span><span class="w"> </span><span class="nv">Consortium</span>.
<span class="nv">All</span><span class="w"> </span><span class="nv">rights</span><span class="w"> </span><span class="nv">reserved</span>.
<span class="k">For</span><span class="w"> </span><span class="nv">info</span>,<span class="w"> </span><span class="nv">please</span><span class="w"> </span><span class="nv">visit</span><span class="w"> </span><span class="nv">https</span>:<span class="o">//</span><span class="nv">www</span>.<span class="nv">isc</span>.<span class="nv">org</span><span class="o">/</span><span class="nv">software</span><span class="o">/</span><span class="nv">dhcp</span><span class="o">/</span>
<span class="nv">Listening</span><span class="w"> </span><span class="nv">on</span><span class="w"> </span><span class="nv">LPF</span><span class="o">/</span><span class="nv">enp0s3</span><span class="o">/</span><span class="mi">08</span>:<span class="mi">00</span>:<span class="mi">27</span>:<span class="mi">2</span><span class="nv">a</span>:<span class="mi">03</span>:<span class="mi">4</span><span class="nv">e</span>
<span class="nv">Sending</span><span class="w"> </span><span class="nv">on</span><span class="w"> </span><span class="nv">LPF</span><span class="o">/</span><span class="nv">enp0s3</span><span class="o">/</span><span class="mi">08</span>:<span class="mi">00</span>:<span class="mi">27</span>:<span class="mi">2</span><span class="nv">a</span>:<span class="mi">03</span>:<span class="mi">4</span><span class="nv">e</span>
<span class="nv">Sending</span><span class="w"> </span><span class="nv">on</span><span class="w"> </span><span class="nv">Socket</span><span class="o">/</span><span class="nv">fallback</span>
<span class="nv">DHCPDISCOVER</span><span class="w"> </span><span class="nv">on</span><span class="w"> </span><span class="nv">enp0s3</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="mi">255</span>.<span class="mi">255</span>.<span class="mi">255</span>.<span class="mi">255</span><span class="w"> </span><span class="nv">port</span><span class="w"> </span><span class="mi">67</span><span class="w"> </span><span class="nv">interval</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="ss">(</span><span class="nv">xid</span><span class="o">=</span><span class="mi">0</span><span class="nv">xdfb94764</span><span class="ss">)</span>
<span class="nv">DHCPREQUEST</span><span class="w"> </span><span class="nv">of</span><span class="w"> </span><span class="mi">192</span>.<span class="mi">168</span>.<span class="mi">1</span>.<span class="mi">103</span><span class="w"> </span><span class="nv">on</span><span class="w"> </span><span class="nv">enp0s3</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="mi">255</span>.<span class="mi">255</span>.<span class="mi">255</span>.<span class="mi">255</span><span class="w"> </span><span class="nv">port</span><span class="w"> </span><span class="mi">67</span><span class="w"> </span><span class="ss">(</span><span class="nv">xid</span><span class="o">=</span><span class="mi">0</span><span class="nv">x6447b9df</span><span class="ss">)</span>
<span class="nv">DHCPOFFER</span><span class="w"> </span><span class="nv">of</span><span class="w"> </span><span class="mi">192</span>.<span class="mi">168</span>.<span class="mi">1</span>.<span class="mi">103</span><span class="w"> </span><span class="nv">from</span><span class="w"> </span><span class="mi">192</span>.<span class="mi">168</span>.<span class="mi">1</span>.<span class="mi">1</span>
<span class="nv">DHCPACK</span><span class="w"> </span><span class="nv">of</span><span class="w"> </span><span class="mi">192</span>.<span class="mi">168</span>.<span class="mi">1</span>.<span class="mi">103</span><span class="w"> </span><span class="nv">from</span><span class="w"> </span><span class="mi">192</span>.<span class="mi">168</span>.<span class="mi">1</span>.<span class="mi">1</span>
<span class="nv">bound</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="mi">192</span>.<span class="mi">168</span>.<span class="mi">1</span>.<span class="mi">103</span><span class="w"> </span><span class="o">--</span><span class="w"> </span><span class="nv">renewal</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="mi">35146</span><span class="w"> </span><span class="nv">seconds</span>.
</code></pre></div>

<p><strong>注意</strong>：如果你从远程连接到服务器，把上面的两个命令放到<strong>一行</strong>中<strong>非常重要</strong>，因为第一个命令会断掉你的连接。而采用这种方式可以保留你的 ssh 会话。</p>
<p>现在，让我们用下面的命令来检查一下是否添加了新的 IP：</p>
<div class="highlight"><pre><span></span><code><span class="nx">sudo</span><span class="w"> </span><span class="nx">ip</span><span class="w"> </span><span class="nx">address</span><span class="w"> </span><span class="nx">show</span><span class="w"> </span><span class="nx">enp0s3</span>
</code></pre></div>

<p><strong>输出样例：</strong></p>
<div class="highlight"><pre><span></span><code><span class="mi">2</span><span class="o">:</span><span class="w"> </span><span class="n">enp0s3</span><span class="o">:</span><span class="w"> </span><span class="o">&lt;</span><span class="n">BROADCAST</span><span class="o">,</span><span class="n">MULTICAST</span><span class="o">,</span><span class="n">UP</span><span class="o">,</span><span class="n">LOWER_UP</span><span class="o">&gt;</span><span class="w"> </span><span class="n">mtu</span><span class="w"> </span><span class="mi">1500</span><span class="w"> </span><span class="n">qdisc</span><span class="w"> </span><span class="n">pfifo_fast</span><span class="w"> </span><span class="n">state</span><span class="w"> </span><span class="n">UP</span><span class="w"> </span><span class="n">group</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="n">qlen</span><span class="w"> </span><span class="mi">1000</span>
<span class="n">link</span><span class="o">/</span><span class="n">ether</span><span class="w"> </span><span class="mi">08</span><span class="o">:</span><span class="mi">00</span><span class="o">:</span><span class="mi">27</span><span class="o">:</span><span class="mi">2</span><span class="n">a</span><span class="o">:</span><span class="mi">03</span><span class="o">:</span><span class="mi">4</span><span class="n">e</span><span class="w"> </span><span class="n">brd</span><span class="w"> </span><span class="n">ff</span><span class="o">:</span><span class="n">ff</span><span class="o">:</span><span class="n">ff</span><span class="o">:</span><span class="n">ff</span><span class="o">:</span><span class="n">ff</span><span class="o">:</span><span class="n">ff</span>
<span class="n">inet</span><span class="w"> </span><span class="mf">192.168</span><span class="o">.</span><span class="mf">1.103</span><span class="o">/</span><span class="mi">24</span><span class="w"> </span><span class="n">brd</span><span class="w"> </span><span class="mf">192.168</span><span class="o">.</span><span class="mf">1.255</span><span class="w"> </span><span class="n">scope</span><span class="w"> </span><span class="n">global</span><span class="w"> </span><span class="n">enp0s3</span>
<span class="n">valid_lft</span><span class="w"> </span><span class="n">forever</span><span class="w"> </span><span class="n">preferred_lft</span><span class="w"> </span><span class="n">forever</span>
<span class="n">inet</span><span class="w"> </span><span class="mf">192.168</span><span class="o">.</span><span class="mf">1.104</span><span class="o">/</span><span class="mi">24</span><span class="w"> </span><span class="n">brd</span><span class="w"> </span><span class="mf">192.168</span><span class="o">.</span><span class="mf">1.255</span><span class="w"> </span><span class="n">scope</span><span class="w"> </span><span class="n">global</span><span class="w"> </span><span class="n">secondary</span><span class="w"> </span><span class="n">enp0s3</span>
<span class="n">valid_lft</span><span class="w"> </span><span class="n">forever</span><span class="w"> </span><span class="n">preferred_lft</span><span class="w"> </span><span class="n">forever</span>
<span class="n">inet6</span><span class="w"> </span><span class="n">fe80</span><span class="o">::</span><span class="n">a00</span><span class="o">:</span><span class="mi">27</span><span class="n">ff</span><span class="o">:</span><span class="n">fe2a</span><span class="o">:</span><span class="mi">34</span><span class="n">e</span><span class="o">/</span><span class="mi">64</span><span class="w"> </span><span class="n">scope</span><span class="w"> </span><span class="n">link</span><span class="w"> </span>
<span class="n">valid_lft</span><span class="w"> </span><span class="n">forever</span><span class="w"> </span><span class="n">preferred_lft</span><span class="w"> </span><span class="n">forever</span>
</code></pre></div>

<p>很好！我们已经添加了额外的 IP。</p>
<p>再次 ping IP 地址进行验证。</p>
<div class="highlight"><pre><span></span><code>sudo ping 192.168.1.104
</code></pre></div>

<p><strong>样例输出：</strong></p>
<div class="highlight"><pre><span></span><code>PING 192.168.1.104 (192.168.1.104) 56(84) bytes of data.
64 bytes from 192.168.1.104: icmp_seq=1 ttl=64 time=0.137 ms
64 bytes from 192.168.1.104: icmp_seq=2 ttl=64 time=0.050 ms
64 bytes from 192.168.1.104: icmp_seq=3 ttl=64 time=0.054 ms
64 bytes from 192.168.1.104: icmp_seq=4 ttl=64 time=0.067 ms
</code></pre></div>

<p>好极了！它能正常工作。就是这样。</p>
<p>想知道怎么给 CentOS/RHEL/Scientific Linux/Fedora 系统添加额外的 IP 地址，可以点击下面的链接。</p>
<ul>
<li><a href="/article-5127-1.html">在CentOS 7上给一个网卡分配多个IP地址</a></li>
</ul>
<p>工作愉快！</p>
    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>links</h2>
                        <ul>
                            <li><a href="https://getpelican.com/">Pelican</a></li>
                            <li><a href="https://www.python.org/">Python.org</a></li>
                            <li><a href="https://palletsprojects.com/p/jinja/">Jinja2</a></li>
                            <li><a href="#">You can modify those links in your config file</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>

                            <li><a href="#">You can add links in your config file</a></li>
                            <li><a href="#">Another social link</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a rel="nofollow" href="https://getpelican.com/">Pelican</a>, which takes great advantage of <a rel="nofollow" href="https://www.python.org/">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a rel="nofollow" href="https://www.smashingmagazine.com/2009/08/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>