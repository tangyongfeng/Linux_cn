<!DOCTYPE html>
<html lang="zh">
<head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="generator" content="Pelican" />
        <title>“Ubuntu on Windows” 初体验</title>
        <link rel="stylesheet" href="/theme/css/main.css" />
        <meta name="description" content="Author: wxy 在 Windows 10 中原生运行 Linux bash 和其它的 ELF 二进制程序？对，你没看错，这就是昨晚微软宣布的“Ubuntu on Windows”项目所披露的事实——而且 …" />
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">linux_cn</a></h1>
                <nav><ul>
                    <li><a href="/category/chuan-shan-jia-zhuan-fang">穿山甲专访</a></li>
                    <li><a href="/category/dai-ma-ying-xiong">代码英雄</a></li>
                    <li><a href="/category/fen-xiang">分享</a></li>
                    <li><a href="/category/guan-dian">观点</a></li>
                    <li><a href="/category/huo-dong">活动</a></li>
                    <li><a href="/category/ji-ke-man-hua">极客漫画</a></li>
                    <li class="active"><a href="/category/ji-zhu">技术</a></li>
                    <li><a href="/category/kai-yuan-zhi-hui">开源智慧</a></li>
                    <li><a href="/category/linux-fa-xing-ban">Linux 发行版</a></li>
                    <li><a href="/category/mei-ri-an-quan-zi-xun">每日安全资讯</a></li>
                    <li><a href="/category/misc">Misc</a></li>
                    <li><a href="/category/qu-kuai-lian">区块链</a></li>
                    <li><a href="/category/rong-qi-yu-yun">容器与云</a></li>
                    <li><a href="/category/ruan-jian-kai-fa">软件开发</a></li>
                    <li><a href="/category/shu-mei-pai">树莓派</a></li>
                    <li><a href="/category/xi-tong-yun-wei">系统运维</a></li>
                    <li><a href="/category/xin-wen">新闻</a></li>
                    <li><a href="/category/ying-he-guan-cha">硬核观察</a></li>
                    <li><a href="/category/zhi-ye-sheng-ya">职业生涯</a></li>
                    <li><a href="/category/zhong-jiang-ming-dan">中奖名单</a></li>
                    <li><a href="/category/zhuo-mian-ying-yong">桌面应用</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="/2016/03/ubuntu-on-windows-chu-ti-yan.html" rel="bookmark"
           title="Permalink to “Ubuntu on Windows” 初体验">“Ubuntu on Windows” 初体验</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2016-03-31T16:07:18+02:00">
                Published: Thu 31 March 2016
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/linux-fans-from-china.html">linux fans from china</a>
        </address>
<p>In <a href="/category/ji-zhu">技术</a>.</p>

</footer><!-- /.post-info -->      <p>Author: wxy</p>
<p>在 Windows 10 中原生运行 Linux bash 和其它的 ELF 二进制程序？对，你没看错，这就是昨晚微软<a href="/article-7177-1.html">宣布</a>的“Ubuntu on Windows”项目所披露的事实——而且，今天不是 4/1。</p>
<p>之前就有传闻说，微软在 <a href="/article-6979-1.html">Windows 10 里暗藏神秘 Linux 子系统！</a>现在，传闻变成真的了。</p>
<p><img alt="Ubuntu on Windows 10" src="/data/attachment/album/201603/31/160721hcwz5cbo2cgc40ez.jpg"></p>
<p>据该项目的合作方， Ubnutu 背后的 Canonical 公司的产品与战略负责人 <a href="https://www.linkedin.com/in/dustinkirkland/">Dustin Kirkland</a> 说，他在几个月前听说这个疯狂的想法时也懵了，花费了不少工夫才理解这后面发生了什么。</p>
<p>本文带你揭开“Ubuntu on Windows”的神秘一角。</p>
<p>首先，让我们看看发生了什么？</p>
<ol>
<li>首先你得有个 Windows 10</li>
<li>打开 Windows 开始菜单</li>
<li>输入“bash” （没有引号），回车</li>
<li>这会打开一个 cmd.exe 窗口</li>
<li>运行 Ubuntu 的 /bin/bash</li>
<li>宾果！你可以完全访问所有的 Ubuntu 用户空间了</li>
<li>没错，这包括 apt、 ssh、 rsync、 find、 grep、 awk、 sed、 sort、 xargs、 md5sum、 gpg、 curl、 wget、apache、 mysql、 python、 perl、 ruby、 php、 gcc、 tar、 vim、 emacs、 diff、 patch 等等</li>
<li>以及，Ubuntu 软件库中数以万计的 ELF 二进制程序中的绝大多数！</li>
</ol>
<p><img alt="Bash" src="/data/attachment/album/201603/31/151117fu333omffsp3o494.jpg"></p>
<p>“好吧，这是一个运行在虚拟机的 Ubuntu 吗？” 不！<strong>这根本不是一个虚拟机</strong>，不用在虚拟机中启动 Linux 内核，它就是 Ubuntu 的用户空间。</p>
<p>“哦，那是运行在容器里面啰？” 不不！<strong>这也不是一个容器</strong>，这是在 Windows 里面直接运行原生的 Ubuntu 二进制程序。</p>
<p>“嗯，就像 cygwin 那样？”不不不！cygwin 所包括的开源程序是以源代码重新编译后才能原生运行在 Windows 上。而这里，我们说的是一个比特都不差、校验值<strong>完全一样的 Ubuntu 的 ELF 二进制程序可以直接运行在 Windows 下</strong>！</p>
<p>... ...</p>
<p>“那么，这就像是模拟器一样么？”这就比较接近真相了，来自微软的一些尖端技术人员正在研究一种技术，可以<strong>将 Linux 的系统调用实时地转换为 Windows 的系统调用</strong>。你可以把它当成 Wine 的一种反向技术。微软将其称之为“<ruby> Windows 下的 Linux 子系统 <rt>  Windows Subsystem for Linux </rt></ruby>”，当然现在还没有开源。（我觉得网友 <a href="https://linux.cn/space/23856/">delectate</a> 说的比较有趣，这个东西不如叫做 mine=microsoft's native emulator 。）</p>
<p>而且，根据 <a href="https://www.linkedin.com/in/dustinkirkland/">Dustin Kirkland</a> 的<a href="http://blog.dustinkirkland.com/2016/03/ubuntu-on-windows.html">说法</a>，使用跨平台的性能测试工具 sysbench 进行测试的结果发现，在 Windows 下运行这些原生的 ELF 二进制程序和在 Linux 下运行所消耗的 CPU 、内存和 IO 性能相当。对于这个结果，我表示非常的吃惊！</p>
<p><a href="https://www.linkedin.com/in/dustinkirkland/">Dustin Kirkland</a> 是该项目组的成员之一，他的体验可以让我们感受一下这个“超级神秘”的项目。</p>
<p>由于需要将整个 Ubuntu 的根文件系统打包到一个 Windows 应用软件包（.appx）中，这位已经十几年没有使用过 Windows 的老兄对微软开发工具十分陌生，在经过几个小时与 Visual Studio 的痛苦搏斗，制作了一堆各种尺寸的 png 图标，编辑了一打以上的 XML 文件后，他简直忍不住要将咖啡杯扔到该死的屏幕上了。</p>
<p>到最后，他终于寻求他所熟悉的 Linux 经验解决了这些问题。</p>
<p>按下 Windows 键，输入“bash”，回车！他发现这个要上载的根文件系统的内容放在 /mnt/c/Users/Kirkland/Downloads 下，只需要使用一个 cp -a 复制到目标位置即可，并用 find | xargs |rename 来批量更新文件名，用 grep| xargs | sed 搜索替换路径，用 convert 工具快速地批量缩放图标，简直不要太容易地搞定了这些工作，剩下的就只需要让 Visual Studio 自己干了，编译、上载到 Windows Store。搞定！</p>
<p>嗯，你也许从终端窗口中看到了 /mnt/c ，没错，这就是你的 Windows 下的 C: 盘，它们以读写模式直接挂载到 /mnt 下了。当然，你也可以在 Windows 下通过类似如下的路径访问 Ubuntu 的文件系统：C:\Users\Kirkland\AppData\Local\Lxss\rootfs\ 。</p>
<p><img alt="文件系统" src="/data/attachment/album/201603/31/151003ljojc3jbkomm1mjm.jpg"></p>
<p>同时，如果需要 ssh 连接到其它的 Linux 上，你根本不用下载 putty，直接输入 ssh 即可：</p>
<p><img alt="ssh" src="/data/attachment/album/201603/31/151329dupcfwbc1wppw8v6.jpg"></p>
<p>当然，你也可以使用 apt 来安装和更新软件包：</p>
<p><img alt="apt" src="/data/attachment/album/201603/31/151425vz7crhkosobarzdt.jpg"></p>
<p>到目前为止，是不是所有的东西都可以完美工作了？还不全是。<a href="https://github.com/linux-test-project/ltp">LTP</a> 测试中的大多数都没问题，但是有一些则还不行，主要是 tty 相关的部分，比如 byobu、screen、tmux 等还不能很好的工作，不过相信也快了。</p>
<p>另外，顺便提一句，当前这个子系统所采用的 Linux 镜像是 Ubuntu 14.04 LTS，等 16.04 LTS 发布后相信很快就会更新到 Windows Store 上。</p>
    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>links</h2>
                        <ul>
                            <li><a href="https://getpelican.com/">Pelican</a></li>
                            <li><a href="https://www.python.org/">Python.org</a></li>
                            <li><a href="https://palletsprojects.com/p/jinja/">Jinja2</a></li>
                            <li><a href="#">You can modify those links in your config file</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>

                            <li><a href="#">You can add links in your config file</a></li>
                            <li><a href="#">Another social link</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a rel="nofollow" href="https://getpelican.com/">Pelican</a>, which takes great advantage of <a rel="nofollow" href="https://www.python.org/">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a rel="nofollow" href="https://www.smashingmagazine.com/2009/08/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>