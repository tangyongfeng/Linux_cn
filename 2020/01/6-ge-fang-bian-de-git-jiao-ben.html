<!DOCTYPE html>
<html lang="zh">
<head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="generator" content="Pelican" />
        <title>6 个方便的 Git 脚本</title>
        <link rel="stylesheet" href="/theme/css/main.css" />
        <meta name="description" content="Author: Bob Peterson 当使用 Git 存储库时，这六个 Bash 脚本将使你的生活更轻松。 我编写了许多 Bash 脚本，这些脚本使我在使用 Git 存储库时工 …" />
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">linux_cn</a></h1>
                <nav><ul>
                    <li><a href="/category/chuan-shan-jia-zhuan-fang">穿山甲专访</a></li>
                    <li><a href="/category/dai-ma-ying-xiong">代码英雄</a></li>
                    <li><a href="/category/fen-xiang">分享</a></li>
                    <li><a href="/category/guan-dian">观点</a></li>
                    <li><a href="/category/huo-dong">活动</a></li>
                    <li><a href="/category/ji-ke-man-hua">极客漫画</a></li>
                    <li><a href="/category/ji-zhu">技术</a></li>
                    <li><a href="/category/kai-yuan-zhi-hui">开源智慧</a></li>
                    <li><a href="/category/linux-fa-xing-ban">Linux 发行版</a></li>
                    <li><a href="/category/mei-ri-an-quan-zi-xun">每日安全资讯</a></li>
                    <li><a href="/category/misc">Misc</a></li>
                    <li><a href="/category/qu-kuai-lian">区块链</a></li>
                    <li><a href="/category/rong-qi-yu-yun">容器与云</a></li>
                    <li class="active"><a href="/category/ruan-jian-kai-fa">软件开发</a></li>
                    <li><a href="/category/shu-mei-pai">树莓派</a></li>
                    <li><a href="/category/xi-tong-yun-wei">系统运维</a></li>
                    <li><a href="/category/xin-wen">新闻</a></li>
                    <li><a href="/category/ying-he-guan-cha">硬核观察</a></li>
                    <li><a href="/category/zhi-ye-sheng-ya">职业生涯</a></li>
                    <li><a href="/category/zhong-jiang-ming-dan">中奖名单</a></li>
                    <li><a href="/category/zhuo-mian-ying-yong">桌面应用</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="/2020/01/6-ge-fang-bian-de-git-jiao-ben.html" rel="bookmark"
           title="Permalink to 6 个方便的 Git 脚本">6 个方便的 Git 脚本</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2020-01-18T23:17:58+01:00">
                Published: Sat 18 January 2020
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/linux-fans-from-china.html">linux fans from china</a>
        </address>
<p>In <a href="/category/ruan-jian-kai-fa">软件开发</a>.</p>

</footer><!-- /.post-info -->      <p>Author: Bob Peterson</p>
<blockquote>
<p>当使用 Git 存储库时，这六个 Bash 脚本将使你的生活更轻松。</p>
</blockquote>
<p><img alt="" src="/data/attachment/album/202001/18/231713jegbk8fyek798gxb.jpg"></p>
<p>我编写了许多 Bash 脚本，这些脚本使我在使用 Git 存储库时工作更加轻松。我的许多同事说没有必要：我所做的一切都可以用 Git 命令完成。虽然这可能是正确的，但我发现脚本远比尝试找出适当的 Git 命令来执行我想要的操作更加方便。</p>
<h3>1、gitlog</h3>
<p><code>gitlog</code> 打印针对 master 分支的当前补丁的简短列表。它从最旧到最新打印它们，并显示作者和描述，其中 <code>H</code> 代表 <code>HEAD</code>，<code>^</code> 代表 <code>HEAD^</code>，<code>2</code> 代表 <code>HEAD~2</code>，依此类推。例如：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>gitlog
-----------------------<span class="o">[</span><span class="w"> </span>recovery25<span class="w"> </span><span class="o">]</span>-----------------------
<span class="o">(</span>snip<span class="o">)</span>
<span class="m">11</span><span class="w"> </span>340d27a33895<span class="w"> </span>Bob<span class="w"> </span>Peterson<span class="w">     </span>gfs2:<span class="w"> </span>drain<span class="w"> </span>the<span class="w"> </span>ail2<span class="w"> </span>list<span class="w"> </span>after<span class="w"> </span>io<span class="w"> </span>errors
<span class="m">10</span><span class="w"> </span>9b3c4e6efb10<span class="w"> </span>Bob<span class="w"> </span>Peterson<span class="w">     </span>gfs2:<span class="w"> </span>clean<span class="w"> </span>up<span class="w"> </span>iopen<span class="w"> </span>glock<span class="w"> </span>mess<span class="w"> </span><span class="k">in</span><span class="w"> </span>gfs2_create_inode
<span class="w"> </span><span class="m">9</span><span class="w"> </span>d2e8c22be39b<span class="w"> </span>Bob<span class="w"> </span>Peterson<span class="w">     </span>gfs2:<span class="w"> </span>Do<span class="w"> </span>proper<span class="w"> </span>error<span class="w"> </span>checking<span class="w"> </span><span class="k">for</span><span class="w"> </span>go_sync<span class="w"> </span>family<span class="w"> </span>of<span class="w"> </span>glops
<span class="w"> </span><span class="m">8</span><span class="w"> </span>9563e31f8bfd<span class="w"> </span>Christoph<span class="w"> </span>Hellwig<span class="w"> </span>gfs2:<span class="w"> </span>use<span class="w"> </span>page_offset<span class="w"> </span><span class="k">in</span><span class="w"> </span>gfs2_page_mkwrite
<span class="w"> </span><span class="m">7</span><span class="w"> </span>ebac7a38036c<span class="w"> </span>Christoph<span class="w"> </span>Hellwig<span class="w"> </span>gfs2:<span class="w"> </span>don<span class="s1">&#39;t use buffer_heads in gfs2_allocate_page_backing</span>
<span class="s1"> 6 f703a3c27874 Andreas Gruenbacher gfs2: Improve mmap write vs. punch_hole consistency</span>
<span class="s1"> 5 a3e86d2ef30e Andreas Gruenbacher gfs2: Multi-block allocations in gfs2_page_mkwrite</span>
<span class="s1"> 4 da3c604755b0 Andreas Gruenbacher gfs2: Fix end-of-file handling in gfs2_page_mkwrite</span>
<span class="s1"> 3 4525c2f5b46f Bob Peterson     Rafael Aquini&#39;</span>s<span class="w"> </span>slab<span class="w"> </span>instrumentation
<span class="w"> </span><span class="m">2</span><span class="w"> </span>a06a5b7dea02<span class="w"> </span>Bob<span class="w"> </span>Peterson<span class="w">     </span>GFS2:<span class="w"> </span>Add<span class="w"> </span>go_get_holdtime<span class="w"> </span>to<span class="w"> </span>gl_ops
<span class="w"> </span>^<span class="w"> </span>8ba93c796d5c<span class="w"> </span>Bob<span class="w"> </span>Peterson<span class="w">     </span>gfs2:<span class="w"> </span>introduce<span class="w"> </span>new<span class="w"> </span><span class="k">function</span><span class="w"> </span>remaining_hold_time<span class="w"> </span>and<span class="w"> </span>use<span class="w"> </span>it<span class="w"> </span><span class="k">in</span><span class="w"> </span>dq
<span class="w"> </span>H<span class="w"> </span>e8b5ff851bb9<span class="w"> </span>Bob<span class="w"> </span>Peterson<span class="w">     </span>gfs2:<span class="w"> </span>Allow<span class="w"> </span>rgrps<span class="w"> </span>to<span class="w"> </span>have<span class="w"> </span>a<span class="w"> </span>minimum<span class="w"> </span>hold<span class="w"> </span><span class="nb">time</span>
</code></pre></div>

<p>如果我想查看其他分支上有哪些补丁，可以指定一个替代分支：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>gitlog<span class="w"> </span>recovery24
</code></pre></div>

<h3>2、gitlog.id</h3>
<p><code>gitlog.id</code> 只是打印出补丁的 SHA1 ID：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>gitlog.id
-----------------------<span class="o">[</span><span class="w"> </span>recovery25<span class="w"> </span><span class="o">]</span>-----------------------
56908eeb6940<span class="w"> </span>2ca4a6b628a1<span class="w"> </span>fc64ad5d99fe<span class="w"> </span>02031a00a251<span class="w"> </span>f6f38da7dd18<span class="w"> </span>d8546e8f0023<span class="w"> </span>fc3cc1f98f6b<span class="w"> </span>12c3e0cb3523<span class="w"> </span>76cce178b134<span class="w"> </span>6fc1dce3ab9c<span class="w"> </span>1b681ab074ca<span class="w"> </span>26fed8de719b<span class="w"> </span>802ff51a5670<span class="w"> </span>49f67a512d8c<span class="w"> </span>f04f20193bbb<span class="w"> </span>5f6afe809d23<span class="w"> </span>2030521dc70e<span class="w"> </span>dada79b3be94<span class="w"> </span>9b19a1e08161<span class="w"> </span>78a035041d3e<span class="w"> </span>f03da011cae2<span class="w"> </span>0d2b2e068fcd<span class="w"> </span>2449976aa133<span class="w"> </span>57dfb5e12ccd<span class="w"> </span>53abedfdcf72<span class="w"> </span>6fbdda3474b3<span class="w"> </span>49544a547188<span class="w"> </span>187032f7a63c<span class="w"> </span>6f75dae23d93<span class="w"> </span>95fc2a261b00<span class="w"> </span>ebfb14ded191<span class="w"> </span>f653ee9e414a<span class="w"> </span>0e2911cb8111<span class="w"> </span>73968b76e2e3<span class="w"> </span>8a3e4cb5e92c<span class="w"> </span>a5f2da803b5b<span class="w"> </span>7c9ef68388ed<span class="w"> </span>71ca19d0cba8<span class="w"> </span>340d27a33895<span class="w"> </span>9b3c4e6efb10<span class="w"> </span>d2e8c22be39b<span class="w"> </span>9563e31f8bfd<span class="w"> </span>ebac7a38036c<span class="w"> </span>f703a3c27874<span class="w"> </span>a3e86d2ef30e<span class="w"> </span>da3c604755b0<span class="w"> </span>4525c2f5b46f<span class="w"> </span>a06a5b7dea02<span class="w"> </span>8ba93c796d5c<span class="w"> </span>e8b5ff851bb9
</code></pre></div>

<p>同样，它假定是当前分支，但是如果需要，我可以指定其他分支。</p>
<h3>3、gitlog.id2</h3>
<p><code>gitlog.id2</code> 与 <code>gitlog.id</code> 相同，但顶部没有显示分支的行。这对于从一个分支挑选所有补丁到当前分支很方便：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span><span class="c1"># 创建一个新分支</span>
$<span class="w"> </span>git<span class="w"> </span>branch<span class="w"> </span>--track<span class="w"> </span>origin/master
$<span class="w"> </span><span class="c1"># 检出刚刚创建的新分支</span>
$<span class="w"> </span>git<span class="w"> </span>checkout<span class="w"> </span>recovery26
$<span class="w"> </span><span class="c1"># 从旧的分支挑选所有补丁到新分支</span>
$<span class="w"> </span><span class="k">for</span><span class="w"> </span>i<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="sb">`</span>gitlog.id2<span class="w"> </span>recovery25<span class="sb">`</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="k">do</span><span class="w"> </span>git<span class="w"> </span>cherry-pick<span class="w"> </span><span class="nv">$i</span><span class="w"> </span><span class="p">;</span><span class="k">done</span>
</code></pre></div>

<h3>4、gitlog.grep</h3>
<p><code>gitlog.grep</code> 会在该补丁集合中寻找一个字符串。例如，如果我发现一个错误并想修复引用了函数 <code>inode_go_sync</code> 的补丁，我可以简单地执行以下操作：</p>
<div class="highlight"><pre><span></span><code><span class="err">$</span> <span class="s s-Atom">gitlog</span><span class="p">.</span><span class="s s-Atom">grep</span> <span class="s s-Atom">inode_go_sync</span>
<span class="s s-Atom">-----------------------</span><span class="p">[</span> <span class="s s-Atom">recovery25</span> <span class="o">-</span> <span class="mi">50</span> <span class="s s-Atom">patches</span> <span class="p">]</span><span class="s s-Atom">-----------------------</span>
<span class="p">(</span><span class="s s-Atom">snip</span><span class="p">)</span>
<span class="mi">11</span> <span class="mi">340</span><span class="s s-Atom">d27a33895</span> <span class="nv">Bob</span> <span class="nv">Peterson</span>     <span class="s s-Atom">gfs2</span><span class="o">:</span> <span class="s s-Atom">drain</span> <span class="s s-Atom">the</span> <span class="s s-Atom">ail2</span> <span class="s s-Atom">list</span> <span class="s s-Atom">after</span> <span class="s s-Atom">io</span> <span class="s s-Atom">errors</span>
<span class="mi">10</span> <span class="mi">9</span><span class="s s-Atom">b3c4e6efb10</span> <span class="nv">Bob</span> <span class="nv">Peterson</span>     <span class="s s-Atom">gfs2</span><span class="o">:</span> <span class="s s-Atom">clean</span> <span class="s s-Atom">up</span> <span class="s s-Atom">iopen</span> <span class="s s-Atom">glock</span> <span class="s s-Atom">mess</span> <span class="s s-Atom">in</span> <span class="s s-Atom">gfs2_create_inode</span>
 <span class="mi">9</span> <span class="s s-Atom">d2e8c22be39b</span> <span class="nv">Bob</span> <span class="nv">Peterson</span>     <span class="s s-Atom">gfs2</span><span class="o">:</span> <span class="nv">Do</span> <span class="s s-Atom">proper</span> <span class="s s-Atom">error</span> <span class="s s-Atom">checking</span> <span class="s s-Atom">for</span> <span class="s s-Atom">go_sync</span> <span class="s s-Atom">family</span> <span class="s s-Atom">of</span> <span class="s s-Atom">glops</span>
<span class="mi">152</span><span class="o">:-</span><span class="s s-Atom">static</span> <span class="s s-Atom">void</span> <span class="nf">inode_go_sync</span><span class="p">(</span><span class="s s-Atom">struct</span> <span class="s s-Atom">gfs2_glock</span> <span class="o">*</span><span class="s s-Atom">gl</span><span class="p">)</span>
<span class="mi">153</span><span class="o">:+</span><span class="s s-Atom">static</span> <span class="s s-Atom">int</span> <span class="nf">inode_go_sync</span><span class="p">(</span><span class="s s-Atom">struct</span> <span class="s s-Atom">gfs2_glock</span> <span class="o">*</span><span class="s s-Atom">gl</span><span class="p">)</span>
<span class="mi">163</span><span class="o">:</span><span class="s s-Atom">@@</span> <span class="o">-</span><span class="mi">296</span><span class="p">,</span><span class="mi">6</span> <span class="o">+</span><span class="mi">302</span><span class="p">,</span><span class="mi">7</span> <span class="s s-Atom">@@</span> <span class="s s-Atom">static</span> <span class="s s-Atom">void</span> <span class="nf">inode_go_sync</span><span class="p">(</span><span class="s s-Atom">struct</span> <span class="s s-Atom">gfs2_glock</span> <span class="o">*</span><span class="s s-Atom">gl</span><span class="p">)</span>
 <span class="mi">8</span> <span class="mi">9563</span><span class="s s-Atom">e31f8bfd</span> <span class="nv">Christoph</span> <span class="nv">Hellwig</span> <span class="s s-Atom">gfs2</span><span class="o">:</span> <span class="s s-Atom">use</span> <span class="s s-Atom">page_offset</span> <span class="s s-Atom">in</span> <span class="s s-Atom">gfs2_page_mkwrite</span>
 <span class="mi">7</span> <span class="s s-Atom">ebac7a38036c</span> <span class="nv">Christoph</span> <span class="nv">Hellwig</span> <span class="s s-Atom">gfs2</span><span class="o">:</span> <span class="s s-Atom">don&#39;t use buffer_heads in gfs2_allocate_page_backing</span>
<span class="s s-Atom"> 6 f703a3c27874 Andreas Gruenbacher gfs2: Improve mmap write vs. punch_hole consistency</span>
<span class="s s-Atom"> 5 a3e86d2ef30e Andreas Gruenbacher gfs2: Multi-block allocations in gfs2_page_mkwrite</span>
<span class="s s-Atom"> 4 da3c604755b0 Andreas Gruenbacher gfs2: Fix end-of-file handling in gfs2_page_mkwrite</span>
<span class="s s-Atom"> 3 4525c2f5b46f Bob Peterson     Rafael Aquini&#39;s</span> <span class="s s-Atom">slab</span> <span class="s s-Atom">instrumentation</span>
 <span class="mi">2</span> <span class="s s-Atom">a06a5b7dea02</span> <span class="nv">Bob</span> <span class="nv">Peterson</span>     <span class="nv">GFS2</span><span class="o">:</span> <span class="nv">Add</span> <span class="s s-Atom">go_get_holdtime</span> <span class="s s-Atom">to</span> <span class="s s-Atom">gl_ops</span>
 <span class="s s-Atom">^</span> <span class="mi">8</span><span class="s s-Atom">ba93c796d5c</span> <span class="nv">Bob</span> <span class="nv">Peterson</span>     <span class="s s-Atom">gfs2</span><span class="o">:</span> <span class="s s-Atom">introduce</span> <span class="s s-Atom">new</span> <span class="s s-Atom">function</span> <span class="s s-Atom">remaining_hold_time</span> <span class="s s-Atom">and</span> <span class="s s-Atom">use</span> <span class="s s-Atom">it</span> <span class="s s-Atom">in</span> <span class="s s-Atom">dq</span>
 <span class="nv">H</span> <span class="s s-Atom">e8b5ff851bb9</span> <span class="nv">Bob</span> <span class="nv">Peterson</span>     <span class="s s-Atom">gfs2</span><span class="o">:</span> <span class="nv">Allow</span> <span class="s s-Atom">rgrps</span> <span class="s s-Atom">to</span> <span class="s s-Atom">have</span> <span class="s s-Atom">a</span> <span class="s s-Atom">minimum</span> <span class="s s-Atom">hold</span> <span class="s s-Atom">time</span>
</code></pre></div>

<p>因此，现在我知道补丁 <code>HEAD~9</code> 是需要修复的补丁。我使用 <code>git rebase -i HEAD~10</code> 编辑补丁 9，<code>git commit -a --amend</code>，然后 <code>git rebase --continue</code> 以进行必要的调整。</p>
<h3>5、gitbranchcmp3</h3>
<p><code>gitbranchcmp3</code> 使我可以将当前分支与另一个分支进行比较，因此我可以将较旧版本的补丁与我的较新版本进行比较，并快速查看已更改和未更改的内容。它生成一个比较脚本（使用了 KDE 工具 <a href="https://kde.org/applications/development/org.kde.kompare">Kompare</a>，该工具也可在 GNOME3 上使用）以比较不太相同的补丁。如果除行号外没有其他差异，则打印 <code>[SAME]</code>。如果仅存在注释差异，则打印 <code>[same]</code>（小写）。例如：</p>
<div class="highlight"><pre><span></span><code><span class="err">$</span><span class="w"> </span><span class="n">gitbranchcmp3</span><span class="w"> </span><span class="n">recovery24</span>
<span class="n">Branch</span><span class="w"> </span><span class="n">recovery24</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="mi">47</span><span class="w"> </span><span class="n">patches</span>
<span class="n">Branch</span><span class="w"> </span><span class="n">recovery25</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="mi">50</span><span class="w"> </span><span class="n">patches</span>

<span class="p">(</span><span class="n">snip</span><span class="p">)</span>
<span class="mi">38</span><span class="w"> </span><span class="mi">87</span><span class="n">eb6901607a</span><span class="w"> </span><span class="mi">340</span><span class="n">d27a33895</span><span class="w"> </span><span class="o">[</span><span class="n">same</span><span class="o">]</span><span class="w"> </span><span class="nl">gfs2</span><span class="p">:</span><span class="w"> </span><span class="n">drain</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">ail2</span><span class="w"> </span><span class="n">list</span><span class="w"> </span><span class="k">after</span><span class="w"> </span><span class="n">io</span><span class="w"> </span><span class="n">errors</span>
<span class="mi">39</span><span class="w"> </span><span class="mi">90</span><span class="n">fefb577a26</span><span class="w"> </span><span class="mi">9</span><span class="n">b3c4e6efb10</span><span class="w"> </span><span class="o">[</span><span class="n">same</span><span class="o">]</span><span class="w"> </span><span class="nl">gfs2</span><span class="p">:</span><span class="w"> </span><span class="n">clean</span><span class="w"> </span><span class="n">up</span><span class="w"> </span><span class="n">iopen</span><span class="w"> </span><span class="n">glock</span><span class="w"> </span><span class="n">mess</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">gfs2_create_inode</span>
<span class="mi">40</span><span class="w"> </span><span class="n">ba3ae06b8b0e</span><span class="w"> </span><span class="n">d2e8c22be39b</span><span class="w"> </span><span class="o">[</span><span class="n">same</span><span class="o">]</span><span class="w"> </span><span class="nl">gfs2</span><span class="p">:</span><span class="w"> </span><span class="n">Do</span><span class="w"> </span><span class="n">proper</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="n">checking</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">go_sync</span><span class="w"> </span><span class="n">family</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">glops</span>
<span class="mi">41</span><span class="w"> </span><span class="mi">2</span><span class="n">ab662294329</span><span class="w"> </span><span class="mf">9563e31</span><span class="n">f8bfd</span><span class="w"> </span><span class="o">[</span><span class="n">SAME</span><span class="o">]</span><span class="w"> </span><span class="nl">gfs2</span><span class="p">:</span><span class="w"> </span><span class="k">use</span><span class="w"> </span><span class="n">page_offset</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">gfs2_page_mkwrite</span>
<span class="mi">42</span><span class="w"> </span><span class="mi">0</span><span class="n">adc6d817b7a</span><span class="w"> </span><span class="n">ebac7a38036c</span><span class="w"> </span><span class="o">[</span><span class="n">SAME</span><span class="o">]</span><span class="w"> </span><span class="nl">gfs2</span><span class="p">:</span><span class="w"> </span><span class="n">don</span><span class="s1">&#39;t use buffer_heads in gfs2_allocate_page_backing</span>
<span class="s1">43 55ef1f8d0be8 f703a3c27874 [SAME] gfs2: Improve mmap write vs. punch_hole consistency</span>
<span class="s1">44 de57c2f72570 a3e86d2ef30e [SAME] gfs2: Multi-block allocations in gfs2_page_mkwrite</span>
<span class="s1">45 7c5305fbd68a da3c604755b0 [SAME] gfs2: Fix end-of-file handling in gfs2_page_mkwrite</span>
<span class="s1">46 162524005151 4525c2f5b46f [SAME] Rafael Aquini&#39;</span><span class="n">s</span><span class="w"> </span><span class="n">slab</span><span class="w"> </span><span class="n">instrumentation</span>
<span class="mi">47</span><span class="w">              </span><span class="n">a06a5b7dea02</span><span class="w"> </span><span class="o">[</span><span class="n">    </span><span class="o">]</span><span class="w"> </span><span class="nl">GFS2</span><span class="p">:</span><span class="w"> </span><span class="k">Add</span><span class="w"> </span><span class="n">go_get_holdtime</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">gl_ops</span>
<span class="mi">48</span><span class="w">              </span><span class="mi">8</span><span class="n">ba93c796d5c</span><span class="w"> </span><span class="o">[</span><span class="n">    </span><span class="o">]</span><span class="w"> </span><span class="nl">gfs2</span><span class="p">:</span><span class="w"> </span><span class="n">introduce</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="k">function</span><span class="w"> </span><span class="n">remaining_hold_time</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="k">use</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">dq</span>
<span class="mi">49</span><span class="w">              </span><span class="n">e8b5ff851bb9</span><span class="w"> </span><span class="o">[</span><span class="n">    </span><span class="o">]</span><span class="w"> </span><span class="nl">gfs2</span><span class="p">:</span><span class="w"> </span><span class="n">Allow</span><span class="w"> </span><span class="n">rgrps</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">minimum</span><span class="w"> </span><span class="k">hold</span><span class="w"> </span><span class="nc">time</span>

<span class="n">Missing</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="nl">recovery25</span><span class="p">:</span>
<span class="n">The</span><span class="w"> </span><span class="nl">missing</span><span class="p">:</span>
<span class="n">Compare</span><span class="w"> </span><span class="n">script</span><span class="w"> </span><span class="n">generated</span><span class="w"> </span><span class="k">at</span><span class="err">:</span><span class="w"> </span><span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">compare_mismatches</span><span class="p">.</span><span class="n">sh</span>
</code></pre></div>

<h3>6、gitlog.find</h3>
<p>最后，我有一个 <code>gitlog.find</code> 脚本，可以帮助我识别补丁程序的上游版本在哪里以及每个补丁的当前状态。它通过匹配补丁说明来实现。它还会生成一个比较脚本（再次使用了 Kompare），以将当前补丁与上游对应补丁进行比较：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>gitlog.find
-----------------------<span class="o">[</span><span class="w"> </span>recovery25<span class="w"> </span>-<span class="w"> </span><span class="m">50</span><span class="w"> </span>patches<span class="w"> </span><span class="o">]</span>-----------------------
<span class="o">(</span>snip<span class="o">)</span>
<span class="m">11</span><span class="w"> </span>340d27a33895<span class="w"> </span>Bob<span class="w"> </span>Peterson<span class="w">     </span>gfs2:<span class="w"> </span>drain<span class="w"> </span>the<span class="w"> </span>ail2<span class="w"> </span>list<span class="w"> </span>after<span class="w"> </span>io<span class="w"> </span>errors
lo<span class="w"> </span>5bcb9be74b2a<span class="w"> </span>Bob<span class="w"> </span>Peterson<span class="w">     </span>gfs2:<span class="w"> </span>drain<span class="w"> </span>the<span class="w"> </span>ail2<span class="w"> </span>list<span class="w"> </span>after<span class="w"> </span>io<span class="w"> </span>errors
<span class="m">10</span><span class="w"> </span>9b3c4e6efb10<span class="w"> </span>Bob<span class="w"> </span>Peterson<span class="w">     </span>gfs2:<span class="w"> </span>clean<span class="w"> </span>up<span class="w"> </span>iopen<span class="w"> </span>glock<span class="w"> </span>mess<span class="w"> </span><span class="k">in</span><span class="w"> </span>gfs2_create_inode
fn<span class="w"> </span>2c47c1be51fb<span class="w"> </span>Bob<span class="w"> </span>Peterson<span class="w">     </span>gfs2:<span class="w"> </span>clean<span class="w"> </span>up<span class="w"> </span>iopen<span class="w"> </span>glock<span class="w"> </span>mess<span class="w"> </span><span class="k">in</span><span class="w"> </span>gfs2_create_inode
<span class="w"> </span><span class="m">9</span><span class="w"> </span>d2e8c22be39b<span class="w"> </span>Bob<span class="w"> </span>Peterson<span class="w">     </span>gfs2:<span class="w"> </span>Do<span class="w"> </span>proper<span class="w"> </span>error<span class="w"> </span>checking<span class="w"> </span><span class="k">for</span><span class="w"> </span>go_sync<span class="w"> </span>family<span class="w"> </span>of<span class="w"> </span>glops
lo<span class="w"> </span>feb7ea639472<span class="w"> </span>Bob<span class="w"> </span>Peterson<span class="w">     </span>gfs2:<span class="w"> </span>Do<span class="w"> </span>proper<span class="w"> </span>error<span class="w"> </span>checking<span class="w"> </span><span class="k">for</span><span class="w"> </span>go_sync<span class="w"> </span>family<span class="w"> </span>of<span class="w"> </span>glops
<span class="w"> </span><span class="m">8</span><span class="w"> </span>9563e31f8bfd<span class="w"> </span>Christoph<span class="w"> </span>Hellwig<span class="w"> </span>gfs2:<span class="w"> </span>use<span class="w"> </span>page_offset<span class="w"> </span><span class="k">in</span><span class="w"> </span>gfs2_page_mkwrite
ms<span class="w"> </span>f3915f83e84c<span class="w"> </span>Christoph<span class="w"> </span>Hellwig<span class="w"> </span>gfs2:<span class="w"> </span>use<span class="w"> </span>page_offset<span class="w"> </span><span class="k">in</span><span class="w"> </span>gfs2_page_mkwrite
<span class="w"> </span><span class="m">7</span><span class="w"> </span>ebac7a38036c<span class="w"> </span>Christoph<span class="w"> </span>Hellwig<span class="w"> </span>gfs2:<span class="w"> </span>don<span class="s1">&#39;t use buffer_heads in gfs2_allocate_page_backing</span>
<span class="s1">ms 35af80aef99b Christoph Hellwig gfs2: don&#39;</span>t<span class="w"> </span>use<span class="w"> </span>buffer_heads<span class="w"> </span><span class="k">in</span><span class="w"> </span>gfs2_allocate_page_backing
<span class="w"> </span><span class="m">6</span><span class="w"> </span>f703a3c27874<span class="w"> </span>Andreas<span class="w"> </span>Gruenbacher<span class="w"> </span>gfs2:<span class="w"> </span>Improve<span class="w"> </span>mmap<span class="w"> </span>write<span class="w"> </span>vs.<span class="w"> </span>punch_hole<span class="w"> </span>consistency
fn<span class="w"> </span>39c3a948ecf6<span class="w"> </span>Andreas<span class="w"> </span>Gruenbacher<span class="w"> </span>gfs2:<span class="w"> </span>Improve<span class="w"> </span>mmap<span class="w"> </span>write<span class="w"> </span>vs.<span class="w"> </span>punch_hole<span class="w"> </span>consistency
<span class="w"> </span><span class="m">5</span><span class="w"> </span>a3e86d2ef30e<span class="w"> </span>Andreas<span class="w"> </span>Gruenbacher<span class="w"> </span>gfs2:<span class="w"> </span>Multi-block<span class="w"> </span>allocations<span class="w"> </span><span class="k">in</span><span class="w"> </span>gfs2_page_mkwrite
fn<span class="w"> </span>f53056c43063<span class="w"> </span>Andreas<span class="w"> </span>Gruenbacher<span class="w"> </span>gfs2:<span class="w"> </span>Multi-block<span class="w"> </span>allocations<span class="w"> </span><span class="k">in</span><span class="w"> </span>gfs2_page_mkwrite
<span class="w"> </span><span class="m">4</span><span class="w"> </span>da3c604755b0<span class="w"> </span>Andreas<span class="w"> </span>Gruenbacher<span class="w"> </span>gfs2:<span class="w"> </span>Fix<span class="w"> </span>end-of-file<span class="w"> </span>handling<span class="w"> </span><span class="k">in</span><span class="w"> </span>gfs2_page_mkwrite
fn<span class="w"> </span>184b4e60853d<span class="w"> </span>Andreas<span class="w"> </span>Gruenbacher<span class="w"> </span>gfs2:<span class="w"> </span>Fix<span class="w"> </span>end-of-file<span class="w"> </span>handling<span class="w"> </span><span class="k">in</span><span class="w"> </span>gfs2_page_mkwrite
<span class="w"> </span><span class="m">3</span><span class="w"> </span>4525c2f5b46f<span class="w"> </span>Bob<span class="w"> </span>Peterson<span class="w">     </span>Rafael<span class="w"> </span>Aquini<span class="err">&#39;</span>s<span class="w"> </span>slab<span class="w"> </span>instrumentation
<span class="w">   </span>Not<span class="w"> </span>found<span class="w"> </span>upstream
<span class="w"> </span><span class="m">2</span><span class="w"> </span>a06a5b7dea02<span class="w"> </span>Bob<span class="w"> </span>Peterson<span class="w">     </span>GFS2:<span class="w"> </span>Add<span class="w"> </span>go_get_holdtime<span class="w"> </span>to<span class="w"> </span>gl_ops
<span class="w">   </span>Not<span class="w"> </span>found<span class="w"> </span>upstream
<span class="w"> </span>^<span class="w"> </span>8ba93c796d5c<span class="w"> </span>Bob<span class="w"> </span>Peterson<span class="w">     </span>gfs2:<span class="w"> </span>introduce<span class="w"> </span>new<span class="w"> </span><span class="k">function</span><span class="w"> </span>remaining_hold_time<span class="w"> </span>and<span class="w"> </span>use<span class="w"> </span>it<span class="w"> </span><span class="k">in</span><span class="w"> </span>dq
<span class="w">   </span>Not<span class="w"> </span>found<span class="w"> </span>upstream
<span class="w"> </span>H<span class="w"> </span>e8b5ff851bb9<span class="w"> </span>Bob<span class="w"> </span>Peterson<span class="w">     </span>gfs2:<span class="w"> </span>Allow<span class="w"> </span>rgrps<span class="w"> </span>to<span class="w"> </span>have<span class="w"> </span>a<span class="w"> </span>minimum<span class="w"> </span>hold<span class="w"> </span><span class="nb">time</span>
<span class="w">   </span>Not<span class="w"> </span>found<span class="w"> </span>upstream
Compare<span class="w"> </span>script<span class="w"> </span>generated:<span class="w"> </span>/tmp/compare_upstream.sh
</code></pre></div>

<p>补丁显示为两行，第一行是你当前的修补程序，然后是相应的上游补丁，以及 2 个字符的缩写，以指示其上游状态：</p>
<ul>
<li><code>lo</code> 表示补丁仅在本地（<code>local</code>）上游 Git 存储库中（即尚未推送到上游）。</li>
<li><code>ms</code> 表示补丁位于 Linus Torvald 的主（<code>master</code>）分支中。</li>
<li><code>fn</code> 意味着补丁被推送到我的 “for-next” 开发分支，用于下一个上游合并窗口。 我的一些脚本根据我通常使用 Git 的方式做出假设。例如，当搜索上游补丁时，它使用我众所周知的 Git 树的位置。因此，你需要调整或改进它们以适合你的条件。<code>gitlog.find</code> 脚本旨在仅定位 <a href="https://en.wikipedia.org/wiki/GFS2">GFS2</a> 和 <a href="https://en.wikipedia.org/wiki/Distributed_lock_manager">DLM</a> 补丁，因此，除非你是 GFS2 开发人员，否则你需要针对你感兴趣的组件对其进行自定义。</li>
</ul>
<h3>源代码</h3>
<p>以下是这些脚本的源代码。</p>
<h4>1、gitlog</h4>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>
<span class="nv">branch</span><span class="o">=</span><span class="nv">$1</span>

<span class="k">if</span><span class="w"> </span><span class="nb">test</span><span class="w"> </span><span class="s2">&quot;x</span><span class="nv">$branch</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>x<span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span><span class="nv">branch</span><span class="o">=</span><span class="sb">`</span>git<span class="w"> </span>branch<span class="w"> </span>-a<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s2">&quot;*&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>cut<span class="w"> </span>-d<span class="w"> </span><span class="s1">&#39; &#39;</span><span class="w"> </span>-f2<span class="sb">`</span>
<span class="k">fi</span>

<span class="nv">patches</span><span class="o">=</span><span class="m">0</span>
<span class="nv">tracking</span><span class="o">=</span><span class="sb">`</span>git<span class="w"> </span>rev-parse<span class="w"> </span>--abbrev-ref<span class="w"> </span>--symbolic-full-name<span class="w"> </span>@<span class="o">{</span>u<span class="o">}</span><span class="sb">`</span>

<span class="nv">LIST</span><span class="o">=</span><span class="sb">`</span>git<span class="w"> </span>log<span class="w"> </span>--reverse<span class="w"> </span>--abbrev-commit<span class="w"> </span>--pretty<span class="o">=</span>oneline<span class="w"> </span><span class="nv">$tracking</span>..<span class="nv">$branch</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>cut<span class="w"> </span>-d<span class="w"> </span><span class="s1">&#39; &#39;</span><span class="w"> </span>-f1<span class="w"> </span><span class="p">|</span>paste<span class="w"> </span>-s<span class="w"> </span>-d<span class="w"> </span><span class="s1">&#39; &#39;</span><span class="sb">`</span>
<span class="k">for</span><span class="w"> </span>i<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nv">$LIST</span><span class="p">;</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="nv">patches</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span><span class="w"> </span><span class="nv">$patches</span><span class="w"> </span>+<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>bc<span class="k">)</span><span class="p">;</span><span class="k">done</span>

<span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="nv">$branch</span><span class="w"> </span><span class="o">=</span>~<span class="w"> </span>.*for-next.*<span class="w"> </span><span class="o">]]</span>
<span class="k">then</span>
<span class="w">    </span><span class="nv">start</span><span class="o">=</span>HEAD
<span class="c1">#    start=origin/for-next</span>
<span class="k">else</span>
<span class="w">    </span><span class="nv">start</span><span class="o">=</span>origin/master
<span class="k">fi</span>

<span class="nv">tracking</span><span class="o">=</span><span class="sb">`</span>git<span class="w"> </span>rev-parse<span class="w"> </span>--abbrev-ref<span class="w"> </span>--symbolic-full-name<span class="w"> </span>@<span class="o">{</span>u<span class="o">}</span><span class="sb">`</span>

/usr/bin/echo<span class="w"> </span><span class="s2">&quot;-----------------------[&quot;</span><span class="w"> </span><span class="nv">$branch</span><span class="w"> </span><span class="s2">&quot;]-----------------------&quot;</span>
<span class="nv">patches</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span><span class="w"> </span><span class="nv">$patches</span><span class="w"> </span>-<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>bc<span class="k">)</span><span class="p">;</span>
<span class="k">for</span><span class="w"> </span>i<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nv">$LIST</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="nv">$patches</span><span class="w"> </span>-eq<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span><span class="nv">cnt</span><span class="o">=</span><span class="s2">&quot; ^&quot;</span>
<span class="w">    </span><span class="k">elif</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="nv">$patches</span><span class="w"> </span>-eq<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span><span class="nv">cnt</span><span class="o">=</span><span class="s2">&quot; H&quot;</span>
<span class="w">    </span><span class="k">else</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="nv">$patches</span><span class="w"> </span>-lt<span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">            </span><span class="nv">cnt</span><span class="o">=</span><span class="s2">&quot; </span><span class="nv">$patches</span><span class="s2">&quot;</span>
<span class="w">        </span><span class="k">else</span>
<span class="w">            </span><span class="nv">cnt</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$patches</span><span class="s2">&quot;</span>
<span class="w">        </span><span class="k">fi</span>
<span class="w">    </span><span class="k">fi</span>
<span class="w">    </span>/usr/bin/git<span class="w"> </span>show<span class="w"> </span>--abbrev-commit<span class="w"> </span>-s<span class="w"> </span>--pretty<span class="o">=</span>format:<span class="s2">&quot;</span><span class="nv">$cnt</span><span class="s2"> %h %&lt;|(32)%an %s %n&quot;</span><span class="w"> </span><span class="nv">$i</span>
<span class="w">    </span><span class="nv">patches</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span><span class="w"> </span><span class="nv">$patches</span><span class="w"> </span>-<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>bc<span class="k">)</span>
<span class="k">done</span>
<span class="c1">#git log --reverse --abbrev-commit --pretty=format:&quot;%h %&lt;|(32)%an %s&quot; $tracking..$branch</span>
<span class="c1">#git log --reverse --abbrev-commit --pretty=format:&quot;%h %&lt;|(32)%an %s&quot; ^origin/master ^linux-gfs2/for-next $branch</span>
</code></pre></div>

<h4>2、gitlog.id</h4>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>
<span class="nv">branch</span><span class="o">=</span><span class="nv">$1</span>

<span class="k">if</span><span class="w"> </span><span class="nb">test</span><span class="w"> </span><span class="s2">&quot;x</span><span class="nv">$branch</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>x<span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span><span class="nv">branch</span><span class="o">=</span><span class="sb">`</span>git<span class="w"> </span>branch<span class="w"> </span>-a<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s2">&quot;*&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>cut<span class="w"> </span>-d<span class="w"> </span><span class="s1">&#39; &#39;</span><span class="w"> </span>-f2<span class="sb">`</span>
<span class="k">fi</span>

<span class="nv">tracking</span><span class="o">=</span><span class="sb">`</span>git<span class="w"> </span>rev-parse<span class="w"> </span>--abbrev-ref<span class="w"> </span>--symbolic-full-name<span class="w"> </span>@<span class="o">{</span>u<span class="o">}</span><span class="sb">`</span>

/usr/bin/echo<span class="w"> </span><span class="s2">&quot;-----------------------[&quot;</span><span class="w"> </span><span class="nv">$branch</span><span class="w"> </span><span class="s2">&quot;]-----------------------&quot;</span>
git<span class="w"> </span>log<span class="w"> </span>--reverse<span class="w"> </span>--abbrev-commit<span class="w"> </span>--pretty<span class="o">=</span>oneline<span class="w"> </span><span class="nv">$tracking</span>..<span class="nv">$branch</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>cut<span class="w"> </span>-d<span class="w"> </span><span class="s1">&#39; &#39;</span><span class="w"> </span>-f1<span class="w"> </span><span class="p">|</span>paste<span class="w"> </span>-s<span class="w"> </span>-d<span class="w"> </span><span class="s1">&#39; &#39;</span>
</code></pre></div>

<h4>3、gitlog.id2</h4>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>
<span class="nv">branch</span><span class="o">=</span><span class="nv">$1</span>

<span class="k">if</span><span class="w"> </span><span class="nb">test</span><span class="w"> </span><span class="s2">&quot;x</span><span class="nv">$branch</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>x<span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span><span class="nv">branch</span><span class="o">=</span><span class="sb">`</span>git<span class="w"> </span>branch<span class="w"> </span>-a<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s2">&quot;*&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>cut<span class="w"> </span>-d<span class="w"> </span><span class="s1">&#39; &#39;</span><span class="w"> </span>-f2<span class="sb">`</span>
<span class="k">fi</span>

<span class="nv">tracking</span><span class="o">=</span><span class="sb">`</span>git<span class="w"> </span>rev-parse<span class="w"> </span>--abbrev-ref<span class="w"> </span>--symbolic-full-name<span class="w"> </span>@<span class="o">{</span>u<span class="o">}</span><span class="sb">`</span>
git<span class="w"> </span>log<span class="w"> </span>--reverse<span class="w"> </span>--abbrev-commit<span class="w"> </span>--pretty<span class="o">=</span>oneline<span class="w"> </span><span class="nv">$tracking</span>..<span class="nv">$branch</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>cut<span class="w"> </span>-d<span class="w"> </span><span class="s1">&#39; &#39;</span><span class="w"> </span>-f1<span class="w"> </span><span class="p">|</span>paste<span class="w"> </span>-s<span class="w"> </span>-d<span class="w"> </span><span class="s1">&#39; &#39;</span>
</code></pre></div>

<h4>4、gitlog.grep</h4>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>
<span class="nv">param1</span><span class="o">=</span><span class="nv">$1</span>
<span class="nv">param2</span><span class="o">=</span><span class="nv">$2</span>

<span class="k">if</span><span class="w"> </span><span class="nb">test</span><span class="w"> </span><span class="s2">&quot;x</span><span class="nv">$param2</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>x<span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span><span class="nv">branch</span><span class="o">=</span><span class="sb">`</span>git<span class="w"> </span>branch<span class="w"> </span>-a<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s2">&quot;*&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>cut<span class="w"> </span>-d<span class="w"> </span><span class="s1">&#39; &#39;</span><span class="w"> </span>-f2<span class="sb">`</span>
<span class="w">    </span><span class="nv">string</span><span class="o">=</span><span class="nv">$param1</span>
<span class="k">else</span>
<span class="w">    </span><span class="nv">branch</span><span class="o">=</span><span class="nv">$param1</span>
<span class="w">    </span><span class="nv">string</span><span class="o">=</span><span class="nv">$param2</span>
<span class="k">fi</span>

<span class="nv">patches</span><span class="o">=</span><span class="m">0</span>
<span class="nv">tracking</span><span class="o">=</span><span class="sb">`</span>git<span class="w"> </span>rev-parse<span class="w"> </span>--abbrev-ref<span class="w"> </span>--symbolic-full-name<span class="w"> </span>@<span class="o">{</span>u<span class="o">}</span><span class="sb">`</span>

<span class="nv">LIST</span><span class="o">=</span><span class="sb">`</span>git<span class="w"> </span>log<span class="w"> </span>--reverse<span class="w"> </span>--abbrev-commit<span class="w"> </span>--pretty<span class="o">=</span>oneline<span class="w"> </span><span class="nv">$tracking</span>..<span class="nv">$branch</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>cut<span class="w"> </span>-d<span class="w"> </span><span class="s1">&#39; &#39;</span><span class="w"> </span>-f1<span class="w"> </span><span class="p">|</span>paste<span class="w"> </span>-s<span class="w"> </span>-d<span class="w"> </span><span class="s1">&#39; &#39;</span><span class="sb">`</span>
<span class="k">for</span><span class="w"> </span>i<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nv">$LIST</span><span class="p">;</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="nv">patches</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span><span class="w"> </span><span class="nv">$patches</span><span class="w"> </span>+<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>bc<span class="k">)</span><span class="p">;</span><span class="k">done</span>
/usr/bin/echo<span class="w"> </span><span class="s2">&quot;-----------------------[&quot;</span><span class="w"> </span><span class="nv">$branch</span><span class="w"> </span><span class="s2">&quot;-&quot;</span><span class="w"> </span><span class="nv">$patches</span><span class="w"> </span><span class="s2">&quot;patches ]-----------------------&quot;</span>
<span class="nv">patches</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span><span class="w"> </span><span class="nv">$patches</span><span class="w"> </span>-<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>bc<span class="k">)</span><span class="p">;</span>
<span class="k">for</span><span class="w"> </span>i<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nv">$LIST</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="nv">$patches</span><span class="w"> </span>-eq<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span><span class="nv">cnt</span><span class="o">=</span><span class="s2">&quot; ^&quot;</span>
<span class="w">    </span><span class="k">elif</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="nv">$patches</span><span class="w"> </span>-eq<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span><span class="nv">cnt</span><span class="o">=</span><span class="s2">&quot; H&quot;</span>
<span class="w">    </span><span class="k">else</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="nv">$patches</span><span class="w"> </span>-lt<span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">            </span><span class="nv">cnt</span><span class="o">=</span><span class="s2">&quot; </span><span class="nv">$patches</span><span class="s2">&quot;</span>
<span class="w">        </span><span class="k">else</span>
<span class="w">            </span><span class="nv">cnt</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$patches</span><span class="s2">&quot;</span>
<span class="w">        </span><span class="k">fi</span>
<span class="w">    </span><span class="k">fi</span>
<span class="w">    </span>/usr/bin/git<span class="w"> </span>show<span class="w"> </span>--abbrev-commit<span class="w"> </span>-s<span class="w"> </span>--pretty<span class="o">=</span>format:<span class="s2">&quot;</span><span class="nv">$cnt</span><span class="s2"> %h %&lt;|(32)%an %s&quot;</span><span class="w"> </span><span class="nv">$i</span>
<span class="w">    </span>/usr/bin/git<span class="w"> </span>show<span class="w"> </span>--pretty<span class="o">=</span>email<span class="w"> </span>--patch-with-stat<span class="w"> </span><span class="nv">$i</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-n<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$string</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="nv">patches</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span><span class="w"> </span><span class="nv">$patches</span><span class="w"> </span>-<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>bc<span class="k">)</span>
<span class="k">done</span>
</code></pre></div>

<h4>5、gitbranchcmp3</h4>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>
<span class="c1">#</span>
<span class="c1"># gitbranchcmp3 &lt;old branch&gt; [&lt;new_branch&gt;]</span>
<span class="c1">#</span>
<span class="nv">oldbranch</span><span class="o">=</span><span class="nv">$1</span>
<span class="nv">newbranch</span><span class="o">=</span><span class="nv">$2</span>
<span class="nv">script</span><span class="o">=</span>/tmp/compare_mismatches.sh

/usr/bin/rm<span class="w"> </span>-f<span class="w"> </span><span class="nv">$script</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;#!/bin/bash&quot;</span><span class="w"> </span>&gt;<span class="w"> </span><span class="nv">$script</span>
/usr/bin/chmod<span class="w"> </span><span class="m">755</span><span class="w"> </span><span class="nv">$script</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;# Generated by gitbranchcmp3.sh&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span><span class="nv">$script</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;# Run this script to compare the mismatched patches&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span><span class="nv">$script</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot; &quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span><span class="nv">$script</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;function compare_them()&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span><span class="nv">$script</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;{&quot;</span><span class="w">  </span>&gt;&gt;<span class="w"> </span><span class="nv">$script</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;    git show --pretty=email --patch-with-stat \$1 &gt; /tmp/gronk1&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span><span class="nv">$script</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;    git show --pretty=email --patch-with-stat \$2 &gt; /tmp/gronk2&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span><span class="nv">$script</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;    kompare /tmp/gronk1 /tmp/gronk2&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span><span class="nv">$script</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;}&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span><span class="nv">$script</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot; &quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span><span class="nv">$script</span>

<span class="k">if</span><span class="w"> </span><span class="nb">test</span><span class="w"> </span><span class="s2">&quot;x</span><span class="nv">$newbranch</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>x<span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span><span class="nv">newbranch</span><span class="o">=</span><span class="sb">`</span>git<span class="w"> </span>branch<span class="w"> </span>-a<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s2">&quot;*&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>cut<span class="w"> </span>-d<span class="w"> </span><span class="s1">&#39; &#39;</span><span class="w"> </span>-f2<span class="sb">`</span>
<span class="k">fi</span>

<span class="nv">tracking</span><span class="o">=</span><span class="sb">`</span>git<span class="w"> </span>rev-parse<span class="w"> </span>--abbrev-ref<span class="w"> </span>--symbolic-full-name<span class="w"> </span>@<span class="o">{</span>u<span class="o">}</span><span class="sb">`</span>

<span class="nb">declare</span><span class="w"> </span>-a<span class="w"> </span><span class="nv">oldsha1s</span><span class="o">=(</span><span class="sb">`</span>git<span class="w"> </span>log<span class="w"> </span>--reverse<span class="w"> </span>--abbrev-commit<span class="w"> </span>--pretty<span class="o">=</span>oneline<span class="w"> </span><span class="nv">$tracking</span>..<span class="nv">$oldbranch</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>cut<span class="w"> </span>-d<span class="w"> </span><span class="s1">&#39; &#39;</span><span class="w"> </span>-f1<span class="w"> </span><span class="p">|</span>paste<span class="w"> </span>-s<span class="w"> </span>-d<span class="w"> </span><span class="s1">&#39; &#39;</span><span class="sb">`</span><span class="o">)</span>
<span class="nb">declare</span><span class="w"> </span>-a<span class="w"> </span><span class="nv">newsha1s</span><span class="o">=(</span><span class="sb">`</span>git<span class="w"> </span>log<span class="w"> </span>--reverse<span class="w"> </span>--abbrev-commit<span class="w"> </span>--pretty<span class="o">=</span>oneline<span class="w"> </span><span class="nv">$tracking</span>..<span class="nv">$newbranch</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>cut<span class="w"> </span>-d<span class="w"> </span><span class="s1">&#39; &#39;</span><span class="w"> </span>-f1<span class="w"> </span><span class="p">|</span>paste<span class="w"> </span>-s<span class="w"> </span>-d<span class="w"> </span><span class="s1">&#39; &#39;</span><span class="sb">`</span><span class="o">)</span>

<span class="c1">#echo &quot;old: &quot; $oldsha1s</span>
<span class="nv">oldcount</span><span class="o">=</span><span class="si">${#</span><span class="nv">oldsha1s</span><span class="p">[@]</span><span class="si">}</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Branch </span><span class="nv">$oldbranch</span><span class="s2"> has </span><span class="nv">$oldcount</span><span class="s2"> patches&quot;</span>
<span class="nv">oldcount</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span><span class="w"> </span><span class="nv">$oldcount</span><span class="w"> </span>-<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>bc<span class="k">)</span>
<span class="c1">#for o in `seq 0 ${#oldsha1s[@]}`; do</span>
<span class="c1">#    echo -n ${oldsha1s[$o]} &quot; &quot;</span>
<span class="c1">#    desc=`git show $i | head -5 | tail -1|cut -b5-`</span>
<span class="c1">#done</span>

<span class="c1">#echo &quot;new: &quot; $newsha1s</span>
<span class="nv">newcount</span><span class="o">=</span><span class="si">${#</span><span class="nv">newsha1s</span><span class="p">[@]</span><span class="si">}</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Branch </span><span class="nv">$newbranch</span><span class="s2"> has </span><span class="nv">$newcount</span><span class="s2"> patches&quot;</span>
<span class="nv">newcount</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span><span class="w"> </span><span class="nv">$newcount</span><span class="w"> </span>-<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>bc<span class="k">)</span>
<span class="c1">#for o in `seq 0 ${#newsha1s[@]}`; do</span>
<span class="c1">#    echo -n ${newsha1s[$o]} &quot; &quot;</span>
<span class="c1">#    desc=`git show $i | head -5 | tail -1|cut -b5-`</span>
<span class="c1">#done</span>
<span class="nb">echo</span>

<span class="k">for</span><span class="w"> </span>new<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="sb">`</span>seq<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="nv">$newcount</span><span class="sb">`</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">    </span><span class="nv">newsha</span><span class="o">=</span><span class="si">${</span><span class="nv">newsha1s</span><span class="p">[</span><span class="nv">$new</span><span class="p">]</span><span class="si">}</span>
<span class="w">    </span><span class="nv">newdesc</span><span class="o">=</span><span class="sb">`</span>git<span class="w"> </span>show<span class="w"> </span><span class="nv">$newsha</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>head<span class="w"> </span>-5<span class="w"> </span><span class="p">|</span><span class="w"> </span>tail<span class="w"> </span>-1<span class="p">|</span>cut<span class="w"> </span>-b5-<span class="sb">`</span>
<span class="w">    </span><span class="nv">oldsha</span><span class="o">=</span><span class="s2">&quot;            &quot;</span>
<span class="w">    </span><span class="nv">same</span><span class="o">=</span><span class="s2">&quot;[    ]&quot;</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span>old<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="sb">`</span>seq<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="nv">$oldcount</span><span class="sb">`</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nb">test</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">oldsha1s</span><span class="p">[</span><span class="nv">$old</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;match&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">            </span><span class="k">continue</span><span class="p">;</span>
<span class="w">        </span><span class="k">fi</span>
<span class="w">        </span><span class="nv">olddesc</span><span class="o">=</span><span class="sb">`</span>git<span class="w"> </span>show<span class="w"> </span><span class="si">${</span><span class="nv">oldsha1s</span><span class="p">[</span><span class="nv">$old</span><span class="p">]</span><span class="si">}</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>head<span class="w"> </span>-5<span class="w"> </span><span class="p">|</span><span class="w"> </span>tail<span class="w"> </span>-1<span class="p">|</span>cut<span class="w"> </span>-b5-<span class="sb">`</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nb">test</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$olddesc</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$newdesc</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">            </span><span class="nv">oldsha</span><span class="o">=</span><span class="si">${</span><span class="nv">oldsha1s</span><span class="p">[</span><span class="nv">$old</span><span class="p">]</span><span class="si">}</span>
<span class="w">            </span><span class="c1">#echo $oldsha</span>
<span class="w">            </span>git<span class="w"> </span>show<span class="w"> </span><span class="nv">$oldsha</span><span class="w"> </span><span class="p">|</span>tail<span class="w"> </span>-n<span class="w"> </span>+2<span class="w"> </span><span class="p">|</span>grep<span class="w"> </span>-v<span class="w"> </span><span class="s2">&quot;index.*\.\.&quot;</span><span class="w"> </span><span class="p">|</span>grep<span class="w"> </span>-v<span class="w"> </span><span class="s2">&quot;@@&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>/tmp/gronk1
<span class="w">            </span>git<span class="w"> </span>show<span class="w"> </span><span class="nv">$newsha</span><span class="w"> </span><span class="p">|</span>tail<span class="w"> </span>-n<span class="w"> </span>+2<span class="w"> </span><span class="p">|</span>grep<span class="w"> </span>-v<span class="w"> </span><span class="s2">&quot;index.*\.\.&quot;</span><span class="w"> </span><span class="p">|</span>grep<span class="w"> </span>-v<span class="w"> </span><span class="s2">&quot;@@&quot;</span><span class="w">  </span>&gt;<span class="w"> </span>/tmp/gronk2
<span class="w">            </span>diff<span class="w"> </span>/tmp/gronk1<span class="w"> </span>/tmp/gronk2<span class="w"> </span><span class="p">&amp;</span>&gt;<span class="w"> </span>/dev/null
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="nv">$?</span><span class="w"> </span>-eq<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">]</span><span class="w"> </span><span class="p">;</span><span class="k">then</span>
<span class="c1"># No differences</span>
<span class="w">                </span><span class="nv">same</span><span class="o">=</span><span class="s2">&quot;[SAME]&quot;</span>
<span class="w">                </span>oldsha1s<span class="o">[</span><span class="nv">$old</span><span class="o">]=</span><span class="s2">&quot;match&quot;</span>
<span class="w">                </span><span class="k">break</span>
<span class="w">            </span><span class="k">fi</span>
<span class="w">            </span>git<span class="w"> </span>show<span class="w"> </span><span class="nv">$oldsha</span><span class="w"> </span><span class="p">|</span>sed<span class="w"> </span>-n<span class="w"> </span><span class="s1">&#39;/diff/,$p&#39;</span><span class="w"> </span><span class="p">|</span>grep<span class="w"> </span>-v<span class="w"> </span><span class="s2">&quot;index.*\.\.&quot;</span><span class="w"> </span><span class="p">|</span>grep<span class="w"> </span>-v<span class="w"> </span><span class="s2">&quot;@@&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>/tmp/gronk1
<span class="w">            </span>git<span class="w"> </span>show<span class="w"> </span><span class="nv">$newsha</span><span class="w"> </span><span class="p">|</span>sed<span class="w"> </span>-n<span class="w"> </span><span class="s1">&#39;/diff/,$p&#39;</span><span class="w"> </span><span class="p">|</span>grep<span class="w"> </span>-v<span class="w"> </span><span class="s2">&quot;index.*\.\.&quot;</span><span class="w"> </span><span class="p">|</span>grep<span class="w"> </span>-v<span class="w"> </span><span class="s2">&quot;@@&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>/tmp/gronk2
<span class="w">            </span>diff<span class="w"> </span>/tmp/gronk1<span class="w"> </span>/tmp/gronk2<span class="w"> </span><span class="p">&amp;</span>&gt;<span class="w"> </span>/dev/null
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="nv">$?</span><span class="w"> </span>-eq<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">]</span><span class="w"> </span><span class="p">;</span><span class="k">then</span>
<span class="c1"># Differences in comments only</span>
<span class="w">                </span><span class="nv">same</span><span class="o">=</span><span class="s2">&quot;[same]&quot;</span>
<span class="w">                </span>oldsha1s<span class="o">[</span><span class="nv">$old</span><span class="o">]=</span><span class="s2">&quot;match&quot;</span>
<span class="w">                </span><span class="k">break</span>
<span class="w">            </span><span class="k">fi</span>
<span class="w">            </span>oldsha1s<span class="o">[</span><span class="nv">$old</span><span class="o">]=</span><span class="s2">&quot;match&quot;</span>
<span class="w">            </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;compare_them </span><span class="nv">$oldsha</span><span class="s2"> </span><span class="nv">$newsha</span><span class="s2">&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span><span class="nv">$script</span>
<span class="w">        </span><span class="k">fi</span>
<span class="w">    </span><span class="k">done</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$new</span><span class="s2"> </span><span class="nv">$oldsha</span><span class="s2"> </span><span class="nv">$newsha</span><span class="s2"> </span><span class="nv">$same</span><span class="s2"> </span><span class="nv">$newdesc</span><span class="s2">&quot;</span>
<span class="k">done</span>

<span class="nb">echo</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Missing from </span><span class="nv">$newbranch</span><span class="s2">:&quot;</span>
<span class="nv">the_missing</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
<span class="c1"># Now run through the olds we haven&#39;t matched up</span>
<span class="k">for</span><span class="w"> </span>old<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="sb">`</span>seq<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="nv">$oldcount</span><span class="sb">`</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nb">test</span><span class="w"> </span><span class="si">${</span><span class="nv">oldsha1s</span><span class="p">[</span><span class="nv">$old</span><span class="p">]</span><span class="si">}</span><span class="w"> </span>!<span class="o">=</span><span class="w"> </span><span class="s2">&quot;match&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span><span class="nv">olddesc</span><span class="o">=</span><span class="sb">`</span>git<span class="w"> </span>show<span class="w"> </span><span class="si">${</span><span class="nv">oldsha1s</span><span class="p">[</span><span class="nv">$old</span><span class="p">]</span><span class="si">}</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>head<span class="w"> </span>-5<span class="w"> </span><span class="p">|</span><span class="w"> </span>tail<span class="w"> </span>-1<span class="p">|</span>cut<span class="w"> </span>-b5-<span class="sb">`</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">oldsha1s</span><span class="p">[</span><span class="nv">$old</span><span class="p">]</span><span class="si">}</span><span class="s2"> </span><span class="nv">$olddesc</span><span class="s2">&quot;</span>
<span class="w">        </span><span class="nv">the_missing</span><span class="o">=</span><span class="sb">`</span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$the_missing</span><span class="s2"> </span><span class="si">${</span><span class="nv">oldsha1s</span><span class="p">[</span><span class="nv">$old</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="sb">`</span>
<span class="w">    </span><span class="k">fi</span>
<span class="k">done</span>

<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;The missing: &quot;</span><span class="w"> </span><span class="nv">$the_missing</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Compare script generated at: </span><span class="nv">$script</span><span class="s2">&quot;</span>
<span class="c1">#git log --reverse --abbrev-commit --pretty=oneline $tracking..$branch | cut -d &#39; &#39; -f1 |paste -s -d &#39; &#39;</span>
</code></pre></div>

<h4>6、gitlog.find</h4>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>
<span class="c1">#</span>
<span class="c1"># Find the upstream equivalent patch</span>
<span class="c1">#</span>
<span class="c1"># gitlog.find</span>
<span class="c1">#</span>
<span class="nv">cwd</span><span class="o">=</span><span class="nv">$PWD</span>
<span class="nv">param1</span><span class="o">=</span><span class="nv">$1</span>
<span class="nv">ubranch</span><span class="o">=</span><span class="nv">$2</span>
<span class="nv">patches</span><span class="o">=</span><span class="m">0</span>
<span class="nv">script</span><span class="o">=</span>/tmp/compare_upstream.sh
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;#!/bin/bash&quot;</span><span class="w"> </span>&gt;<span class="w"> </span><span class="nv">$script</span>
/usr/bin/chmod<span class="w"> </span><span class="m">755</span><span class="w"> </span><span class="nv">$script</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;# Generated by gitbranchcmp3.sh&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span><span class="nv">$script</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;# Run this script to compare the mismatched patches&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span><span class="nv">$script</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot; &quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span><span class="nv">$script</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;function compare_them()&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span><span class="nv">$script</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;{&quot;</span><span class="w">  </span>&gt;&gt;<span class="w"> </span><span class="nv">$script</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;    cwd=</span><span class="nv">$PWD</span><span class="s2">&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span><span class="nv">$script</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;    git show --pretty=email --patch-with-stat \$2 &gt; /tmp/gronk2&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span><span class="nv">$script</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;    cd ~/linux.git/fs/gfs2&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span><span class="nv">$script</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;    git show --pretty=email --patch-with-stat \$1 &gt; /tmp/gronk1&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span><span class="nv">$script</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;    cd </span><span class="nv">$cwd</span><span class="s2">&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span><span class="nv">$script</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;    kompare /tmp/gronk1 /tmp/gronk2&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span><span class="nv">$script</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;}&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span><span class="nv">$script</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot; &quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span><span class="nv">$script</span>

<span class="c1">#echo &quot;Gathering upstream patch info. Please wait.&quot;</span>
<span class="nv">branch</span><span class="o">=</span><span class="sb">`</span>git<span class="w"> </span>branch<span class="w"> </span>-a<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s2">&quot;*&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>cut<span class="w"> </span>-d<span class="w"> </span><span class="s1">&#39; &#39;</span><span class="w"> </span>-f2<span class="sb">`</span>
<span class="nv">tracking</span><span class="o">=</span><span class="sb">`</span>git<span class="w"> </span>rev-parse<span class="w"> </span>--abbrev-ref<span class="w"> </span>--symbolic-full-name<span class="w"> </span>@<span class="o">{</span>u<span class="o">}</span><span class="sb">`</span>

<span class="nb">cd</span><span class="w"> </span>~/linux.git
<span class="k">if</span><span class="w"> </span><span class="nb">test</span><span class="w"> </span><span class="s2">&quot;X</span><span class="si">${</span><span class="nv">ubranch</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;X&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span><span class="nv">ubranch</span><span class="o">=</span><span class="sb">`</span>git<span class="w"> </span>branch<span class="w"> </span>-a<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s2">&quot;*&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>cut<span class="w"> </span>-d<span class="w"> </span><span class="s1">&#39; &#39;</span><span class="w"> </span>-f2<span class="sb">`</span>
<span class="k">fi</span>
<span class="nv">utracking</span><span class="o">=</span><span class="sb">`</span>git<span class="w"> </span>rev-parse<span class="w"> </span>--abbrev-ref<span class="w"> </span>--symbolic-full-name<span class="w"> </span>@<span class="o">{</span>u<span class="o">}</span><span class="sb">`</span>
<span class="c1">#</span>
<span class="c1"># gather a list of gfs2 patches from master just in case we can&#39;t find it</span>
<span class="c1">#</span>
<span class="c1">#git log --abbrev-commit --pretty=format:&quot;   %h %&lt;|(32)%an %s&quot; master |grep -i -e &quot;gfs2&quot; -e &quot;dlm&quot; &gt; /tmp/gronk</span>
git<span class="w"> </span>log<span class="w"> </span>--reverse<span class="w"> </span>--abbrev-commit<span class="w"> </span>--pretty<span class="o">=</span>format:<span class="s2">&quot;ms %h %&lt;|(32)%an %s&quot;</span><span class="w"> </span>master<span class="w"> </span>fs/gfs2/<span class="w"> </span>&gt;<span class="w"> </span>/tmp/gronk.gfs2
<span class="c1"># ms = in Linus&#39;s master</span>
git<span class="w"> </span>log<span class="w"> </span>--reverse<span class="w"> </span>--abbrev-commit<span class="w"> </span>--pretty<span class="o">=</span>format:<span class="s2">&quot;ms %h %&lt;|(32)%an %s&quot;</span><span class="w"> </span>master<span class="w"> </span>fs/dlm/<span class="w"> </span>&gt;<span class="w"> </span>/tmp/gronk.dlm

<span class="nb">cd</span><span class="w"> </span><span class="nv">$cwd</span>
<span class="nv">LIST</span><span class="o">=</span><span class="sb">`</span>git<span class="w"> </span>log<span class="w"> </span>--reverse<span class="w"> </span>--abbrev-commit<span class="w"> </span>--pretty<span class="o">=</span>oneline<span class="w"> </span><span class="nv">$tracking</span>..<span class="nv">$branch</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>cut<span class="w"> </span>-d<span class="w"> </span><span class="s1">&#39; &#39;</span><span class="w"> </span>-f1<span class="w"> </span><span class="p">|</span>paste<span class="w"> </span>-s<span class="w"> </span>-d<span class="w"> </span><span class="s1">&#39; &#39;</span><span class="sb">`</span>
<span class="k">for</span><span class="w"> </span>i<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nv">$LIST</span><span class="p">;</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="nv">patches</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span><span class="w"> </span><span class="nv">$patches</span><span class="w"> </span>+<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>bc<span class="k">)</span><span class="p">;</span><span class="k">done</span>
/usr/bin/echo<span class="w"> </span><span class="s2">&quot;-----------------------[&quot;</span><span class="w"> </span><span class="nv">$branch</span><span class="w"> </span><span class="s2">&quot;-&quot;</span><span class="w"> </span><span class="nv">$patches</span><span class="w"> </span><span class="s2">&quot;patches ]-----------------------&quot;</span>
<span class="nv">patches</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span><span class="w"> </span><span class="nv">$patches</span><span class="w"> </span>-<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>bc<span class="k">)</span><span class="p">;</span>
<span class="k">for</span><span class="w"> </span>i<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nv">$LIST</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="nv">$patches</span><span class="w"> </span>-eq<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span><span class="nv">cnt</span><span class="o">=</span><span class="s2">&quot; ^&quot;</span>
<span class="w">    </span><span class="k">elif</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="nv">$patches</span><span class="w"> </span>-eq<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span><span class="nv">cnt</span><span class="o">=</span><span class="s2">&quot; H&quot;</span>
<span class="w">    </span><span class="k">else</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="nv">$patches</span><span class="w"> </span>-lt<span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">            </span><span class="nv">cnt</span><span class="o">=</span><span class="s2">&quot; </span><span class="nv">$patches</span><span class="s2">&quot;</span>
<span class="w">        </span><span class="k">else</span>
<span class="w">            </span><span class="nv">cnt</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$patches</span><span class="s2">&quot;</span>
<span class="w">        </span><span class="k">fi</span>
<span class="w">    </span><span class="k">fi</span>
<span class="w">    </span>/usr/bin/git<span class="w"> </span>show<span class="w"> </span>--abbrev-commit<span class="w"> </span>-s<span class="w"> </span>--pretty<span class="o">=</span>format:<span class="s2">&quot;</span><span class="nv">$cnt</span><span class="s2"> %h %&lt;|(32)%an %s&quot;</span><span class="w"> </span><span class="nv">$i</span>
<span class="w">    </span><span class="nv">desc</span><span class="o">=</span><span class="sb">`</span>/usr/bin/git<span class="w"> </span>show<span class="w"> </span>--abbrev-commit<span class="w"> </span>-s<span class="w"> </span>--pretty<span class="o">=</span>format:<span class="s2">&quot;%s&quot;</span><span class="w"> </span><span class="nv">$i</span><span class="sb">`</span>
<span class="w">    </span><span class="nb">cd</span><span class="w"> </span>~/linux.git
<span class="w">    </span><span class="nv">cmp</span><span class="o">=</span><span class="m">1</span>
<span class="w">    </span><span class="nv">up_eq</span><span class="o">=</span><span class="sb">`</span>git<span class="w"> </span>log<span class="w"> </span>--reverse<span class="w"> </span>--abbrev-commit<span class="w"> </span>--pretty<span class="o">=</span>format:<span class="s2">&quot;lo %h %&lt;|(32)%an %s&quot;</span><span class="w"> </span><span class="nv">$utracking</span>..<span class="nv">$ubranch</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$desc</span><span class="s2">&quot;</span><span class="sb">`</span>
<span class="c1"># lo = in local for-next</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nb">test</span><span class="w"> </span><span class="s2">&quot;X</span><span class="nv">$up_eq</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;X&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span><span class="nv">up_eq</span><span class="o">=</span><span class="sb">`</span>git<span class="w"> </span>log<span class="w"> </span>--reverse<span class="w"> </span>--abbrev-commit<span class="w"> </span>--pretty<span class="o">=</span>format:<span class="s2">&quot;fn %h %&lt;|(32)%an %s&quot;</span><span class="w"> </span>master..<span class="nv">$utracking</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$desc</span><span class="s2">&quot;</span><span class="sb">`</span>
<span class="c1"># fn = in for-next for next merge window</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nb">test</span><span class="w"> </span><span class="s2">&quot;X</span><span class="nv">$up_eq</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;X&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">            </span><span class="nv">up_eq</span><span class="o">=</span><span class="sb">`</span>grep<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$desc</span><span class="s2">&quot;</span><span class="w"> </span>/tmp/gronk.gfs2<span class="sb">`</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="nb">test</span><span class="w"> </span><span class="s2">&quot;X</span><span class="nv">$up_eq</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;X&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">                </span><span class="nv">up_eq</span><span class="o">=</span><span class="sb">`</span>grep<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$desc</span><span class="s2">&quot;</span><span class="w"> </span>/tmp/gronk.dlm<span class="sb">`</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="nb">test</span><span class="w"> </span><span class="s2">&quot;X</span><span class="nv">$up_eq</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;X&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">                    </span><span class="nv">up_eq</span><span class="o">=</span><span class="s2">&quot;   Not found upstream&quot;</span>
<span class="w">                    </span><span class="nv">cmp</span><span class="o">=</span><span class="m">0</span>
<span class="w">                </span><span class="k">fi</span>
<span class="w">            </span><span class="k">fi</span>
<span class="w">        </span><span class="k">fi</span>
<span class="w">    </span><span class="k">fi</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$up_eq</span><span class="s2">&quot;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="nv">$cmp</span><span class="w"> </span>-eq<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">]</span><span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">        </span><span class="nv">UP_SHA1</span><span class="o">=</span><span class="sb">`</span><span class="nb">echo</span><span class="w"> </span><span class="nv">$up_eq</span><span class="p">|</span>cut<span class="w"> </span>-d<span class="s1">&#39; &#39;</span><span class="w"> </span>-f2<span class="sb">`</span>
<span class="w">        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;compare_them </span><span class="nv">$UP_SHA1</span><span class="s2"> </span><span class="nv">$i</span><span class="s2">&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span><span class="nv">$script</span>
<span class="w">    </span><span class="k">fi</span>
<span class="w">    </span><span class="nb">cd</span><span class="w"> </span><span class="nv">$cwd</span>
<span class="w">    </span><span class="nv">patches</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span><span class="w"> </span><span class="nv">$patches</span><span class="w"> </span>-<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>bc<span class="k">)</span>
<span class="k">done</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Compare script generated: </span><span class="nv">$script</span><span class="s2">&quot;</span>
</code></pre></div>
    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>links</h2>
                        <ul>
                            <li><a href="https://getpelican.com/">Pelican</a></li>
                            <li><a href="https://www.python.org/">Python.org</a></li>
                            <li><a href="https://palletsprojects.com/p/jinja/">Jinja2</a></li>
                            <li><a href="#">You can modify those links in your config file</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>

                            <li><a href="#">You can add links in your config file</a></li>
                            <li><a href="#">Another social link</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a rel="nofollow" href="https://getpelican.com/">Pelican</a>, which takes great advantage of <a rel="nofollow" href="https://www.python.org/">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a rel="nofollow" href="https://www.smashingmagazine.com/2009/08/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>