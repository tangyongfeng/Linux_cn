<!DOCTYPE html>
<html lang="zh">
<head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="generator" content="Pelican" />
        <title>线上图片请抛弃 PNG 和 JPG：使用 WebP</title>
        <link rel="stylesheet" href="/theme/css/main.css" />
        <meta name="description" content="Author: Jeff Macharyas 了解一下这个开源的图片编辑工具来节省时间和空间。 WebP 是 2010 年 Google 开发的一种图片格式，它为网页上的图片提供 …" />
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">linux_cn</a></h1>
                <nav><ul>
                    <li><a href="/category/chuan-shan-jia-zhuan-fang">穿山甲专访</a></li>
                    <li><a href="/category/dai-ma-ying-xiong">代码英雄</a></li>
                    <li><a href="/category/fen-xiang">分享</a></li>
                    <li><a href="/category/guan-dian">观点</a></li>
                    <li><a href="/category/huo-dong">活动</a></li>
                    <li><a href="/category/ji-ke-man-hua">极客漫画</a></li>
                    <li class="active"><a href="/category/ji-zhu">技术</a></li>
                    <li><a href="/category/kai-yuan-zhi-hui">开源智慧</a></li>
                    <li><a href="/category/linux-fa-xing-ban">Linux 发行版</a></li>
                    <li><a href="/category/mei-ri-an-quan-zi-xun">每日安全资讯</a></li>
                    <li><a href="/category/misc">Misc</a></li>
                    <li><a href="/category/qu-kuai-lian">区块链</a></li>
                    <li><a href="/category/rong-qi-yu-yun">容器与云</a></li>
                    <li><a href="/category/ruan-jian-kai-fa">软件开发</a></li>
                    <li><a href="/category/shu-mei-pai">树莓派</a></li>
                    <li><a href="/category/xi-tong-yun-wei">系统运维</a></li>
                    <li><a href="/category/xin-wen">新闻</a></li>
                    <li><a href="/category/ying-he-guan-cha">硬核观察</a></li>
                    <li><a href="/category/zhi-ye-sheng-ya">职业生涯</a></li>
                    <li><a href="/category/zhong-jiang-ming-dan">中奖名单</a></li>
                    <li><a href="/category/zhuo-mian-ying-yong">桌面应用</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="/2020/05/xian-shang-tu-pian-qing-pao-qi-png-he-jpgshi-yong-webp.html" rel="bookmark"
           title="Permalink to 线上图片请抛弃 PNG 和 JPG：使用 WebP">线上图片请抛弃 PNG 和 JPG：使用 WebP</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2020-05-07T14:39:00+02:00">
                Published: Thu 07 May 2020
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/linux-fans-from-china.html">linux fans from china</a>
        </address>
<p>In <a href="/category/ji-zhu">技术</a>.</p>

</footer><!-- /.post-info -->      <p>Author: Jeff Macharyas</p>
<blockquote>
<p>了解一下这个开源的图片编辑工具来节省时间和空间。</p>
</blockquote>
<p><img alt="" src="/data/attachment/album/202005/07/143932l22hot7ebhbbqjmm.jpg"></p>
<p>WebP 是 2010 年 Google 开发的一种图片格式，它为网页上的图片提供了卓越的无损和有损压缩。网站开发者们可以使用 WebP 来创建尺寸更小、细节更丰富的图片，以此来提高网站的速度。更快的加载速度对于网站的用户体验和网站的营销效果是至关重要的。</p>
<p>为了在所有设备和用户中达到最佳加载效果，你网站上的图片文件大小不应该超过 500 KB。</p>
<p>与 PNG 图片相比，WebP 无损图片通常至少要比 PNG 图片小 25%。在同等的 SSIM（<ruby> 结构相似度 <rt>  structural similarity </rt></ruby>）质量指标下，WebP 有损图片通常比 JPEG 图片小 25% 到 34%。</p>
<p>无损 WebP 也支持透明度。而在可接受有损 RGB 压缩的情况下，有损 WebP 也支持透明度，通常 PNG 文件大小比它大三倍。</p>
<p>Google 报告称，把动画 GIF 文件转换为有损 WebP 后文件大小减少了 64%，转换为无损 WebP 后文件大小减少了 19%。</p>
<p>WebP 文件格式是一种基于 RIFF（<ruby> 资源互换文件格式 <rt>  resource interchange file format </rt></ruby>）的文档格式。你可以用 <a href="https://opensource.com/article/19/8/dig-binary-files-hexdump">hexdump</a> 看到文件的签名是 <code>52 49 46 46</code>（RIFF）：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>hexdump<span class="w"> </span>--canonical<span class="w"> </span>pixel.webp
<span class="m">00000000</span><span class="w">  </span><span class="m">52</span><span class="w"> </span><span class="m">49</span><span class="w"> </span><span class="m">46</span><span class="w"> </span><span class="m">46</span><span class="w"> </span><span class="m">26</span><span class="w"> </span><span class="m">00</span><span class="w"> </span><span class="m">00</span><span class="w"> </span><span class="m">00</span><span class="w">  </span><span class="o">[</span>...<span class="o">]</span><span class="w">  </span><span class="p">|</span>RIFF<span class="p">&amp;</span>amp<span class="p">;</span>...WEBPVP8<span class="w"> </span><span class="p">|</span>
<span class="m">00000010</span><span class="w">  </span>1a<span class="w"> </span><span class="m">00</span><span class="w"> </span><span class="m">00</span><span class="w"> </span><span class="m">00</span><span class="w"> </span><span class="m">30</span><span class="w"> </span><span class="m">01</span><span class="w"> </span><span class="m">00</span><span class="w"> </span>9d<span class="w">  </span><span class="o">[</span>...<span class="o">]</span><span class="w">  </span><span class="p">|</span>....0....*......<span class="p">|</span>
<span class="m">00000020</span><span class="w">  </span>0e<span class="w"> </span><span class="m">25</span><span class="w"> </span>a4<span class="w"> </span><span class="m">00</span><span class="w"> </span><span class="m">03</span><span class="w"> </span><span class="m">70</span><span class="w"> </span><span class="m">00</span><span class="w"> </span>fe<span class="w">  </span><span class="o">[</span>...<span class="o">]</span><span class="w">  </span><span class="p">|</span>.%...p...<span class="sb">`</span>....<span class="p">|</span>
0000002e
</code></pre></div>

<p>独立的 libwebp 库作为 WebP 技术规范的参考实现，可以从 Google 的 <a href="https://storage.googleapis.com/downloads.webmproject.org/releases/webp/index.html">Git 仓库</a> 或 tar 包中获得。</p>
<p>全球在用的 80% 的 web 浏览器兼容 WebP 格式。本文撰写时，Apple 的 Safari 浏览器还不兼容。解决这个问题的方法是将 JPG/PNG 图片与 WebP 图片一起提供，有一些方法和 Wordpress 插件可以做到这一点。</p>
<h3>为什么要这样做？</h3>
<p>我的部分工作是设计和维护我们组织的网站。由于网站是个营销工具，而网站的速度是衡量用户体验的重要指标，我一直致力于提高网站速度，通过把图片转换为 WebP 来减少图片大小是一个很好的解决方案。</p>
<p>我使用了 web.dev 来检测其中一个网页，该工具是由 Lighthouse 提供服务的，遵循 Apache 2.0 许可证，可以在 <a href="https://github.com/GoogleChrome/lighthouse">https://github.com/GoogleChrome/lighthouse</a> 找到。</p>
<p>据其官方描述，“LIghthouse 是一个开源的，旨在提升网页质量的自动化工具。你可以在任何公共的或需要鉴权的网页上运行它。它有性能、可用性、渐进式 web 应用、SEO 等方面的审计。你可以在 Chrome 浏览器的开发工具中运行 Lighthouse，也可以通过命令行或作为 Node 模块运行。你输入一个 URL 给 Lighthouse，它会对这个网页进行一系列的审计，然后生成这个网页的审计结果报告。从报告的失败审计条目中可以知道应该怎么优化网页。每条审计都有对应的文档解释为什么该项目是重要的，以及如何修复它。”</p>
<h3>创建更小的 WebP 图片</h3>
<p>我测试的页面返回了三张图片。在它生成的报告中，它提供了推荐和目标。我选择了它报告有 650 KB 的 <code>app-graphic</code> 图片。通过把它转换为 WebP 格式，预计可以把图片大小降到 61 KB，节省 589 KB。我在 Photoshop 中把它转换了，用默认的 WebP 设置参数保存它，它的文件大小为 44.9 KB。比预期的还要好！从下面的 Photoshop 截图中可以看出，两张图在视觉质量上完全一样。</p>
<p><img alt="" src="/data/attachment/album/202005/07/144528m4jgucnozc4v0iqz.png"></p>
<p><em>左图：650 KB（实际大小）。右图： 44.9 KB（转换之后的目标大小）。</em></p>
<p>当然，也可以用开源图片编辑工具 <a href="http://gimp.org">GIMP</a> 把图片导出为 WebP。它提供了几个质量和压缩的参数：</p>
<p><img alt="" src="/data/attachment/album/202005/07/143538plu797s4wmhy9b1p.jpg"></p>
<p>另一张图放大后：</p>
<p><img alt="" src="/data/attachment/album/202005/07/144549ee1ddngawdr01ari.png"></p>
<p>PNG（左图）和 WebP（右图），都是从 JPG 转换而来，两图对比可以看出 WebP 不仅在文件大小更小，在视觉质量上也更优秀。</p>
<h3>把图片转换为 WebP</h3>
<p>你也可以用 Linux 的命令行工具把图片从 JPG/PNG 转换为 WebP：</p>
<p>在命令行使用 <code>cwebp</code> 把 PNG 或 JPG 图片文件转换为 WebP 格式。你可以用下面的命令把 PNG 图片文件转换为质量参数为 80 的 WebP 图片。</p>
<div class="highlight"><pre><span></span><code>cwebp -q 80 image.png -o image.webp
</code></pre></div>

<p>你还可以用 <a href="https://imagemagick.org">Image Magick</a>，这个工具可能在你的发行版本软件仓库中可以找到。转换的子命令是 <code>convert</code>，它需要的所有参数就是输入和输出文件：</p>
<div class="highlight"><pre><span></span><code>convert pixel.png pixel.webp
</code></pre></div>

<h3>使用编辑器把图片转换为 WebP</h3>
<p>要在图片编辑器中来把图片转换为 WebP，可以使用 <a href="https://en.wikipedia.org/wiki/GIMP">GIMP</a>。从 2.10 版本开始，它原生地支持 WebP。</p>
<p>如果你是 Photoshop 用户，由于 Photoshop 默认不包含 WebP 支持，因此你需要一个转换插件。遵循 Apache License 2.0 许可证发布的 WebPShop 0.2.1 是一个用于打开和保存包括动画图在内的 WebP 图片的 Photoshop 模块，在 <a href="https://github.com/webmproject/WebPShop">https://github.com/webmproject/WebPShop</a> 可以找到。</p>
<p>为了能正常使用它，你需要把它放进 Photoshop 插件目录下的 <code>bin</code> 文件夹：</p>
<p>Windows x64 ：<code>C:\Program Files\Adobe\Adobe Photoshop\Plug-ins\WebPShop.8bi</code></p>
<p>Mac：<code>Applications/Adobe Photoshop/Plug-ins/WebPShop.plugin</code></p>
<h3>Wordpress 上的 WebP</h3>
<p>很多网站是用 Wordpress 搭建的（我的网站就是）。因此，Wordpress 怎么上传 WebP 图片？本文撰写时，它还不支持。但是，当然已经有插件来满足这种需求，因此你可以在你的网站上同时准备 WebP 和 PNG/JPG 图片（为 Apple 用户）。</p>
<p>在 <a href="https://mariushosting.com/">Marius Hosting</a> 有下面的<a href="https://mariushosting.com/how-to-upload-webp-files-on-wordpress/">说明</a>：</p>
<blockquote>
<p>“直接向 Wordpress 上传 WebP 图片会怎样？这很简单。向你的主题 <code>functions.php</code> 文件添加几行内容就可以了。Wordpress 默认不支持展示和上传 WebP 文件，但是我会向你介绍一下怎么通过几个简单的步骤来让它支持。登录进你的 Wordpress 管理员界面，进入‘外观/主题编辑器’找到 <code>functions.php</code>。复制下面的代码粘贴到该文件最后并保存：</p>
<p><code>//** *Enable upload for webp image files.*/
function webp_upload_mimes($existing_mimes) {
    $existing_mimes['webp'] = 'image/webp';
    return $existing_mimes;
}
add_filter('mime_types', 'webp_upload_mimes');</code></p>
<p>如果你想在‘媒体/媒体库’时看到缩略图预览，那么你需要把下面的代码也添加到 <code>functions.php</code> 文件。为了找到 <code>functions.php</code> 文件，进入‘外观/主题编辑器’并搜索 <code>functions.php</code>，然后复制下面的代码粘贴到文件最后并保存：</p>
<p>```
//*<em> * Enable preview / thumbnail for webp image files.</em>/
function webp_is_displayable($result, $path) {
    if ($result === false) {
        $displayable_image_types = array( IMAGETYPE_WEBP );
        $info = @getimagesize( $path );</p>
<div class="highlight"><pre><span></span><code><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">empty</span><span class="p">(</span><span class="err">$</span><span class="nx">info</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="err">$</span><span class="nx">result</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="nx">elseif</span><span class="w"> </span><span class="p">(!</span><span class="nx">in_array</span><span class="p">(</span><span class="err">$</span><span class="nx">info</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="w"> </span><span class="err">$</span><span class="nx">displayable_image_types</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="err">$</span><span class="nx">result</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="err">$</span><span class="nx">result</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="k">return</span><span class="w"> </span><span class="err">$</span><span class="nx">result</span><span class="p">;</span>
</code></pre></div>

<p>}
add_filter('file_is_displayable_image', 'webp_is_displayable', 10, 2);
```</p>
<p>”</p>
</blockquote>
<h3>WebP 和未来</h3>
<p>WebP 是一个健壮而优化的格式。它看起来更好，压缩率更高，并具有其他大部分常见图片格式的所有特性。不必再等了，现在就使用它吧。</p>
    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>links</h2>
                        <ul>
                            <li><a href="https://getpelican.com/">Pelican</a></li>
                            <li><a href="https://www.python.org/">Python.org</a></li>
                            <li><a href="https://palletsprojects.com/p/jinja/">Jinja2</a></li>
                            <li><a href="#">You can modify those links in your config file</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>

                            <li><a href="#">You can add links in your config file</a></li>
                            <li><a href="#">Another social link</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a rel="nofollow" href="https://getpelican.com/">Pelican</a>, which takes great advantage of <a rel="nofollow" href="https://www.python.org/">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a rel="nofollow" href="https://www.smashingmagazine.com/2009/08/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>