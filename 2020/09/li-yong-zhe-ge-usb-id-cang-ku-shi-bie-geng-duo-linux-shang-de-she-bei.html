<!DOCTYPE html>
<html lang="zh">
<head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="generator" content="Pelican" />
        <title>利用这个 USB ID 仓库识别更多 Linux 上的设备</title>
        <link rel="stylesheet" href="/theme/css/main.css" />
        <meta name="description" content="Author: Alan Formy-duval 这是一个包含了所有已知 USB 设备 ID 的开源项目。 市场上有成千上万的 USB 设备：键盘、扫描仪、打印机、鼠标和其他无数 …" />
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">linux_cn</a></h1>
                <nav><ul>
                    <li><a href="/category/chuan-shan-jia-zhuan-fang">穿山甲专访</a></li>
                    <li><a href="/category/dai-ma-ying-xiong">代码英雄</a></li>
                    <li><a href="/category/fen-xiang">分享</a></li>
                    <li><a href="/category/guan-dian">观点</a></li>
                    <li><a href="/category/huo-dong">活动</a></li>
                    <li><a href="/category/ji-ke-man-hua">极客漫画</a></li>
                    <li class="active"><a href="/category/ji-zhu">技术</a></li>
                    <li><a href="/category/kai-yuan-zhi-hui">开源智慧</a></li>
                    <li><a href="/category/linux-fa-xing-ban">Linux 发行版</a></li>
                    <li><a href="/category/mei-ri-an-quan-zi-xun">每日安全资讯</a></li>
                    <li><a href="/category/misc">Misc</a></li>
                    <li><a href="/category/qu-kuai-lian">区块链</a></li>
                    <li><a href="/category/rong-qi-yu-yun">容器与云</a></li>
                    <li><a href="/category/ruan-jian-kai-fa">软件开发</a></li>
                    <li><a href="/category/shu-mei-pai">树莓派</a></li>
                    <li><a href="/category/xi-tong-yun-wei">系统运维</a></li>
                    <li><a href="/category/xin-wen">新闻</a></li>
                    <li><a href="/category/ying-he-guan-cha">硬核观察</a></li>
                    <li><a href="/category/zhi-ye-sheng-ya">职业生涯</a></li>
                    <li><a href="/category/zhong-jiang-ming-dan">中奖名单</a></li>
                    <li><a href="/category/zhuo-mian-ying-yong">桌面应用</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="/2020/09/li-yong-zhe-ge-usb-id-cang-ku-shi-bie-geng-duo-linux-shang-de-she-bei.html" rel="bookmark"
           title="Permalink to 利用这个 USB ID 仓库识别更多 Linux 上的设备">利用这个 USB ID 仓库识别更多 Linux 上的设备</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2020-09-13T22:55:42+02:00">
                Published: Sun 13 September 2020
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/linux-fans-from-china.html">linux fans from china</a>
        </address>
<p>In <a href="/category/ji-zhu">技术</a>.</p>

</footer><!-- /.post-info -->      <p>Author: Alan Formy-duval</p>
<blockquote>
<p>这是一个包含了所有已知 USB 设备 ID 的开源项目。</p>
</blockquote>
<p><img alt="" src="/data/attachment/album/202009/13/225426zpfbfopxhjxomuxf.jpg"></p>
<p>市场上有成千上万的 USB 设备：键盘、扫描仪、打印机、鼠标和其他无数的设备，都能在 Linux 上工作。它们的供应商详情都存储在 USB ID 仓库中。</p>
<h3>lsusb</h3>
<p>Linux <code>lsusb</code> 命令列出了连接到系统的 USB 设备的信息，但有时信息不完整。例如，我最近注意到我的一个 USB 设备的品牌没有被识别。设备是可以使用的，但是在列出我所连接的 USB 设备的详情中没有提供任何识别信息。以下是我的 <code>lsusb</code> 命令的输出：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>lsusb
Bus<span class="w"> </span><span class="m">002</span><span class="w"> </span>Device<span class="w"> </span><span class="m">001</span>:<span class="w"> </span>ID<span class="w"> </span>1d6b:0003<span class="w"> </span>Linux<span class="w"> </span>Foundation<span class="w"> </span><span class="m">3</span>.0<span class="w"> </span>root<span class="w"> </span>hub
Bus<span class="w"> </span><span class="m">001</span><span class="w"> </span>Device<span class="w"> </span><span class="m">004</span>:<span class="w"> </span>ID<span class="w"> </span>046d:082c<span class="w"> </span>Logitech,<span class="w"> </span>Inc.
Bus<span class="w"> </span><span class="m">001</span><span class="w"> </span>Device<span class="w"> </span><span class="m">003</span>:<span class="w"> </span>ID<span class="w"> </span><span class="m">0951</span>:16d2<span class="w"> </span>Kingston<span class="w"> </span>Technology
Bus<span class="w"> </span><span class="m">001</span><span class="w"> </span>Device<span class="w"> </span><span class="m">002</span>:<span class="w"> </span>ID<span class="w"> </span>18f8:1486<span class="w">  </span>
Bus<span class="w"> </span><span class="m">001</span><span class="w"> </span>Device<span class="w"> </span><span class="m">005</span>:<span class="w"> </span>ID<span class="w"> </span>051d:0002<span class="w"> </span>American<span class="w"> </span>Power<span class="w"> </span>Conversion<span class="w"> </span>Uninterruptible<span class="w"> </span>Power<span class="w"> </span>Supply
Bus<span class="w"> </span><span class="m">001</span><span class="w"> </span>Device<span class="w"> </span><span class="m">001</span>:<span class="w"> </span>ID<span class="w"> </span>1d6b:0002<span class="w"> </span>Linux<span class="w"> </span>Foundation<span class="w"> </span><span class="m">2</span>.0<span class="w"> </span>root<span class="w"> </span>hub
</code></pre></div>

<p>正如你在最后一栏中看到的，有一个设备没有制造商描述。要确定这个设备是什么，我必须对我的 USB 设备树进行更深入的检查。幸运的是，<code>lsusb</code> 命令有更多的选项。其中一个选项是 <code>-D device</code>，来获取每个设备的详细信息，正如手册页面所解释的那样：</p>
<blockquote>
<p>“不会扫描 <code>/dev/bus/usb</code> 目录，而只显示给定设备文件所属设备的信息。设备文件应该是类似 <code>/dev/bus/usb/001/001</code> 这样的文件。这个选项会像 <code>v</code> 选项一样显示详细信息，但你必须是 root 用户才行。"</p>
</blockquote>
<p>我认为如何将设备路径传递给 <code>lsusb</code> 命令并不容易，但在仔细阅读手册页和初始输出后，我能够确定如何构造它。USB 设备驻留在 UDEV 文件系统中。它们的设备路径始于 USB 设备目录 <code>/dev/bus/usb/</code>。路径的其余部分由设备的总线 ID 和设备 ID 组成。我的无描述设备是 <code>Bus 001 Device 002</code>，被翻译成了 <code>001/002</code>，完成的路径为 <code>/dev/bus/usb/001/002</code>。现在我可以把这个路径传给 <code>lsusb</code>。我还会用管道传给 <code>more</code>，因为这里往往有很多信息：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>lsusb<span class="w"> </span>-D<span class="w"> </span>/dev/bus/usb/001/002<span class="w"> </span><span class="p">|</span>more
Device:<span class="w"> </span>ID<span class="w"> </span>18f8:1486<span class="w">  </span>
Device<span class="w"> </span>Descriptor:
<span class="w">  </span>bLength<span class="w">                </span><span class="m">18</span>
<span class="w">  </span>bDescriptorType<span class="w">         </span><span class="m">1</span>
<span class="w">  </span>bcdUSB<span class="w">               </span><span class="m">1</span>.10
<span class="w">  </span>bDeviceClass<span class="w">            </span><span class="m">0</span><span class="w"> </span><span class="o">(</span>Defined<span class="w"> </span>at<span class="w"> </span>Interface<span class="w"> </span>level<span class="o">)</span>
<span class="w">  </span>bDeviceSubClass<span class="w">         </span><span class="m">0</span>
<span class="w">  </span>bDeviceProtocol<span class="w">         </span><span class="m">0</span>
<span class="w">  </span>bMaxPacketSize0<span class="w">         </span><span class="m">8</span>
<span class="w">  </span>idVendor<span class="w">           </span>0x18f8
<span class="w">  </span>idProduct<span class="w">          </span>0x1486
<span class="w">  </span>bcdDevice<span class="w">            </span><span class="m">1</span>.00
<span class="w">  </span>iManufacturer<span class="w">           </span><span class="m">0</span>
<span class="w">  </span>iProduct<span class="w">                </span><span class="m">1</span>
<span class="w">  </span>iSerial<span class="w">                 </span><span class="m">0</span>
<span class="w">  </span>bNumConfigurations<span class="w">      </span><span class="m">1</span>
<span class="w">  </span>Configuration<span class="w"> </span>Descriptor:
<span class="w">    </span>bLength<span class="w">                 </span><span class="m">9</span>
<span class="w">    </span>bDescriptorType<span class="w">         </span><span class="m">2</span>
<span class="w">    </span>wTotalLength<span class="w">           </span><span class="m">59</span>
<span class="w">    </span>bNumInterfaces<span class="w">          </span><span class="m">2</span>
<span class="w">    </span>bConfigurationValue<span class="w">     </span><span class="m">1</span>
<span class="w">    </span>iConfiguration<span class="w">          </span><span class="m">0</span>
<span class="w">    </span>bmAttributes<span class="w">         </span>0xa0
<span class="w">      </span><span class="o">(</span>Bus<span class="w"> </span>Powered<span class="o">)</span>
<span class="w">      </span>Remote<span class="w"> </span>Wakeup
<span class="w">    </span>MaxPower<span class="w">              </span>100mA
<span class="w">    </span>Interface<span class="w"> </span>Descriptor:
<span class="w">      </span>bLength<span class="w">                 </span><span class="m">9</span>
<span class="w">      </span>bDescriptorType<span class="w">         </span><span class="m">4</span>
<span class="w">      </span>bInterfaceNumber<span class="w">        </span><span class="m">0</span>
<span class="w">      </span>bAlternateSetting<span class="w">       </span><span class="m">0</span>
<span class="w">      </span>bNumEndpoints<span class="w">           </span><span class="m">1</span>
<span class="w">      </span>bInterfaceClass<span class="w">         </span><span class="m">3</span><span class="w"> </span>Human<span class="w"> </span>Interface<span class="w"> </span>Device
<span class="w">      </span>bInterfaceSubClass<span class="w">      </span><span class="m">1</span><span class="w"> </span>Boot<span class="w"> </span>Interface<span class="w"> </span>Subclass
<span class="w">      </span>bInterfaceProtocol<span class="w">      </span><span class="m">2</span><span class="w"> </span>Mouse
<span class="w">      </span>iInterface<span class="w">              </span><span class="m">0</span>
<span class="w">        </span>HID<span class="w"> </span>Device<span class="w"> </span>Descriptor:
</code></pre></div>

<p>不幸的是，这里并没有提供我希望找到的细节。初始输出中出现的两个字段 <code>idVendor</code> 和 <code>idProduct</code> 都是空的。这有些帮助，因为往下看一下，就会发现 <code>Mouse</code> 这个词。所以，这个设备就是我的鼠标。</p>
<h3>USB ID 仓库</h3>
<p>这让我不禁想知道如何才能填充这些字段，不仅是为了自己，也是为了其他 Linux 用户。原来已经有了一个开源项目：<a href="http://www.linux-usb.org/usb-ids.html">USB ID 仓库</a>。它是一个公共仓库，它包含了 USB 设备中使用的所有已知 ID。它也被用于各种程序中，包括 <a href="https://sourceforge.net/projects/linux-usb/files/">USB Utilities</a>，用于显示人类可读的设备名称。</p>
<p><img alt="The USB ID Repository Site" src="/data/attachment/album/202009/13/225559xux1x41qhuaic1iz.png" title="The USB ID Repository Site"></p>
<p>你可以从网站上或通过下载数据库来浏览特定设备的仓库。也欢迎用户提交新的数据。我要为我的鼠标提交数据，因为它没有在里面。</p>
<h3>更新你的 USB ID</h3>
<p>USB ID 数据库存储在一个名为 <code>usb.ids</code> 的文件中。这个文件的位置可能会因 Linux 发行版的不同而不同。</p>
<p>在 Ubuntu 18.04 中，这个文件位于 <code>/var/lib/usbutils</code>。要更新数据库，使用命令 <code>update-usbids</code>，你需要用 root 权限或 <code>sudo</code> 来运行。</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>sudo<span class="w"> </span>update-usbids
</code></pre></div>

<p>如果有新文件，它就会被下载。当前的文件将被备份，并被替换为新文件：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>ls<span class="w"> </span>-la
total<span class="w"> </span><span class="m">1148</span>
drwxr-xr-x<span class="w">  </span><span class="m">2</span><span class="w"> </span>root<span class="w"> </span>root<span class="w">   </span><span class="m">4096</span><span class="w"> </span>Jan<span class="w"> </span><span class="m">15</span><span class="w"> </span><span class="m">00</span>:34<span class="w"> </span>.
drwxr-xr-x<span class="w"> </span><span class="m">85</span><span class="w"> </span>root<span class="w"> </span>root<span class="w">   </span><span class="m">4096</span><span class="w"> </span>Nov<span class="w">  </span><span class="m">7</span><span class="w"> </span><span class="m">08</span>:05<span class="w"> </span>..
-rw-r--r--<span class="w">  </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w"> </span><span class="m">614379</span><span class="w"> </span>Jan<span class="w">  </span><span class="m">9</span><span class="w"> </span><span class="m">15</span>:34<span class="w"> </span>usb.ids
-rw-r--r--<span class="w">  </span><span class="m">1</span><span class="w"> </span>root<span class="w"> </span>root<span class="w"> </span><span class="m">551472</span><span class="w"> </span>Jan<span class="w"> </span><span class="m">15</span><span class="w"> </span><span class="m">00</span>:34<span class="w"> </span>usb.ids.old
</code></pre></div>

<p>最新版本的 Fedora Linux 将数据库文件保存在 <code>/usr/share/hwdata</code> 中。而且，没有更新脚本。而是，数据库由一个名为 <code>hwdata</code> 的软件包维护。</p>
<div class="highlight"><pre><span></span><code><span class="c1"># dnf info hwdata</span>

<span class="n">Installed</span><span class="w"> </span><span class="n">Packages</span>
<span class="n">Name</span><span class="w">         </span><span class="p">:</span><span class="w"> </span><span class="n">hwdata</span>
<span class="n">Version</span><span class="w">      </span><span class="p">:</span><span class="w"> </span><span class="mf">0.332</span>
<span class="n">Release</span><span class="w">      </span><span class="p">:</span><span class="w"> </span><span class="mf">1.</span><span class="n">fc31</span>
<span class="n">Architecture</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">noarch</span>
<span class="n">Size</span><span class="w">         </span><span class="p">:</span><span class="w"> </span><span class="mf">7.5</span><span class="w"> </span><span class="n">M</span>
<span class="n">Source</span><span class="w">       </span><span class="p">:</span><span class="w"> </span><span class="n">hwdata</span><span class="o">-</span><span class="mf">0.332</span><span class="o">-</span><span class="mf">1.</span><span class="n">fc31</span><span class="o">.</span><span class="n">src</span><span class="o">.</span><span class="n">rpm</span>
<span class="n">Repository</span><span class="w">   </span><span class="p">:</span><span class="w"> </span><span class="err">@</span><span class="n">System</span>
<span class="n">From</span><span class="w"> </span><span class="n">repo</span><span class="w">    </span><span class="p">:</span><span class="w"> </span><span class="n">updates</span>
<span class="n">Summary</span><span class="w">      </span><span class="p">:</span><span class="w"> </span><span class="n">Hardware</span><span class="w"> </span><span class="n">identification</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">configuration</span><span class="w"> </span><span class="n">data</span>
<span class="n">URL</span><span class="w">          </span><span class="p">:</span><span class="w"> </span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">vcrhonek</span><span class="o">/</span><span class="n">hwdata</span>
<span class="n">License</span><span class="w">      </span><span class="p">:</span><span class="w"> </span><span class="n">GPLv2</span><span class="o">+</span>
<span class="n">Description</span><span class="w">  </span><span class="p">:</span><span class="w"> </span><span class="n">hwdata</span><span class="w"> </span><span class="n">contains</span><span class="w"> </span><span class="n">various</span><span class="w"> </span><span class="n">hardware</span><span class="w"> </span><span class="n">identification</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">configuration</span><span class="w"> </span><span class="n">data</span><span class="p">,</span>
<span class="w">             </span><span class="p">:</span><span class="w"> </span><span class="n">such</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">pci</span><span class="o">.</span><span class="n">ids</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">usb</span><span class="o">.</span><span class="n">ids</span><span class="w"> </span><span class="n">databases</span><span class="o">.</span>
</code></pre></div>

<p>现在我的 USB 设备列表在这个之前未命名的设备旁边显示了一个名字。比较一下上面的输出：</p>
<div class="highlight"><pre><span></span><code><span class="err">$</span><span class="w"> </span><span class="n">lsusb</span>
<span class="n">Bus</span><span class="w"> </span><span class="mi">002</span><span class="w"> </span><span class="n">Device</span><span class="w"> </span><span class="mi">001</span><span class="err">:</span><span class="w"> </span><span class="n">ID</span><span class="w"> </span><span class="mi">1</span><span class="nl">d6b</span><span class="p">:</span><span class="mi">0003</span><span class="w"> </span><span class="n">Linux</span><span class="w"> </span><span class="n">Foundation</span><span class="w"> </span><span class="mf">3.0</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="n">hub</span>
<span class="n">Bus</span><span class="w"> </span><span class="mi">001</span><span class="w"> </span><span class="n">Device</span><span class="w"> </span><span class="mi">004</span><span class="err">:</span><span class="w"> </span><span class="n">ID</span><span class="w"> </span><span class="mi">046</span><span class="nl">d</span><span class="p">:</span><span class="mi">082</span><span class="n">c</span><span class="w"> </span><span class="n">Logitech</span><span class="p">,</span><span class="w"> </span><span class="n">Inc</span><span class="p">.</span><span class="w"> </span><span class="n">HD</span><span class="w"> </span><span class="n">Webcam</span><span class="w"> </span><span class="n">C615</span>
<span class="n">Bus</span><span class="w"> </span><span class="mi">001</span><span class="w"> </span><span class="n">Device</span><span class="w"> </span><span class="mi">003</span><span class="err">:</span><span class="w"> </span><span class="n">ID</span><span class="w"> </span><span class="mi">0951</span><span class="err">:</span><span class="mi">16</span><span class="n">d2</span><span class="w"> </span><span class="n">Kingston</span><span class="w"> </span><span class="n">Technology</span>
<span class="n">Bus</span><span class="w"> </span><span class="mi">001</span><span class="w"> </span><span class="n">Device</span><span class="w"> </span><span class="mi">014</span><span class="err">:</span><span class="w"> </span><span class="n">ID</span><span class="w"> </span><span class="mi">18</span><span class="nl">f8</span><span class="p">:</span><span class="mi">1486</span><span class="w"> </span><span class="o">[</span><span class="n">Maxxter</span><span class="o">]</span>
<span class="n">Bus</span><span class="w"> </span><span class="mi">001</span><span class="w"> </span><span class="n">Device</span><span class="w"> </span><span class="mi">005</span><span class="err">:</span><span class="w"> </span><span class="n">ID</span><span class="w"> </span><span class="mi">051</span><span class="nl">d</span><span class="p">:</span><span class="mi">0002</span><span class="w"> </span><span class="n">American</span><span class="w"> </span><span class="nf">Power</span><span class="w"> </span><span class="n">Conversion</span><span class="w"> </span><span class="n">Uninterruptible</span><span class="w"> </span><span class="nf">Power</span><span class="w"> </span><span class="n">Supply</span>
<span class="n">Bus</span><span class="w"> </span><span class="mi">001</span><span class="w"> </span><span class="n">Device</span><span class="w"> </span><span class="mi">001</span><span class="err">:</span><span class="w"> </span><span class="n">ID</span><span class="w"> </span><span class="mi">1</span><span class="nl">d6b</span><span class="p">:</span><span class="mi">0002</span><span class="w"> </span><span class="n">Linux</span><span class="w"> </span><span class="n">Foundation</span><span class="w"> </span><span class="mf">2.0</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="n">hub</span>
</code></pre></div>

<p>你可能会注意到，随着仓库定期更新新设备和现有设备的详细信息，其他设备的描述也会发生变化。</p>
<h3>提交新数据</h3>
<p>提交新数据有两种方式：使用网站或通过电子邮件发送特殊格式的补丁文件。在开始之前，我阅读了提交指南。首先，我必须注册一个账户，然后我需要使用项目的提交系统提供我鼠标的 ID 和名称。添加任何 USB 设备的过程都是一样的。</p>
<p>你使用过 USB ID 仓库么？如果有，请在评论中分享你的反馈。</p>
    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>links</h2>
                        <ul>
                            <li><a href="https://getpelican.com/">Pelican</a></li>
                            <li><a href="https://www.python.org/">Python.org</a></li>
                            <li><a href="https://palletsprojects.com/p/jinja/">Jinja2</a></li>
                            <li><a href="#">You can modify those links in your config file</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>

                            <li><a href="#">You can add links in your config file</a></li>
                            <li><a href="#">Another social link</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a rel="nofollow" href="https://getpelican.com/">Pelican</a>, which takes great advantage of <a rel="nofollow" href="https://www.python.org/">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a rel="nofollow" href="https://www.smashingmagazine.com/2009/08/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>