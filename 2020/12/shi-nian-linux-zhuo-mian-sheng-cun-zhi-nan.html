<!DOCTYPE html>
<html lang="zh">
<head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="generator" content="Pelican" />
        <title>十年 Linux 桌面生存指南</title>
        <link rel="stylesheet" href="/theme/css/main.css" />
        <meta name="description" content="Author: Dennis Felsing 从 2006 年开始转战 Linux 系统后，经过几年的实践，我的软件设置在过去十年内出人意料的固定。再过十年回顾一下，看看 …" />
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">linux_cn</a></h1>
                <nav><ul>
                    <li><a href="/category/chuan-shan-jia-zhuan-fang">穿山甲专访</a></li>
                    <li><a href="/category/dai-ma-ying-xiong">代码英雄</a></li>
                    <li><a href="/category/fen-xiang">分享</a></li>
                    <li><a href="/category/guan-dian">观点</a></li>
                    <li><a href="/category/huo-dong">活动</a></li>
                    <li><a href="/category/ji-ke-man-hua">极客漫画</a></li>
                    <li class="active"><a href="/category/ji-zhu">技术</a></li>
                    <li><a href="/category/kai-yuan-zhi-hui">开源智慧</a></li>
                    <li><a href="/category/linux-fa-xing-ban">Linux 发行版</a></li>
                    <li><a href="/category/mei-ri-an-quan-zi-xun">每日安全资讯</a></li>
                    <li><a href="/category/misc">Misc</a></li>
                    <li><a href="/category/qu-kuai-lian">区块链</a></li>
                    <li><a href="/category/rong-qi-yu-yun">容器与云</a></li>
                    <li><a href="/category/ruan-jian-kai-fa">软件开发</a></li>
                    <li><a href="/category/shu-mei-pai">树莓派</a></li>
                    <li><a href="/category/xi-tong-yun-wei">系统运维</a></li>
                    <li><a href="/category/xin-wen">新闻</a></li>
                    <li><a href="/category/ying-he-guan-cha">硬核观察</a></li>
                    <li><a href="/category/zhi-ye-sheng-ya">职业生涯</a></li>
                    <li><a href="/category/zhong-jiang-ming-dan">中奖名单</a></li>
                    <li><a href="/category/zhuo-mian-ying-yong">桌面应用</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="/2020/12/shi-nian-linux-zhuo-mian-sheng-cun-zhi-nan.html" rel="bookmark"
           title="Permalink to 十年 Linux 桌面生存指南">十年 Linux 桌面生存指南</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2020-12-03T22:39:00+01:00">
                Published: Thu 03 December 2020
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/linux-fans-from-china.html">linux fans from china</a>
        </address>
<p>In <a href="/category/ji-zhu">技术</a>.</p>

</footer><!-- /.post-info -->      <p>Author: Dennis Felsing</p>
<p><img alt="" src="/data/attachment/album/202012/03/223817smrej5qwsbqjb3vs.jpg"></p>
<p>从 2006 年开始转战 Linux 系统后，经过几年的实践，我的软件设置在过去十年内出人意料的固定。再过十年回顾一下，看看发生了什么，也许会非常有趣。在写这篇推文时，我迅速回顾了正在运行的内容：</p>
<p><img alt="htop overview" src="/data/attachment/album/202012/03/223912v0gsgf43fsxs383f.png"></p>
<h3>动机</h3>
<p>我的软件介绍排序不分先后：</p>
<ul>
<li>程序应该运行在本地系统中以便我可以控制它，这其中并不包括云解决方案。</li>
<li>程序应在终端中运行，以便于在任何地方连贯地使用它们，包括性能稍差的电脑或手机。</li>
<li>通过使用终端软件，可以实现自动聚焦键盘。只有在一些有意义的地方，我会更喜欢使用鼠标，因为在打字期间一直伸手去拿鼠标感觉像在浪费时间。有时候过了一个小时我才注意到甚至还没有插鼠标。</li>
<li>最好使用快速高效的软件，我不喜欢听到风扇的声音和感到房间在变热。我还可以继续长久地运行旧硬件，已经使用了 10 年的 Thinkpad x200s 还能很好地支持我所使用的软件。</li>
<li>组合。我不想手动执行每个步骤，而是在需要时自动执行更多操作，这时自然是支持 shell。</li>
</ul>
<h3>操作系统</h3>
<p>十二年前移除 Windows 系统后，我在 Linux 系统上经历了一个艰难的开始，当时我手上只有 <a href="https://gentoo.org/">Gentoo Linux</a> 系统的安装光盘和一本打印的说明书，要用它们来实现一个可运行的 Linux 系统。虽然花费了几天的时间去编译和修整，但最终还是觉得自己受益颇多。</p>
<p>自此我再也没有转回 Windows 系统，但在持续的编译压力导致风扇失灵后，我将我的电脑系统切换到 <a href="https://www.archlinux.org/">Arch Linux</a>。之后我将其他的电脑和私人服务器也切换到了 Arch Linux。作为一个滚动发布发行版，你可以随时升级软件包，但 <a href="https://www.archlinux.org/news/">Arch Linux News</a> 已经详细报道了其中最主要的漏洞。</p>
<p>不过，令人烦恼的是一旦你更新了旧的内核模组，Arch Linux 就会移除旧版的相关信息。我经常注意到一旦我试着插入一个 USB 闪存盘，内核就无法加载相关组件。相反，每次内核升级后都应该进行重启。有一些 <a href="https://www.reddit.com/r/archlinux/comments/4zrsc3/keep_your_system_fully_functional_after_a_kernel/">方法</a> 可以解决这个问题，但我还没有实际地使用它们。</p>
<p>其他程序也会出现类似的情况，通常 Firefox 、 cron 或者 Samba 在升级后都需要重启，但恼人的是，它们没有警告你存在这种情况。我在工作中使用的 <a href="https://www.suse.com/">SUSE</a> 很好地提醒了这种情况。</p>
<p>对于 <a href="https://ddnet.tw/">DDNet</a> 产品服务器，相较于 Arch Linux ，我更倾向于 <a href="https://www.debian.org/">Debian</a> 系统，这样在每次升级时出现故障的几率更低。我的防火墙和路由器使用了 <a href="https://www.openbsd.org/">OpenBSD</a> ，它拥有干净系统、文档和强大的 <a href="https://www.openbsd.org/faq/pf/">pf 防火墙</a>，而我现在不需要一个单独的路由器。</p>
<h3>窗口管理器</h3>
<p>从我开始使用 Gentoo 后，我很快注意到 KDE 的编译时间非常长，这让我没办法继续使用它。我四处寻找更简单的解决方案，最初使用了 <a href="http://openbox.org/wiki/Main_Page">Openbox</a> 和 <a href="http://fluxbox.org/">Fluxbox</a>。某次，为了能更多进行纯键盘操作，我开始尝试转入平铺窗口管理器，并在研究其初始版本的时候学习了 <a href="https://dwm.suckless.org/">dwm</a> 和 <a href="https://awesomewm.org/">awesome</a>。</p>
<p>最终，由于 <a href="https://xmonad.org/">xmonad</a>的灵活性、可扩展性以及使用纯 <a href="https://www.haskell.org/">Haskell</a>（一种出色的函数编程语言）编写和配置，最终选择了它。一个例子是，我在家中运行一个 40" 4K 的屏幕，但经常会将它分为四个虚拟屏幕，每个虚拟屏幕显示一个工作区，每个工作区自动排列在我的窗口上。当然， xmonad 有一个对应的 <a href="http://hackage.haskell.org/package/xmonad-contrib-0.15/docs/XMonad-Layout-LayoutScreens.html">模块</a>。</p>
<p><a href="http://robm.github.io/dzen/">dzen</a> 和 <a href="https://github.com/brndnmtthws/conky">conky</a> 对我来说是一个非常简单的状态栏。我的整体 conky 配置看起来是这样的：</p>
<div class="highlight"><pre><span></span><code><span class="n">out_to_console</span><span class="w"> </span><span class="n">yes</span>
<span class="n">update_interval</span><span class="w"> </span><span class="mi">1</span>
<span class="n">total_run_times</span><span class="w"> </span><span class="mi">0</span>

<span class="n">TEXT</span>
<span class="o">$</span><span class="p">{</span><span class="n">downspeed</span><span class="w"> </span><span class="n">eth0</span><span class="p">}</span><span class="w"> </span><span class="o">$</span><span class="p">{</span><span class="n">upspeed</span><span class="w"> </span><span class="n">eth0</span><span class="p">}</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">$</span><span class="n">cpu</span><span class="o">%</span><span class="w"> </span><span class="o">$</span><span class="p">{</span><span class="n">loadavg</span><span class="w"> </span><span class="mi">1</span><span class="p">}</span><span class="w"> </span><span class="o">$</span><span class="p">{</span><span class="n">loadavg</span><span class="w"> </span><span class="mi">2</span><span class="p">}</span><span class="w"> </span><span class="o">$</span><span class="p">{</span><span class="n">loadavg</span><span class="w"> </span><span class="mi">3</span><span class="p">}</span><span class="w"> </span><span class="o">$</span><span class="n">mem</span><span class="o">/$</span><span class="n">memmax</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">$</span><span class="p">{</span><span class="n">time</span><span class="w"> </span><span class="o">%</span><span class="n">F</span><span class="w"> </span><span class="o">%</span><span class="n">T</span><span class="p">}</span>
</code></pre></div>

<p>输入命令直接通过管道输入 dzen2：</p>
<div class="highlight"><pre><span></span><code>conky | dzen2 -fn &#39;-xos4-terminus-medium-r-normal-*-12-*-*-*-*-*-*-*&#39; -bg &#39;#000000&#39; -fg &#39;#ffffff&#39; -p -e &#39;&#39; -x 1000 -w 920 -xs 1 -ta r
</code></pre></div>

<p>对我而言，一项重要功能是在完成工作后使终端发出蜂鸣声。只需要简单地在 zsh 中的 <code>PR_TITLEBAR</code> 变量中添加一个 <code>\a</code> 字符就可以做到，只要工作完成就可以发出蜂鸣声。当然，我使用了命令：</p>
<div class="highlight"><pre><span></span><code>echo &quot;blacklist pcspkr&quot; &gt; /etc/modprobe.d/nobeep.conf
</code></pre></div>

<p>将 <code>pcspkr</code> 内核模块列入黑名单来禁用实际的蜂鸣声。相反 urxvt 的 <code>URxvt.urgentOnBell: true</code> 设置会将声音变为尖锐。之后 xmonad 有一个 urgency 钩子来捕捉这类信号，并且我可以使用组合键自动聚焦到当前的发出紧急信号的窗口。在 dzen 中我可以看到一个漂亮且明亮的 <code>#ff0000</code> 紧急窗口。</p>
<p>在我笔记本上所得到的最终成品是：</p>
<p><img alt="Laptop screenshot" src="/data/attachment/album/202012/03/223915yh19a7t4ta9z1zlx.png"></p>
<p>我听说前几年 <a href="https://i3wm.org/">i3</a> 变得非常流行，但它要求更多的手动窗口对齐而不是自动对齐。</p>
<p>我意识到也有像 <a href="https://github.com/tmux/tmux/wiki">tmux</a> 那样的终端多路复用器，但我仍想要一些图形化应用程序，因此最终我没有有效地使用它们。</p>
<h3>终端连续性</h3>
<p>为了使终端保持活跃状态，我使用了 <a href="http://dtach.sourceforge.net/">dtach</a> ，它只是模拟屏幕分离功能。为了使计算机上的每个终端都可连接和断开，我编写了一个小的封装脚本。 这意味着，即使必须重新启动 X 服务器，我也可以使所有终端都运行良好，包括本地和远程终端。</p>
<h3>Shell &amp; 编程</h3>
<p>对于 shell，我使用 <a href="http://www.zsh.org/">zsh</a> 而不是 <a href="https://www.gnu.org/software/bash/">bash</a>，因为它有众多的功能。</p>
<p>作为终端模拟，我发现 <a href="http://software.schmorp.de/pkg/rxvt-unicode.html">urxvt</a> 足够轻巧，支持 Unicode 编码和 256 色，具有出色的性能。另一个重要的功能是可以分别运行 urxvt 客户端和守护进程。因此，即使大量终端也几乎不占用任何内存（回滚缓冲区除外）。</p>
<p>对我而言，只有一种字体看起来绝对干净和完美： <a href="http://terminus-font.sourceforge.net/">Terminus</a>。 由于它是位图字体，因此所有内容都是完美像素，渲染速度极快且 CPU 使用率低。为了能使用 <code>CTRL-WIN-[1-7]</code> 在每个终端按需切换字体，我的 <code>~/.Xdefaults</code> 包含:</p>
<div class="highlight"><pre><span></span><code><span class="nt">URxvt</span><span class="p">.</span><span class="nc">font</span><span class="o">:</span><span class="w"> </span><span class="nt">-xos4-terminus-medium-r-normal-</span><span class="o">*</span><span class="nt">-14-</span><span class="o">*</span><span class="nt">-</span><span class="o">*</span><span class="nt">-</span><span class="o">*</span><span class="nt">-</span><span class="o">*</span><span class="nt">-</span><span class="o">*</span><span class="nt">-</span><span class="o">*</span><span class="nt">-</span><span class="o">*</span>
<span class="nt">dzen2</span><span class="p">.</span><span class="nc">font</span><span class="o">:</span><span class="w"> </span><span class="nt">-xos4-terminus-medium-r-normal-</span><span class="o">*</span><span class="nt">-14-</span><span class="o">*</span><span class="nt">-</span><span class="o">*</span><span class="nt">-</span><span class="o">*</span><span class="nt">-</span><span class="o">*</span><span class="nt">-</span><span class="o">*</span><span class="nt">-</span><span class="o">*</span><span class="nt">-</span><span class="o">*</span>

<span class="nt">URxvt</span><span class="p">.</span><span class="nc">keysym</span><span class="p">.</span><span class="nc">C-M-1</span><span class="o">:</span><span class="w"> </span><span class="nt">command</span><span class="o">:</span><span class="err">\</span><span class="nt">033</span><span class="o">]</span><span class="nt">50</span><span class="o">;</span><span class="nt">-xos4-terminus-medium-r-normal-</span><span class="o">*</span><span class="nt">-12-</span><span class="o">*</span><span class="nt">-</span><span class="o">*</span><span class="nt">-</span><span class="o">*</span><span class="nt">-</span><span class="o">*</span><span class="nt">-</span><span class="o">*</span><span class="nt">-</span><span class="o">*</span><span class="nt">-</span><span class="o">*</span><span class="err">\</span><span class="nt">007</span>
<span class="nt">URxvt</span><span class="p">.</span><span class="nc">keysym</span><span class="p">.</span><span class="nc">C-M-2</span><span class="o">:</span><span class="w"> </span><span class="nt">command</span><span class="o">:</span><span class="err">\</span><span class="nt">033</span><span class="o">]</span><span class="nt">50</span><span class="o">;</span><span class="nt">-xos4-terminus-medium-r-normal-</span><span class="o">*</span><span class="nt">-14-</span><span class="o">*</span><span class="nt">-</span><span class="o">*</span><span class="nt">-</span><span class="o">*</span><span class="nt">-</span><span class="o">*</span><span class="nt">-</span><span class="o">*</span><span class="nt">-</span><span class="o">*</span><span class="nt">-</span><span class="o">*</span><span class="err">\</span><span class="nt">007</span>
<span class="nt">URxvt</span><span class="p">.</span><span class="nc">keysym</span><span class="p">.</span><span class="nc">C-M-3</span><span class="o">:</span><span class="w"> </span><span class="nt">command</span><span class="o">:</span><span class="err">\</span><span class="nt">033</span><span class="o">]</span><span class="nt">50</span><span class="o">;</span><span class="nt">-xos4-terminus-medium-r-normal-</span><span class="o">*</span><span class="nt">-18-</span><span class="o">*</span><span class="nt">-</span><span class="o">*</span><span class="nt">-</span><span class="o">*</span><span class="nt">-</span><span class="o">*</span><span class="nt">-</span><span class="o">*</span><span class="nt">-</span><span class="o">*</span><span class="nt">-</span><span class="o">*</span><span class="err">\</span><span class="nt">007</span>
<span class="nt">URxvt</span><span class="p">.</span><span class="nc">keysym</span><span class="p">.</span><span class="nc">C-M-4</span><span class="o">:</span><span class="w"> </span><span class="nt">command</span><span class="o">:</span><span class="err">\</span><span class="nt">033</span><span class="o">]</span><span class="nt">50</span><span class="o">;</span><span class="nt">-xos4-terminus-medium-r-normal-</span><span class="o">*</span><span class="nt">-22-</span><span class="o">*</span><span class="nt">-</span><span class="o">*</span><span class="nt">-</span><span class="o">*</span><span class="nt">-</span><span class="o">*</span><span class="nt">-</span><span class="o">*</span><span class="nt">-</span><span class="o">*</span><span class="nt">-</span><span class="o">*</span><span class="err">\</span><span class="nt">007</span>
<span class="nt">URxvt</span><span class="p">.</span><span class="nc">keysym</span><span class="p">.</span><span class="nc">C-M-5</span><span class="o">:</span><span class="w"> </span><span class="nt">command</span><span class="o">:</span><span class="err">\</span><span class="nt">033</span><span class="o">]</span><span class="nt">50</span><span class="o">;</span><span class="nt">-xos4-terminus-medium-r-normal-</span><span class="o">*</span><span class="nt">-24-</span><span class="o">*</span><span class="nt">-</span><span class="o">*</span><span class="nt">-</span><span class="o">*</span><span class="nt">-</span><span class="o">*</span><span class="nt">-</span><span class="o">*</span><span class="nt">-</span><span class="o">*</span><span class="nt">-</span><span class="o">*</span><span class="err">\</span><span class="nt">007</span>
<span class="nt">URxvt</span><span class="p">.</span><span class="nc">keysym</span><span class="p">.</span><span class="nc">C-M-6</span><span class="o">:</span><span class="w"> </span><span class="nt">command</span><span class="o">:</span><span class="err">\</span><span class="nt">033</span><span class="o">]</span><span class="nt">50</span><span class="o">;</span><span class="nt">-xos4-terminus-medium-r-normal-</span><span class="o">*</span><span class="nt">-28-</span><span class="o">*</span><span class="nt">-</span><span class="o">*</span><span class="nt">-</span><span class="o">*</span><span class="nt">-</span><span class="o">*</span><span class="nt">-</span><span class="o">*</span><span class="nt">-</span><span class="o">*</span><span class="nt">-</span><span class="o">*</span><span class="err">\</span><span class="nt">007</span>
<span class="nt">URxvt</span><span class="p">.</span><span class="nc">keysym</span><span class="p">.</span><span class="nc">C-M-7</span><span class="o">:</span><span class="w"> </span><span class="nt">command</span><span class="o">:</span><span class="err">\</span><span class="nt">033</span><span class="o">]</span><span class="nt">50</span><span class="o">;</span><span class="nt">-xos4-terminus-medium-r-normal-</span><span class="o">*</span><span class="nt">-32-</span><span class="o">*</span><span class="nt">-</span><span class="o">*</span><span class="nt">-</span><span class="o">*</span><span class="nt">-</span><span class="o">*</span><span class="nt">-</span><span class="o">*</span><span class="nt">-</span><span class="o">*</span><span class="nt">-</span><span class="o">*</span><span class="err">\</span><span class="nt">007</span>

<span class="nt">URxvt</span><span class="p">.</span><span class="nc">keysym</span><span class="p">.</span><span class="nc">C-M-n</span><span class="o">:</span><span class="w"> </span><span class="nt">command</span><span class="o">:</span><span class="err">\</span><span class="nt">033</span><span class="o">]</span><span class="nt">10</span><span class="o">;</span><span class="p">#</span><span class="nn">ffffff</span><span class="err">\</span><span class="nt">007</span><span class="err">\</span><span class="nt">033</span><span class="o">]</span><span class="nt">11</span><span class="o">;</span><span class="p">#</span><span class="nn">000000</span><span class="err">\</span><span class="nt">007</span><span class="err">\</span><span class="nt">033</span><span class="o">]</span><span class="nt">12</span><span class="o">;</span><span class="p">#</span><span class="nn">ffffff</span><span class="err">\</span><span class="nt">007</span><span class="err">\</span><span class="nt">033</span><span class="o">]</span><span class="nt">706</span><span class="o">;</span><span class="p">#</span><span class="nn">00ffff</span><span class="err">\</span><span class="nt">007</span><span class="err">\</span><span class="nt">033</span><span class="o">]</span><span class="nt">707</span><span class="o">;</span><span class="p">#</span><span class="nn">ffff00</span><span class="err">\</span><span class="nt">007</span>
<span class="nt">URxvt</span><span class="p">.</span><span class="nc">keysym</span><span class="p">.</span><span class="nc">C-M-b</span><span class="o">:</span><span class="w"> </span><span class="nt">command</span><span class="o">:</span><span class="err">\</span><span class="nt">033</span><span class="o">]</span><span class="nt">10</span><span class="o">;</span><span class="p">#</span><span class="nn">000000</span><span class="err">\</span><span class="nt">007</span><span class="err">\</span><span class="nt">033</span><span class="o">]</span><span class="nt">11</span><span class="o">;</span><span class="p">#</span><span class="nn">ffffff</span><span class="err">\</span><span class="nt">007</span><span class="err">\</span><span class="nt">033</span><span class="o">]</span><span class="nt">12</span><span class="o">;</span><span class="p">#</span><span class="nn">000000</span><span class="err">\</span><span class="nt">007</span><span class="err">\</span><span class="nt">033</span><span class="o">]</span><span class="nt">706</span><span class="o">;</span><span class="p">#</span><span class="nn">0000ff</span><span class="err">\</span><span class="nt">007</span><span class="err">\</span><span class="nt">033</span><span class="o">]</span><span class="nt">707</span><span class="o">;</span><span class="p">#</span><span class="nn">ff0000</span><span class="err">\</span><span class="nt">007</span>
</code></pre></div>

<p>对于编程和书写，我使用 <a href="https://www.vim.org/">Vim</a> 语法高亮显示和 <a href="http://ctags.sourceforge.net/">ctags</a> 进行索引，以及一些带有 <code>grep</code> 、<code>sed</code> 和其他用于搜索和操作的常用终端窗口。这可能不像 IDE 那样舒适，但可以实现更多的自动化。</p>
<p>Vim 的一个问题是你已经习惯了它的键映射，因此希望在任何地方都使用它们。</p>
<p>在 shell 功能不够强大时，<a href="https://www.python.org/">Python</a> 和 <a href="https://nim-lang.org/">Nim</a> 作为脚本语言也不错。</p>
<h3>系统监控</h3>
<p><a href="https://hisham.hm/htop/">htop</a> （查看当前站点的后台运行，是托管服务器的实时视图）非常适合快速了解软件的当前运行状态。 <a href="http://lm-sensors.org/">lm_sensors</a> 可以监控硬件温度、风扇和电压。 <a href="https://01.org/powertop/">powertop</a> 是一款由 Intel 发布的优秀省电小工具。 <a href="https://dev.yorhel.nl/ncdu">ncdu</a> 可以交互式分析磁盘使用情况。</p>
<p><a href="https://nmap.org/">nmap</a>、 iptraf-ng、 <a href="https://www.tcpdump.org/">tcpdump</a> 和 <a href="https://www.wireshark.org/">Wireshark</a> 都是分析网络问题的基本工具。</p>
<p>当然还有很多更优秀的工具。</p>
<h3>邮件 &amp; 同步</h3>
<p>在我的家庭服务器上，我为自己所有的邮箱账号运行了 <a href="http://www.fetchmail.info/">fetchmail</a> 守护进程。fetchmail 只是检索收到的邮件并调用 <a href="http://www.procmail.org/">procmail</a>：</p>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/sh</span>
<span class="k">for</span><span class="w"> </span>i<span class="w"> </span><span class="k">in</span><span class="w"> </span>/home/deen/.fetchmail/*<span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w"> </span><span class="nv">FETCHMAILHOME</span><span class="o">=</span><span class="nv">$i</span><span class="w"> </span>/usr/bin/fetchmail<span class="w"> </span>-m<span class="w"> </span><span class="s1">&#39;procmail -d %T&#39;</span><span class="w"> </span>-d<span class="w"> </span><span class="m">60</span>
<span class="k">done</span>
</code></pre></div>

<p>配置非常简单，然后等待服务器通知我们有新的邮件：</p>
<div class="highlight"><pre><span></span><code><span class="n">poll</span><span class="w"> </span><span class="n">imap</span><span class="mf">.1</span><span class="n">und1</span><span class="p">.</span><span class="n">de</span><span class="w"> </span><span class="n">protocol</span><span class="w"> </span><span class="n">imap</span><span class="w"> </span><span class="n">timeout</span><span class="w"> </span><span class="mi">120</span><span class="w"> </span><span class="k">user</span><span class="w"> </span><span class="ss">&quot;dennis@felsin9.de&quot;</span><span class="w"> </span><span class="n">password</span><span class="w"> </span><span class="ss">&quot;XXX&quot;</span><span class="w"> </span><span class="n">folders</span><span class="w"> </span><span class="n">INBOX</span><span class="w"> </span><span class="n">keep</span><span class="w"> </span><span class="n">ssl</span><span class="w"> </span><span class="n">idle</span>
</code></pre></div>

<p>我的 <code>.procmailrc</code> 配置包含一些备份全部邮件的规则，并将邮件整理在对应的目录下面。例如，基于邮件列表名或者邮件标题：</p>
<div class="highlight"><pre><span></span><code>MAILDIR=/home/deen/shared/Maildir
LOGFILE=$HOME/.procmaillog
LOGABSTRACT=no
VERBOSE=off
FORMAIL=/usr/bin/formail
NL=&quot;
&quot;

:0wc
<span class="gs">* ! ? test -d /media/mailarchive/`date +%Y`</span>
<span class="gs">| mkdir -p /media/mailarchive/`date +%Y`</span>

<span class="gs"># Make backups of all mail received in format YYYY/YYYY-MM</span>
<span class="gs">:0c</span>
<span class="gs">/media/mailarchive/`date +%Y`/`date +%Y-%m`</span>

<span class="gs">:0</span>
<span class="gs">*</span> ^From: .*(.*@.*.kit.edu|.*@.*.uka.de|.*@.*.uni-karlsruhe.de)
$MAILDIR/.uni/

:0
<span class="k">*</span> ^list-Id:.*lists.kit.edu
$MAILDIR/.uni-ml/

[...]
</code></pre></div>

<p>我使用 <a href="https://marlam.de/msmtp/">msmtp</a> 来发送邮件，它也很好配置：</p>
<div class="highlight"><pre><span></span><code><span class="n">account</span><span class="w"> </span><span class="k">default</span>
<span class="k">host</span><span class="w"> </span><span class="n">smtp</span><span class="mf">.1</span><span class="n">und1</span><span class="p">.</span><span class="n">de</span>
<span class="n">tls</span><span class="w"> </span><span class="k">on</span>
<span class="n">tls_trust_file</span><span class="w"> </span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">ssl</span><span class="o">/</span><span class="n">certs</span><span class="o">/</span><span class="n">ca</span><span class="o">-</span><span class="n">certificates</span><span class="p">.</span><span class="n">crt</span>
<span class="n">auth</span><span class="w"> </span><span class="k">on</span>
<span class="k">from</span><span class="w"> </span><span class="n">dennis</span><span class="nv">@felsin9</span><span class="p">.</span><span class="n">de</span>
<span class="k">user</span><span class="w"> </span><span class="n">dennis</span><span class="nv">@felsin9</span><span class="p">.</span><span class="n">de</span>
<span class="n">password</span><span class="w"> </span><span class="n">XXX</span>

<span class="o">[</span><span class="n">...</span><span class="o">]</span>
</code></pre></div>

<p>但是到目前为止，邮件还在服务器上。 我的文档全部存储在一个目录中，我使用 <a href="https://www.cis.upenn.edu/~bcpierce/unison/">Unison</a> 在所有计算机之间进行同步。Unison 可以视为双向交互式 <a href="https://rsync.samba.org/">rsync</a>，我的邮件是这个文件目录下的一部分，因此它们最终存储在我的电脑上。</p>
<p>这也意味着，尽管邮件会立即到达我的邮箱，但我只是按需拿取，而不是邮件一到达时就立即收到通知。</p>
<p>从此我使用 <a href="http://www.mutt.org/">mutt</a> 阅读邮件，使用侧边栏显示我的邮件目录。 <code>/etc/mailcap</code> 文件对于显示非纯文本邮件（ HTML, Word 或者 PDF）不可或缺：</p>
<div class="highlight"><pre><span></span><code>text/html;w3m -I %{charset} -T text/html; copiousoutput
application/msword; antiword %s; copiousoutput
application/pdf; pdftotext -layout /dev/stdin -; copiousoutput
</code></pre></div>

<h3>新闻 &amp; 通讯</h3>
<p><a href="https://newsboat.org/">Newsboat</a> 是一个非常棒的终端 RSS/Atom 阅读器。我在一个有约 150 个提要的 <code>tach</code> 会话服务器上运行它。也可以在本地选择提要，例如：</p>
<div class="highlight"><pre><span></span><code><span class="nv">ignore</span><span class="o">-</span><span class="nv">article</span><span class="w"> </span><span class="s2">&quot;https://forum.ddnet.tw/feed.php&quot;</span><span class="w"> </span><span class="s2">&quot;title =~ \&quot;</span><span class="nv">Map</span><span class="w"> </span><span class="nv">Testing</span><span class="w"> </span>•\<span class="s2">&quot; or title =~ \&quot;</span><span class="nv">Old</span><span class="w"> </span><span class="nv">maps</span><span class="w"> </span>•\<span class="s2">&quot; or title =~ \&quot;</span><span class="nv">Map</span><span class="w"> </span><span class="nv">Bugs</span><span class="w"> </span>•\<span class="s2">&quot; or title =~ \&quot;</span><span class="nv">Archive</span><span class="w"> </span>•\<span class="s2">&quot; or title =~ \&quot;</span><span class="nv">Waiting</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">mapper</span><span class="w"> </span>•\<span class="s2">&quot; or title =~ \&quot;</span><span class="nv">Other</span><span class="w"> </span><span class="nv">mods</span><span class="w"> </span>•\<span class="s2">&quot; or title =~ \&quot;</span><span class="nv">Fixes</span><span class="w"> </span>•\<span class="s2">&quot;&quot;</span>
</code></pre></div>

<p>我以同样的方式使用 <a href="https://irssi.org/">Irssi</a> 进行 IRC 通讯。</p>
<h3>日历</h3>
<p><a href="https://www.roaringpenguin.com/products/remind">remind</a> 是一个可以从命令行获取的日历。通过编辑 <code>rem</code> 文件可以设置新的提醒：</p>
<div class="highlight"><pre><span></span><code><span class="cp"># One time events</span>
<span class="n">REM</span><span class="w"> </span><span class="mi">2019</span><span class="o">-</span><span class="mo">01</span><span class="o">-</span><span class="mi">20</span><span class="w"> </span><span class="o">+</span><span class="mi">90</span><span class="w"> </span><span class="n">Flight</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">China</span><span class="w"> </span><span class="o">%</span><span class="n">b</span>

<span class="cp"># Recurring Holidays</span>
<span class="n">REM</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">May</span><span class="w"> </span><span class="o">+</span><span class="mi">90</span><span class="w"> </span><span class="n">Holiday</span><span class="w"> </span><span class="s">&quot;Tag der Arbeit&quot;</span><span class="w"> </span><span class="o">%</span><span class="n">b</span>
<span class="n">REM</span><span class="w"> </span><span class="p">[</span><span class="n">trigger</span><span class="p">(</span><span class="n">easterdate</span><span class="p">(</span><span class="n">year</span><span class="p">(</span><span class="n">today</span><span class="p">()))</span><span class="o">-</span><span class="mi">2</span><span class="p">)]</span><span class="w"> </span><span class="o">+</span><span class="mi">90</span><span class="w"> </span><span class="n">Holiday</span><span class="w"> </span><span class="s">&quot;Karfreitag&quot;</span><span class="w"> </span><span class="o">%</span><span class="n">b</span>

<span class="cp"># Time Change</span>
<span class="n">REM</span><span class="w"> </span><span class="n">Nov</span><span class="w"> </span><span class="n">Sunday</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">--</span><span class="mi">7</span><span class="w"> </span><span class="o">+</span><span class="mi">90</span><span class="w"> </span><span class="n">Time</span><span class="w"> </span><span class="n">Change</span><span class="w"> </span><span class="p">(</span><span class="mo">03</span><span class="o">:</span><span class="mo">00</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="mo">02</span><span class="o">:</span><span class="mo">00</span><span class="p">)</span><span class="w"> </span><span class="o">%</span><span class="n">b</span>
<span class="n">REM</span><span class="w"> </span><span class="n">Apr</span><span class="w"> </span><span class="n">Sunday</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">--</span><span class="mi">7</span><span class="w"> </span><span class="o">+</span><span class="mi">90</span><span class="w"> </span><span class="n">Time</span><span class="w"> </span><span class="n">Change</span><span class="w"> </span><span class="p">(</span><span class="mo">02</span><span class="o">:</span><span class="mo">00</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="mo">03</span><span class="o">:</span><span class="mo">00</span><span class="p">)</span><span class="w"> </span><span class="o">%</span><span class="n">b</span>

<span class="cp"># Birthdays</span>
<span class="n">FSET</span><span class="w"> </span><span class="n">birthday</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="s">&quot;&#39;</span><span class="n">s</span><span class="w"> </span><span class="s">&quot; + ord(year(trigdate())-x) + &quot;</span><span class="w"> </span><span class="n">birthday</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="o">%</span><span class="n">b</span><span class="s">&quot;</span>
<span class="s">REM 16 Apr +90 MSG Andreas[birthday(1994)]</span>

<span class="s"># Sun</span>
<span class="s">SET $LatDeg 49</span>
<span class="s">SET $LatMin 19</span>
<span class="s">SET $LatSec 49</span>
<span class="s">SET $LongDeg -8</span>
<span class="s">SET $LongMin -40</span>
<span class="s">SET $LongSec -24</span>

<span class="s">MSG Sun from [sunrise(trigdate())] to [sunset(trigdate())]</span>
<span class="s">[...]</span>
</code></pre></div>

<p>遗憾的是，目前 remind 中还没有中国农历的提醒功能，因此中国的节日不易计算。</p>
<p>我给提醒设置了两个名字：</p>
<div class="highlight"><pre><span></span><code>rem -m -b1 -q -g
</code></pre></div>

<p>按时间顺序查看待办事项清单</p>
<div class="highlight"><pre><span></span><code>rem -m -b1 -q -cuc12 -w$(($(tput cols)+1)) | sed -e &quot;s/\f//g&quot; | less
</code></pre></div>

<p>显示适应终端宽度的日历：</p>
<p><img alt="remcal" src="/data/attachment/album/202012/03/223915bjyjlmaylvfmyyal.png"></p>
<h3>字典</h3>
<p><a href="https://github.com/tsdh/rdictcc">rdictcc</a> 是鲜为人知的字典工具，它可以使用 <a href="https://www.dict.cc/">dict.cc</a> 很棒的词典并将他们转存在本地数据库中：</p>
<div class="highlight"><pre><span></span><code><span class="n">$</span><span class="w"> </span><span class="n">rdictcc</span><span class="w"> </span><span class="n">rasch</span>
<span class="o">====================</span><span class="p">[</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">B</span><span class="w"> </span><span class="p">]</span><span class="o">====================</span>
<span class="nl">rasch</span><span class="p">:</span>
<span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">apace</span>
<span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">brisk</span><span class="w"> </span><span class="p">[</span><span class="n">speedy</span><span class="p">]</span>
<span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">cursory</span>
<span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">timely</span><span class="w"> </span><span class="n">manner</span>
<span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">quick</span>
<span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">quickly</span>
<span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">rapid</span>
<span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">rapidly</span>
<span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">sharpish</span><span class="w"> </span><span class="p">[</span><span class="n">Br</span><span class="p">.]</span><span class="w"> </span><span class="p">[</span><span class="n">coll</span><span class="p">.]</span>
<span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">speedily</span>
<span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">speedy</span>
<span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">swift</span>
<span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">swiftly</span>
<span class="n">rasch</span><span class="w"> </span><span class="p">[</span><span class="n">gehen</span><span class="p">]</span><span class="o">:</span>
<span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">smartly</span><span class="w"> </span><span class="p">[</span><span class="n">quickly</span><span class="p">]</span>
<span class="n">Rasch</span><span class="w"> </span><span class="p">{</span><span class="n">n</span><span class="p">}</span><span class="w"> </span><span class="p">[</span><span class="n">Zittergras</span><span class="o">-</span><span class="n">Segge</span><span class="p">]</span><span class="o">:</span>
<span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Alpine</span><span class="w"> </span><span class="n">grass</span><span class="w"> </span><span class="p">[</span><span class="n">Carex</span><span class="w"> </span><span class="n">brizoides</span><span class="p">]</span>
<span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">quaking</span><span class="w"> </span><span class="n">grass</span><span class="w"> </span><span class="n">sedge</span><span class="w"> </span><span class="p">[</span><span class="n">Carex</span><span class="w"> </span><span class="n">brizoides</span><span class="p">]</span>
<span class="n">Rasch</span><span class="w"> </span><span class="p">{</span><span class="n">m</span><span class="p">}</span><span class="w"> </span><span class="p">[</span><span class="n">regional</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">Putzrasch</span><span class="p">]</span><span class="o">:</span>
<span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">scouring</span><span class="w"> </span><span class="n">pad</span>
<span class="o">====================</span><span class="p">[</span><span class="w"> </span><span class="n">B</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="p">]</span><span class="o">====================</span>
<span class="n">Rasch</span><span class="w"> </span><span class="n">model</span><span class="o">:</span>
<span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Rasch</span><span class="o">-</span><span class="n">Modell</span><span class="w"> </span><span class="p">{</span><span class="n">n</span><span class="p">}</span>
</code></pre></div>

<h3>记录和阅读</h3>
<p>我有一个简单记录任务的备忘录，在 Vim 会话中基本上一直处于打开状态。我也使用备忘录作为工作中“已完成”工作的记录，这样就可以检查自己每天完成了哪些任务。</p>
<p>对于写文件、信件和演示文稿，我会使用 <a href="https://www.latex-project.org/">LaTeX</a> 进行高级排版。德式的简单信件可以这样设置，例如：</p>
<div class="highlight"><pre><span></span><code><span class="k">\documentclass</span><span class="na">[paper = a4, fromalign = right]</span><span class="nb">{</span>scrlttr2<span class="nb">}</span>
<span class="k">\usepackage</span><span class="nb">{</span>german<span class="nb">}</span>
<span class="k">\usepackage</span><span class="nb">{</span>eurosym<span class="nb">}</span>
<span class="k">\usepackage</span><span class="na">[utf8]</span><span class="nb">{</span>inputenc<span class="nb">}</span>
<span class="k">\setlength</span><span class="nb">{</span><span class="k">\parskip</span><span class="nb">}{</span>6pt<span class="nb">}</span>
<span class="k">\setlength</span><span class="nb">{</span><span class="k">\parindent</span><span class="nb">}{</span>0pt<span class="nb">}</span>

<span class="k">\setkomavar</span><span class="nb">{</span>fromname<span class="nb">}{</span>Dennis Felsing<span class="nb">}</span>
<span class="k">\setkomavar</span><span class="nb">{</span>fromaddress<span class="nb">}{</span>Meine Str. 1<span class="k">\\</span>69181 Leimen<span class="nb">}</span>
<span class="k">\setkomavar</span><span class="nb">{</span>subject<span class="nb">}{</span>Titel<span class="nb">}</span>

<span class="k">\setkomavar*</span><span class="nb">{</span>enclseparator<span class="nb">}{</span>Anlagen<span class="nb">}</span>

<span class="k">\makeatletter</span>
<span class="k">\@</span>setplength<span class="nb">{</span>refvpos<span class="nb">}{</span>89mm<span class="nb">}</span>
<span class="k">\makeatother</span>

<span class="k">\begin</span><span class="nb">{</span>document<span class="nb">}</span>
<span class="k">\begin</span><span class="nb">{</span>letter<span class="nb">}</span> <span class="nb">{</span>Herr Soundso<span class="k">\\</span>Deine Str. 2<span class="k">\\</span>69121 Heidelberg<span class="nb">}</span>
<span class="k">\opening</span><span class="nb">{</span>Sehr geehrter Herr Soundso,<span class="nb">}</span>

Sie haben bei mir seit dem Bla Bla Bla.

Ich fordere Sie hiermit zu Bla Bla Bla auf.

<span class="k">\closing</span><span class="nb">{</span>Mit freundlichen Grüßen<span class="nb">}</span>

<span class="k">\end</span><span class="nb">{</span>letter<span class="nb">}</span>
<span class="k">\end</span><span class="nb">{</span>document<span class="nb">}</span>
</code></pre></div>

<p>在 <a href="http://felsin9.de/nnis/research/">我的私人网站</a> 上可以找到更多的示例文档和演示文稿。</p>
<p><a href="https://pwmt.org/projects/zathura/">Zathura</a> 读取 PDF 文件速度很快，支持 Vim 类控件，还支持两种不同的 PDF 后端： Poppler 和 MuPDF。另一方面，在偶尔遇到 Zathura 无法打开的文件时，<a href="https://wiki.gnome.org/Apps/Evince">Evince</a> 则显得更全能一些。</p>
<h3>图片编辑</h3>
<p>简便的选择是，<a href="https://www.gimp.org/">GIMP</a> 和 <a href="https://inkscape.org/">Inkscape</a> 分别用于照片编辑和交互式向量图形。</p>
<p>有时 <a href="https://imagemagick.org/Usage/">Imagemagick</a> 已经足够好了，它可以从命令行直接使用，从而自动编辑图片。同样 <a href="https://www.graphviz.org/">Graphviz</a> 和 <a href="https://sourceforge.net/projects/pgf/">TikZ</a> 可以用来绘制曲线图和其他图表。</p>
<h3>Web 浏览器</h3>
<p>对于 Web 浏览器，我一直在使用 <a href="https://www.mozilla.org/en-US/firefox/new/">Firefox</a>。相较于 Chrome，它的可扩展性更好，资源使用率更低。</p>
<p>不幸的是，在 Firefox 完全改用 Chrome 风格的扩展之后， <a href="https://github.com/5digits/dactyl">Pentadactyl</a> 扩展的开发就停止了，所以我的浏览器中再也没有令人满意的 Vim 类控件了。</p>
<h3>媒体播放器</h3>
<p>通过设置 <code>vo=gpu</code> 以及 <code>hwdec=vaapi</code>，具有硬件解码功能的 <a href="https://mpv.io/">mpv</a> 在播放期间 CPU 的占用率保持在 5%。相较于默认的 PulseAudio，mpv 中的 <code>audio-channels=2</code> 似乎可以使我的立体扬声器/耳机获得更清晰的降级混频。一个很棒的小功能是用 <code>Shift-Q</code> 退出，而不是只用 <code>Q</code> 来保存回放位置。当你与母语是其他语言的人一起看视频时，你可以使用 <code>--secondary-sid=</code> 同时显示两种字幕，主字幕位于底部，次字幕位于屏幕顶部。</p>
<p>我的无线鼠标可以简单地通过一个小的配置文件（ <code>~/.config/mpv/input.conf</code> ）实现远程控制 mpv ：</p>
<div class="highlight"><pre><span></span><code>MOUSE_BTN5 run &quot;mixer&quot; &quot;pcm&quot; &quot;-2&quot;
MOUSE_BTN6 run &quot;mixer&quot; &quot;pcm&quot; &quot;+2&quot;
MOUSE_BTN1 cycle sub-visibility
MOUSE_BTN7 add chapter -1
MOUSE_BTN8 add chapter 1
</code></pre></div>

<p><a href="https://rg3.github.io/youtube-dl/">youtube-dl</a> 非常适合观看在线托管的视频，使用 <code>-f bestvideo+bestaudio/best --all-subs --embed-subs</code> 命令可获得最高质量的视频。</p>
<p>作为音乐播放器， <a href="http://moc.daper.net/">MOC</a> 不再活跃开发，但它仍是一个简易的播放器，可以播放各种可能的格式，包括最不常用的 Chiptune 格式。在 AUR 中有一个 <a href="https://aur.archlinux.org/packages/moc-pulse/">补丁</a> 增加了 PulseAudio 支持。即使在 CPU 时钟频率降到 800 MHz， MOC 也只使用了单核 CPU 的 1-2% 。</p>
<p><img alt="moc" src="/data/attachment/album/202012/03/223920maaylcaooljjca3e.png"></p>
<p>我的音乐收藏夹保存在我的家庭服务器上，因此我可以从任何地方访问它。它使用 <a href="https://github.com/libfuse/sshfs">SSHFS</a> 挂载并自动安装在 <code>/etc/fstab/</code> 目录下：</p>
<div class="highlight"><pre><span></span><code><span class="n">root</span><span class="nv">@server</span><span class="err">:</span><span class="o">/</span><span class="n">media</span><span class="o">/</span><span class="n">media</span><span class="w"> </span><span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">media</span><span class="w"> </span><span class="n">fuse</span><span class="p">.</span><span class="n">sshfs</span><span class="w"> </span><span class="n">noauto</span><span class="p">,</span><span class="n">x</span><span class="o">-</span><span class="n">systemd</span><span class="p">.</span><span class="n">automount</span><span class="p">,</span><span class="n">idmap</span><span class="o">=</span><span class="k">user</span><span class="p">,</span><span class="n">IdentityFile</span><span class="o">=/</span><span class="n">root</span><span class="o">/</span><span class="p">.</span><span class="n">ssh</span><span class="o">/</span><span class="n">id_rsa</span><span class="p">,</span><span class="n">allow_other</span><span class="p">,</span><span class="n">reconnect</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="mi">0</span>
</code></pre></div>

<h3>跨平台构建</h3>
<p>除了 Linux 本身，它对于构建任何主流操作系统的软件包都很优秀！ 一开始，我使用 <a href="https://www.qemu.org/">QEMU</a> 与旧版 Debian、 Windows 以及 Mac OS X VM 一起构建这些平台。</p>
<p>现在我在旧版 Debian 发行版上转而使用 chroot （以获得最大的 Linux 兼容性），在 Windows 上使用 <a href="http://www.mingw.org/">MinGW</a> 进行交叉编译，在 Mac OS X 上则使用 <a href="https://github.com/tpoechtrager/osxcross">OSXCross</a>。</p>
<p>用于 <a href="https://github.com/ddnet/ddnet-scripts/blob/master/ddnet-release.sh">构建 DDNet</a> 的脚本以及 <a href="https://github.com/ddnet/ddnet-scripts/blob/master/ddnet-lib-update.sh">更新库构建的说明</a> 的脚本都基于这个。</p>
<h3>备份</h3>
<p>通常，我们都会忘记备份。即使这是最后一节，它也不应该成为事后诸葛。</p>
<p>十年前我写了 <a href="https://github.com/def-/rrb/blob/master/rrb">rrb</a> （反向 rsync 备份）重新封装了 <code>rsync</code> ，因此我只需要将备份服务器的 root SSH 权限授予正在备份的计算机。令人惊讶地是，尽管我一直在使用 rrb ，但它在过去十年里没有任何改变。</p>
<p>备份文件直接存储在文件系统中。使用硬链接实现增量备份（<code>--link-dest</code>）。一个简单的 <a href="https://github.com/def-/rrb/blob/master/config.example">配置</a> 定义了备份保存时间，默认为：</p>
<div class="highlight"><pre><span></span><code>KEEP_RULES=( \
   7  7 \ # One backup a day for the last 7 days
  31  8 \ # 8 more backups for the last month
 365 11 \ # 11 more backups for the last year
1825  4 \ # 4 more backups for the last 5 years
)
</code></pre></div>

<p>因为我的一些计算机没有静态 IP / DNS 但仍想使用 rrb 备份，那我会使用反向安全隧道（作为 systemd 服务）：</p>
<div class="highlight"><pre><span></span><code><span class="k">[Unit]</span>
<span class="na">Description</span><span class="o">=</span><span class="s">Reverse SSH Tunnel</span>
<span class="na">After</span><span class="o">=</span><span class="s">network.target</span>

<span class="k">[Service]</span>
<span class="na">ExecStart</span><span class="o">=</span><span class="s">/usr/bin/ssh -N -R 27276:localhost:22 -o &quot;ExitOnForwardFailure yes&quot; server</span>
<span class="na">KillMode</span><span class="o">=</span><span class="s">process</span>
<span class="na">Restart</span><span class="o">=</span><span class="s">always</span>

<span class="k">[Install]</span>
<span class="na">WantedBy</span><span class="o">=</span><span class="s">multi-user.target</span>
</code></pre></div>

<p>现在，隧道运行备份时，服务器可以通过 <code>ssh -p 27276 localhost</code> 命令或者使用 <code>.ssh/config</code> 到达服务器端。</p>
<div class="highlight"><pre><span></span><code>Host cr-remote
 HostName localhost
 Port 27276
</code></pre></div>

<p>在谈及 SSH 技巧时，有时由于某些中断的路由会很难访问到服务器。在那种情况下你可以借道其他服务器的 SSH 连接，以获得更好的路由。在这种情况下，你可能通过美国连接访问到我的中国服务器，而来自德国的不可靠连接可能需要几个周：</p>
<div class="highlight"><pre><span></span><code>Host chn.ddnet.tw
 ProxyCommand ssh -q usa.ddnet.tw nc -q0 chn.ddnet.tw 22
 Port 22
</code></pre></div>

<h3>结语</h3>
<p>感谢阅读我工具的收藏。这其中我也许遗漏了许多日常中自然成习惯的步骤。让我们来看看我的软件设置在下一年里能多稳定吧。如果你有任何问题，随时联系我 <a href="mailto:dennis@felsin9.de">dennis@felsin9.de</a> 。</p>
<p>在 <a href="https://news.ycombinator.com/item?id=18979731">Hacker News</a> 下评论吧。</p>
    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>links</h2>
                        <ul>
                            <li><a href="https://getpelican.com/">Pelican</a></li>
                            <li><a href="https://www.python.org/">Python.org</a></li>
                            <li><a href="https://palletsprojects.com/p/jinja/">Jinja2</a></li>
                            <li><a href="#">You can modify those links in your config file</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>

                            <li><a href="#">You can add links in your config file</a></li>
                            <li><a href="#">Another social link</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a rel="nofollow" href="https://getpelican.com/">Pelican</a>, which takes great advantage of <a rel="nofollow" href="https://www.python.org/">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a rel="nofollow" href="https://www.smashingmagazine.com/2009/08/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>