<!DOCTYPE html>
<html lang="zh">
<head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="generator" content="Pelican" />
        <title>了解一下 Fossil，一个 Git 的替代品</title>
        <link rel="stylesheet" href="/theme/css/main.css" />
        <meta name="description" content="Author: Klaatu Fossil 是一个集版本控制系统、bug 追踪、维基、论坛以及文档解决方案于一体的系统。 每个开发者都知道，追踪代码的修改是 …" />
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">linux_cn</a></h1>
                <nav><ul>
                    <li><a href="/category/chuan-shan-jia-zhuan-fang">穿山甲专访</a></li>
                    <li><a href="/category/dai-ma-ying-xiong">代码英雄</a></li>
                    <li><a href="/category/fen-xiang">分享</a></li>
                    <li><a href="/category/guan-dian">观点</a></li>
                    <li><a href="/category/huo-dong">活动</a></li>
                    <li><a href="/category/ji-ke-man-hua">极客漫画</a></li>
                    <li class="active"><a href="/category/ji-zhu">技术</a></li>
                    <li><a href="/category/kai-yuan-zhi-hui">开源智慧</a></li>
                    <li><a href="/category/linux-fa-xing-ban">Linux 发行版</a></li>
                    <li><a href="/category/mei-ri-an-quan-zi-xun">每日安全资讯</a></li>
                    <li><a href="/category/misc">Misc</a></li>
                    <li><a href="/category/qu-kuai-lian">区块链</a></li>
                    <li><a href="/category/rong-qi-yu-yun">容器与云</a></li>
                    <li><a href="/category/ruan-jian-kai-fa">软件开发</a></li>
                    <li><a href="/category/shu-mei-pai">树莓派</a></li>
                    <li><a href="/category/xi-tong-yun-wei">系统运维</a></li>
                    <li><a href="/category/xin-wen">新闻</a></li>
                    <li><a href="/category/ying-he-guan-cha">硬核观察</a></li>
                    <li><a href="/category/zhi-ye-sheng-ya">职业生涯</a></li>
                    <li><a href="/category/zhong-jiang-ming-dan">中奖名单</a></li>
                    <li><a href="/category/zhuo-mian-ying-yong">桌面应用</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="/2020/12/liao-jie-yi-xia-fossilyi-ge-git-de-ti-dai-pin.html" rel="bookmark"
           title="Permalink to 了解一下 Fossil，一个 Git 的替代品">了解一下 Fossil，一个 Git 的替代品</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2020-12-01T17:31:09+01:00">
                Published: Tue 01 December 2020
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/linux-fans-from-china.html">linux fans from china</a>
        </address>
<p>In <a href="/category/ji-zhu">技术</a>.</p>

</footer><!-- /.post-info -->      <p>Author: Klaatu</p>
<blockquote>
<p>Fossil 是一个集版本控制系统、bug 追踪、维基、论坛以及文档解决方案于一体的系统。</p>
</blockquote>
<p><img alt="" src="/data/attachment/album/202012/01/173057hfhyzyw921zll219.jpg"></p>
<p>每个开发者都知道，追踪代码的修改是至关重要的。有时候你会处于好奇或者教育的目的需要展示你的项目开始和进化的历史。有时候你想让其他的开发者参与到你的项目中，因此你需要一种值得信赖的能合并不同代码分支的方法。更极端一点，有时候你为了解决一个问题而修改的代码导致已有的功能不能正常使用。</p>
<p><a href="https://fossil-scm.org/home/doc/trunk/www/index.wiki">Fossil</a> 源码管理系统是由著名的 <a href="https://www.sqlite.org/index.html">SQLite</a> 数据库的作者开发的一个集版本控制系统、bug 追踪、维基、论坛以及文档解决方案于一体的系统。</p>
<h3>安装 Fossil</h3>
<p>Fossil 是一个独立的 C 程序，因此你可以从它的网站上<a href="https://fossil-scm.org/home/uv/download.html">下载</a>后放在环境变量 <a href="https://opensource.com/article/17/6/set-path-linux">PATH</a> 中的任意位置。例如，假定 <code>/usr/local/bin</code> 已经在你的环境变量中（默认情况下是在的）：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>wget<span class="w"> </span>https://fossil-scm.org/home/uv/fossil-linux-x64-X.Y.tar.gz
$<span class="w"> </span>sudo<span class="w"> </span>tar<span class="w"> </span>xvf<span class="w"> </span>fossil-linux-x64-X.Y.tar.gz<span class="w"> </span>--directory<span class="w"> </span>/usr/local/bin
</code></pre></div>

<p>你也可以通过包管理器从软件仓库中找到 Fossil，或者直接从源码编译。</p>
<h3>创建一个 Fossil 仓库</h3>
<p>如果你已经有一个代码项目，想用 Fossil 来追踪，那么第一步就是创建一个 Fossil 仓库：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>fossil<span class="w"> </span>init<span class="w"> </span>myproject.fossil
project-id:<span class="w"> </span>010836ac6112fefb0b015702152d447c8c1d8604
server-id:<span class="w">  </span>54d837e9dc938ba1caa56d31b99c35a4c9627f44
admin-user:<span class="w"> </span>klaatu<span class="w"> </span><span class="o">(</span>initial<span class="w"> </span>password<span class="w"> </span>is<span class="w"> </span><span class="s2">&quot;14b605&quot;</span><span class="o">)</span>
</code></pre></div>

<p>创建 Fossil 仓库的过程中会返回三行信息：一个唯一的项目 ID、一个唯一的服务器 ID 以及管理员 ID 和密码。项目 ID 和服务器 ID 是版本数字。管理员凭证表明你对这个仓库的所有权，当你把 Fossil 作为服务器让其他用户来访问时可以使用管理员权限。</p>
<h3>Fossil 仓库工作流</h3>
<p>在你使用 Fossil 仓库之前，你需要先为它的数据创建一个工作路径。你可以把这个过程类比为使用 Python 时创建一个虚拟环境或者解压一个只用来备份的 ZIP 文件。</p>
<p>创建一个工作目录并进入：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>mkdir<span class="w"> </span>myprojectdir
$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>myprojectdir
</code></pre></div>

<p>把你的 Fossil 打开到刚刚创建的目录：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>fossil<span class="w"> </span>open<span class="w"> </span>../myproject
project-name:<span class="w"> </span>&lt;unnamed&gt;
repository:<span class="w">   </span>/home/klaatu/myprojectdir/../myproject
local-root:<span class="w">   </span>/home/klaatu/myprojectdir/
config-db:<span class="w">    </span>/home/klaatu/.fossil
project-code:<span class="w"> </span>010836ac6112fefb0b015702152d447c8c1d8604
checkout:<span class="w">     </span>9e6cd96dd675544c58a246520ad58cdd460d1559<span class="w"> </span><span class="m">2020</span>-11-09<span class="w"> </span><span class="m">04</span>:09:35<span class="w"> </span>UTC
tags:<span class="w">         </span>trunk
comment:<span class="w">      </span>initial<span class="w"> </span>empty<span class="w"> </span>check-in<span class="w"> </span><span class="o">(</span>user:<span class="w"> </span>klaatu<span class="o">)</span>
check-ins:<span class="w">    </span><span class="m">1</span>
</code></pre></div>

<p>你可能注意到了，Fossil 在你的家目录下创建了一个名为 <code>.fossil</code> 的隐藏文件，用来追踪你的全局 Fossil 配置。这个配置不是只适用于你的一个项目的；这个文件只会在你第一次使用 Fossil 时生成。</p>
<h4>添加文件</h4>
<p>使用 <code>add</code> 和 <code>commit</code> 子命令来向你的仓库添加文件。例如，创建一个简单的 <code>README</code> 文件，把它添加到仓库：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;My first Fossil project&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>README
$<span class="w"> </span>fossil<span class="w"> </span>add<span class="w"> </span>README
ADDED<span class="w">  </span>README
$<span class="w"> </span>fossil<span class="w"> </span>commit<span class="w"> </span>-m<span class="w"> </span><span class="s1">&#39;My first commit&#39;</span>
New_Version:<span class="w"> </span>2472a43acd11c93d08314e852dedfc6a476403695e44f47061607e4e90ad01aa
</code></pre></div>

<h4>使用分支</h4>
<p>Fossil 仓库开始时默认使用的主分支名为 <code>trunk</code>。当你想修改代码而又不影响主干代码时，你可以从 trunk 分支切走。创建新分支需要使用 <code>branch</code> 子命令，这个命令需要两个参数：一个新分支的名字，一个新分支的基分支名字。在本例中，只有一个分支 <code>trunk</code>，因此尝试创建一个名为 <code>dev</code> 的新分支：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>fossil<span class="w"> </span>branch<span class="w"> </span>--help
Usage:<span class="w"> </span>fossil<span class="w"> </span>branch<span class="w"> </span>new<span class="w"> </span>BRANCH-NAME<span class="w"> </span>BASIS<span class="w"> </span>?OPTIONS?
$<span class="w"> </span>fossil<span class="w"> </span>branch<span class="w"> </span>new<span class="w"> </span>dev<span class="w"> </span>trunk
New<span class="w"> </span>branch:<span class="w"> </span>cb90e9c6f23a9c98e0c3656d7e18d320fa52e666700b12b5ebbc4674a0703695
</code></pre></div>

<p>你已经创建了一个新分支，但是你当前所在的分支仍然是 <code>trunk</code>：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>fossil<span class="w"> </span>branch<span class="w"> </span>current
trunk
</code></pre></div>

<p>使用 <code>checkout</code> 命令切换到你的新分支 <code>dev</code>：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>fossil<span class="w"> </span>checkout<span class="w"> </span>dev
dev
</code></pre></div>

<h4>合并修改</h4>
<p>假设你在 <code>dev</code> 分支中添加了一个新文件，完成了测试，现在想把它合并到 <code>trunk</code>。这个过程叫做<em>合并</em>。</p>
<p>首先，切回目标分支（本例中目标分支为 <code>trunk</code>）：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>fossil<span class="w"> </span>checkout<span class="w"> </span>trunk
trunk
$<span class="w"> </span>ls
README
</code></pre></div>

<p>这个分支中没有你的新文件（或者你对其他文件的修改），而那些内容是合并的过程需要的信息：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>fossil<span class="w"> </span>merge<span class="w"> </span>dev
<span class="w"> </span><span class="s2">&quot;fossil undo&quot;</span><span class="w"> </span>is<span class="w"> </span>available<span class="w"> </span>to<span class="w"> </span>undo<span class="w"> </span>changes<span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span>working<span class="w"> </span>checkout.
$<span class="w"> </span>ls
myfile.lua<span class="w">  </span>README
</code></pre></div>

<h3>查看 Fossil 时间线</h3>
<p>使用 <code>timeline</code> 选项来查看仓库的历史。这个命令列出了你的仓库的所有活动的详细信息，包括用来表示每次修改的哈希值、每次提交时填写的信息以及提交者：</p>
<div class="highlight"><pre><span></span><code><span class="err">$</span><span class="w"> </span><span class="n">fossil</span><span class="w"> </span><span class="n">timeline</span>
<span class="o">===</span><span class="w"> </span><span class="mi">2020</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">09</span><span class="w"> </span><span class="o">===</span>
<span class="mi">06</span><span class="err">:</span><span class="mi">24</span><span class="err">:</span><span class="mi">16</span><span class="w"> </span><span class="o">[</span><span class="n">5ef06e668b</span><span class="o">]</span><span class="w"> </span><span class="n">added</span><span class="w"> </span><span class="n">exciting</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="k">file</span><span class="w"> </span><span class="p">(</span><span class="k">user</span><span class="err">:</span><span class="w"> </span><span class="n">klaatu</span><span class="w"> </span><span class="nl">tags</span><span class="p">:</span><span class="w"> </span><span class="n">dev</span><span class="p">)</span>
<span class="mi">06</span><span class="err">:</span><span class="mi">11</span><span class="err">:</span><span class="mi">19</span><span class="w"> </span><span class="o">[</span><span class="n">cb90e9c6f2</span><span class="o">]</span><span class="w"> </span><span class="k">Create</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">branch</span><span class="w"> </span><span class="n">named</span><span class="w"> </span><span class="ss">&quot;dev&quot;</span><span class="w"> </span><span class="p">(</span><span class="k">user</span><span class="err">:</span><span class="w"> </span><span class="n">klaatu</span><span class="w"> </span><span class="nl">tags</span><span class="p">:</span><span class="w"> </span><span class="n">dev</span><span class="p">)</span>
<span class="mi">06</span><span class="err">:</span><span class="mi">08</span><span class="err">:</span><span class="mi">09</span><span class="w"> </span><span class="o">[</span><span class="n">a2bb73e4a3</span><span class="o">]</span><span class="w"> </span><span class="o">*</span><span class="k">CURRENT</span><span class="o">*</span><span class="w"> </span><span class="ow">some</span><span class="w"> </span><span class="n">additions</span><span class="w"> </span><span class="n">were</span><span class="w"> </span><span class="n">made</span><span class="w"> </span><span class="p">(</span><span class="k">user</span><span class="err">:</span><span class="w"> </span><span class="n">klaatu</span><span class="w"> </span><span class="nl">tags</span><span class="p">:</span><span class="w"> </span><span class="n">trunk</span><span class="p">)</span>
<span class="mi">06</span><span class="err">:</span><span class="mi">00</span><span class="err">:</span><span class="mi">47</span><span class="w"> </span><span class="o">[</span><span class="n">2472a43acd</span><span class="o">]</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">my</span><span class="w"> </span><span class="k">first</span><span class="w"> </span><span class="k">commit</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="k">user</span><span class="err">:</span><span class="w"> </span><span class="n">klaatu</span><span class="w"> </span><span class="nl">tags</span><span class="p">:</span><span class="w"> </span><span class="n">trunk</span><span class="p">)</span>
<span class="mi">04</span><span class="err">:</span><span class="mi">09</span><span class="err">:</span><span class="mi">35</span><span class="w"> </span><span class="o">[</span><span class="n">9e6cd96dd6</span><span class="o">]</span><span class="w"> </span><span class="n">initial</span><span class="w"> </span><span class="n">empty</span><span class="w"> </span><span class="k">check</span><span class="o">-</span><span class="ow">in</span><span class="w"> </span><span class="p">(</span><span class="k">user</span><span class="err">:</span><span class="w"> </span><span class="n">klaatu</span><span class="w"> </span><span class="nl">tags</span><span class="p">:</span><span class="w"> </span><span class="n">trunk</span><span class="p">)</span>
<span class="o">+++</span><span class="w"> </span><span class="k">no</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="k">data</span><span class="w"> </span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="o">+++</span>
</code></pre></div>

<p><img alt="Fossil UI" src="/data/attachment/album/202012/01/173115xvph5vnm6mhhnhnc.jpg" title="Fossil UI"></p>
<h3>公开你的 Fossil 仓库</h3>
<p>因为 Fossil 有个内置的 web 界面，所以 Fossil 不像 GitLab 和 Gitea 那样需要主机服务。Fossil 就是它自己的主机服务，只要你把它放在一台机器上就行了。在你公开你的 Fossil 仓库之前，你还需要通过 web 用户界面（UI）来配置一些信息：</p>
<p>使用 <code>ui</code> 子命令启动一个本地的实例：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span><span class="nb">pwd</span>
/home/klaatu/myprojectdir/
$<span class="w"> </span>fossil<span class="w"> </span>ui
</code></pre></div>

<p>“Users” 和 “Settings” 是安全相关的，“Configuration” 是项目属性相关的（包括一个合适的标题）。web 界面不仅仅是一个方便的功能。 它是能在生产环境中使用并作为 Fossil 项目的宿主机来使用的。它还有一些其他的高级选项，比如用户管理（或者叫自我管理）、在同一个服务器上与其他的 Fossil 仓库进行单点登录（SSO）。</p>
<p>当配置完成后，关掉 web 界面并按下 <code>Ctrl+C</code> 来停止 UI 引擎。像提交代码一样提交你的 web 修改。</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>fossil<span class="w"> </span>commit<span class="w"> </span>-m<span class="w"> </span><span class="s1">&#39;web ui updates&#39;</span>
New_Version:<span class="w"> </span>11fe7f2855a3246c303df00ec725d0fca526fa0b83fa67c95db92283e8273c60
</code></pre></div>

<p>现在你可以配置你的 Fossil 服务器了。</p>
<ol>
<li>把你的 Fossil 仓库（本例中是 <code>myproject.fossil</code>）复制到服务器，你只需要这一个文件。</li>
<li>如果你的服务器没有安装 Fossil，就在你的服务器上安装 Fossil。在服务器上安装的过程跟在本地一样。</li>
<li>在你的 <code>cgi-bin</code> 目录下（或它对应的目录，这取决于你的 HTTP 守护进程）创建一个名为 <code>repo_myproject.cgi</code> 的文件：</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="gh">#</span>!/usr/local/bin/fossil
repository: /home/klaatu/public_html/myproject.fossil
</code></pre></div>

<p>添加可执行权限：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>chmod<span class="w"> </span>+x<span class="w"> </span>repo_myproject.cgi
</code></pre></div>

<p>你需要做的都已经做完了。现在可以通过互联网访问你的项目了。</p>
<p>你可以通过 CGI 脚本来访问 web UI，例如 <code>https://example.com/cgi-bin/repo_myproject.cgi</code>。</p>
<p>你也可以通过命令行来进行交互：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>fossil<span class="w"> </span>clone<span class="w"> </span>https://klaatu@example.com/cgi-bin/repo_myproject.cgi
</code></pre></div>

<p>在本地的克隆仓库中工作时，你需要使用 <code>push</code> 子命令把本地的修改推送到远程的仓库，使用 <code>pull</code> 子命令把远程的修改拉取到本地仓库：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>fossil<span class="w"> </span>push<span class="w"> </span>https://klaatu@example.com/cgi-bin/repo_myproject.cgi
</code></pre></div>

<h3>使用 Fossil 作为独立的托管</h3>
<p>Fossil 将大量的权力交到了你的手中（以及你的合作者的手中），让你不再依赖托管服务。本文只是简单的介绍了基本概念。你的代码项目还会用到很多有用的 Fossil 功能。尝试一下 Fossil。它不仅会改变你对版本控制的理解；它会让你不再考虑其他的版本控制系统。</p>
    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>links</h2>
                        <ul>
                            <li><a href="https://getpelican.com/">Pelican</a></li>
                            <li><a href="https://www.python.org/">Python.org</a></li>
                            <li><a href="https://palletsprojects.com/p/jinja/">Jinja2</a></li>
                            <li><a href="#">You can modify those links in your config file</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>

                            <li><a href="#">You can add links in your config file</a></li>
                            <li><a href="#">Another social link</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a rel="nofollow" href="https://getpelican.com/">Pelican</a>, which takes great advantage of <a rel="nofollow" href="https://www.python.org/">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a rel="nofollow" href="https://www.smashingmagazine.com/2009/08/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>