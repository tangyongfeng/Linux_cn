<!DOCTYPE html>
<html lang="zh">
<head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="generator" content="Pelican" />
        <title>初次登录 Linux 服务器马上要做的 9 件事</title>
        <link rel="stylesheet" href="/theme/css/main.css" />
        <meta name="description" content="Author: Gaurav Kamathe 在将新配置的服务器投入工作之前，请确保你知道你正在使用什么。 当我在 Linux 上测试软件时（这是我工作中的一个 …" />
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">linux_cn</a></h1>
                <nav><ul>
                    <li><a href="/category/chuan-shan-jia-zhuan-fang">穿山甲专访</a></li>
                    <li><a href="/category/dai-ma-ying-xiong">代码英雄</a></li>
                    <li><a href="/category/fen-xiang">分享</a></li>
                    <li><a href="/category/guan-dian">观点</a></li>
                    <li><a href="/category/huo-dong">活动</a></li>
                    <li><a href="/category/ji-ke-man-hua">极客漫画</a></li>
                    <li><a href="/category/ji-zhu">技术</a></li>
                    <li><a href="/category/kai-yuan-zhi-hui">开源智慧</a></li>
                    <li><a href="/category/linux-fa-xing-ban">Linux 发行版</a></li>
                    <li><a href="/category/mei-ri-an-quan-zi-xun">每日安全资讯</a></li>
                    <li><a href="/category/misc">Misc</a></li>
                    <li><a href="/category/qu-kuai-lian">区块链</a></li>
                    <li><a href="/category/rong-qi-yu-yun">容器与云</a></li>
                    <li><a href="/category/ruan-jian-kai-fa">软件开发</a></li>
                    <li><a href="/category/shu-mei-pai">树莓派</a></li>
                    <li class="active"><a href="/category/xi-tong-yun-wei">系统运维</a></li>
                    <li><a href="/category/xin-wen">新闻</a></li>
                    <li><a href="/category/ying-he-guan-cha">硬核观察</a></li>
                    <li><a href="/category/zhi-ye-sheng-ya">职业生涯</a></li>
                    <li><a href="/category/zhong-jiang-ming-dan">中奖名单</a></li>
                    <li><a href="/category/zhuo-mian-ying-yong">桌面应用</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="/2020/12/chu-ci-deng-lu-linux-fu-wu-qi-ma-shang-yao-zuo-de-9-jian-shi.html" rel="bookmark"
           title="Permalink to 初次登录 Linux 服务器马上要做的 9 件事">初次登录 Linux 服务器马上要做的 9 件事</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2020-12-27T11:21:06+01:00">
                Published: Sun 27 December 2020
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/linux-fans-from-china.html">linux fans from china</a>
        </address>
<p>In <a href="/category/xi-tong-yun-wei">系统运维</a>.</p>

</footer><!-- /.post-info -->      <p>Author: Gaurav Kamathe</p>
<blockquote>
<p>在将新配置的服务器投入工作之前，请确保你知道你正在使用什么。</p>
</blockquote>
<p><img alt="" src="/data/attachment/album/202012/27/112042zuz1lpudkypeppeu.jpg"></p>
<p>当我在 Linux 上测试软件时（这是我工作中的一个常规部分），我需要使用多台运行 Linux 的不同架构的服务器。我整备机器，安装所需的软件包，运行我的测试，收集结果，并将机器返回到仓库中，以便其他人可以使用它进行测试。</p>
<p>由于我经常这样做（甚至一天多次），我初次登录 Linux 服务器的前 10 分钟内的工作已经成为每天的仪式。当我初次登录 Linux 服务器时，我会使用命令来收集我需要的信息来寻找某些东西。我将在本文中介绍我的过程，但请注意，在大多数情况下，我只给出命令名称，所以你需要确定这些命令的具体选项，以获得你需要的信息。阅读命令的手册页是一个很好的起点。</p>
<h3>1、第一次接触</h3>
<p>当我登录到一台服务器时，我做的第一件事就是检查它是否拥有我将要运行的测试所需的操作系统、内核和硬件架构。我经常会检查一台服务器已经运行了多久。虽然这对测试系统来说并不重要，因为它会被多次重启，但我还是发现这些信息很有帮助。</p>
<p>使用下面的命令来获取这些信息。我主要使用 Red Hat Linux 进行测试，所以如果你使用其他 Linux 发行版，请在文件名中使用 <code>*-release</code> 而不是 <code>redhat-release</code>：</p>
<div class="highlight"><pre><span></span><code><span class="nv">cat</span><span class="w"> </span><span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">redhat</span><span class="o">-</span><span class="nv">release</span>
<span class="nv">uname</span><span class="w"> </span><span class="o">-</span><span class="nv">a</span>
<span class="nv">hostnamectl</span>
<span class="k">uptime</span>
</code></pre></div>

<h3>2、有人登录在上面吗？</h3>
<p>一旦我知道这台机器符合我的测试需求，我需要确保没有其他人同时登录该系统运行他们自己的测试。虽然考虑到整备系统会帮我处理好这个问题，这种可能性很小，但偶尔检查一下还是有好处的 —— 尤其是当我第一次登录服务器的时候。我还会检查是否有其他用户（除了 root）可以访问系统。</p>
<p>使用下面的命令来查找这些信息。最后一条命令是查找 <code>/etc/passwd</code> 文件中具有 shell 访问权限的用户；它会跳过文件中没有 shell 访问权限或 shell 设置为 <code>nologin</code> 的其他服务：</p>
<div class="highlight"><pre><span></span><code>who
who -Hu
grep sh$ /etc/passwd
</code></pre></div>

<h3>3、物理机还是虚拟机</h3>
<p>现在我有了属于自己的机器，我需要确定它是一台物理机还是一台虚拟机（VM）。如果是我自己整备的这台机器，我可以确定这是我要求的东西。但是，如果你使用的是一台不是你自己整备的机器，你应该检查该机器是物理机还是虚拟机。</p>
<p>使用以下命令来识别这些信息。如果是物理系统，你会看到供应商的名称（如 HP、IBM 等）以及服务器的品牌和型号；而在虚拟机中，你应该看到 KVM、VirtualBox 等，这取决于创建虚拟机时使用了什么虚拟化软件：</p>
<div class="highlight"><pre><span></span><code>dmidecode -s system-manufacturer
dmidecode -s system-product-name
lshw -c system | grep product | head -1
cat /sys/class/dmi/id/product_name
cat /sys/class/dmi/id/sys_vendor
</code></pre></div>

<h3>4、硬件</h3>
<p>因为我经常测试连接到 Linux 机器的硬件，所以我通常使用物理服务器，而不是虚拟机。在物理机器上，我的下一步是确定服务器的硬件能力 —— 例如，运行的是什么类型的 CPU，它有多少个核心，启用了哪些标志，以及有多少内存可用于运行测试。如果我正在运行网络测试，我会检查连接到服务器的以太网或其他网络设备的类型和容量。</p>
<p>使用以下命令来显示连接到 Linux 服务器的硬件。其中一些命令在新的操作系统版本中可能会被废弃，但你仍然可以从 yum 存储库中安装它们或切换到它们的等效新命令：</p>
<div class="highlight"><pre><span></span><code><span class="n">lscpu</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="n">cat</span><span class="w"> </span><span class="o">/</span><span class="n">proc</span><span class="o">/</span><span class="n">cpuinfo</span>
<span class="n">lsmem</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="n">cat</span><span class="w"> </span><span class="o">/</span><span class="n">proc</span><span class="o">/</span><span class="n">meminfo</span>
<span class="n">ifconfig</span><span class="w"> </span><span class="o">-</span><span class="n">a</span>
<span class="n">ethtool</span><span class="w"> </span><span class="o">&lt;</span><span class="n">devname</span><span class="o">&gt;</span>
<span class="n">lshw</span>
<span class="n">lspci</span>
<span class="n">dmidecode</span>
</code></pre></div>

<h3>5、已安装的软件</h3>
<p>测试软件总是需要安装额外的依赖包、库等。然而，在安装任何东西之前，我都会检查已经安装了什么（包括是什么版本），以及配置了哪些存储库，这样我就知道软件来自哪里，并可以调试任何软件包安装问题。</p>
<p>使用下面的命令来确定安装了什么软件：</p>
<div class="highlight"><pre><span></span><code>rpm -qa
rpm -qa | grep &lt;pkgname&gt;
rpm -qi &lt;pkgname&gt;
yum repolist
yum repoinfo
yum install &lt;pkgname&gt;
ls -l /etc/yum.repos.d/
</code></pre></div>

<h3>6、运行的进程和服务</h3>
<p>检查了安装的软件之后，自然就会检查系统上有哪些进程在运行。当在系统上运行性能测试时，这一点至关重要 —— 如果一个正在运行的进程、守护进程、测试软件等占用了大部分 CPU/RAM，那么在运行测试之前停止该进程是有意义的。这也可以检查测试所需的进程或守护进程是否已经启动并运行。例如，如果测试需要 <code>httpd</code> 运行，那么即使安装了软件包，启动守护进程的服务也可能没有运行。</p>
<p>使用以下命令来识别系统上正在运行的进程和已启用的服务：</p>
<div class="highlight"><pre><span></span><code>pstree -pa 1
ps -ef
ps auxf
systemctl
</code></pre></div>

<h3>7、网络连接</h3>
<p>如今的机器网络化程度很高，它们需要与网络上的其他机器或服务进行通信。我会识别服务器上哪些端口是开放的，是否有到测试机器的任何网络连接，是否启用了防火墙，如果启用了，是否屏蔽了任何端口，以及机器与哪些 DNS 服务器对话。</p>
<p>使用以下命令来识别网络服务相关信息。如果一个过时的命令不可用，请从 yum 存储库中安装它或使用等效的新命令：</p>
<div class="highlight"><pre><span></span><code>netstat -tulpn
netstat -anp
lsof -i
ss
iptables -L -n
cat /etc/resolv.conf
</code></pre></div>

<h3>8、内核</h3>
<p>在进行系统测试时，我发现了解内核相关的信息是很有帮助的，比如内核版本和加载了哪些内核模块。我还会列出任何<a href="https://www.oreilly.com/library/view/red-hat-enterprise/9781785283550/ch10s05.html">可调整的内核参数</a>以及它们的设置，并检查启动运行中的内核时使用的选项。</p>
<p>使用以下命令来识别这些信息：</p>
<div class="highlight"><pre><span></span><code>uname -r
cat /proc/cmdline
lsmod
modinfo &lt;module&gt;
sysctl -a
cat /boot/grub2/grub.cfg
</code></pre></div>

<h3>9、日志</h3>
<p>现在，我已经对服务器有了很好的了解，包括安装了哪些软件，运行了哪些进程。还有一件事我无法逃避，那就是日志文件 —— 我需要知道在哪里可以查看不断更新的信息。</p>
<p>使用以下命令查看系统的日志：</p>
<div class="highlight"><pre><span></span><code><span class="n">dmesg</span>
<span class="n">tail</span><span class="w"> </span><span class="o">-</span><span class="n">f</span><span class="w"> </span><span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="nb">log</span><span class="o">/</span><span class="n">messages</span>
<span class="n">journalctl</span>
</code></pre></div>

<h3>接下来的步骤</h3>
<p>虽然命令和实用程序会发生变化，但它们所显示的基本信息大致不变。在你专注于掌握哪些命令之前，你需要对你要寻找的信息以及它属于什么类别有一个宏观的看法。</p>
<p>由于 Linux 将大部分信息保存在文件中，这些命令基本上是从文件中读取信息，并以一种易于理解的方式呈现出来。下一步的好做法是找出每个命令用来获取信息显示的文件。一个提示：寻找这些信息的方法是 <code>strace</code> 命令。</p>
    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>links</h2>
                        <ul>
                            <li><a href="https://getpelican.com/">Pelican</a></li>
                            <li><a href="https://www.python.org/">Python.org</a></li>
                            <li><a href="https://palletsprojects.com/p/jinja/">Jinja2</a></li>
                            <li><a href="#">You can modify those links in your config file</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>

                            <li><a href="#">You can add links in your config file</a></li>
                            <li><a href="#">Another social link</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a rel="nofollow" href="https://getpelican.com/">Pelican</a>, which takes great advantage of <a rel="nofollow" href="https://www.python.org/">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a rel="nofollow" href="https://www.smashingmagazine.com/2009/08/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>