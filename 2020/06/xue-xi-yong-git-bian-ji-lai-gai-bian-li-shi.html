<!DOCTYPE html>
<html lang="zh">
<head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="generator" content="Pelican" />
        <title>学习用 Git 变基来改变历史！</title>
        <link rel="stylesheet" href="/theme/css/main.css" />
        <meta name="description" content="Author: Git-rebase Git 核心的附加价值之一就是编辑历史记录的能力。与将历史记录视为神圣的记录的版本控制系统不同，在 Git 中，我们 …" />
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">linux_cn</a></h1>
                <nav><ul>
                    <li><a href="/category/chuan-shan-jia-zhuan-fang">穿山甲专访</a></li>
                    <li><a href="/category/dai-ma-ying-xiong">代码英雄</a></li>
                    <li><a href="/category/fen-xiang">分享</a></li>
                    <li><a href="/category/guan-dian">观点</a></li>
                    <li><a href="/category/huo-dong">活动</a></li>
                    <li><a href="/category/ji-ke-man-hua">极客漫画</a></li>
                    <li><a href="/category/ji-zhu">技术</a></li>
                    <li><a href="/category/kai-yuan-zhi-hui">开源智慧</a></li>
                    <li><a href="/category/linux-fa-xing-ban">Linux 发行版</a></li>
                    <li><a href="/category/mei-ri-an-quan-zi-xun">每日安全资讯</a></li>
                    <li><a href="/category/misc">Misc</a></li>
                    <li><a href="/category/qu-kuai-lian">区块链</a></li>
                    <li><a href="/category/rong-qi-yu-yun">容器与云</a></li>
                    <li class="active"><a href="/category/ruan-jian-kai-fa">软件开发</a></li>
                    <li><a href="/category/shu-mei-pai">树莓派</a></li>
                    <li><a href="/category/xi-tong-yun-wei">系统运维</a></li>
                    <li><a href="/category/xin-wen">新闻</a></li>
                    <li><a href="/category/ying-he-guan-cha">硬核观察</a></li>
                    <li><a href="/category/zhi-ye-sheng-ya">职业生涯</a></li>
                    <li><a href="/category/zhong-jiang-ming-dan">中奖名单</a></li>
                    <li><a href="/category/zhuo-mian-ying-yong">桌面应用</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="/2020/06/xue-xi-yong-git-bian-ji-lai-gai-bian-li-shi.html" rel="bookmark"
           title="Permalink to 学习用 Git 变基来改变历史！">学习用 Git 变基来改变历史！</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2020-06-01T17:40:09+02:00">
                Published: Mon 01 June 2020
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/linux-fans-from-china.html">linux fans from china</a>
        </address>
<p>In <a href="/category/ruan-jian-kai-fa">软件开发</a>.</p>

</footer><!-- /.post-info -->      <p>Author: Git-rebase</p>
<p><img alt="" src="/data/attachment/album/202006/01/173829c2e9c5e33galha2l.jpg"></p>
<p><a href="https://git-scm.com/">Git</a> 核心的附加价值之一就是编辑历史记录的能力。与将历史记录视为神圣的记录的版本控制系统不同，在 Git 中，我们可以修改历史记录以适应我们的需要。这为我们提供了很多强大的工具，让我们可以像使用重构来维护良好的软件设计实践一样，编织良好的提交历史。这些工具对于新手甚至是有经验的 Git 用户来说可能会有些令人生畏，但本指南将帮助我们揭开强大的 git-rebase 的神秘面纱。</p>
<blockquote>
<p>值得注意的是：一般建议不要修改公共分支、共享分支或稳定分支的历史记录。编辑特性分支和个人分支的历史记录是可以的，编辑还没有推送的提交也是可以的。在编辑完提交后，可以使用 <code>git push -f</code> 来强制推送你的修改到个人分支或特性分支。</p>
</blockquote>
<p>尽管有这么可怕的警告，但值得一提的是，本指南中提到的一切都是非破坏性操作。实际上，在 Git 中永久丢失数据是相当困难的。本指南结尾介绍了在犯错误时进行纠正的方法。</p>
<h3>设置沙盒</h3>
<p>我们不想破坏你的任何实际的版本库，所以在整个指南中，我们将使用一个沙盒版本库。运行这些命令来开始工作。<sup id="fnref1"> <a href="#fn1" rel="footnote">  1 </a></sup></p>
<div class="highlight"><pre><span></span><code>git init /tmp/rebase-sandbox
cd /tmp/rebase-sandbox
git commit --allow-empty -m&quot;Initial commit&quot;
</code></pre></div>

<p>如果你遇到麻烦，只需运行 <code>rm -rf /tmp/rebase-sandbox</code>，并重新运行这些步骤即可重新开始。本指南的每一步都可以在新的沙箱上运行，所以没有必要重做每个任务。</p>
<h3>修正最近的提交</h3>
<p>让我们从简单的事情开始：修复你最近的提交。让我们向沙盒中添加一个文件，并犯个错误。</p>
<div class="highlight"><pre><span></span><code>echo &quot;Hello wrold!&quot; &gt;greeting.txt
git add greeting.txt
git commit -m&quot;Add greeting.txt&quot;
</code></pre></div>

<p>修复这个错误是非常容易的。我们只需要编辑文件，然后用 <code>--amend</code> 提交就可以了，就像这样：</p>
<div class="highlight"><pre><span></span><code>echo &quot;Hello world!&quot; &gt;greeting.txt
git commit -a --amend
</code></pre></div>

<p>指定 <code>-a</code> 会自动将所有 Git 已经知道的文件进行暂存（例如 Git 添加的），而 <code>--amend</code> 会将更改的内容压扁到最近的提交中。保存并退出你的编辑器（如果需要，你现在可以修改提交信息）。你可以通过运行 <code>git show</code> 看到修复的提交。</p>
<div class="highlight"><pre><span></span><code><span class="n">commit</span><span class="w"> </span><span class="n">f5f19fbf6d35b2db37dcac3a55289ff9602e4d00</span><span class="w"> </span><span class="p">(</span><span class="n">HEAD</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">master</span><span class="p">)</span>
<span class="n">Author</span><span class="o">:</span><span class="w"> </span><span class="n">Drew</span><span class="w"> </span><span class="n">DeVault</span><span class="w"> </span>
<span class="n">Date</span><span class="o">:</span><span class="w">   </span><span class="n">Sun</span><span class="w"> </span><span class="n">Apr</span><span class="w"> </span><span class="mi">28</span><span class="w"> </span><span class="mi">11</span><span class="o">:</span><span class="mi">09</span><span class="o">:</span><span class="mi">47</span><span class="w"> </span><span class="mi">2019</span><span class="w"> </span><span class="o">-</span><span class="mo">0400</span>

<span class="w">    </span><span class="n">Add</span><span class="w"> </span><span class="n">greeting</span><span class="p">.</span><span class="n">txt</span>

<span class="n">diff</span><span class="w"> </span><span class="o">--</span><span class="n">git</span><span class="w"> </span><span class="n">a</span><span class="o">/</span><span class="n">greeting</span><span class="p">.</span><span class="n">txt</span><span class="w"> </span><span class="n">b</span><span class="o">/</span><span class="n">greeting</span><span class="p">.</span><span class="n">txt</span>
<span class="n">new</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">mode</span><span class="w"> </span><span class="mi">100644</span>
<span class="nf">index</span><span class="w"> </span><span class="mf">0000000.</span><span class="p">.</span><span class="n">cd08755</span>
<span class="o">---</span><span class="w"> </span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span>
<span class="o">+++</span><span class="w"> </span><span class="n">b</span><span class="o">/</span><span class="n">greeting</span><span class="p">.</span><span class="n">txt</span>
<span class="err">@@</span><span class="w"> </span><span class="o">-</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="w"> </span><span class="o">+</span><span class="mi">1</span><span class="w"> </span><span class="err">@@</span>
<span class="o">+</span><span class="n">Hello</span><span class="w"> </span><span class="n">world</span><span class="o">!</span>
</code></pre></div>

<h3>修复较旧的提交</h3>
<p><code>--amend</code> 仅适用于最近的提交。如果你需要修正一个较旧的提交会怎么样？让我们从相应地设置沙盒开始：</p>
<div class="highlight"><pre><span></span><code>echo &quot;Hello!&quot; &gt;greeting.txt
git add greeting.txt
git commit -m&quot;Add greeting.txt&quot;

echo &quot;Goodbye world!&quot; &gt;farewell.txt
git add farewell.txt
git commit -m&quot;Add farewell.txt&quot;
</code></pre></div>

<p>看起来 <code>greeting.txt</code> 像是丢失了 <code>"world"</code>。让我们正常地写个提交来解决这个问题：</p>
<div class="highlight"><pre><span></span><code>echo &quot;Hello world!&quot; &gt;greeting.txt
git commit -a -m&quot;fixup greeting.txt&quot;
</code></pre></div>

<p>现在文件看起来正确，但是我们的历史记录可以更好一点 —— 让我们使用新的提交来“修复”（<code>fixup</code>）最后一个提交。为此，我们需要引入一个新工具：交互式变基。我们将以这种方式编辑最后三个提交，因此我们将运行 <code>git rebase -i HEAD~3</code>（<code>-i</code> 代表交互式）。这样会打开文本编辑器，如下所示：</p>
<div class="highlight"><pre><span></span><code>pick 8d3fc77 Add greeting.txt
pick 2a73a77 Add farewell.txt
pick 0b9d0bb fixup greeting.txt

# Rebase f5f19fb..0b9d0bb onto f5f19fb (3 commands)
#
# Commands:
# p, pick &lt;commit&gt; = use commit
# f, fixup &lt;commit&gt; = like &quot;squash&quot;, but discard this commit&#39;s log message
</code></pre></div>

<p>这是变基计划，通过编辑此文件，你可以指导 Git 如何编辑历史记录。我已经将该摘要削减为仅与变基计划这一部分相关的细节，但是你可以在文本编辑器中浏览完整的摘要。</p>
<p>当我们保存并关闭编辑器时，Git 将从其历史记录中删除所有这些提交，然后一次执行一行。默认情况下，它将选取（<code>pick</code>）每个提交，将其从堆中召唤出来并添加到分支中。如果我们对此文件根本没有做任何编辑，则将直接回到起点，按原样选取每个提交。现在，我们将使用我最喜欢的功能之一：修复（<code>fixup</code>）。编辑第三行，将操作从 <code>pick</code> 更改为 <code>fixup</code>，并将其立即移至我们要“修复”的提交之后：</p>
<div class="highlight"><pre><span></span><code>pick 8d3fc77 Add greeting.txt
fixup 0b9d0bb fixup greeting.txt
pick 2a73a77 Add farewell.txt
</code></pre></div>

<blockquote>
<p><strong>技巧</strong>：我们也可以只用 <code>f</code> 来缩写它，以加快下次的速度。</p>
</blockquote>
<p>保存并退出编辑器，Git 将运行这些命令。我们可以检查日志以验证结果：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>git<span class="w"> </span>log<span class="w"> </span>-2<span class="w"> </span>--oneline
fcff6ae<span class="w"> </span><span class="o">(</span>HEAD<span class="w"> </span>-&gt;<span class="w"> </span>master<span class="o">)</span><span class="w"> </span>Add<span class="w"> </span>farewell.txt
a479e94<span class="w"> </span>Add<span class="w"> </span>greeting.txt
</code></pre></div>

<h3>将多个提交压扁为一个</h3>
<p>在工作时，当你达到较小的里程碑或修复以前的提交中的错误时，你可能会发现写很多提交很有用。但是，在将你的工作合并到 <code>master</code> 分支之前，将这些提交“压扁”（<code>squash</code>）到一起以使历史记录更清晰可能很有用。为此，我们将使用“压扁”（<code>squash</code>）操作。让我们从编写一堆提交开始，如果要加快速度，只需复制并粘贴这些：</p>
<div class="highlight"><pre><span></span><code><span class="nv">git</span><span class="w"> </span><span class="nv">checkout</span><span class="w"> </span><span class="o">-</span><span class="nv">b</span><span class="w"> </span><span class="nv">squash</span>
<span class="k">for</span><span class="w"> </span><span class="nv">c</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">H</span><span class="w"> </span><span class="nv">e</span><span class="w"> </span><span class="nv">l</span><span class="w"> </span><span class="nv">l</span><span class="w"> </span><span class="nv">o</span><span class="w"> </span>,<span class="w"> </span><span class="s1">&#39; &#39;</span><span class="w"> </span><span class="nv">w</span><span class="w"> </span><span class="nv">o</span><span class="w"> </span><span class="nv">r</span><span class="w"> </span><span class="nv">l</span><span class="w"> </span><span class="nv">d</span><span class="c1">; do</span>
<span class="w">    </span><span class="nv">echo</span><span class="w"> </span><span class="s2">&quot;$c&quot;</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="nv">squash</span>.<span class="nv">txt</span>
<span class="w">    </span><span class="nv">git</span><span class="w"> </span><span class="nv">add</span><span class="w"> </span><span class="nv">squash</span>.<span class="nv">txt</span>
<span class="w">    </span><span class="nv">git</span><span class="w"> </span><span class="nv">commit</span><span class="w"> </span><span class="o">-</span><span class="nv">m</span><span class="s2">&quot;Add &#39;$c&#39; to squash.txt&quot;</span>
<span class="nv">done</span>
</code></pre></div>

<p>要制作出一个写着 “Hello，world” 的文件，要做很多事情！让我们开始另一个交互式变基，将它们压扁在一起。请注意，我们首先签出了一个分支来进行尝试。因此，因为我们使用 <code>git rebase -i master</code> 进行的分支，我们可以快速变基所有提交。结果：</p>
<div class="highlight"><pre><span></span><code>pick 1e85199 Add &#39;H&#39; to squash.txt
pick fff6631 Add &#39;e&#39; to squash.txt
pick b354c74 Add &#39;l&#39; to squash.txt
pick 04aaf74 Add &#39;l&#39; to squash.txt
pick 9b0f720 Add &#39;o&#39; to squash.txt
pick 66b114d Add &#39;,&#39; to squash.txt
pick dc158cd Add &#39; &#39; to squash.txt
pick dfcf9d6 Add &#39;w&#39; to squash.txt
pick 7a85f34 Add &#39;o&#39; to squash.txt
pick c275c27 Add &#39;r&#39; to squash.txt
pick a513fd1 Add &#39;l&#39; to squash.txt
pick 6b608ae Add &#39;d&#39; to squash.txt

# Rebase 1af1b46..6b608ae onto 1af1b46 (12 commands)
#
# Commands:
# p, pick &lt;commit&gt; = use commit
# s, squash &lt;commit&gt; = use commit, but meld into previous commit
</code></pre></div>

<blockquote>
<p><strong>技巧</strong>：你的本地 <code>master</code> 分支独立于远程 <code>master</code> 分支而发展，并且 Git 将远程分支存储为 <code>origin/master</code>。结合这种技巧，<code>git rebase -i origin/master</code> 通常是一种非常方便的方法，可以变基所有尚未合并到上游的提交！</p>
</blockquote>
<p>我们将把所有这些更改压扁到第一个提交中。为此，将第一行除外的每个“选取”（<code>pick</code>）操作都更改为“压扁”（<code>squash</code>），如下所示：</p>
<div class="highlight"><pre><span></span><code>pick 1e85199 Add &#39;H&#39; to squash.txt
squash fff6631 Add &#39;e&#39; to squash.txt
squash b354c74 Add &#39;l&#39; to squash.txt
squash 04aaf74 Add &#39;l&#39; to squash.txt
squash 9b0f720 Add &#39;o&#39; to squash.txt
squash 66b114d Add &#39;,&#39; to squash.txt
squash dc158cd Add &#39; &#39; to squash.txt
squash dfcf9d6 Add &#39;w&#39; to squash.txt
squash 7a85f34 Add &#39;o&#39; to squash.txt
squash c275c27 Add &#39;r&#39; to squash.txt
squash a513fd1 Add &#39;l&#39; to squash.txt
squash 6b608ae Add &#39;d&#39; to squash.txt
</code></pre></div>

<p>保存并关闭编辑器时，Git 会考虑片刻，然后再次打开编辑器以修改最终的提交消息。你会看到以下内容：</p>
<div class="highlight"><pre><span></span><code><span class="err">#</span><span class="w"> </span><span class="nt">This</span><span class="w"> </span><span class="nt">is</span><span class="w"> </span><span class="nt">a</span><span class="w"> </span><span class="nt">combination</span><span class="w"> </span><span class="nt">of</span><span class="w"> </span><span class="nt">12</span><span class="w"> </span><span class="nt">commits</span><span class="o">.</span>
<span class="err">#</span><span class="w"> </span><span class="nt">This</span><span class="w"> </span><span class="nt">is</span><span class="w"> </span><span class="nt">the</span><span class="w"> </span><span class="nt">1st</span><span class="w"> </span><span class="nt">commit</span><span class="w"> </span><span class="nt">message</span><span class="o">:</span>

<span class="nt">Add</span><span class="w"> </span><span class="s1">&#39;H&#39;</span><span class="w"> </span><span class="nt">to</span><span class="w"> </span><span class="nt">squash</span><span class="p">.</span><span class="nc">txt</span>

<span class="err">#</span><span class="w"> </span><span class="nt">This</span><span class="w"> </span><span class="nt">is</span><span class="w"> </span><span class="nt">the</span><span class="w"> </span><span class="nt">commit</span><span class="w"> </span><span class="nt">message</span><span class="w"> </span><span class="p">#</span><span class="nn">2</span><span class="o">:</span>

<span class="nt">Add</span><span class="w"> </span><span class="s1">&#39;e&#39;</span><span class="w"> </span><span class="nt">to</span><span class="w"> </span><span class="nt">squash</span><span class="p">.</span><span class="nc">txt</span>

<span class="err">#</span><span class="w"> </span><span class="nt">This</span><span class="w"> </span><span class="nt">is</span><span class="w"> </span><span class="nt">the</span><span class="w"> </span><span class="nt">commit</span><span class="w"> </span><span class="nt">message</span><span class="w"> </span><span class="p">#</span><span class="nn">3</span><span class="o">:</span>

<span class="nt">Add</span><span class="w"> </span><span class="s1">&#39;l&#39;</span><span class="w"> </span><span class="nt">to</span><span class="w"> </span><span class="nt">squash</span><span class="p">.</span><span class="nc">txt</span>

<span class="err">#</span><span class="w"> </span><span class="nt">This</span><span class="w"> </span><span class="nt">is</span><span class="w"> </span><span class="nt">the</span><span class="w"> </span><span class="nt">commit</span><span class="w"> </span><span class="nt">message</span><span class="w"> </span><span class="p">#</span><span class="nn">4</span><span class="o">:</span>

<span class="nt">Add</span><span class="w"> </span><span class="s1">&#39;l&#39;</span><span class="w"> </span><span class="nt">to</span><span class="w"> </span><span class="nt">squash</span><span class="p">.</span><span class="nc">txt</span>

<span class="err">#</span><span class="w"> </span><span class="nt">This</span><span class="w"> </span><span class="nt">is</span><span class="w"> </span><span class="nt">the</span><span class="w"> </span><span class="nt">commit</span><span class="w"> </span><span class="nt">message</span><span class="w"> </span><span class="p">#</span><span class="nn">5</span><span class="o">:</span>

<span class="nt">Add</span><span class="w"> </span><span class="s1">&#39;o&#39;</span><span class="w"> </span><span class="nt">to</span><span class="w"> </span><span class="nt">squash</span><span class="p">.</span><span class="nc">txt</span>

<span class="err">#</span><span class="w"> </span><span class="nt">This</span><span class="w"> </span><span class="nt">is</span><span class="w"> </span><span class="nt">the</span><span class="w"> </span><span class="nt">commit</span><span class="w"> </span><span class="nt">message</span><span class="w"> </span><span class="p">#</span><span class="nn">6</span><span class="o">:</span>

<span class="nt">Add</span><span class="w"> </span><span class="s1">&#39;,&#39;</span><span class="w"> </span><span class="nt">to</span><span class="w"> </span><span class="nt">squash</span><span class="p">.</span><span class="nc">txt</span>

<span class="err">#</span><span class="w"> </span><span class="nt">This</span><span class="w"> </span><span class="nt">is</span><span class="w"> </span><span class="nt">the</span><span class="w"> </span><span class="nt">commit</span><span class="w"> </span><span class="nt">message</span><span class="w"> </span><span class="p">#</span><span class="nn">7</span><span class="o">:</span>

<span class="nt">Add</span><span class="w"> </span><span class="s1">&#39; &#39;</span><span class="w"> </span><span class="nt">to</span><span class="w"> </span><span class="nt">squash</span><span class="p">.</span><span class="nc">txt</span>

<span class="err">#</span><span class="w"> </span><span class="nt">This</span><span class="w"> </span><span class="nt">is</span><span class="w"> </span><span class="nt">the</span><span class="w"> </span><span class="nt">commit</span><span class="w"> </span><span class="nt">message</span><span class="w"> </span><span class="p">#</span><span class="nn">8</span><span class="o">:</span>

<span class="nt">Add</span><span class="w"> </span><span class="s1">&#39;w&#39;</span><span class="w"> </span><span class="nt">to</span><span class="w"> </span><span class="nt">squash</span><span class="p">.</span><span class="nc">txt</span>

<span class="err">#</span><span class="w"> </span><span class="nt">This</span><span class="w"> </span><span class="nt">is</span><span class="w"> </span><span class="nt">the</span><span class="w"> </span><span class="nt">commit</span><span class="w"> </span><span class="nt">message</span><span class="w"> </span><span class="p">#</span><span class="nn">9</span><span class="o">:</span>

<span class="nt">Add</span><span class="w"> </span><span class="s1">&#39;o&#39;</span><span class="w"> </span><span class="nt">to</span><span class="w"> </span><span class="nt">squash</span><span class="p">.</span><span class="nc">txt</span>

<span class="err">#</span><span class="w"> </span><span class="nt">This</span><span class="w"> </span><span class="nt">is</span><span class="w"> </span><span class="nt">the</span><span class="w"> </span><span class="nt">commit</span><span class="w"> </span><span class="nt">message</span><span class="w"> </span><span class="p">#</span><span class="nn">10</span><span class="o">:</span>

<span class="nt">Add</span><span class="w"> </span><span class="s1">&#39;r&#39;</span><span class="w"> </span><span class="nt">to</span><span class="w"> </span><span class="nt">squash</span><span class="p">.</span><span class="nc">txt</span>

<span class="err">#</span><span class="w"> </span><span class="nt">This</span><span class="w"> </span><span class="nt">is</span><span class="w"> </span><span class="nt">the</span><span class="w"> </span><span class="nt">commit</span><span class="w"> </span><span class="nt">message</span><span class="w"> </span><span class="p">#</span><span class="nn">11</span><span class="o">:</span>

<span class="nt">Add</span><span class="w"> </span><span class="s1">&#39;l&#39;</span><span class="w"> </span><span class="nt">to</span><span class="w"> </span><span class="nt">squash</span><span class="p">.</span><span class="nc">txt</span>

<span class="err">#</span><span class="w"> </span><span class="nt">This</span><span class="w"> </span><span class="nt">is</span><span class="w"> </span><span class="nt">the</span><span class="w"> </span><span class="nt">commit</span><span class="w"> </span><span class="nt">message</span><span class="w"> </span><span class="p">#</span><span class="nn">12</span><span class="o">:</span>

<span class="nt">Add</span><span class="w"> </span><span class="s1">&#39;d&#39;</span><span class="w"> </span><span class="nt">to</span><span class="w"> </span><span class="nt">squash</span><span class="p">.</span><span class="nc">txt</span>

<span class="err">#</span><span class="w"> </span><span class="nt">Please</span><span class="w"> </span><span class="nt">enter</span><span class="w"> </span><span class="nt">the</span><span class="w"> </span><span class="nt">commit</span><span class="w"> </span><span class="nt">message</span><span class="w"> </span><span class="nt">for</span><span class="w"> </span><span class="nt">your</span><span class="w"> </span><span class="nt">changes</span><span class="o">.</span><span class="w"> </span><span class="nt">Lines</span><span class="w"> </span><span class="nt">starting</span>
<span class="err">#</span><span class="w"> </span><span class="nt">with</span><span class="w"> </span><span class="s1">&#39;#&#39;</span><span class="w"> </span><span class="nt">will</span><span class="w"> </span><span class="nt">be</span><span class="w"> </span><span class="nt">ignored</span><span class="o">,</span><span class="w"> </span><span class="nt">and</span><span class="w"> </span><span class="nt">an</span><span class="w"> </span><span class="nt">empty</span><span class="w"> </span><span class="nt">message</span><span class="w"> </span><span class="nt">aborts</span><span class="w"> </span><span class="nt">the</span><span class="w"> </span><span class="nt">commit</span><span class="o">.</span>
<span class="err">#</span>
<span class="err">#</span><span class="w"> </span><span class="nt">Date</span><span class="o">:</span><span class="w">      </span><span class="nt">Sun</span><span class="w"> </span><span class="nt">Apr</span><span class="w"> </span><span class="nt">28</span><span class="w"> </span><span class="nt">14</span><span class="p">:</span><span class="nd">21</span><span class="p">:</span><span class="nd">56</span><span class="w"> </span><span class="nt">2019</span><span class="w"> </span><span class="nt">-0400</span>
<span class="err">#</span>
<span class="err">#</span><span class="w"> </span><span class="nt">interactive</span><span class="w"> </span><span class="nt">rebase</span><span class="w"> </span><span class="nt">in</span><span class="w"> </span><span class="nt">progress</span><span class="o">;</span><span class="w"> </span><span class="nt">onto</span><span class="w"> </span><span class="nt">1af1b46</span>
<span class="err">#</span><span class="w"> </span><span class="nt">Last</span><span class="w"> </span><span class="nt">commands</span><span class="w"> </span><span class="nt">done</span><span class="w"> </span><span class="o">(</span><span class="nt">12</span><span class="w"> </span><span class="nt">commands</span><span class="w"> </span><span class="nt">done</span><span class="o">):</span>
<span class="err">#</span><span class="w">    </span><span class="nt">squash</span><span class="w"> </span><span class="nt">a513fd1</span><span class="w"> </span><span class="nt">Add</span><span class="w"> </span><span class="s1">&#39;l&#39;</span><span class="w"> </span><span class="nt">to</span><span class="w"> </span><span class="nt">squash</span><span class="p">.</span><span class="nc">txt</span>
<span class="err">#</span><span class="w">    </span><span class="nt">squash</span><span class="w"> </span><span class="nt">6b608ae</span><span class="w"> </span><span class="nt">Add</span><span class="w"> </span><span class="s1">&#39;d&#39;</span><span class="w"> </span><span class="nt">to</span><span class="w"> </span><span class="nt">squash</span><span class="p">.</span><span class="nc">txt</span>
<span class="err">#</span><span class="w"> </span><span class="nt">No</span><span class="w"> </span><span class="nt">commands</span><span class="w"> </span><span class="nt">remaining</span><span class="o">.</span>
<span class="err">#</span><span class="w"> </span><span class="nt">You</span><span class="w"> </span><span class="nt">are</span><span class="w"> </span><span class="nt">currently</span><span class="w"> </span><span class="nt">rebasing</span><span class="w"> </span><span class="nt">branch</span><span class="w"> </span><span class="s1">&#39;squash&#39;</span><span class="w"> </span><span class="nt">on</span><span class="w"> </span><span class="s1">&#39;1af1b46&#39;</span><span class="o">.</span>
<span class="err">#</span>
<span class="err">#</span><span class="w"> </span><span class="nt">Changes</span><span class="w"> </span><span class="nt">to</span><span class="w"> </span><span class="nt">be</span><span class="w"> </span><span class="nt">committed</span><span class="o">:</span>
<span class="err">#</span><span class="w">   </span><span class="nt">new</span><span class="w"> </span><span class="nt">file</span><span class="o">:</span><span class="w">   </span><span class="nt">squash</span><span class="p">.</span><span class="nc">txt</span>
<span class="err">#</span>
</code></pre></div>

<p>默认情况下，这是所有要压扁的提交的消息的组合，但是像这样将其保留肯定不是你想要的。不过，旧的提交消息在编写新的提交消息时可能很有用，所以放在这里以供参考。</p>
<blockquote>
<p><strong>提示</strong>：你在上一节中了解的“修复”（<code>fixup</code>）命令也可以用于此目的，但它会丢弃压扁的提交的消息。</p>
</blockquote>
<p>让我们删除所有内容，并用更好的提交消息替换它，如下所示：</p>
<div class="highlight"><pre><span></span><code><span class="nt">Add</span><span class="w"> </span><span class="nt">squash</span><span class="p">.</span><span class="nc">txt</span><span class="w"> </span><span class="nt">with</span><span class="w"> </span><span class="nt">contents</span><span class="w"> </span><span class="s2">&quot;Hello, world&quot;</span>

<span class="err">#</span><span class="w"> </span><span class="nt">Please</span><span class="w"> </span><span class="nt">enter</span><span class="w"> </span><span class="nt">the</span><span class="w"> </span><span class="nt">commit</span><span class="w"> </span><span class="nt">message</span><span class="w"> </span><span class="nt">for</span><span class="w"> </span><span class="nt">your</span><span class="w"> </span><span class="nt">changes</span><span class="o">.</span><span class="w"> </span><span class="nt">Lines</span><span class="w"> </span><span class="nt">starting</span>
<span class="err">#</span><span class="w"> </span><span class="nt">with</span><span class="w"> </span><span class="s1">&#39;#&#39;</span><span class="w"> </span><span class="nt">will</span><span class="w"> </span><span class="nt">be</span><span class="w"> </span><span class="nt">ignored</span><span class="o">,</span><span class="w"> </span><span class="nt">and</span><span class="w"> </span><span class="nt">an</span><span class="w"> </span><span class="nt">empty</span><span class="w"> </span><span class="nt">message</span><span class="w"> </span><span class="nt">aborts</span><span class="w"> </span><span class="nt">the</span><span class="w"> </span><span class="nt">commit</span><span class="o">.</span>
<span class="err">#</span>
<span class="err">#</span><span class="w"> </span><span class="nt">Date</span><span class="o">:</span><span class="w">      </span><span class="nt">Sun</span><span class="w"> </span><span class="nt">Apr</span><span class="w"> </span><span class="nt">28</span><span class="w"> </span><span class="nt">14</span><span class="p">:</span><span class="nd">21</span><span class="p">:</span><span class="nd">56</span><span class="w"> </span><span class="nt">2019</span><span class="w"> </span><span class="nt">-0400</span>
<span class="err">#</span>
<span class="err">#</span><span class="w"> </span><span class="nt">interactive</span><span class="w"> </span><span class="nt">rebase</span><span class="w"> </span><span class="nt">in</span><span class="w"> </span><span class="nt">progress</span><span class="o">;</span><span class="w"> </span><span class="nt">onto</span><span class="w"> </span><span class="nt">1af1b46</span>
<span class="err">#</span><span class="w"> </span><span class="nt">Last</span><span class="w"> </span><span class="nt">commands</span><span class="w"> </span><span class="nt">done</span><span class="w"> </span><span class="o">(</span><span class="nt">12</span><span class="w"> </span><span class="nt">commands</span><span class="w"> </span><span class="nt">done</span><span class="o">):</span>
<span class="err">#</span><span class="w">    </span><span class="nt">squash</span><span class="w"> </span><span class="nt">a513fd1</span><span class="w"> </span><span class="nt">Add</span><span class="w"> </span><span class="s1">&#39;l&#39;</span><span class="w"> </span><span class="nt">to</span><span class="w"> </span><span class="nt">squash</span><span class="p">.</span><span class="nc">txt</span>
<span class="err">#</span><span class="w">    </span><span class="nt">squash</span><span class="w"> </span><span class="nt">6b608ae</span><span class="w"> </span><span class="nt">Add</span><span class="w"> </span><span class="s1">&#39;d&#39;</span><span class="w"> </span><span class="nt">to</span><span class="w"> </span><span class="nt">squash</span><span class="p">.</span><span class="nc">txt</span>
<span class="err">#</span><span class="w"> </span><span class="nt">No</span><span class="w"> </span><span class="nt">commands</span><span class="w"> </span><span class="nt">remaining</span><span class="o">.</span>
<span class="err">#</span><span class="w"> </span><span class="nt">You</span><span class="w"> </span><span class="nt">are</span><span class="w"> </span><span class="nt">currently</span><span class="w"> </span><span class="nt">rebasing</span><span class="w"> </span><span class="nt">branch</span><span class="w"> </span><span class="s1">&#39;squash&#39;</span><span class="w"> </span><span class="nt">on</span><span class="w"> </span><span class="s1">&#39;1af1b46&#39;</span><span class="o">.</span>
<span class="err">#</span>
<span class="err">#</span><span class="w"> </span><span class="nt">Changes</span><span class="w"> </span><span class="nt">to</span><span class="w"> </span><span class="nt">be</span><span class="w"> </span><span class="nt">committed</span><span class="o">:</span>
<span class="err">#</span><span class="w">   </span><span class="nt">new</span><span class="w"> </span><span class="nt">file</span><span class="o">:</span><span class="w">   </span><span class="nt">squash</span><span class="p">.</span><span class="nc">txt</span>
<span class="err">#</span>
</code></pre></div>

<p>保存并退出编辑器，然后检查你的 Git 日志，成功！</p>
<div class="highlight"><pre><span></span><code><span class="n">commit</span><span class="w"> </span><span class="n">c785f476c7dff76f21ce2cad7c51cf2af00a44b6</span><span class="w"> </span><span class="p">(</span><span class="n">HEAD</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">squash</span><span class="p">)</span>
<span class="n">Author</span><span class="o">:</span><span class="w"> </span><span class="n">Drew</span><span class="w"> </span><span class="n">DeVault</span>
<span class="n">Date</span><span class="o">:</span><span class="w">   </span><span class="n">Sun</span><span class="w"> </span><span class="n">Apr</span><span class="w"> </span><span class="mi">28</span><span class="w"> </span><span class="mi">14</span><span class="o">:</span><span class="mi">21</span><span class="o">:</span><span class="mi">56</span><span class="w"> </span><span class="mi">2019</span><span class="w"> </span><span class="o">-</span><span class="mo">0400</span>

<span class="w">    </span><span class="n">Add</span><span class="w"> </span><span class="n">squash</span><span class="p">.</span><span class="n">txt</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">contents</span><span class="w"> </span><span class="s">&quot;Hello, world&quot;</span>
</code></pre></div>

<p>在继续之前，让我们将所做的更改拉入 <code>master</code> 分支中，并摆脱掉这一草稿。我们可以像使用 <code>git merge</code> 一样使用 <code>git rebase</code>，但是它避免了创建合并提交：</p>
<div class="highlight"><pre><span></span><code>git checkout master
git rebase squash
git branch -D squash
</code></pre></div>

<p>除非我们实际上正在合并无关的历史记录，否则我们通常希望避免使用 <code>git merge</code>。如果你有两个不同的分支，则 <code>git merge</code> 对于记录它们合并的时间非常有用。在正常工作过程中，变基通常更为合适。</p>
<h3>将一个提交拆分为多个</h3>
<p>有时会发生相反的问题：一个提交太大了。让我们来看一看拆分它们。这次，让我们写一些实际的代码。从一个简单的 C 程序 <sup id="fnref2"> <a href="#fn2" rel="footnote">  2 </a></sup> 开始（你仍然可以将此代码段复制并粘贴到你的 shell 中以快速执行此操作）：</p>
<div class="highlight"><pre><span></span><code>cat &lt;&lt;EOF &gt;main.c
int main(int argc, char *argv[]) {
    return 0;
}
EOF
</code></pre></div>

<p>首先提交它：</p>
<div class="highlight"><pre><span></span><code>git add main.c
git commit -m&quot;Add C program skeleton&quot;
</code></pre></div>

<p>然后把这个程序扩展一些：</p>
<div class="highlight"><pre><span></span><code><span class="n">cat</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="n">EOF</span><span class="w"> </span><span class="o">&gt;</span><span class="n">main</span><span class="o">.</span><span class="n">c</span>
<span class="c1">#include &amp;ltstdio.h&gt;</span>

<span class="k">const</span><span class="w"> </span><span class="nb">char</span><span class="w"> </span><span class="o">*</span><span class="n">get_name</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="nb">char</span><span class="w"> </span><span class="n">buf</span><span class="p">[</span><span class="mi">128</span><span class="p">];</span>
<span class="w">    </span><span class="n">scanf</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">buf</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">buf</span><span class="p">;</span>
<span class="p">}</span>

<span class="nb nb-Type">int</span><span class="w"> </span><span class="n">main</span><span class="p">(</span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="nb">char</span><span class="w"> </span><span class="o">*</span><span class="n">argv</span><span class="p">[])</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s2">&quot;What&#39;s your name? &quot;</span><span class="p">);</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="nb">char</span><span class="w"> </span><span class="o">*</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get_name</span><span class="p">();</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s2">&quot;Hello, </span><span class="si">%s</span><span class="s2">!</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">EOF</span>
</code></pre></div>

<p>提交之后，我们就可以准备学习如何将其拆分：</p>
<div class="highlight"><pre><span></span><code>git commit -a -m&quot;Flesh out C program&quot;
</code></pre></div>

<p>第一步是启动交互式变基。让我们用 <code>git rebase -i HEAD~2</code> 来变基这两个提交，给出的变基计划如下：</p>
<div class="highlight"><pre><span></span><code><span class="nv">pick</span><span class="w"> </span><span class="mi">237</span><span class="nv">b246</span><span class="w"> </span><span class="nv">Add</span><span class="w"> </span><span class="nv">C</span><span class="w"> </span><span class="nv">program</span><span class="w"> </span><span class="nv">skeleton</span>
<span class="nv">pick</span><span class="w"> </span><span class="nv">b3f188b</span><span class="w"> </span><span class="nv">Flesh</span><span class="w"> </span><span class="nv">out</span><span class="w"> </span><span class="nv">C</span><span class="w"> </span><span class="nv">program</span>

#<span class="w"> </span><span class="nv">Rebase</span><span class="w"> </span><span class="nv">c785f47</span>..<span class="nv">b3f188b</span><span class="w"> </span><span class="nv">onto</span><span class="w"> </span><span class="nv">c785f47</span><span class="w"> </span><span class="ss">(</span><span class="mi">2</span><span class="w"> </span><span class="nv">commands</span><span class="ss">)</span>
#
#<span class="w"> </span><span class="nv">Commands</span>:
#<span class="w"> </span><span class="nv">p</span>,<span class="w"> </span><span class="nv">pick</span><span class="w"> </span><span class="o">&lt;</span><span class="nv">commit</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">use</span><span class="w"> </span><span class="nv">commit</span>
#<span class="w"> </span><span class="nv">e</span>,<span class="w"> </span><span class="nv">edit</span><span class="w"> </span><span class="o">&lt;</span><span class="nv">commit</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">use</span><span class="w"> </span><span class="nv">commit</span>,<span class="w"> </span><span class="nv">but</span><span class="w"> </span><span class="nv">stop</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">amending</span>
</code></pre></div>

<p>将第二个提交的命令从 <code>pick</code> 更改为 <code>edit</code>，然后保存并关闭编辑器。Git 会考虑一秒钟，然后向你建议：</p>
<div class="highlight"><pre><span></span><code><span class="nv">Stopped</span><span class="w"> </span><span class="nv">at</span><span class="w"> </span><span class="nv">b3f188b</span>...<span class="w">  </span><span class="nv">Flesh</span><span class="w"> </span><span class="nv">out</span><span class="w"> </span><span class="nv">C</span><span class="w"> </span><span class="nv">program</span>
<span class="nv">You</span><span class="w"> </span><span class="nv">can</span><span class="w"> </span><span class="nv">amend</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">commit</span><span class="w"> </span><span class="nv">now</span>,<span class="w"> </span><span class="nv">with</span>

<span class="w">  </span><span class="nv">git</span><span class="w"> </span><span class="nv">commit</span><span class="w"> </span><span class="o">--</span><span class="nv">amend</span>

<span class="nv">Once</span><span class="w"> </span><span class="nv">you</span><span class="w"> </span><span class="nv">are</span><span class="w"> </span><span class="nv">satisfied</span><span class="w"> </span><span class="nv">with</span><span class="w"> </span><span class="nv">your</span><span class="w"> </span><span class="nv">changes</span>,<span class="w"> </span><span class="nv">run</span>

<span class="w">  </span><span class="nv">git</span><span class="w"> </span><span class="nv">rebase</span><span class="w"> </span><span class="o">--</span><span class="k">continue</span>
</code></pre></div>

<p>我们可以按照以下说明为提交<em>添加</em>新的更改，但我们可以通过运行 <code>git reset HEAD^</code> 来进行“软重置” <sup id="fnref3"> <a href="#fn3" rel="footnote">  3 </a></sup>。如果在此之后运行 <code>git status</code>，你将看到它取消了提交最新的提交，并将其更改添加到工作树中：</p>
<div class="highlight"><pre><span></span><code><span class="nv">Last</span><span class="w"> </span><span class="nv">commands</span><span class="w"> </span><span class="nv">done</span><span class="w"> </span><span class="ss">(</span><span class="mi">2</span><span class="w"> </span><span class="nv">commands</span><span class="w"> </span><span class="nv">done</span><span class="ss">)</span>:
<span class="w">   </span><span class="nv">pick</span><span class="w"> </span><span class="mi">237</span><span class="nv">b246</span><span class="w"> </span><span class="nv">Add</span><span class="w"> </span><span class="nv">C</span><span class="w"> </span><span class="nv">program</span><span class="w"> </span><span class="nv">skeleton</span>
<span class="w">   </span><span class="nv">edit</span><span class="w"> </span><span class="nv">b3f188b</span><span class="w"> </span><span class="nv">Flesh</span><span class="w"> </span><span class="nv">out</span><span class="w"> </span><span class="nv">C</span><span class="w"> </span><span class="nv">program</span>
<span class="nv">No</span><span class="w"> </span><span class="nv">commands</span><span class="w"> </span><span class="nv">remaining</span>.
<span class="nv">You</span><span class="w"> </span><span class="nv">are</span><span class="w"> </span><span class="nv">currently</span><span class="w"> </span><span class="nv">splitting</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nv">commit</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="nv">rebasing</span><span class="w"> </span><span class="nv">branch</span><span class="w"> </span><span class="s1">&#39;master&#39;</span><span class="w"> </span><span class="nv">on</span><span class="w"> </span><span class="s1">&#39;c785f47&#39;</span>.
<span class="w">  </span><span class="ss">(</span><span class="nv">Once</span><span class="w"> </span><span class="nv">your</span><span class="w"> </span><span class="nv">working</span><span class="w"> </span><span class="nv">directory</span><span class="w"> </span><span class="nv">is</span><span class="w"> </span><span class="nv">clean</span>,<span class="w"> </span><span class="nv">run</span><span class="w"> </span><span class="s2">&quot;git rebase --continue&quot;</span><span class="ss">)</span>

<span class="nv">Changes</span><span class="w"> </span><span class="nv">not</span><span class="w"> </span><span class="nv">staged</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">commit</span>:
<span class="w">  </span><span class="ss">(</span><span class="nv">use</span><span class="w"> </span><span class="s2">&quot;git add ...&quot;</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="nv">update</span><span class="w"> </span><span class="nv">what</span><span class="w"> </span><span class="nv">will</span><span class="w"> </span><span class="nv">be</span><span class="w"> </span><span class="nv">committed</span><span class="ss">)</span>
<span class="w">  </span><span class="ss">(</span><span class="nv">use</span><span class="w"> </span><span class="s2">&quot;git checkout -- ...&quot;</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="nv">discard</span><span class="w"> </span><span class="nv">changes</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">working</span><span class="w"> </span><span class="nv">directory</span><span class="ss">)</span>

<span class="w">  </span><span class="nv">modified</span>:<span class="w">   </span><span class="nv">main</span>.<span class="nv">c</span>

<span class="nv">no</span><span class="w"> </span><span class="nv">changes</span><span class="w"> </span><span class="nv">added</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="nv">commit</span><span class="w"> </span><span class="ss">(</span><span class="nv">use</span><span class="w"> </span><span class="s2">&quot;git add&quot;</span><span class="w"> </span><span class="nv">and</span><span class="o">/</span><span class="nv">or</span><span class="w"> </span><span class="s2">&quot;git commit -a&quot;</span><span class="ss">)</span>
</code></pre></div>

<p>为了对此进行拆分，我们将进行<em>交互式提交</em>。这使我们能够选择性地仅提交工作树中的特定更改。运行 <code>git commit -p</code> 开始此过程，你将看到以下提示：</p>
<div class="highlight"><pre><span></span><code><span class="gh">diff --git a/main.c b/main.c</span>
<span class="gh">index b1d9c2c..3463610 100644</span>
<span class="gd">--- a/main.c</span>
<span class="gi">+++ b/main.c</span>
<span class="gu">@@ -1,3 +1,14 @@</span>
<span class="gi">+#include &amp;ltstdio.h&gt;</span>
<span class="gi">+</span>
<span class="gi">+const char *get_name() {</span>
<span class="gi">+    static char buf[128];</span>
<span class="gi">+    scanf(&quot;%s&quot;, buf);</span>
<span class="gi">+    return buf;</span>
<span class="gi">+}</span>
<span class="gi">+</span>
<span class="w"> </span>int main(int argc, char *argv[]) {
<span class="gi">+    printf(&quot;What&#39;s your name? &quot;);</span>
<span class="gi">+    const char *name = get_name();</span>
<span class="gi">+    printf(&quot;Hello, %s!\n&quot;, name);</span>
<span class="w"> </span>    return 0;
<span class="w"> </span>}
Stage this hunk [y,n,q,a,d,s,e,?]?
</code></pre></div>

<p>Git 仅向你提供了一个“大块”（即单个更改）以进行提交。不过，这太大了，让我们使用 <code>s</code> 命令将这个“大块”拆分成较小的部分。</p>
<div class="highlight"><pre><span></span><code><span class="n">Split</span><span class="w"> </span><span class="n">into</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="n">hunks</span><span class="o">.</span>
<span class="err">@@</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">9</span><span class="w"> </span><span class="err">@@</span>
<span class="o">+</span><span class="c1">#include &lt;stdio.h&gt;</span>
<span class="o">+</span>
<span class="o">+</span><span class="k">const</span><span class="w"> </span><span class="nb">char</span><span class="w"> </span><span class="o">*</span><span class="n">get_name</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="o">+</span><span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="nb">char</span><span class="w"> </span><span class="n">buf</span><span class="p">[</span><span class="mi">128</span><span class="p">];</span>
<span class="o">+</span><span class="w">    </span><span class="n">scanf</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">buf</span><span class="p">);</span>
<span class="o">+</span><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">buf</span><span class="p">;</span>
<span class="o">+</span><span class="p">}</span>
<span class="o">+</span>
<span class="w"> </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">main</span><span class="p">(</span><span class="nb nb-Type">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="nb">char</span><span class="w"> </span><span class="o">*</span><span class="n">argv</span><span class="p">[])</span><span class="w"> </span><span class="p">{</span>
<span class="n">Stage</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">hunk</span><span class="w"> </span><span class="p">[</span><span class="n">y</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">q</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">J</span><span class="p">,</span><span class="n">g</span><span class="p">,</span><span class="o">/</span><span class="p">,</span><span class="n">e</span><span class="p">,</span><span class="err">?</span><span class="p">]</span><span class="err">?</span>
</code></pre></div>

<blockquote>
<p><strong>提示</strong>：如果你对其他选项感到好奇，请按 <code>?</code> 汇总显示。</p>
</blockquote>
<p>这个大块看起来更好：单一、独立的更改。让我们按 <code>y</code> 来回答问题（并暂存那个“大块”），然后按 <code>q</code> 以“退出”交互式会话并继续进行提交。会弹出编辑器，要求输入合适的提交消息。</p>
<div class="highlight"><pre><span></span><code>Add get_name function to C program

<span class="gh">#</span> Please enter the commit message for your changes. Lines starting
<span class="gh">#</span> with &#39;#&#39; will be ignored, and an empty message aborts the commit.
<span class="gh">#</span>
# interactive rebase in progress; onto c785f47
<span class="gh">#</span> Last commands done (2 commands done):
<span class="gh">#</span>    pick 237b246 Add C program skeleton
<span class="gh">#</span>    edit b3f188b Flesh out C program
<span class="gh">#</span> No commands remaining.
<span class="gh">#</span> You are currently splitting a commit while rebasing branch &#39;master&#39; on &#39;c785f47&#39;.
<span class="gh">#</span>
# Changes to be committed:
<span class="gh">#</span>   modified:   main.c
<span class="gh">#</span>
# Changes not staged for commit:
<span class="gh">#</span>   modified:   main.c
#
</code></pre></div>

<p>保存并关闭编辑器，然后我们进行第二次提交。我们可以执行另一次交互式提交，但是由于我们只想在此提交中包括其余更改，因此我们将执行以下操作：</p>
<div class="highlight"><pre><span></span><code><span class="nv">git</span><span class="w"> </span><span class="nv">commit</span><span class="w"> </span><span class="o">-</span><span class="nv">a</span><span class="w"> </span><span class="o">-</span><span class="nv">m</span><span class="s2">&quot;Prompt user for their name&quot;</span>
<span class="nv">git</span><span class="w"> </span><span class="nv">rebase</span><span class="w"> </span><span class="o">--</span><span class="k">continue</span>
</code></pre></div>

<p>最后一条命令告诉 Git 我们已经完成了此提交的编辑，并继续执行下一个变基命令。这样就行了！运行 <code>git log</code> 来查看你的劳动成果：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>git<span class="w"> </span>log<span class="w"> </span>-3<span class="w"> </span>--oneline
fe19cc3<span class="w"> </span><span class="o">(</span>HEAD<span class="w"> </span>-&gt;<span class="w"> </span>master<span class="o">)</span><span class="w"> </span>Prompt<span class="w"> </span>user<span class="w"> </span><span class="k">for</span><span class="w"> </span>their<span class="w"> </span>name
659a489<span class="w"> </span>Add<span class="w"> </span>get_name<span class="w"> </span><span class="k">function</span><span class="w"> </span>to<span class="w"> </span>C<span class="w"> </span>program
237b246<span class="w"> </span>Add<span class="w"> </span>C<span class="w"> </span>program<span class="w"> </span>skeleton
</code></pre></div>

<h3>重新排序提交</h3>
<p>这很简单。让我们从设置沙箱开始：</p>
<div class="highlight"><pre><span></span><code>echo &quot;Goodbye now!&quot; &gt;farewell.txt
git add farewell.txt
git commit -m&quot;Add farewell.txt&quot;

echo &quot;Hello there!&quot; &gt;greeting.txt
git add greeting.txt
git commit -m&quot;Add greeting.txt&quot;

echo &quot;How&#39;re you doing?&quot; &gt;inquiry.txt
git add inquiry.txt
git commit -m&quot;Add inquiry.txt&quot;
</code></pre></div>

<p>现在 <code>git log</code> 看起来应如下所示：</p>
<div class="highlight"><pre><span></span><code><span class="n">f03baa5</span><span class="w"> </span><span class="p">(</span><span class="n">HEAD</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">master</span><span class="p">)</span><span class="w"> </span><span class="n">Add</span><span class="w"> </span><span class="n">inquiry</span><span class="p">.</span><span class="n">txt</span>
<span class="n">a4cebf7</span><span class="w"> </span><span class="n">Add</span><span class="w"> </span><span class="n">greeting</span><span class="p">.</span><span class="n">txt</span>
<span class="mi">90</span><span class="n">bb015</span><span class="w"> </span><span class="n">Add</span><span class="w"> </span><span class="n">farewell</span><span class="p">.</span><span class="n">txt</span>
</code></pre></div>

<p>显然，这都是乱序。让我们对过去的 3 个提交进行交互式变基来解决此问题。运行 <code>git rebase -i HEAD~3</code>，这个变基规划将出现：</p>
<div class="highlight"><pre><span></span><code><span class="nt">pick</span><span class="w"> </span><span class="nt">90bb015</span><span class="w"> </span><span class="nt">Add</span><span class="w"> </span><span class="nt">farewell</span><span class="p">.</span><span class="nc">txt</span>
<span class="nt">pick</span><span class="w"> </span><span class="nt">a4cebf7</span><span class="w"> </span><span class="nt">Add</span><span class="w"> </span><span class="nt">greeting</span><span class="p">.</span><span class="nc">txt</span>
<span class="nt">pick</span><span class="w"> </span><span class="nt">f03baa5</span><span class="w"> </span><span class="nt">Add</span><span class="w"> </span><span class="nt">inquiry</span><span class="p">.</span><span class="nc">txt</span>

<span class="err">#</span><span class="w"> </span><span class="nt">Rebase</span><span class="w"> </span><span class="nt">fe19cc3</span><span class="o">.</span><span class="p">.</span><span class="nc">f03baa5</span><span class="w"> </span><span class="nt">onto</span><span class="w"> </span><span class="nt">fe19cc3</span><span class="w"> </span><span class="o">(</span><span class="nt">3</span><span class="w"> </span><span class="nt">commands</span><span class="o">)</span>
<span class="err">#</span>
<span class="err">#</span><span class="w"> </span><span class="nt">Commands</span><span class="o">:</span>
<span class="err">#</span><span class="w"> </span><span class="nt">p</span><span class="o">,</span><span class="w"> </span><span class="nt">pick</span><span class="w"> </span><span class="o">&lt;</span><span class="nt">commit</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">use</span><span class="w"> </span><span class="nt">commit</span>
<span class="err">#</span>
<span class="err">#</span><span class="w"> </span><span class="nt">These</span><span class="w"> </span><span class="nt">lines</span><span class="w"> </span><span class="nt">can</span><span class="w"> </span><span class="nt">be</span><span class="w"> </span><span class="nt">re-ordered</span><span class="o">;</span><span class="w"> </span><span class="nt">they</span><span class="w"> </span><span class="nt">are</span><span class="w"> </span><span class="nt">executed</span><span class="w"> </span><span class="nt">from</span><span class="w"> </span><span class="nt">top</span><span class="w"> </span><span class="nt">to</span><span class="w"> </span><span class="nt">bottom</span><span class="o">.</span>
</code></pre></div>

<p>现在，解决方法很简单：只需按照你希望提交出现的顺序重新排列这些行。应该看起来像这样：</p>
<div class="highlight"><pre><span></span><code>pick a4cebf7 Add greeting.txt
pick f03baa5 Add inquiry.txt
pick 90bb015 Add farewell.txt
</code></pre></div>

<p>保存并关闭你的编辑器，而 Git 将为你完成其余工作。请注意，在实践中这样做可能会导致冲突，参看下面章节以获取解决冲突的帮助。</p>
<h3>git pull –rebase</h3>
<p>如果你一直在由上游更新的分支 <code>&lt;branch&gt;</code>（比如说原始远程）上做一些提交，通常 <code>git pull</code> 会创建一个合并提交。在这方面，<code>git pull</code> 的默认行为等同于：</p>
<div class="highlight"><pre><span></span><code>git fetch origin &lt;branch&gt;
git merge origin/&lt;branch&gt;
</code></pre></div>

<p>假设本地分支 <code>&lt;branch&gt;</code> 配置为从原始远程跟踪 <code>&lt;branch&gt;</code> 分支，即：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>git<span class="w"> </span>config<span class="w"> </span>branch.&lt;branch&gt;.remote
origin
$<span class="w"> </span>git<span class="w"> </span>config<span class="w"> </span>branch.&lt;branch&gt;.merge
refs/heads/&lt;branch&gt;
</code></pre></div>

<p>还有另一种选择，它通常更有用，并且会让历史记录更清晰：<code>git pull --rebase</code>。与合并方式不同，这基本上 <sup id="fnref4"> <a href="#fn4" rel="footnote">  4 </a></sup> 等效于以下内容：</p>
<div class="highlight"><pre><span></span><code>git fetch origin
git rebase origin/&lt;branch&gt;
</code></pre></div>

<p>合并方式更简单易懂，但是如果你了解如何使用 <code>git rebase</code>，那么变基方式几乎可以做到你想要做的任何事情。如果愿意，可以将其设置为默认行为，如下所示：</p>
<div class="highlight"><pre><span></span><code>git config --global pull.rebase true
</code></pre></div>

<p>当你执行此操作时，从技术上讲，你在应用我们在下一节中讨论的过程……因此，让我们也解释一下故意执行此操作的含义。</p>
<h3>使用 git rebase 来变基</h3>
<p>具有讽刺意味的是，我最少使用的 Git 变基功能是它以之命名的功能：变基分支。假设你有以下分支：</p>
<div class="highlight"><pre><span></span><code><span class="n">A</span><span class="o">--</span><span class="n">B</span><span class="o">--</span><span class="n">C</span><span class="o">--</span><span class="n">D</span><span class="o">--&gt;</span><span class="w"> </span><span class="n">master</span>
<span class="w">   </span><span class="err">\</span><span class="o">--</span><span class="n">E</span><span class="o">--</span><span class="n">F</span><span class="o">--&gt;</span><span class="w"> </span><span class="n">feature</span><span class="o">-</span><span class="mi">1</span>
<span class="w">      </span><span class="err">\</span><span class="o">--</span><span class="n">G</span><span class="o">--&gt;</span><span class="w"> </span><span class="n">feature</span><span class="o">-</span><span class="mi">2</span>
</code></pre></div>

<p>事实证明，<code>feature-2</code> 不依赖于 <code>feature-1</code> 的任何更改，它依赖于提交 E，因此你可以将其作为基础脱离 <code>master</code>。因此，解决方法是：</p>
<div class="highlight"><pre><span></span><code>git rebase --onto master feature-1 feature-2
</code></pre></div>

<p>非交互式变基对所有牵连的提交都执行默认操作（<code>pick</code>）<sup id="fnref5"> <a href="#fn5" rel="footnote">  5 </a></sup> ，它只是简单地将不在 <code>feature-1</code> 中的 <code>feature-2</code> 中提交重放到 <code>master</code> 上。你的历史记录现在看起来像这样：</p>
<div class="highlight"><pre><span></span><code><span class="n">A</span><span class="o">--</span><span class="n">B</span><span class="o">--</span><span class="n">C</span><span class="o">--</span><span class="n">D</span><span class="o">--&gt;</span><span class="w"> </span><span class="n">master</span>
<span class="w">   </span><span class="o">|</span><span class="w">     </span><span class="err">\</span><span class="o">--</span><span class="n">G</span><span class="o">--&gt;</span><span class="w"> </span><span class="n">feature</span><span class="o">-</span><span class="mi">2</span>
<span class="w">   </span><span class="err">\</span><span class="o">--</span><span class="n">E</span><span class="o">--</span><span class="n">F</span><span class="o">--&gt;</span><span class="w"> </span><span class="n">feature</span><span class="o">-</span><span class="mi">1</span>
</code></pre></div>

<h3>解决冲突</h3>
<p>解决合并冲突的详细信息不在本指南的范围内，将来请你注意另一篇指南。假设你熟悉通常的解决冲突的方法，那么这里是专门适用于变基的部分。</p>
<p>有时，在进行变基时会遇到合并冲突，你可以像处理其他任何合并冲突一样处理该冲突。Git 将在受影响的文件中设置冲突标记，<code>git status</code> 将显示你需要解决的问题，并且你可以使用 <code>git add</code> 或 <code>git rm</code> 将文件标记为已解决。但是，在 <code>git rebase</code> 的上下文中，你应该注意两个选项。</p>
<p>首先是如何完成冲突解决。解决由于 <code>git merge</code> 引起的冲突时，与其使用 <code>git commit</code> 那样的命令，更适当的变基命令是 <code>git rebase --continue</code>。但是，还有一个可用的选项：<code>git rebase --skip</code>。 这将跳过你正在处理的提交，它不会包含在变基中。这在执行非交互性变基时最常见，这时 Git 不会意识到它从“其他”分支中提取的提交是与“我们”分支上冲突的提交的更新版本。</p>
<h3>帮帮我！ 我把它弄坏了！</h3>
<p>毫无疑问，变基有时会很难。如果你犯了一个错误，并因此而丢失了所需的提交，那么可以使用 <code>git reflog</code> 来节省下一天的时间。运行此命令将向你显示更改一个引用（即分支和标记）的每个操作。每行显示你的旧引用所指向的内容，你可对你认为丢失的 Git 提交执行 <code>git cherry-pick</code>、<code>git checkout</code>、<code>git show</code> 或任何其他操作。</p>
<p>via: <a href="https://git-rebase.io/">https://git-rebase.io/</a></p>
<p>作者：<a href="https://git-rebase.io/">git-rebase</a> 选题：<a href="https://github.com/lujun9972">lujun9972</a> 译者：<a href="https://github.com/wxy">wxy</a> 校对：<a href="https://github.com/wxy">wxy</a></p>
<p>本文由 <a href="https://github.com/LCTT/TranslateProject">LCTT</a> 原创编译，<a href="https://linux.cn/">Linux中国</a> 荣誉推出</p>
    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>links</h2>
                        <ul>
                            <li><a href="https://getpelican.com/">Pelican</a></li>
                            <li><a href="https://www.python.org/">Python.org</a></li>
                            <li><a href="https://palletsprojects.com/p/jinja/">Jinja2</a></li>
                            <li><a href="#">You can modify those links in your config file</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>

                            <li><a href="#">You can add links in your config file</a></li>
                            <li><a href="#">Another social link</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a rel="nofollow" href="https://getpelican.com/">Pelican</a>, which takes great advantage of <a rel="nofollow" href="https://www.python.org/">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a rel="nofollow" href="https://www.smashingmagazine.com/2009/08/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>