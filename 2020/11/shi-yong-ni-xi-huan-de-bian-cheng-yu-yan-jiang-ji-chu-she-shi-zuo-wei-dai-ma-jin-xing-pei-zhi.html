<!DOCTYPE html>
<html lang="zh">
<head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="generator" content="Pelican" />
        <title>使用你喜欢的编程语言，将基础设施作为代码进行配置</title>
        <link rel="stylesheet" href="/theme/css/main.css" />
        <meta name="description" content="Author: Lee Briggs 用 Node.js 或其他编程语言为你提供启动基础设施所需的一切服务。 当你在 IT 和技术的世界里遨游时，你会反复遇到 …" />
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">linux_cn</a></h1>
                <nav><ul>
                    <li><a href="/category/chuan-shan-jia-zhuan-fang">穿山甲专访</a></li>
                    <li><a href="/category/dai-ma-ying-xiong">代码英雄</a></li>
                    <li><a href="/category/fen-xiang">分享</a></li>
                    <li><a href="/category/guan-dian">观点</a></li>
                    <li><a href="/category/huo-dong">活动</a></li>
                    <li><a href="/category/ji-ke-man-hua">极客漫画</a></li>
                    <li><a href="/category/ji-zhu">技术</a></li>
                    <li><a href="/category/kai-yuan-zhi-hui">开源智慧</a></li>
                    <li><a href="/category/linux-fa-xing-ban">Linux 发行版</a></li>
                    <li><a href="/category/mei-ri-an-quan-zi-xun">每日安全资讯</a></li>
                    <li><a href="/category/misc">Misc</a></li>
                    <li><a href="/category/qu-kuai-lian">区块链</a></li>
                    <li><a href="/category/rong-qi-yu-yun">容器与云</a></li>
                    <li><a href="/category/ruan-jian-kai-fa">软件开发</a></li>
                    <li><a href="/category/shu-mei-pai">树莓派</a></li>
                    <li class="active"><a href="/category/xi-tong-yun-wei">系统运维</a></li>
                    <li><a href="/category/xin-wen">新闻</a></li>
                    <li><a href="/category/ying-he-guan-cha">硬核观察</a></li>
                    <li><a href="/category/zhi-ye-sheng-ya">职业生涯</a></li>
                    <li><a href="/category/zhong-jiang-ming-dan">中奖名单</a></li>
                    <li><a href="/category/zhuo-mian-ying-yong">桌面应用</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="/2020/11/shi-yong-ni-xi-huan-de-bian-cheng-yu-yan-jiang-ji-chu-she-shi-zuo-wei-dai-ma-jin-xing-pei-zhi.html" rel="bookmark"
           title="Permalink to 使用你喜欢的编程语言，将基础设施作为代码进行配置">使用你喜欢的编程语言，将基础设施作为代码进行配置</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2020-11-27T15:11:43+01:00">
                Published: Fri 27 November 2020
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/linux-fans-from-china.html">linux fans from china</a>
        </address>
<p>In <a href="/category/xi-tong-yun-wei">系统运维</a>.</p>

</footer><!-- /.post-info -->      <p>Author: Lee Briggs</p>
<blockquote>
<p>用 Node.js 或其他编程语言为你提供启动基础设施所需的一切服务。</p>
</blockquote>
<p><img alt="" src="/data/attachment/album/202011/27/151108bnnggmxegfzwog46.jpg"></p>
<p>当你在 IT 和技术的世界里遨游时，你会反复遇到一些术语。其中有些术语很难量化，随着时间的推移，可能会有不同的含义。<a href="https://opensource.com/resources/devops">“DevOps”</a> 就是一个例子，这个词似乎（在我看来）会根据使用它的人而改变；最初的 DevOps 先驱者可能甚至不认识我们今天所说的 DevOps。</p>
<p>如果你是一个软件开发者，“<ruby> 基础架构即代码 <rt>  Infrastructure as Code </rt></ruby>”（IaC）可能是其中一个术语。IaC 是使用与你编写面向用户的功能相同的软件开发实践来声明应用程序运行的基础设施。这通常意味着使用 <a href="https://git-scm.com/">Git</a> 或 <a href="https://www.mercurial-scm.org/">Mercurial</a> 等工具进行版本控制，使用 Puppet、Chef 或 Ansible 进行<a href="https://opensource.com/article/18/12/configuration-management-tools">配置管理</a>。在基础设施供应层，最常见的技术是 CloudFormation（专用于 AWS），或开源替代品 <a href="https://opensource.com/article/20/7/terraform-kubernetes">Terraform</a>，用来创建供你的应用程序运行的混合云资源。</p>
<p>在配置管理领域有很好产品可供选择，可以将 IaC 写成配置文件或首选的编程语言，但这种选择在基础设施供应领域并不常见。</p>
<p><a href="https://www.pulumi.com/">Pulumi</a> 提供了一个使用标准编程语言来定义基础设施的方式。它支持一系列语言，包括 <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript">JavaScript</a>、<a href="https://www.typescriptlang.org/">TypeScript</a>、<a href="https://golang.org/">Go</a>、<a href="https://www.python.org/">Python</a> 和 <a href="https://en.wikipedia.org/wiki/C_Sharp_(programming_language)">C#</a>。就像 Terraform 一样，Pulumi 对许多熟悉的云提供商有一流的支持，比如 <a href="https://www.pulumi.com/docs/intro/cloud-providers/aws/">AWS</a>、<a href="https://www.pulumi.com/docs/intro/cloud-providers/azure/">Azure</a>、<a href="https://www.pulumi.com/docs/intro/cloud-providers/gcp/">Google Cloud</a> 和<a href="https://www.pulumi.com/docs/reference/pkg/">其他提供商</a>。</p>
<p>在本文中，我将向你展示如何使用 Pulumi 以 Node.js 编写基础设施。</p>
<h3>先决条件</h3>
<p>首先，确保你已经做好了使用 Pulumi 的准备。Pulumi 支持所有主流的操作系统，所以你安装其先决条件的方法取决于你使用的操作系统。</p>
<p>首先，安装你喜欢的编程语言的解释器。我将使用 TypeScript，所以我需要安装 <code>node</code> 二进制。请查阅 Node 的<a href="https://nodejs.org/en/download/">安装说明</a>，了解你的操作系统的信息。你可以在 <a href="https://opensource.com/article/20/6/homebrew-mac">Mac</a> 或 <a href="https://opensource.com/article/20/6/homebrew-linux">Linux</a> 上使用 <a href="https://brew.sh/">Homebrew</a> 来安装：</p>
<div class="highlight"><pre><span></span><code>brew install node
</code></pre></div>

<p>在 Linux 上，你可以使用你常用的软件包管理器，如 <code>apt</code> 或 <code>dnf</code>。</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>sudo<span class="w"> </span>dnf<span class="w"> </span>install<span class="w"> </span>nodejs
</code></pre></div>

<p>无论哪种情况，结果都应该是 <code>node</code> 二进制文件在你的 <code>$PATH</code> 中可用。要确认它是可访问的，运行：</p>
<div class="highlight"><pre><span></span><code>node --version
</code></pre></div>

<p>接下来，安装 Pulumi 命令行界面（CLI）。你可以在 Pulumi 的文档中找到针对不同操作系统的<a href="https://www.pulumi.com/docs/get-started/install/">安装说明</a>。在 Mac 或 Linux 上使用 <code>brew</code>：</p>
<div class="highlight"><pre><span></span><code>brew install pulumi
</code></pre></div>

<p>另外，你也可以使用安装脚本。首先下载并审查它，然后执行它：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>curl<span class="w"> </span>-fsSL<span class="w"> </span>--output<span class="w"> </span>pulumi_installer.sh<span class="w"> </span>https://get.pulumi.com/
$<span class="w"> </span>more<span class="w">  </span>pulumi_installer.sh
$<span class="w"> </span>sh<span class="w"> </span>./pulumi_installer.sh
</code></pre></div>

<p>同样，我们所希望的结果是在你的路径上有 <code>pulumi</code> 二进制。检查版本以确保你已经准备好了：</p>
<div class="highlight"><pre><span></span><code>pulumi version
v2.5.0
</code></pre></div>

<h3>配置 Pulumi</h3>
<p>在你开始配置任何基础设施之前，给 Pulumi 一个存储其<a href="https://www.pulumi.com/docs/intro/concepts/state/">状态</a>的地方。</p>
<p>Pulumi 将其状态存储在后端。默认的后端是 Pulumi 的软件即服务（它有一个针对个人用户的免费计划），但在这个例子中，我使用替代的文件后端。文件后端将在你的本地文件系统上创建一个文件来存储状态：</p>
<div class="highlight"><pre><span></span><code>pulumi login --local
</code></pre></div>

<p>如果你打算和别人分享这个项目，文件后台可能不是一个好的起点。Pulumi 还可以将其状态存储在 AWS S3 等云对象存储中。要使用它，请创建一个 S3 bucket 并登录：</p>
<div class="highlight"><pre><span></span><code>pulumi login --cloud-url s3://my-pulumi-state-bucket
</code></pre></div>

<p>现在你已经登录到了状态后端，你可以创建一个项目和一个堆栈了！</p>
<p>在你开始创建 Pulumi 项目之前，请先了解以下 Pulumi 术语，你将在本教程中看到这些术语。</p>
<h4>项目</h4>
<p><ruby> <a href="https://www.pulumi.com/docs/intro/concepts/project/">  项目 </a> <rt>  project </rt></ruby>是一个包含 <code>Pulumi.yaml</code> 文件的目录。这个文件包含了 Pulumi 需要知道的元数据，以便进行它的工作。在 <code>Pulumi.yaml</code> 文件中可以找到的示例字段有：</p>
<ul>
<li>运行时（例如，Python、Node、Go、.Net）</li>
<li>项目说明（如“我的第一个 Pulumi 项目”）</li>
<li>项目名称</li>
</ul>
<p>项目是一个松散的概念，可以满足你的需求。一般来说，一个项目包含了一系列的<em>资源</em>，这些资源是你想要提供和控制的东西。你可以选择拥有资源很少的小型 Pulumi 项目，也可以选择包含所有你需要的资源的大型项目。随着你对 Pulumi 越来越熟悉，你想如何布局你的项目会变得更加清晰。</p>
<h4>堆栈</h4>
<p>Pulumi <ruby> <a href="https://www.pulumi.com/docs/intro/concepts/stack/">  堆栈 </a> <rt>  stack </rt></ruby>允许你根据可配置的值来区分你的 Pulumi 项目。一个常见的用途是将一个项目部署到不同的环境，如开发或生产环境，或不同的地区，如欧洲、中东和非洲以及美国。</p>
<p>在入门时，你不大需要一个复杂的堆栈设置，所以本演练使用默认的堆栈名称 <code>dev</code>。</p>
<h3>在 IaC 中使用 TypeScript</h3>
<p>你可以使用方便的 <code>pulumi new</code> 命令来<ruby> 初建 <rt>  bootstrap </rt></ruby>一个 Pulumi 项目。<code>new</code> 命令有一大堆标志和选项，可以帮助你入门 Pulumi，所以请继续创建你的第一个项目：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>pulumi<span class="w"> </span>new<span class="w"> </span>typescript
This<span class="w"> </span><span class="nb">command</span><span class="w"> </span>will<span class="w"> </span>walk<span class="w"> </span>you<span class="w"> </span>through<span class="w"> </span>creating<span class="w"> </span>a<span class="w"> </span>new<span class="w"> </span>Pulumi<span class="w"> </span>project.

Enter<span class="w"> </span>a<span class="w"> </span>value<span class="w"> </span>or<span class="w"> </span>leave<span class="w"> </span>blank<span class="w"> </span>to<span class="w"> </span>accept<span class="w"> </span>the<span class="w"> </span><span class="o">(</span>default<span class="o">)</span>,<span class="w"> </span>and<span class="w"> </span>press<span class="w"> </span>&lt;ENTER&gt;.
Press<span class="w"> </span>^C<span class="w"> </span>at<span class="w"> </span>any<span class="w"> </span><span class="nb">time</span><span class="w"> </span>to<span class="w"> </span>quit.

project<span class="w"> </span>name:<span class="w"> </span><span class="o">(</span>pulumi<span class="o">)</span><span class="w"> </span>my-first-project
project<span class="w"> </span>description:<span class="w"> </span><span class="o">(</span>A<span class="w"> </span>minimal<span class="w"> </span>TypeScript<span class="w"> </span>Pulumi<span class="w"> </span>program<span class="o">)</span><span class="w"> </span>My<span class="w"> </span>very<span class="w"> </span>first<span class="w"> </span>Pulumi<span class="w"> </span>program
Created<span class="w"> </span>project<span class="w"> </span><span class="s1">&#39;my-first-project&#39;</span>

Please<span class="w"> </span>enter<span class="w"> </span>your<span class="w"> </span>desired<span class="w"> </span>stack<span class="w"> </span>name.
To<span class="w"> </span>create<span class="w"> </span>a<span class="w"> </span>stack<span class="w"> </span><span class="k">in</span><span class="w"> </span>an<span class="w"> </span>organization,<span class="w"> </span>use<span class="w"> </span>the<span class="w"> </span>format<span class="w"> </span>&lt;org-name&gt;/&lt;stack-name&gt;<span class="w"> </span><span class="o">(</span>e.g.<span class="w"> </span><span class="sb">`</span>acmecorp/dev<span class="sb">`</span><span class="o">)</span>.
stack<span class="w"> </span>name:<span class="w"> </span><span class="o">(</span>dev<span class="o">)</span><span class="w"> </span>dev
Created<span class="w"> </span>stack<span class="w"> </span><span class="s1">&#39;dev&#39;</span>

Installing<span class="w"> </span>dependencies...


&gt;<span class="w"> </span>node<span class="w"> </span>scripts/postinstall

added<span class="w"> </span><span class="m">82</span><span class="w"> </span>packages<span class="w"> </span>from<span class="w"> </span><span class="m">126</span><span class="w"> </span>contributors<span class="w"> </span>and<span class="w"> </span>audited<span class="w"> </span><span class="m">82</span><span class="w"> </span>packages<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">2</span>.84s

<span class="m">13</span><span class="w"> </span>packages<span class="w"> </span>are<span class="w"> </span>looking<span class="w"> </span><span class="k">for</span><span class="w"> </span>funding
<span class="w">  </span>run<span class="w"> </span><span class="sb">`</span>npm<span class="w"> </span>fund<span class="sb">`</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>details

found<span class="w"> </span><span class="m">0</span><span class="w"> </span>vulnerabilities

Finished<span class="w"> </span>installing<span class="w"> </span>dependencies

Your<span class="w"> </span>new<span class="w"> </span>project<span class="w"> </span>is<span class="w"> </span>ready<span class="w"> </span>to<span class="w"> </span>go!<span class="w"> </span>✨

To<span class="w"> </span>perform<span class="w"> </span>an<span class="w"> </span>initial<span class="w"> </span>deployment,<span class="w"> </span>run<span class="w"> </span><span class="s1">&#39;pulumi up&#39;</span>
</code></pre></div>

<p>这里发生了很多事情，我将其展开来说：</p>
<p>第一部分是为你的 Pulumi 项目确定一个模板。我选择了通用的 <code>typescript</code> 选项，但是有<a href="https://github.com/pulumi/templates">很多选项可供选择</a>。</p>
<p>这个 <code>new</code> 命令从你的模板库中抓取模板，并将这个文件复制到本地，包括运行时的依赖关系（在本例中是 <code>package.json</code>）。</p>
<p><code>new</code> 命令通过在这个目录下运行 <code>npm install</code> 来安装这些依赖关系。然后 <code>npm install</code> 下载并安装运行 Pulumi 程序所需的一切，在这种情况下就是：<code>@pulumi/pulumi</code> NPM 包。</p>
<p>你已经准备好创建你的第一个资源了!</p>
<h3>创建你的第一个云资源</h3>
<p>资源是一个由你的基础设施供应软件生命周期进行管理的东西。资源一般是一个<ruby> 云提供商对象 <rt>  cloud provider object </rt></ruby>，比如 S3 桶。Pulumi 的提供商处理 Pulumi 资源，提供商是具体的云提供商。Pulumi 有大约 <a href="https://www.pulumi.com/docs/intro/cloud-providers/">40 个提供商</a>可供你使用，但对于你的第一个资源，使用一个最简单的：<ruby> <a href="https://www.pulumi.com/docs/intro/cloud-providers/random/">  随机提供商 </a> <rt>  random provider </rt></ruby>。</p>
<p>随机提供者顾名思义：它幂等地创建一个随机资源（例如，可以是一个字符串），并将其存储在 Pulumi 状态中。</p>
<p>使用 <code>npm</code> 将其添加到你的 Pulumi 项目中作为依赖关系：</p>
<div class="highlight"><pre><span></span><code><span class="n">npm</span><span class="w"> </span><span class="n">install</span><span class="w"> </span><span class="nv">@pulumi</span><span class="o">/</span><span class="n">random</span>
</code></pre></div>

<p>npm 包管理器下载并安装随机提供者包，并为你安装。现在你已经准备好编写你的 Pulumi 程序了。</p>
<p>当你之前生成你的项目时，Pulumi 的初建过程创建了一个 <code>index.ts</code> TypeScript 文件。在你喜欢的集成开发环境（IDE）中打开它，并添加你的第一个资源：</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="o">*</span> <span class="k">as</span> <span class="n">pulumi</span> <span class="kn">from</span> <span class="s2">&quot;@pulumi/pulumi&quot;</span><span class="p">;</span>
<span class="kn">import</span> <span class="o">*</span> <span class="k">as</span> <span class="n">random</span> <span class="kn">from</span> <span class="s2">&quot;@pulumi/random&quot;</span><span class="p">;</span>

<span class="n">const</span> <span class="n">password</span> <span class="o">=</span> <span class="n">new</span> <span class="n">random</span><span class="o">.</span><span class="n">RandomString</span><span class="p">(</span><span class="err">`</span><span class="n">password</span><span class="err">`</span><span class="p">,</span> <span class="p">{</span>
    <span class="n">length</span><span class="p">:</span> <span class="mi">10</span>
<span class="p">})</span>
</code></pre></div>

<p>如果你对 TypeScript 或 JavaScript 非常熟悉，这看起来会非常熟悉，因为它是用你熟悉的编程语言编写的。如果你使用的是 Pulumi 支持的其他语言之一，也是一样的。这里是之前的那个随机资源，但这次是用 Python 写的：</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">pulumi_random</span> <span class="k">as</span> <span class="nn">random</span>

<span class="n">password</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">RandomString</span><span class="p">(</span><span class="s2">&quot;password&quot;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</code></pre></div>

<p>一个 Pulumi 项目目前只支持单一一种语言，但每个项目都可以引用其他语言编写的项目，这对于多语言团队的成员来说是一个很有用的技巧。</p>
<p>你已经编写了第一个 Pulumi 资源。现在你需要部署它。</p>
<p>离开编辑器，回到命令行。在你的项目目录下，运行 <code>pulumi up</code>，然后看着神奇的事情发生：</p>
<div class="highlight"><pre><span></span><code><span class="nv">pulumi</span><span class="w"> </span><span class="nv">up</span>

<span class="nv">Previewing</span><span class="w"> </span><span class="nv">update</span><span class="w"> </span><span class="ss">(</span><span class="nv">dev</span><span class="ss">)</span>:
<span class="w">     </span><span class="nv">Type</span><span class="w">                          </span><span class="nv">Name</span><span class="w">                  </span><span class="nv">Plan</span>
<span class="w"> </span><span class="o">+</span><span class="w">   </span><span class="nv">pulumi</span>:<span class="nv">pulumi</span>:<span class="nv">Stack</span><span class="w">           </span><span class="nv">my</span><span class="o">-</span><span class="nv">first</span><span class="o">-</span><span class="nv">project</span><span class="o">-</span><span class="nv">dev</span><span class="w">  </span><span class="nv">create</span>
<span class="w"> </span><span class="o">+</span><span class="w">   </span>└─<span class="w"> </span><span class="k">random</span>:<span class="nv">index</span>:<span class="nv">RandomString</span><span class="w">  </span><span class="nv">password</span><span class="w">              </span><span class="nv">create</span>

<span class="nv">Resources</span>:
<span class="w">    </span><span class="o">+</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="nv">create</span>

<span class="k">Do</span><span class="w"> </span><span class="nv">you</span><span class="w"> </span><span class="nv">want</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="nv">perform</span><span class="w"> </span><span class="nv">this</span><span class="w"> </span><span class="nv">update</span>?<span class="w"> </span><span class="nv">yes</span>
<span class="nv">Updating</span><span class="w"> </span><span class="ss">(</span><span class="nv">dev</span><span class="ss">)</span>:
<span class="w">     </span><span class="nv">Type</span><span class="w">                          </span><span class="nv">Name</span><span class="w">                  </span><span class="nv">Status</span>
<span class="w"> </span><span class="o">+</span><span class="w">   </span><span class="nv">pulumi</span>:<span class="nv">pulumi</span>:<span class="nv">Stack</span><span class="w">           </span><span class="nv">my</span><span class="o">-</span><span class="nv">first</span><span class="o">-</span><span class="nv">project</span><span class="o">-</span><span class="nv">dev</span><span class="w">  </span><span class="nv">created</span>
<span class="w"> </span><span class="o">+</span><span class="w">   </span>└─<span class="w"> </span><span class="k">random</span>:<span class="nv">index</span>:<span class="nv">RandomString</span><span class="w">  </span><span class="nv">password</span><span class="w">              </span><span class="nv">created</span>

<span class="nv">Resources</span>:
<span class="w">    </span><span class="o">+</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="nv">created</span>

<span class="nv">Duration</span>:<span class="w"> </span><span class="mi">2</span><span class="nv">s</span>

<span class="nv">Permalink</span>:<span class="w"> </span><span class="nv">file</span>:<span class="o">///</span><span class="nv">Users</span><span class="o">/</span><span class="nv">lbriggs</span><span class="o">/</span>.<span class="nv">pulumi</span><span class="o">/</span><span class="nv">stacks</span><span class="o">/</span><span class="nv">dev</span>.<span class="nv">json</span>
</code></pre></div>

<p>太好了，你有了第一个 Pulumi 资源! 虽然你可能很享受这种成就感，但不幸的是，这个随机资源并没有那么有用：它只是一个随机的字符串，你甚至看不到它是什么。先解决这部分问题。修改你之前的程序，在你创建的常量中加入 <code>export</code>：</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="o">*</span> <span class="k">as</span> <span class="n">pulumi</span> <span class="kn">from</span> <span class="s2">&quot;@pulumi/pulumi&quot;</span><span class="p">;</span>
<span class="kn">import</span> <span class="o">*</span> <span class="k">as</span> <span class="n">random</span> <span class="kn">from</span> <span class="s2">&quot;@pulumi/random&quot;</span><span class="p">;</span>

<span class="n">export</span> <span class="n">const</span> <span class="n">password</span> <span class="o">=</span> <span class="n">new</span> <span class="n">random</span><span class="o">.</span><span class="n">RandomString</span><span class="p">(</span><span class="err">`</span><span class="n">password</span><span class="err">`</span><span class="p">,</span> <span class="p">{</span>
    <span class="n">length</span><span class="p">:</span> <span class="mi">10</span>
<span class="p">})</span>
</code></pre></div>

<p>重新运行 <code>pulumi up</code>，看看输出：</p>
<div class="highlight"><pre><span></span><code><span class="nv">pulumi</span><span class="w"> </span><span class="nv">up</span>
<span class="nv">Previewing</span><span class="w"> </span><span class="nv">update</span><span class="w"> </span><span class="ss">(</span><span class="nv">dev</span><span class="ss">)</span>:
<span class="w">     </span><span class="nv">Type</span><span class="w">                 </span><span class="nv">Name</span><span class="w">                  </span><span class="nv">Plan</span>
<span class="w">     </span><span class="nv">pulumi</span>:<span class="nv">pulumi</span>:<span class="nv">Stack</span><span class="w">  </span><span class="nv">my</span><span class="o">-</span><span class="nv">first</span><span class="o">-</span><span class="nv">project</span><span class="o">-</span><span class="nv">dev</span>

<span class="nv">Outputs</span>:
<span class="w">  </span><span class="o">+</span><span class="w"> </span><span class="nv">password</span>:<span class="w"> </span>{
<span class="w">      </span><span class="o">+</span><span class="w"> </span><span class="nv">id</span><span class="w">             </span>:<span class="w"> </span><span class="s2">&quot;&amp;+r?{}J$J7&quot;</span>
<span class="w">      </span><span class="o">+</span><span class="w"> </span><span class="nv">keepers</span><span class="w">        </span>:<span class="w"> </span><span class="nv">output</span><span class="o">&lt;</span><span class="nv">string</span><span class="o">&gt;</span>
<span class="w">      </span><span class="o">+</span><span class="w"> </span><span class="nv">length</span><span class="w">         </span>:<span class="w"> </span><span class="mi">10</span>
<span class="w">      </span><span class="o">+</span><span class="w"> </span><span class="nv">lower</span><span class="w">          </span>:<span class="w"> </span><span class="nv">true</span>
<span class="w">      </span><span class="o">+</span><span class="w"> </span><span class="nv">minLower</span><span class="w">       </span>:<span class="w"> </span><span class="mi">0</span>
<span class="w">      </span><span class="o">+</span><span class="w"> </span><span class="nv">minNumeric</span><span class="w">     </span>:<span class="w"> </span><span class="mi">0</span>
<span class="w">      </span><span class="o">+</span><span class="w"> </span><span class="nv">minSpecial</span><span class="w">     </span>:<span class="w"> </span><span class="mi">0</span>
<span class="w">      </span><span class="o">+</span><span class="w"> </span><span class="nv">minUpper</span><span class="w">       </span>:<span class="w"> </span><span class="mi">0</span>
<span class="w">      </span><span class="o">+</span><span class="w"> </span><span class="nv">number</span><span class="w">         </span>:<span class="w"> </span><span class="nv">true</span>
<span class="w">      </span><span class="o">+</span><span class="w"> </span><span class="nv">overrideSpecial</span>:<span class="w"> </span><span class="nv">output</span><span class="o">&lt;</span><span class="nv">string</span><span class="o">&gt;</span>
<span class="w">      </span><span class="o">+</span><span class="w"> </span><span class="nb">result</span><span class="w">         </span>:<span class="w"> </span><span class="s2">&quot;&amp;+r?{}J$J7&quot;</span>
<span class="w">      </span><span class="o">+</span><span class="w"> </span><span class="nv">special</span><span class="w">        </span>:<span class="w"> </span><span class="nv">true</span>
<span class="w">      </span><span class="o">+</span><span class="w"> </span><span class="nv">upper</span><span class="w">          </span>:<span class="w"> </span><span class="nv">true</span>
<span class="w">      </span><span class="o">+</span><span class="w"> </span><span class="nv">urn</span><span class="w">            </span>:<span class="w"> </span><span class="s2">&quot;urn:pulumi:dev::my-first-project::random:index/randomString:RandomString::password&quot;</span>
<span class="w">    </span>}

<span class="nv">Resources</span>:
<span class="w">    </span><span class="mi">2</span><span class="w"> </span><span class="nv">unchanged</span>

<span class="k">Do</span><span class="w"> </span><span class="nv">you</span><span class="w"> </span><span class="nv">want</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="nv">perform</span><span class="w"> </span><span class="nv">this</span><span class="w"> </span><span class="nv">update</span>?<span class="w"> </span><span class="nv">yes</span>
<span class="nv">Updating</span><span class="w"> </span><span class="ss">(</span><span class="nv">dev</span><span class="ss">)</span>:
<span class="w">     </span><span class="nv">Type</span><span class="w">                 </span><span class="nv">Name</span><span class="w">                  </span><span class="nv">Status</span>
<span class="w">     </span><span class="nv">pulumi</span>:<span class="nv">pulumi</span>:<span class="nv">Stack</span><span class="w">  </span><span class="nv">my</span><span class="o">-</span><span class="nv">first</span><span class="o">-</span><span class="nv">project</span><span class="o">-</span><span class="nv">dev</span>

<span class="nv">Outputs</span>:
<span class="w">  </span><span class="o">+</span><span class="w"> </span><span class="nv">password</span>:<span class="w"> </span>{
<span class="w">      </span><span class="o">+</span><span class="w"> </span><span class="nv">id</span><span class="w">        </span>:<span class="w"> </span><span class="s2">&quot;&amp;+r?{}J$J7&quot;</span>
<span class="w">      </span><span class="o">+</span><span class="w"> </span><span class="nv">length</span><span class="w">    </span>:<span class="w"> </span><span class="mi">10</span>
<span class="w">      </span><span class="o">+</span><span class="w"> </span><span class="nv">lower</span><span class="w">     </span>:<span class="w"> </span><span class="nv">true</span>
<span class="w">      </span><span class="o">+</span><span class="w"> </span><span class="nv">minLower</span><span class="w">  </span>:<span class="w"> </span><span class="mi">0</span>
<span class="w">      </span><span class="o">+</span><span class="w"> </span><span class="nv">minNumeric</span>:<span class="w"> </span><span class="mi">0</span>
<span class="w">      </span><span class="o">+</span><span class="w"> </span><span class="nv">minSpecial</span>:<span class="w"> </span><span class="mi">0</span>
<span class="w">      </span><span class="o">+</span><span class="w"> </span><span class="nv">minUpper</span><span class="w">  </span>:<span class="w"> </span><span class="mi">0</span>
<span class="w">      </span><span class="o">+</span><span class="w"> </span><span class="nv">number</span><span class="w">    </span>:<span class="w"> </span><span class="nv">true</span>
<span class="w">      </span><span class="o">+</span><span class="w"> </span><span class="nb">result</span><span class="w">    </span>:<span class="w"> </span><span class="s2">&quot;&amp;+r?{}J$J7&quot;</span>
<span class="w">      </span><span class="o">+</span><span class="w"> </span><span class="nv">special</span><span class="w">   </span>:<span class="w"> </span><span class="nv">true</span>
<span class="w">      </span><span class="o">+</span><span class="w"> </span><span class="nv">upper</span><span class="w">     </span>:<span class="w"> </span><span class="nv">true</span>
<span class="w">      </span><span class="o">+</span><span class="w"> </span><span class="nv">urn</span><span class="w">       </span>:<span class="w"> </span><span class="s2">&quot;urn:pulumi:dev::my-first-project::random:index/randomString:RandomString::password&quot;</span>
<span class="w">    </span>}

<span class="nv">Resources</span>:
<span class="w">    </span><span class="mi">2</span><span class="w"> </span><span class="nv">unchanged</span>

<span class="nv">Duration</span>:<span class="w"> </span><span class="mi">1</span><span class="nv">s</span>
<span class="nv">Permalink</span>:<span class="w"> </span><span class="nv">file</span>:<span class="o">///</span><span class="nv">Users</span><span class="o">/</span><span class="nv">lbriggs</span><span class="o">/</span>.<span class="nv">pulumi</span><span class="o">/</span><span class="nv">stacks</span><span class="o">/</span><span class="nv">dev</span>.<span class="nv">json</span>
</code></pre></div>

<p>现在你可以在 <code>Outputs</code> 的 <code>result</code> 部分下看到一个随机生成的字符串。你现在可以看到你创建的资源有很多属性。</p>
<p>这一切都很好，但如果你想享受 IaC，你得提供一些随机字符串以外的东西。试试吧。</p>
<h3>部署一个容器</h3>
<p>到目前为止，你已经通过安装依赖关系和注册一个简单的随机资源来 体验了初建你的 Pulumi。现在部署一些实际的基础设施，尽管是在你的本地机器上。</p>
<p>首先，将 <code>@pulumi/docker</code> 提供者添加到你的堆栈中。使用你选择的包管理器将其添加到项目中：</p>
<div class="highlight"><pre><span></span><code><span class="n">npm</span><span class="w"> </span><span class="n">install</span><span class="w"> </span><span class="nv">@pulumi</span><span class="o">/</span><span class="n">docker</span>
</code></pre></div>

<p>你已经从 <code>npm</code> 下拉了 Pulumi Docker 提供商包，这意味着你现在可以在你的项目中创建 Docker 镜像。</p>
<p>如果你的机器上还没有安装 Docker，现在是一个极好的时机去安装它。说明将取决于你的操作系统，所以看看 <a href="https://docs.docker.com/get-docker/">Docker 的安装页面</a>了解信息。</p>
<p>再次打开你喜欢的 IDE，运行一个 Docker 容器。修改你之前的 <code>index.ts</code> 文件，让它看起来像这样：</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="o">*</span> <span class="k">as</span> <span class="n">pulumi</span> <span class="kn">from</span> <span class="s2">&quot;@pulumi/pulumi&quot;</span><span class="p">;</span>
<span class="kn">import</span> <span class="o">*</span> <span class="k">as</span> <span class="n">random</span> <span class="kn">from</span> <span class="s2">&quot;@pulumi/random&quot;</span><span class="p">;</span>
<span class="kn">import</span> <span class="o">*</span> <span class="k">as</span> <span class="n">docker</span> <span class="kn">from</span> <span class="s2">&quot;@pulumi/docker&quot;</span><span class="p">;</span>

<span class="n">const</span> <span class="n">password</span> <span class="o">=</span> <span class="n">new</span> <span class="n">random</span><span class="o">.</span><span class="n">RandomString</span><span class="p">(</span><span class="err">`</span><span class="n">password</span><span class="err">`</span><span class="p">,</span> <span class="p">{</span>
    <span class="n">length</span><span class="p">:</span> <span class="mi">10</span>
<span class="p">})</span>

<span class="n">const</span> <span class="n">container</span> <span class="o">=</span> <span class="n">new</span> <span class="n">docker</span><span class="o">.</span><span class="n">Container</span><span class="p">(</span><span class="err">`</span><span class="n">my</span><span class="o">-</span><span class="n">password</span><span class="err">`</span><span class="p">,</span> <span class="p">{</span>
    <span class="n">image</span><span class="p">:</span> <span class="s1">&#39;hashicorp/http-echo&#39;</span><span class="p">,</span>
    <span class="n">command</span><span class="p">:</span> <span class="p">[</span> <span class="n">pulumi</span><span class="o">.</span><span class="n">interpolate</span><span class="err">`</span><span class="o">-</span><span class="n">text</span><span class="o">=</span><span class="n">Your</span> <span class="nb">super</span> <span class="n">secret</span> <span class="n">password</span> <span class="ow">is</span><span class="p">:</span> <span class="err">$</span><span class="p">{</span><span class="n">password</span><span class="o">.</span><span class="n">result</span><span class="p">}</span><span class="err">`</span> <span class="p">],</span>
    <span class="n">ports</span><span class="p">:</span> <span class="p">[{</span>
        <span class="n">internal</span><span class="p">:</span> <span class="mi">5678</span><span class="p">,</span>
        <span class="n">external</span><span class="p">:</span> <span class="mi">5678</span><span class="p">,</span>
    <span class="p">}]</span>
<span class="p">})</span>

<span class="n">export</span> <span class="n">const</span> <span class="nb">id</span> <span class="o">=</span> <span class="n">container</span><span class="o">.</span><span class="n">id</span>
</code></pre></div>

<p>这将创建一个容器，创建一个 Web 服务器。Web 服务器的输出是你随机生成的字符串，在本例中是一个密码。运行这个，看看会发生什么：</p>
<div class="highlight"><pre><span></span><code><span class="nv">pulumi</span><span class="w"> </span><span class="nv">up</span>

<span class="nv">Previewing</span><span class="w"> </span><span class="nv">update</span><span class="w"> </span><span class="ss">(</span><span class="nv">dev</span><span class="ss">)</span>:
<span class="w">     </span><span class="nv">Type</span><span class="w">                       </span><span class="nv">Name</span><span class="w">                  </span><span class="nv">Plan</span>
<span class="w">     </span><span class="nv">pulumi</span>:<span class="nv">pulumi</span>:<span class="nv">Stack</span><span class="w">        </span><span class="nv">my</span><span class="o">-</span><span class="nv">first</span><span class="o">-</span><span class="nv">project</span><span class="o">-</span><span class="nv">dev</span>
<span class="w"> </span><span class="o">+</span><span class="w">   </span>└─<span class="w"> </span><span class="nv">docker</span>:<span class="nv">index</span>:<span class="nv">Container</span><span class="w">  </span><span class="nv">my</span><span class="o">-</span><span class="nv">password</span><span class="w">           </span><span class="nv">create</span>

<span class="nv">Outputs</span>:
<span class="w">  </span><span class="o">+</span><span class="w"> </span><span class="nv">id</span><span class="w">      </span>:<span class="w"> </span><span class="nv">output</span><span class="o">&lt;</span><span class="nv">string</span><span class="o">&gt;</span>
<span class="w">  </span><span class="o">~</span><span class="w"> </span><span class="nv">password</span>:<span class="w"> </span>{
<span class="w">        </span><span class="nv">id</span><span class="w">        </span>:<span class="w"> </span><span class="s2">&quot;&amp;+r?{}J$J7&quot;</span>
<span class="w">        </span><span class="nv">length</span><span class="w">    </span>:<span class="w"> </span><span class="mi">10</span>
<span class="w">        </span><span class="nv">lower</span><span class="w">     </span>:<span class="w"> </span><span class="nv">true</span>
<span class="w">        </span><span class="nv">minLower</span><span class="w">  </span>:<span class="w"> </span><span class="mi">0</span>
<span class="w">        </span><span class="nv">minNumeric</span>:<span class="w"> </span><span class="mi">0</span>
<span class="w">        </span><span class="nv">minSpecial</span>:<span class="w"> </span><span class="mi">0</span>
<span class="w">        </span><span class="nv">minUpper</span><span class="w">  </span>:<span class="w"> </span><span class="mi">0</span>
<span class="w">        </span><span class="nv">number</span><span class="w">    </span>:<span class="w"> </span><span class="nv">true</span>
<span class="w">        </span><span class="nb">result</span><span class="w">    </span>:<span class="w"> </span><span class="s2">&quot;&amp;+r?{}J$J7&quot;</span>
<span class="w">        </span><span class="nv">special</span><span class="w">   </span>:<span class="w"> </span><span class="nv">true</span>
<span class="w">        </span><span class="nv">upper</span><span class="w">     </span>:<span class="w"> </span><span class="nv">true</span>
<span class="w">        </span><span class="nv">urn</span><span class="w">       </span>:<span class="w"> </span><span class="s2">&quot;urn:pulumi:dev::my-first-project::random:index/randomString:RandomString::password&quot;</span>
<span class="w">    </span>}

<span class="nv">Resources</span>:
<span class="w">    </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="nv">create</span>
<span class="w">    </span><span class="mi">2</span><span class="w"> </span><span class="nv">unchanged</span>

<span class="k">Do</span><span class="w"> </span><span class="nv">you</span><span class="w"> </span><span class="nv">want</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="nv">perform</span><span class="w"> </span><span class="nv">this</span><span class="w"> </span><span class="nv">update</span>?<span class="w"> </span><span class="nv">yes</span>
<span class="nv">Updating</span><span class="w"> </span><span class="ss">(</span><span class="nv">dev</span><span class="ss">)</span>:
<span class="w">     </span><span class="nv">Type</span><span class="w">                       </span><span class="nv">Name</span><span class="w">                  </span><span class="nv">Status</span>
<span class="w">     </span><span class="nv">pulumi</span>:<span class="nv">pulumi</span>:<span class="nv">Stack</span><span class="w">        </span><span class="nv">my</span><span class="o">-</span><span class="nv">first</span><span class="o">-</span><span class="nv">project</span><span class="o">-</span><span class="nv">dev</span>
<span class="w"> </span><span class="o">+</span><span class="w">   </span>└─<span class="w"> </span><span class="nv">docker</span>:<span class="nv">index</span>:<span class="nv">Container</span><span class="w">  </span><span class="nv">my</span><span class="o">-</span><span class="nv">password</span><span class="w">           </span><span class="nv">created</span>

<span class="nv">Outputs</span>:
<span class="w">  </span><span class="o">+</span><span class="w"> </span><span class="nv">id</span><span class="w">      </span>:<span class="w"> </span><span class="s2">&quot;e73b34aeca34a64b72b61b0b9b8438637ce28853937bc359a1528ca99f49ddda&quot;</span>
<span class="w">    </span><span class="nv">password</span>:<span class="w"> </span>{
<span class="w">        </span><span class="nv">id</span><span class="w">        </span>:<span class="w"> </span><span class="s2">&quot;&amp;+r?{}J$J7&quot;</span>
<span class="w">        </span><span class="nv">length</span><span class="w">    </span>:<span class="w"> </span><span class="mi">10</span>
<span class="w">        </span><span class="nv">lower</span><span class="w">     </span>:<span class="w"> </span><span class="nv">true</span>
<span class="w">        </span><span class="nv">minLower</span><span class="w">  </span>:<span class="w"> </span><span class="mi">0</span>
<span class="w">        </span><span class="nv">minNumeric</span>:<span class="w"> </span><span class="mi">0</span>
<span class="w">        </span><span class="nv">minSpecial</span>:<span class="w"> </span><span class="mi">0</span>
<span class="w">        </span><span class="nv">minUpper</span><span class="w">  </span>:<span class="w"> </span><span class="mi">0</span>
<span class="w">        </span><span class="nv">number</span><span class="w">    </span>:<span class="w"> </span><span class="nv">true</span>
<span class="w">        </span><span class="nb">result</span><span class="w">    </span>:<span class="w"> </span><span class="s2">&quot;&amp;+r?{}J$J7&quot;</span>
<span class="w">        </span><span class="nv">special</span><span class="w">   </span>:<span class="w"> </span><span class="nv">true</span>
<span class="w">        </span><span class="nv">upper</span><span class="w">     </span>:<span class="w"> </span><span class="nv">true</span>
<span class="w">        </span><span class="nv">urn</span><span class="w">       </span>:<span class="w"> </span><span class="s2">&quot;urn:pulumi:dev::my-first-project::random:index/randomString:RandomString::password&quot;</span>
<span class="w">    </span>}

<span class="nv">Resources</span>:
<span class="w">    </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="nv">created</span>
<span class="w">    </span><span class="mi">2</span><span class="w"> </span><span class="nv">unchanged</span>

<span class="nv">Duration</span>:<span class="w"> </span><span class="mi">2</span><span class="nv">s</span>
<span class="nv">Permalink</span>:<span class="w"> </span><span class="nv">file</span>:<span class="o">///</span><span class="nv">Users</span><span class="o">/</span><span class="nv">lbriggs</span><span class="o">/</span>.<span class="nv">pulumi</span><span class="o">/</span><span class="nv">stacks</span><span class="o">/</span><span class="nv">dev</span>.<span class="nv">json</span>
</code></pre></div>

<p>你会注意到在 <code>Outputs</code> 部分，你输出的值已经改变了，它只是一个 Docker 容器 ID。检查你的非常简单的密码生成器是否工作：</p>
<div class="highlight"><pre><span></span><code>curl http://localhost:5678
Your super secret password is: &amp;+r?{}J$J7
</code></pre></div>

<p>就是这样! 你刚刚用 TypeScript 配置了你的第一个基础架构。</p>
<h4>关于 Pulumi 输出的快速说明</h4>
<p>你会注意到在创建 Docker 容器的代码中，它使用了一个特殊的 <code>pulumi.interpolate</code> 调用。如果你熟悉 TypeScript，你可能会好奇为什么需要这样做（因为它是 Pulumi 特有的）。这有一个有趣的原因。</p>
<p>当 Pulumi 创建一个资源时，直到程序执行时有一些值是 Pulumi 不知道的。在 Pulumi 中，这些值被称为 <code>Outputs</code>。这些 <code>Outputs</code> 可以在上面的代码中看到，例如，在你的第一个随机资源中，你使用 <code>export</code> 关键字来输出随机资源的属性，你还输出了你创建的容器的容器 ID。</p>
<p>因为 Pulumi 直到执行时才知道这些 <code>Outputs</code> 的值，所以在操作字符串时，它需要特殊的助手来使用它们。如果你想了解更多关于这个特殊的编程模型，请观看<a href="https://www.youtube.com/watch?v=lybOxul2otM">这个短视频</a>。</p>
<h3>总结</h3>
<p>随着混合云基础架构中出现的复杂性，IaC 在很多方面都有了发展。在基础设施供应领域，Pulumi 是一个很好的选择，它可以使用你最喜欢的编程语言来供应你所需要的一切基础设施，然后你可以在你最喜欢的配置管理工具中进行标记，以采取下一步措施。</p>
    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>links</h2>
                        <ul>
                            <li><a href="https://getpelican.com/">Pelican</a></li>
                            <li><a href="https://www.python.org/">Python.org</a></li>
                            <li><a href="https://palletsprojects.com/p/jinja/">Jinja2</a></li>
                            <li><a href="#">You can modify those links in your config file</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>

                            <li><a href="#">You can add links in your config file</a></li>
                            <li><a href="#">Another social link</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a rel="nofollow" href="https://getpelican.com/">Pelican</a>, which takes great advantage of <a rel="nofollow" href="https://www.python.org/">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a rel="nofollow" href="https://www.smashingmagazine.com/2009/08/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>