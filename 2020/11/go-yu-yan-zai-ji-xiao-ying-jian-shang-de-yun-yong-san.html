<!DOCTYPE html>
<html lang="zh">
<head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="generator" content="Pelican" />
        <title>Go 语言在极小硬件上的运用（三）</title>
        <link rel="stylesheet" href="/theme/css/main.css" />
        <meta name="description" content="Author: Michał Derkacz 在本系列的 第一 和 第二 部分中讨论的大多数示例都是以某种方式闪烁的 LED。起初它可能很有趣，但是一段时间后 …" />
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">linux_cn</a></h1>
                <nav><ul>
                    <li><a href="/category/chuan-shan-jia-zhuan-fang">穿山甲专访</a></li>
                    <li><a href="/category/dai-ma-ying-xiong">代码英雄</a></li>
                    <li><a href="/category/fen-xiang">分享</a></li>
                    <li><a href="/category/guan-dian">观点</a></li>
                    <li><a href="/category/huo-dong">活动</a></li>
                    <li><a href="/category/ji-ke-man-hua">极客漫画</a></li>
                    <li><a href="/category/ji-zhu">技术</a></li>
                    <li><a href="/category/kai-yuan-zhi-hui">开源智慧</a></li>
                    <li><a href="/category/linux-fa-xing-ban">Linux 发行版</a></li>
                    <li><a href="/category/mei-ri-an-quan-zi-xun">每日安全资讯</a></li>
                    <li><a href="/category/misc">Misc</a></li>
                    <li><a href="/category/qu-kuai-lian">区块链</a></li>
                    <li><a href="/category/rong-qi-yu-yun">容器与云</a></li>
                    <li class="active"><a href="/category/ruan-jian-kai-fa">软件开发</a></li>
                    <li><a href="/category/shu-mei-pai">树莓派</a></li>
                    <li><a href="/category/xi-tong-yun-wei">系统运维</a></li>
                    <li><a href="/category/xin-wen">新闻</a></li>
                    <li><a href="/category/ying-he-guan-cha">硬核观察</a></li>
                    <li><a href="/category/zhi-ye-sheng-ya">职业生涯</a></li>
                    <li><a href="/category/zhong-jiang-ming-dan">中奖名单</a></li>
                    <li><a href="/category/zhuo-mian-ying-yong">桌面应用</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="/2020/11/go-yu-yan-zai-ji-xiao-ying-jian-shang-de-yun-yong-san.html" rel="bookmark"
           title="Permalink to Go 语言在极小硬件上的运用（三）">Go 语言在极小硬件上的运用（三）</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2020-11-03T00:06:00+01:00">
                Published: Tue 03 November 2020
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/linux-fans-from-china.html">linux fans from china</a>
        </address>
<p>In <a href="/category/ruan-jian-kai-fa">软件开发</a>.</p>

</footer><!-- /.post-info -->      <p>Author: Michał Derkacz</p>
<p><img alt="" src="/data/attachment/album/202011/03/000249cjqpwsrvuuqmr9wn.png"></p>
<p>在本系列的 <a href="/article-11383-1.html">第一</a> 和 <a href="/article-12747-1.html">第二</a> 部分中讨论的大多数示例都是以某种方式闪烁的 LED。起初它可能很有趣，但是一段时间后变得有些无聊。让我们做些更有趣的事情……</p>
<p>…让我们点亮更多的 LED！</p>
<p><img alt="STM32F030F4P6" src="/data/attachment/album/202011/03/000716tyl684z694k7vyc6.jpg"></p>
<h3>WS281x LED</h3>
<p><a href="http://www.world-semi.com/solution/list-4-1.html">WS281x</a> RGB LED（及其克隆品）非常受欢迎。你可以以单个元素购买、链成长条或组装成矩阵、环或其他形状。</p>
<p><img alt="WS2812B" src="/data/attachment/album/202011/03/000738k0oxl395ko383x8n.jpg"></p>
<p>它们可以串联连接，基于这个事实，你可以只用 MCU 的单个引脚就可以控制一个很长的 LED 灯条。不幸的是，它们的内部控制器使用的物理协议不能直接适用于你在 MCU 中可以找到的任何外围设备。你必须使用 <ruby> 位脉冲 <rt>  bit-banging </rt></ruby>或以特殊方式使用可用的外设。</p>
<p>哪种可用的解决方案最有效取决于同时控制的 LED 灯条数量。如果你必须驱动 4 到 16 个灯条，那么最有效的方法是 <a href="http://www.martinhubacek.cz/arm/improved-stm32-ws2812b-library">使用定时器和 DMA</a>（请不要忽略这篇文章末尾的链接）。</p>
<p>如果只需要控制一个或两个灯条，请使用可用的 SPI 或 UART 外设。对于 SPI，你只能在发送的一个字节中编码两个 WS281x 位。由于巧妙地使用了起始位和停止位，UART 允许更密集的编码：每发送一个字节 3 位。</p>
<p>我在 <a href="http://mikrokontrolery.blogspot.com/2011/03/Diody-WS2812B-sterowanie-XMega-cz-2.html">此站点</a> 上找到了有关 UART 协议如何适用于 WS281x 协议的最佳解释。如果你不懂波兰语，这里是 <a href="https://translate.google.pl/translate?sl=pl&amp;tl=en&amp;u=http://mikrokontrolery.blogspot.com/2011/03/Diody-WS2812B-sterowanie-XMega-cz-2.html">英文翻译</a>。</p>
<p>基于 WS281x 的 LED 仍然是最受欢迎的，但市场上也有 SPI 控制的 LED：<a href="http://neon-world.com/en/product.php">APA102</a>、<a href="http://www.normandled.com/index.php/Product/view/id/800.html">SK9822</a>。关于它们的三篇有趣的文章在这里：<a href="https://cpldcpu.wordpress.com/2014/08/27/apa102/">1</a>、<a href="https://cpldcpu.wordpress.com/2014/11/30/understanding-the-apa102-superled/">2</a>、<a href="https://cpldcpu.wordpress.com/2016/12/13/sk9822-a-clone-of-the-apa102/">3</a>。</p>
<h3>LED 环</h3>
<p>市场上有许多基于 WS2812 的环。我有一个这样的：</p>
<p><img alt="WS2812B" src="/data/attachment/album/202011/03/000803cs7kfp9o47kp77so.jpg"></p>
<p>它具有 24 个可单独寻址的 RGB LED（WS2812B），并暴露出四个端子：GND、5V、DI 和 DO。通过将 DI（数据输入）端子连接到上一个的 DO（数据输出）端子，可以链接更多的环或其他基于 WS2812 的东西。</p>
<p>让我们将这个环连接到我们的 STM32F030 板上。我们将使用基于 UART 的驱动程序，因此 DI 应连接到 UART 接头连接器上的 TXD 引脚。 WS2812B LED 需要至少 3.5V 的电源。 24 个 LED 会消耗大量电流，因此在编程/调试期间，最好将环上的 GND 和 5V 端子直接连接到 ST-LINK 编程器上可用的 GND 和 5V 引脚：</p>
<p><img alt="WS2812B" src="/data/attachment/album/202011/03/000837a4rk35k3ipplcv5v.jpg"></p>
<p>我们的 STM32F030F4P6 MCU 和整个 STM32 F0、F3、F7、L4 系列具有 F1、F4、L1 MCU 不具备的一项重要功能：它可以反转 UART 信号，因此我们可以将环直接连接到 UART TXD 引脚。如果你不知道我们需要这种反转，那么你可能没有读过我上面提到的 <a href="https://translate.google.pl/translate?sl=pl&amp;tl=en&amp;u=http://mikrokontrolery.blogspot.com/2011/03/Diody-WS2812B-sterowanie-XMega-cz-2.html">文章</a>。</p>
<p>因此，你不能以这种方式使用流行的 <a href="https://jeelabs.org/article/1649a/">Blue Pill</a> 或 <a href="http://www.st.com/en/evaluation-tools/stm32f4discovery.html">STM32F4-DISCOVERY</a>。使用其 SPI 外设或外部反相器。有关使用 SPI 的 NUCLEO-F411RE，请参见 <a href="https://github.com/ziutek/emgo/tree/master/egpath/src/stm32/examples/minidev/treelights">圣诞树灯</a> 项目作为 UART + 逆变器的示例或 <a href="https://github.com/ziutek/emgo/tree/master/egpath/src/stm32/examples/nucleo-f411re/ws2812">WS2812示例</a>。</p>
<p>顺便说一下，大多数 DISCOVERY 板可能还有一个问题：它们在 VDD = 3V 而不是 3.3V 的情况下工作。 对于高 DI，WS281x 至少要求电源电压 * 0.7。如果是 5V 电源，则为 3.5V；如果是 4.7V 电源，则为 3.3V；可在 DISCOVERY 的 5V 引脚上找到。如你所见，即使在我们的情况下，第一个 LED 的工作电压也低于规格 0.2V。对于 DISCOVERY 板，如果供电 4.7V，它将工作在低于规格的 0.3V 下；如果供电 5V，它将工作在低于规格 0.5V 下。</p>
<p>让我们结束这段冗长的介绍并转到代码：</p>
<div class="highlight"><pre><span></span><code><span class="n">package</span> <span class="n">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s2">&quot;delay&quot;</span>
    <span class="s2">&quot;math/rand&quot;</span>
    <span class="s2">&quot;rtos&quot;</span>

    <span class="s2">&quot;led&quot;</span>
    <span class="s2">&quot;led/ws281x/wsuart&quot;</span>

    <span class="s2">&quot;stm32/hal/dma&quot;</span>
    <span class="s2">&quot;stm32/hal/gpio&quot;</span>
    <span class="s2">&quot;stm32/hal/irq&quot;</span>
    <span class="s2">&quot;stm32/hal/system&quot;</span>
    <span class="s2">&quot;stm32/hal/system/timer/systick&quot;</span>
    <span class="s2">&quot;stm32/hal/usart&quot;</span>
<span class="p">)</span>

<span class="n">var</span> <span class="n">tts</span> <span class="o">*</span><span class="n">usart</span><span class="o">.</span><span class="n">Driver</span>

<span class="n">func</span> <span class="n">init</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">system</span><span class="o">.</span><span class="n">SetupPLL</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">48</span><span class="o">/</span><span class="mi">8</span><span class="p">)</span>
    <span class="n">systick</span><span class="o">.</span><span class="n">Setup</span><span class="p">(</span><span class="mf">2e6</span><span class="p">)</span>

    <span class="n">gpio</span><span class="o">.</span><span class="n">A</span><span class="o">.</span><span class="n">EnableClock</span><span class="p">(</span><span class="n">true</span><span class="p">)</span>
    <span class="n">tx</span> <span class="o">:=</span> <span class="n">gpio</span><span class="o">.</span><span class="n">A</span><span class="o">.</span><span class="n">Pin</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span>

    <span class="n">tx</span><span class="o">.</span><span class="n">Setup</span><span class="p">(</span><span class="o">&amp;</span><span class="n">gpio</span><span class="o">.</span><span class="n">Config</span><span class="p">{</span><span class="n">Mode</span><span class="p">:</span> <span class="n">gpio</span><span class="o">.</span><span class="n">Alt</span><span class="p">})</span>
    <span class="n">tx</span><span class="o">.</span><span class="n">SetAltFunc</span><span class="p">(</span><span class="n">gpio</span><span class="o">.</span><span class="n">USART1_AF1</span><span class="p">)</span>

    <span class="n">d</span> <span class="o">:=</span> <span class="n">dma</span><span class="o">.</span><span class="n">DMA1</span>
    <span class="n">d</span><span class="o">.</span><span class="n">EnableClock</span><span class="p">(</span><span class="n">true</span><span class="p">)</span>

    <span class="n">tts</span> <span class="o">=</span> <span class="n">usart</span><span class="o">.</span><span class="n">NewDriver</span><span class="p">(</span><span class="n">usart</span><span class="o">.</span><span class="n">USART1</span><span class="p">,</span> <span class="n">d</span><span class="o">.</span><span class="n">Channel</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">nil</span><span class="p">,</span> <span class="n">nil</span><span class="p">)</span>
    <span class="n">tts</span><span class="o">.</span><span class="n">Periph</span><span class="p">()</span><span class="o">.</span><span class="n">EnableClock</span><span class="p">(</span><span class="n">true</span><span class="p">)</span>
    <span class="n">tts</span><span class="o">.</span><span class="n">Periph</span><span class="p">()</span><span class="o">.</span><span class="n">SetBaudRate</span><span class="p">(</span><span class="mi">3000000000</span> <span class="o">/</span> <span class="mi">1390</span><span class="p">)</span>
    <span class="n">tts</span><span class="o">.</span><span class="n">Periph</span><span class="p">()</span><span class="o">.</span><span class="n">SetConf2</span><span class="p">(</span><span class="n">usart</span><span class="o">.</span><span class="n">TxInv</span><span class="p">)</span>
    <span class="n">tts</span><span class="o">.</span><span class="n">Periph</span><span class="p">()</span><span class="o">.</span><span class="n">Enable</span><span class="p">()</span>
    <span class="n">tts</span><span class="o">.</span><span class="n">EnableTx</span><span class="p">()</span>

    <span class="n">rtos</span><span class="o">.</span><span class="n">IRQ</span><span class="p">(</span><span class="n">irq</span><span class="o">.</span><span class="n">USART1</span><span class="p">)</span><span class="o">.</span><span class="n">Enable</span><span class="p">()</span>
    <span class="n">rtos</span><span class="o">.</span><span class="n">IRQ</span><span class="p">(</span><span class="n">irq</span><span class="o">.</span><span class="n">DMA1_Channel2_3</span><span class="p">)</span><span class="o">.</span><span class="n">Enable</span><span class="p">()</span>
<span class="p">}</span>

<span class="n">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">var</span> <span class="n">rnd</span> <span class="n">rand</span><span class="o">.</span><span class="n">XorShift64</span>
    <span class="n">rnd</span><span class="o">.</span><span class="n">Seed</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">rgb</span> <span class="o">:=</span> <span class="n">wsuart</span><span class="o">.</span><span class="n">GRB</span>
    <span class="n">strip</span> <span class="o">:=</span> <span class="n">wsuart</span><span class="o">.</span><span class="n">Make</span><span class="p">(</span><span class="mi">24</span><span class="p">)</span>
    <span class="n">black</span> <span class="o">:=</span> <span class="n">rgb</span><span class="o">.</span><span class="n">Pixel</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">for</span> <span class="p">{</span>
        <span class="n">c</span> <span class="o">:=</span> <span class="n">led</span><span class="o">.</span><span class="n">Color</span><span class="p">(</span><span class="n">rnd</span><span class="o">.</span><span class="n">Uint32</span><span class="p">())</span><span class="o">.</span><span class="n">Scale</span><span class="p">(</span><span class="mi">127</span><span class="p">)</span>
        <span class="n">pixel</span> <span class="o">:=</span> <span class="n">rgb</span><span class="o">.</span><span class="n">Pixel</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="o">:=</span> <span class="nb">range</span> <span class="n">strip</span> <span class="p">{</span>
            <span class="n">strip</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">pixel</span>
            <span class="n">tts</span><span class="o">.</span><span class="n">Write</span><span class="p">(</span><span class="n">strip</span><span class="o">.</span><span class="n">Bytes</span><span class="p">())</span>
            <span class="n">delay</span><span class="o">.</span><span class="n">Millisec</span><span class="p">(</span><span class="mi">40</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="k">for</span> <span class="n">i</span> <span class="o">:=</span> <span class="nb">range</span> <span class="n">strip</span> <span class="p">{</span>
            <span class="n">strip</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">black</span>
            <span class="n">tts</span><span class="o">.</span><span class="n">Write</span><span class="p">(</span><span class="n">strip</span><span class="o">.</span><span class="n">Bytes</span><span class="p">())</span>
            <span class="n">delay</span><span class="o">.</span><span class="n">Millisec</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="n">func</span> <span class="n">ttsISR</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">tts</span><span class="o">.</span><span class="n">ISR</span><span class="p">()</span>
<span class="p">}</span>

<span class="n">func</span> <span class="n">ttsDMAISR</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">tts</span><span class="o">.</span><span class="n">TxDMAISR</span><span class="p">()</span>
<span class="p">}</span>

<span class="o">//</span><span class="n">c</span><span class="p">:</span><span class="n">__attribute__</span><span class="p">((</span><span class="n">section</span><span class="p">(</span><span class="s2">&quot;.ISRs&quot;</span><span class="p">)))</span>
<span class="n">var</span> <span class="n">ISRs</span> <span class="o">=</span> <span class="p">[</span><span class="o">...</span><span class="p">]</span><span class="n">func</span><span class="p">(){</span>
    <span class="n">irq</span><span class="o">.</span><span class="n">USART1</span><span class="p">:</span>          <span class="n">ttsISR</span><span class="p">,</span>
    <span class="n">irq</span><span class="o">.</span><span class="n">DMA1_Channel2_3</span><span class="p">:</span> <span class="n">ttsDMAISR</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div>

<h4>导入部分</h4>
<p>与前面的示例相比，导入部分中的新内容是 <code>rand/math</code> 包和带有 <code>led/ws281x</code> 子树的 <code>led</code> 包。 <code>led</code> 包本身包含 <code>Color</code> 类型的定义。 <code>led/ws281x/wsuart</code> 定义了 <code>ColorOrder</code>、<code>Pixel</code> 和 <code>Strip</code> 类型。</p>
<p>我想知道如何使用 <code>image/color</code> 中的 <code>Color</code> 或 <code>RGBA</code> 类型，以及如何以它将实现 <code>image.Image</code> 接口的方式定义 <code>Strip</code>。 但是由于使用了 <a href="https://en.wikipedia.org/wiki/Gamma_correction">gamma 校正</a> 和 大开销的 <code>color/draw</code> 包，我以简单的方式结束：</p>
<div class="highlight"><pre><span></span><code><span class="k">type</span><span class="w"> </span><span class="nx">Color</span><span class="w"> </span><span class="nx">uint32</span>
<span class="k">type</span><span class="w"> </span><span class="nx">Strip</span><span class="w"> </span><span class="p">[]</span><span class="nx">Pixel</span>
</code></pre></div>

<p>使用一些有用的方法。然而，这种情况在未来可能会改变。</p>
<h4>init 函数</h4>
<p><code>init</code> 函数没有太多新颖之处。 UART 波特率从 115200 更改为 3000000000/1390 ≈ 2158273，相当于每个 WS2812 位 1390 纳秒。 CR2 寄存器中的 TxInv 位设置为反转 TXD 信号。</p>
<h4>main 函数</h4>
<p><code>XorShift64</code> 伪随机数生成器用于生成随机颜色。 <a href="https://en.wikipedia.org/wiki/Xorshift">XORSHIFT</a> 是目前由 <code>math/rand</code> 包实现的唯一算法。你必须使用带有非零参数的 <code>Seed</code> 方法显式初始化它。</p>
<p><code>rgb</code> 变量的类型为 <code>wsuart.ColorOrder</code>，并设置为 WS2812 使用的 GRB 颜色顺序（WS2811 使用 RGB 顺序）。然后用于将颜色转换为像素。</p>
<p><code>wsuart.Make(24)</code> 创建 24 像素的初始化条带。它等效于：</p>
<div class="highlight"><pre><span></span><code><span class="nv">strip</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nf">make</span><span class="p">(</span><span class="nv">wsuart</span><span class="o">.</span><span class="nv">Strip</span><span class="p">,</span><span class="w"> </span><span class="mi">24</span><span class="p">)</span>
<span class="nv">strip</span><span class="o">.</span><span class="nf">Clear</span><span class="p">()</span>
</code></pre></div>

<p>其余代码使用随机颜色绘制类似于 “Please Wait…” 微调器的内容。</p>
<p><code>strip</code> 切片充当帧缓冲区。 <code>tts.Write(strip.Bytes())</code> 将帧缓冲区的内容发送到环。</p>
<h4>中断</h4>
<p>该程序由处理中断的代码组成，与先前的 <a href="https://ziutek.github.io/2018/04/14/go_on_very_small_hardware2.html#uart">UART 示例</a> 中的代码相同。</p>
<p>让我们编译并运行：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>egc
$<span class="w"> </span>arm-none-eabi-size<span class="w"> </span>cortexm0.elf
<span class="w">   </span>text<span class="w">    </span>data<span class="w">     </span>bss<span class="w">     </span>dec<span class="w">     </span>hex<span class="w"> </span>filename
<span class="w">  </span><span class="m">14088</span><span class="w">     </span><span class="m">240</span><span class="w">     </span><span class="m">204</span><span class="w">   </span><span class="m">14532</span><span class="w">    </span>38c4<span class="w"> </span>cortexm0.elf
$<span class="w"> </span>openocd<span class="w"> </span>-d0<span class="w"> </span>-f<span class="w"> </span>interface/stlink.cfg<span class="w"> </span>-f<span class="w"> </span>target/stm32f0x.cfg<span class="w"> </span>-c<span class="w"> </span><span class="s1">&#39;init; program cortexm0.elf; reset run; exit&#39;</span>
</code></pre></div>

<p>我跳过了 <code>openocd</code> 的输出。下面的视频显示了该程序的工作原理：</p>
<h3>让我们做些有用的事情...</h3>
<p>在 <a href="/article-11383-1.html">第一部分</a> 的开头，我曾问过：“Go 能深入到多低层，而还能做一些有用的事情？”。 我们的 MCU 实际上是一种低端设备（8 比特的人可能会不同意我的看法），但到目前为止，我们还没有做任何有用的事情。</p>
<p>所以... 让我们做些有用的事情... 让我们做个时钟！</p>
<p>在互联网上有许多由 RGB LED 构成的时钟示例。让我们用我们的小板子和 RGB 环制作自己的时钟。我们按照下面的描述更改先前的代码。</p>
<h4>导入部分</h4>
<p>删除 <code>math/rand</code> 包，然后添加 <code>stm32/hal/exti</code>。</p>
<h4>全局变量</h4>
<p>添加两个新的全局变量：<code>btn</code> 和 <code>btnev</code>：</p>
<div class="highlight"><pre><span></span><code><span class="k">var</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="n">tts</span><span class="w">   </span><span class="o">*</span><span class="n">usart</span><span class="o">.</span><span class="n">Driver</span>
<span class="w">    </span><span class="n">btn</span><span class="w">   </span><span class="n">gpio</span><span class="o">.</span><span class="n">Pin</span>
<span class="w">    </span><span class="n">btnev</span><span class="w"> </span><span class="n">rtos</span><span class="o">.</span><span class="n">EventFlag</span>
<span class="p">)</span>
</code></pre></div>

<p>它们将用来处理那些用于设置时钟的 “按钮”。我们的板子除了重置之外没有其他按钮，但是如果没有它，我们仍然可以通过某种方式进行管理。</p>
<h4>init 函数</h4>
<p>将这段代码添加到 <code>init</code> 函数：</p>
<div class="highlight"><pre><span></span><code>btn = gpio.A.Pin(4)

btn.Setup(&amp;gpio.Config{Mode: gpio.In, Pull: gpio.PullUp})
ei := exti.Lines(btn.Mask())
ei.Connect(btn.Port())
ei.EnableFallTrig()
ei.EnableRiseTrig()
ei.EnableIRQ()

rtos.IRQ(irq.EXTI4_15).Enable()
</code></pre></div>

<p>在内部<ruby> 上拉电阻 <rt>  pull-up resistor </rt></ruby>启用的情况下，将 PA4 引脚配置为输入。它已连接至板载 LED，但这不会妨碍任何事情。更重要的是它位于 GND 引脚旁边，所以我们可以使用任何金属物体来模拟按钮并设置时钟。作为奖励，我们还有来自板载 LED 的其他反馈。</p>
<p>我们使用 EXTI 外设来跟踪 PA4 状态。它被配置为在发生任何更改时都会产生中断。</p>
<h4>btnWait 函数</h4>
<p>定义一个新的辅助函数：</p>
<div class="highlight"><pre><span></span><code><span class="k">func</span><span class="w"> </span><span class="n">btnWait</span><span class="p">(</span><span class="n">state</span><span class="w"> </span><span class="nb nb-Type">int</span><span class="p">,</span><span class="w"> </span><span class="n">deadline</span><span class="w"> </span><span class="n">int64</span><span class="p">)</span><span class="w"> </span><span class="nb nb-Type">bool</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">btn</span><span class="o">.</span><span class="n">Load</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">state</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="o">!</span><span class="n">btnev</span><span class="o">.</span><span class="n">Wait</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">deadline</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="bp">false</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">timeout</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="n">btnev</span><span class="o">.</span><span class="n">Reset</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">delay</span><span class="o">.</span><span class="n">Millisec</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">debouncing</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="bp">true</span>
<span class="p">}</span>
</code></pre></div>

<p>它等待 “按钮” 引脚上的指定状态，但只等到最后期限出现。这是稍微改进的轮询代码：</p>
<div class="highlight"><pre><span></span><code><span class="k">for</span><span class="w"> </span><span class="nv">btn</span>.<span class="nv">Load</span><span class="ss">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nv">state</span><span class="w"> </span>{
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nv">rtos</span>.<span class="nv">Nanosec</span><span class="ss">()</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="nv">deadline</span><span class="w"> </span>{
<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="nb">timeout</span>
<span class="w">    </span>}
}
</code></pre></div>

<p>我们的 <code>btnWait</code> 函数不是忙于等待 <code>state</code> 或 <code>deadline</code>，而是使用 <code>rtos.EventFlag</code> 类型的 <code>btnev</code> 变量休眠，直到有事情发生。你当然可以使用通道而不是 <code>rtos.EventFlag</code>，但是后者便宜得多。</p>
<h4>main 函数</h4>
<p>我们需要全新的 <code>main</code> 函数：</p>
<div class="highlight"><pre><span></span><code><span class="n">func</span><span class="w"> </span><span class="n">main</span><span class="p">()</span><span class="w"> </span><span class="err">{</span>
<span class="w">    </span><span class="n">rgb</span><span class="w"> </span><span class="err">:</span><span class="o">=</span><span class="w"> </span><span class="n">wsuart</span><span class="p">.</span><span class="n">GRB</span>
<span class="w">    </span><span class="n">strip</span><span class="w"> </span><span class="err">:</span><span class="o">=</span><span class="w"> </span><span class="n">wsuart</span><span class="p">.</span><span class="n">Make</span><span class="p">(</span><span class="mi">24</span><span class="p">)</span>
<span class="w">    </span><span class="n">ds</span><span class="w"> </span><span class="err">:</span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">60</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nf">len</span><span class="p">(</span><span class="n">strip</span><span class="p">)</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="k">Interval</span><span class="w"> </span><span class="ow">between</span><span class="w"> </span><span class="n">LEDs</span><span class="w"> </span><span class="p">(</span><span class="n">quarter</span><span class="o">-</span><span class="n">seconds</span><span class="p">).</span>
<span class="w">    </span><span class="n">adjust</span><span class="w"> </span><span class="err">:</span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">    </span><span class="n">adjspeed</span><span class="w"> </span><span class="err">:</span><span class="o">=</span><span class="w"> </span><span class="n">ds</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="err">{</span>
<span class="w">        </span><span class="n">qs</span><span class="w"> </span><span class="err">:</span><span class="o">=</span><span class="w"> </span><span class="nc">int</span><span class="p">(</span><span class="n">rtos</span><span class="p">.</span><span class="n">Nanosec</span><span class="p">()</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">25e7</span><span class="p">)</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">Quarter</span><span class="o">-</span><span class="n">seconds</span><span class="w"> </span><span class="n">since</span><span class="w"> </span><span class="n">reset</span><span class="p">.</span>
<span class="w">        </span><span class="n">qa</span><span class="w"> </span><span class="err">:</span><span class="o">=</span><span class="w"> </span><span class="n">qs</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">adjust</span>

<span class="w">        </span><span class="n">qa</span><span class="w"> </span><span class="o">%=</span><span class="w"> </span><span class="mi">12</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">3600</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">Quarter</span><span class="o">-</span><span class="n">seconds</span><span class="w"> </span><span class="n">since</span><span class="w"> </span><span class="mi">0</span><span class="err">:</span><span class="mi">00</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="mi">12</span><span class="err">:</span><span class="mf">00.</span>
<span class="w">        </span><span class="n">hi</span><span class="w"> </span><span class="err">:</span><span class="o">=</span><span class="w"> </span><span class="nf">len</span><span class="p">(</span><span class="n">strip</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">qa</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="mi">12</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">3600</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span>

<span class="w">        </span><span class="n">qa</span><span class="w"> </span><span class="o">%=</span><span class="w"> </span><span class="mi">3600</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">Quarter</span><span class="o">-</span><span class="n">seconds</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">current</span><span class="w"> </span><span class="k">hour</span><span class="p">.</span>
<span class="w">        </span><span class="n">mi</span><span class="w"> </span><span class="err">:</span><span class="o">=</span><span class="w"> </span><span class="nf">len</span><span class="p">(</span><span class="n">strip</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">qa</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="mi">3600</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span>

<span class="w">        </span><span class="n">qa</span><span class="w"> </span><span class="o">%=</span><span class="w"> </span><span class="mi">60</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">Quarter</span><span class="o">-</span><span class="n">seconds</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">current</span><span class="w"> </span><span class="k">minute</span><span class="p">.</span>
<span class="w">        </span><span class="n">si</span><span class="w"> </span><span class="err">:</span><span class="o">=</span><span class="w"> </span><span class="nf">len</span><span class="p">(</span><span class="n">strip</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">qa</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="mi">60</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span>

<span class="w">        </span><span class="n">hc</span><span class="w"> </span><span class="err">:</span><span class="o">=</span><span class="w"> </span><span class="n">led</span><span class="p">.</span><span class="n">Color</span><span class="p">(</span><span class="mh">0x550000</span><span class="p">)</span>
<span class="w">        </span><span class="n">mc</span><span class="w"> </span><span class="err">:</span><span class="o">=</span><span class="w"> </span><span class="n">led</span><span class="p">.</span><span class="n">Color</span><span class="p">(</span><span class="mh">0x005500</span><span class="p">)</span>
<span class="w">        </span><span class="n">sc</span><span class="w"> </span><span class="err">:</span><span class="o">=</span><span class="w"> </span><span class="n">led</span><span class="p">.</span><span class="n">Color</span><span class="p">(</span><span class="mh">0x000055</span><span class="p">)</span>

<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="n">Blend</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">colors</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">hands</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">clock</span><span class="w"> </span><span class="n">overlap</span><span class="p">.</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">hi</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">mi</span><span class="w"> </span><span class="err">{</span>
<span class="w">            </span><span class="n">hc</span><span class="w"> </span><span class="o">|=</span><span class="w"> </span><span class="n">mc</span>
<span class="w">            </span><span class="n">mc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">hc</span>
<span class="w">        </span><span class="err">}</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">mi</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">si</span><span class="w"> </span><span class="err">{</span>
<span class="w">            </span><span class="n">mc</span><span class="w"> </span><span class="o">|=</span><span class="w"> </span><span class="n">sc</span>
<span class="w">            </span><span class="n">sc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mc</span>
<span class="w">        </span><span class="err">}</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">si</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">hi</span><span class="w"> </span><span class="err">{</span>
<span class="w">            </span><span class="n">sc</span><span class="w"> </span><span class="o">|=</span><span class="w"> </span><span class="n">hc</span>
<span class="w">            </span><span class="n">hc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sc</span>
<span class="w">        </span><span class="err">}</span>

<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="n">Draw</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">clock</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="k">write</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">ring</span><span class="p">.</span>
<span class="w">        </span><span class="n">strip</span><span class="p">.</span><span class="n">Clear</span><span class="p">()</span>
<span class="w">        </span><span class="n">strip</span><span class="o">[</span><span class="n">hi</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rgb</span><span class="p">.</span><span class="n">Pixel</span><span class="p">(</span><span class="n">hc</span><span class="p">)</span>
<span class="w">        </span><span class="n">strip</span><span class="o">[</span><span class="n">mi</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rgb</span><span class="p">.</span><span class="n">Pixel</span><span class="p">(</span><span class="n">mc</span><span class="p">)</span>
<span class="w">        </span><span class="n">strip</span><span class="o">[</span><span class="n">si</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rgb</span><span class="p">.</span><span class="n">Pixel</span><span class="p">(</span><span class="n">sc</span><span class="p">)</span>
<span class="w">        </span><span class="n">tts</span><span class="p">.</span><span class="k">Write</span><span class="p">(</span><span class="n">strip</span><span class="p">.</span><span class="n">Bytes</span><span class="p">())</span>

<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="n">Sleep</span><span class="w"> </span><span class="n">until</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">button</span><span class="w"> </span><span class="n">pressed</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">second</span><span class="w"> </span><span class="n">hand</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">moved</span><span class="p">.</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">btnWait</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">int64</span><span class="p">(</span><span class="n">qs</span><span class="o">+</span><span class="n">ds</span><span class="p">)</span><span class="o">*</span><span class="mf">25e7</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">            </span><span class="n">adjust</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">adjspeed</span>
<span class="w">            </span><span class="o">//</span><span class="w"> </span><span class="n">Sleep</span><span class="w"> </span><span class="n">until</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">button</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">released</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="n">timeout</span><span class="p">.</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="err">!</span><span class="n">btnWait</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">rtos</span><span class="p">.</span><span class="n">Nanosec</span><span class="p">()</span><span class="o">+</span><span class="mf">100e6</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="n">adjspeed</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">5</span><span class="o">*</span><span class="mi">60</span><span class="o">*</span><span class="mi">4</span><span class="w"> </span><span class="err">{</span>
<span class="w">                    </span><span class="n">adjspeed</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">ds</span>
<span class="w">                </span><span class="err">}</span>
<span class="w">                </span><span class="k">continue</span>
<span class="w">            </span><span class="err">}</span>
<span class="w">            </span><span class="n">adjspeed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ds</span>
<span class="w">        </span><span class="err">}</span>
<span class="w">    </span><span class="err">}</span>
<span class="err">}</span>
</code></pre></div>

<p>我们使用 <code>rtos.Nanosec</code> 函数代替 <code>time.Now</code> 来获取当前时间。这样可以节省大量的闪存，但也使我们的时钟变成了不知道日、月、年的老式设备，最糟糕的是它无法处理夏令时的变化。</p>
<p>我们的环有 24 个 LED，因此秒针的显示精度可以达到 2.5 秒。为了不牺牲这种精度并获得流畅的运行效果，我们使用 1/4 秒作为基准间隔。半秒就足够了，但四分之一秒更准确，而且与 16 和 48 个 LED 配合使用也很好。</p>
<p>红色、绿色和蓝色分别用于时针、分针和秒针。这允许我们使用简单的“逻辑或操作”进行颜色混合。我们 <code>Color.Blend</code> 方法可以混合任意颜色，但是我们闪存不多，所以我们选择最简单的解决方案。</p>
<p>我们只有在秒针移动时才重画时钟。</p>
<div class="highlight"><pre><span></span><code>btnWait(0, int64(qs+ds)*25e7)
</code></pre></div>

<p>上面的这行代码等待的正是那一刻，或者是按钮的按下。</p>
<p>每按一下按钮就会把时钟向前调一调。按住按钮一段时间会加速调整。</p>
<h4>中断</h4>
<p>定义新的中断处理程序：</p>
<div class="highlight"><pre><span></span><code><span class="k">func</span><span class="w"> </span><span class="n">exti4_15ISR</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">pending</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="n">exti</span><span class="o">.</span><span class="n">Pending</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mh">0xFFF0</span>
<span class="w">    </span><span class="n">pending</span><span class="o">.</span><span class="n">ClearPending</span><span class="p">()</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">pending</span><span class="o">&amp;</span><span class="n">exti</span><span class="o">.</span><span class="n">Lines</span><span class="p">(</span><span class="n">btn</span><span class="o">.</span><span class="n">Mask</span><span class="p">())</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">btnev</span><span class="o">.</span><span class="n">Signal</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>并将 <code>irq.EXTI4_15: exti4_15ISR</code> 条目添加到 ISR 数组。</p>
<p>该处理程序（或中断服务程序）处理 EXTI4_15 IRQ。 Cortex-M0 CPU 支持的 IRQ 明显少于其较大的同类兄弟处理器，因此你经常可以看到一个 IRQ 被多个中断源共享。在我们的例子中，一个 IRQ 由 12 个 EXTI 线共享。</p>
<p>exti4_15ISR 读取所有挂起的位，并从中选择 12 个更高的有效位。接下来，它清除 EXTI 中选中的位并开始处理它们。在我们的例子中，仅检查第 4 位。 <code>btnev.Signal(1)</code> 引发 <code>btnev.Wait(1, deadline)</code> 唤醒并返回 <code>true</code>。</p>
<p>你可以在 <a href="https://github.com/ziutek/emgo/tree/master/egpath/src/stm32/examples/f030-demo-board/ws2812-clock">Github</a> 上找到完整的代码。让我们来编译它：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>egc
$<span class="w"> </span>arm-none-eabi-size<span class="w"> </span>cortexm0.elf
<span class="w">   </span>text<span class="w">    </span>data<span class="w">     </span>bss<span class="w">     </span>dec<span class="w">     </span>hex<span class="w"> </span>filename
<span class="w">  </span><span class="m">15960</span><span class="w">     </span><span class="m">240</span><span class="w">     </span><span class="m">216</span><span class="w">   </span><span class="m">16416</span><span class="w">    </span><span class="m">4020</span><span class="w"> </span>cortexm0.elf
</code></pre></div>

<p>这里所有的改进只得到 184 个字节。让我们再次重新构建所有内容，但这次在 typeinfo 中不使用任何类型和字段名：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span><span class="nv">$HOME</span>/emgo
$<span class="w"> </span>./clean.sh
$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span><span class="nv">$HOME</span>/firstemgo
$<span class="w"> </span>egc<span class="w"> </span>-nf<span class="w"> </span>-nt
$<span class="w"> </span>arm-none-eabi-size<span class="w"> </span>cortexm0.elf
<span class="w">   </span>text<span class="w">    </span>data<span class="w">     </span>bss<span class="w">     </span>dec<span class="w">     </span>hex<span class="w"> </span>filename
<span class="w">  </span><span class="m">15120</span><span class="w">     </span><span class="m">240</span><span class="w">     </span><span class="m">216</span><span class="w">   </span><span class="m">15576</span><span class="w">    </span>3cd8<span class="w"> </span>cortexm0.elf
</code></pre></div>

<p>现在，有了千字节的空闲空间，你可以改进一些东西。让我们看看它是如何工作的：</p>
<p>我不知道我是怎么精确打到 3:00 的！？</p>
<p>以上就是所有内容！在第 4 部分（本系列的结束）中，我们将尝试在 LCD 上显示一些内容。（LCTT 译注：然而烂尾了，第三篇写于 2018 年，整个博客当年就停更了。）</p>
    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>links</h2>
                        <ul>
                            <li><a href="https://getpelican.com/">Pelican</a></li>
                            <li><a href="https://www.python.org/">Python.org</a></li>
                            <li><a href="https://palletsprojects.com/p/jinja/">Jinja2</a></li>
                            <li><a href="#">You can modify those links in your config file</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>

                            <li><a href="#">You can add links in your config file</a></li>
                            <li><a href="#">Another social link</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a rel="nofollow" href="https://getpelican.com/">Pelican</a>, which takes great advantage of <a rel="nofollow" href="https://www.python.org/">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a rel="nofollow" href="https://www.smashingmagazine.com/2009/08/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>