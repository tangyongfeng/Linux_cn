<!DOCTYPE html>
<html lang="zh">
<head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="generator" content="Pelican" />
        <title>使用 Delve 代替 Println 来调试 Go 程序</title>
        <link rel="stylesheet" href="/theme/css/main.css" />
        <meta name="description" content="Author: Gaurav Kamathe Delve 是能让调试变成轻而易举的事的万能工具包。 你上次尝试去学习一种新的编程语言时什么时候？你有没有持之 …" />
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">linux_cn</a></h1>
                <nav><ul>
                    <li><a href="/category/chuan-shan-jia-zhuan-fang">穿山甲专访</a></li>
                    <li><a href="/category/dai-ma-ying-xiong">代码英雄</a></li>
                    <li><a href="/category/fen-xiang">分享</a></li>
                    <li><a href="/category/guan-dian">观点</a></li>
                    <li><a href="/category/huo-dong">活动</a></li>
                    <li><a href="/category/ji-ke-man-hua">极客漫画</a></li>
                    <li><a href="/category/ji-zhu">技术</a></li>
                    <li><a href="/category/kai-yuan-zhi-hui">开源智慧</a></li>
                    <li><a href="/category/linux-fa-xing-ban">Linux 发行版</a></li>
                    <li><a href="/category/mei-ri-an-quan-zi-xun">每日安全资讯</a></li>
                    <li><a href="/category/misc">Misc</a></li>
                    <li><a href="/category/qu-kuai-lian">区块链</a></li>
                    <li><a href="/category/rong-qi-yu-yun">容器与云</a></li>
                    <li class="active"><a href="/category/ruan-jian-kai-fa">软件开发</a></li>
                    <li><a href="/category/shu-mei-pai">树莓派</a></li>
                    <li><a href="/category/xi-tong-yun-wei">系统运维</a></li>
                    <li><a href="/category/xin-wen">新闻</a></li>
                    <li><a href="/category/ying-he-guan-cha">硬核观察</a></li>
                    <li><a href="/category/zhi-ye-sheng-ya">职业生涯</a></li>
                    <li><a href="/category/zhong-jiang-ming-dan">中奖名单</a></li>
                    <li><a href="/category/zhuo-mian-ying-yong">桌面应用</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="/2020/07/shi-yong-delve-dai-ti-println-lai-diao-shi-go-cheng-xu.html" rel="bookmark"
           title="Permalink to 使用 Delve 代替 Println 来调试 Go 程序">使用 Delve 代替 Println 来调试 Go 程序</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2020-07-09T23:44:18+02:00">
                Published: Thu 09 July 2020
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/linux-fans-from-china.html">linux fans from china</a>
        </address>
<p>In <a href="/category/ruan-jian-kai-fa">软件开发</a>.</p>

</footer><!-- /.post-info -->      <p>Author: Gaurav Kamathe</p>
<blockquote>
<p>Delve 是能让调试变成轻而易举的事的万能工具包。</p>
</blockquote>
<p><img alt="" src="/data/attachment/album/202007/09/234357pavw88sbxab0makj.jpg"></p>
<p>你上次尝试去学习一种新的编程语言时什么时候？你有没有持之以恒，你是那些在新事物发布的第一时间就勇敢地去尝试的一员吗？不管怎样，学习一种新的语言也许非常有用，也会有很多乐趣。</p>
<p>你尝试着写简单的 “Hello, world!”，然后写一些示例代码并执行，继续做一些小的修改，之后继续前进。我敢保证我们都有过这个经历，不论我们使用哪种技术。假如你尝试用一段时间一种语言，并且你希望能够精通它，那么有一些事物能在你的进取之路上帮助你。</p>
<p>其中之一就是调试器。有些人喜欢在代码中用简单的 “print” 语句进行调试，这种方式很适合代码量少的简单程序；然而，如果你处理的是有多个开发者和几千行代码的大型项目，你应该使用调试器。</p>
<p>最近我开始学习 Go 编程语言了，在本文中，我们将探讨一种名为 Delve 的调试器。Delve 是专门用来调试 Go 程序的工具，我们会借助一些 Go 示例代码来了解下它的一些功能。不要担心这里展示的 Go 示例代码；即使你之前没有写过 Go 代码也能看懂。Go 的目标之一是简单，因此代码是始终如一的，理解和解释起来都很容易。</p>
<h3>Delve 介绍</h3>
<p>Delve 是托管在 <a href="https://github.com/go-delve/delve">GitHub</a> 上的一个开源项目。</p>
<p>它自己的文档中写道：</p>
<blockquote>
<p>Delve 是 Go 编程语言的调试器。该项目的目标是为 Go 提供一个简单、全功能的调试工具。Delve 应该是易于调用和易于使用的。当你使用调试器时，事情可能不会按你的思路运行。如果你这样想，那么你不适合用 Delve。</p>
</blockquote>
<p>让我们来近距离看一下。</p>
<p>我的测试系统是运行着 Fedora Linux 的笔记本电脑，Go 编译器版本如下：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>cat<span class="w"> </span>/etc/fedora-release
Fedora<span class="w"> </span>release<span class="w"> </span><span class="m">30</span><span class="w"> </span><span class="o">(</span>Thirty<span class="o">)</span>
$
$<span class="w"> </span>go<span class="w"> </span>version
go<span class="w"> </span>version<span class="w"> </span>go1.12.17<span class="w"> </span>linux/amd64
$
</code></pre></div>

<h3>Golang 安装</h3>
<p>如果你没有安装 Go，你可以运行下面的命令，很轻松地就可以从配置的仓库中获取。</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>dnf<span class="w"> </span>install<span class="w"> </span>golang.x86_64
</code></pre></div>

<p>或者，你可以在<a href="https://golang.org/doc/install">安装页面</a>找到适合你的操作系统的其他安装版本。</p>
<p>在开始之前，请先确认已经设置好了 Go 工具依赖的下列各个路径。如果这些路径没有设置，有些示例可能不能正常运行。你可以在 SHELL 的 RC 文件中轻松设置这些环境变量，我的机器上是在 <code>$HOME/bashrc</code> 文件中设置的。</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>go<span class="w"> </span>env<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>GOPATH
<span class="nv">GOPATH</span><span class="o">=</span><span class="s2">&quot;/home/user/go&quot;</span>
$
$<span class="w"> </span>go<span class="w"> </span>env<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>GOBIN
<span class="nv">GOBIN</span><span class="o">=</span><span class="s2">&quot;/home/user/go/gobin&quot;</span>
$
</code></pre></div>

<h3>Delve 安装</h3>
<p>你可以像下面那样，通过运行一个简单的 <code>go get</code> 命令来安装 Delve。<code>go get</code> 是 Golang 从外部源下载和安装需要的包的方式。如果你安装过程中遇到了问题，可以查看 <a href="https://github.com/go-delve/delve/blob/master/Documentation/installation/linux/install.md">Delve 安装教程</a>。</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>go<span class="w"> </span>get<span class="w"> </span>-u<span class="w"> </span>github.com/go-delve/delve/cmd/dlv
$
</code></pre></div>

<p>运行上面的命令，就会把 Delve 下载到你的 <code>$GOPATH</code> 的位置，如果你没有把 <code>$GOPATH</code> 设置成其他值，那么默认情况下 <code>$GOPATH</code> 和 <code>$HOME/go</code> 是同一个路径。</p>
<p>你可以进入 <code>go/</code> 目录，你可以在 <code>bin/</code> 目录下看到 <code>dlv</code>。</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>ls<span class="w"> </span>-l<span class="w"> </span><span class="nv">$HOME</span>/go
total<span class="w"> </span><span class="m">8</span>
drwxrwxr-x.<span class="w"> </span><span class="m">2</span><span class="w"> </span>user<span class="w"> </span>user<span class="w"> </span><span class="m">4096</span><span class="w"> </span>May<span class="w"> </span><span class="m">25</span><span class="w"> </span><span class="m">19</span>:11<span class="w"> </span>bin
drwxrwxr-x.<span class="w"> </span><span class="m">4</span><span class="w"> </span>user<span class="w"> </span>user<span class="w"> </span><span class="m">4096</span><span class="w"> </span>May<span class="w"> </span><span class="m">25</span><span class="w"> </span><span class="m">19</span>:21<span class="w"> </span>src
$
$<span class="w"> </span>ls<span class="w"> </span>-l<span class="w"> </span>~/go/bin/
total<span class="w"> </span><span class="m">19596</span>
-rwxrwxr-x.<span class="w"> </span><span class="m">1</span><span class="w"> </span>user<span class="w"> </span>user<span class="w"> </span><span class="m">20062654</span><span class="w"> </span>May<span class="w"> </span><span class="m">25</span><span class="w"> </span><span class="m">19</span>:17<span class="w"> </span>dlv
$
</code></pre></div>

<p>因为你把 Delve 安装到了 <code>$GOPATH</code>，所以你可以像运行普通的 shell 命令一样运行它，即每次运行时你不必先进入它所在的目录。你可以通过 <code>version</code> 选项来验证 <code>dlv</code> 是否正确安装。示例中安装的版本是 1.4.1。</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>which<span class="w"> </span>dlv
~/go/bin/dlv
$
$<span class="w"> </span>dlv<span class="w"> </span>version
Delve<span class="w"> </span>Debugger
Version:<span class="w"> </span><span class="m">1</span>.4.1
Build:<span class="w"> </span><span class="nv">$Id</span>:<span class="w"> </span>bda606147ff48b58bde39e20b9e11378eaa4db46<span class="w"> </span>$
$
</code></pre></div>

<p>现在，我们一起在 Go 程序中使用 Delve 来理解下它的功能以及如何使用它们。我们先来写一个 <code>hello.go</code>，简单地打印一条 <code>Hello, world!</code> 信息。</p>
<p>记着，我把这些示例程序放到了 <code>$GOBIN</code> 目录下。</p>
<div class="highlight"><pre><span></span><code><span class="err">$</span> <span class="n">pwd</span>
<span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">go</span><span class="o">/</span><span class="n">gobin</span>
<span class="err">$</span>
<span class="err">$</span> <span class="n">cat</span> <span class="n">hello</span><span class="o">.</span><span class="n">go</span>
<span class="n">package</span> <span class="n">main</span>

<span class="kn">import</span> <span class="s2">&quot;fmt&quot;</span>

<span class="n">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s2">&quot;Hello, world!&quot;</span><span class="p">)</span>
<span class="p">}</span>
<span class="err">$</span>
</code></pre></div>

<p>运行 <code>build</code> 命令来编译一个 Go 程序，它的输入是 <code>.go</code> 后缀的文件。如果程序没有语法错误，Go 编译器把它编译成一个二进制可执行文件。这个文件可以被直接运行，运行后我们会在屏幕上看到 <code>Hello, world!</code> 信息。</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>go<span class="w"> </span>build<span class="w"> </span>hello.go
$
$<span class="w"> </span>ls<span class="w"> </span>-l<span class="w"> </span>hello
-rwxrwxr-x.<span class="w"> </span><span class="m">1</span><span class="w"> </span>user<span class="w"> </span>user<span class="w"> </span><span class="m">1997284</span><span class="w"> </span>May<span class="w"> </span><span class="m">26</span><span class="w"> </span><span class="m">12</span>:13<span class="w"> </span>hello
$
$<span class="w"> </span>./hello
Hello,<span class="w"> </span>world!
$
</code></pre></div>

<h3>在 Delve 中加载程序</h3>
<p>把一个程序加载进 Delve 调试器有两种方式。</p>
<h4>在源码编译成二进制文件之前使用 debug 参数</h4>
<p>第一种方式是在需要时对源码使用 <code>debug</code> 命令。Delve 会为你编译出一个名为 <code>__debug_bin</code> 的二进制文件，并把它加载进调试器。</p>
<p>在这个例子中，你可以进入 <code>hello.go</code> 所在的目录，然后运行 <code>dlv debug</code> 命令。如果目录中有多个源文件且每个文件都有自己的主函数，Delve 则可能抛出错误，它期望的是单个程序或从单个项目构建成单个二进制文件。如果出现了这种错误，那么你就应该用下面展示的第二种方式。</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>ls<span class="w"> </span>-l
total<span class="w"> </span><span class="m">4</span>
-rw-rw-r--.<span class="w"> </span><span class="m">1</span><span class="w"> </span>user<span class="w"> </span>user<span class="w"> </span><span class="m">74</span><span class="w"> </span>Jun<span class="w">  </span><span class="m">4</span><span class="w"> </span><span class="m">11</span>:48<span class="w"> </span>hello.go
$
$<span class="w"> </span>dlv<span class="w"> </span>debug
Type<span class="w"> </span><span class="s1">&#39;help&#39;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>list<span class="w"> </span>of<span class="w"> </span>commands.
<span class="o">(</span>dlv<span class="o">)</span>
</code></pre></div>

<p>现在打开另一个终端，列出目录下的文件。你可以看到一个多出来的 <code>__debug_bin</code> 二进制文件，这个文件是由源码编译生成的，并会加载进调试器。你现在可以回到 <code>dlv</code> 提示框继续使用 Delve。</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>ls<span class="w"> </span>-l
total<span class="w"> </span><span class="m">2036</span>
-rwxrwxr-x.<span class="w"> </span><span class="m">1</span><span class="w"> </span>user<span class="w"> </span>user<span class="w"> </span><span class="m">2077085</span><span class="w"> </span>Jun<span class="w">  </span><span class="m">4</span><span class="w"> </span><span class="m">11</span>:48<span class="w"> </span>__debug_bin
-rw-rw-r--.<span class="w"> </span><span class="m">1</span><span class="w"> </span>user<span class="w"> </span>user<span class="w">      </span><span class="m">74</span><span class="w"> </span>Jun<span class="w">  </span><span class="m">4</span><span class="w"> </span><span class="m">11</span>:48<span class="w"> </span>hello.go
$
</code></pre></div>

<h4>使用 exec 参数</h4>
<p>如果你已经有提前编译好的 Go 程序或者已经用 <code>go build</code> 命令编译完成了，不想再用 Delve 编译出 <code>__debug_bin</code> 二进制文件，那么第二种把程序加载进 Delve 的方法在这些情况下会很有用。在上述情况下，你可以使用 <code>exec</code> 命令来把整个目录加载进 Delve 调试器。</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>ls<span class="w"> </span>-l
total<span class="w"> </span><span class="m">4</span>
-rw-rw-r--.<span class="w"> </span><span class="m">1</span><span class="w"> </span>user<span class="w"> </span>user<span class="w"> </span><span class="m">74</span><span class="w"> </span>Jun<span class="w">  </span><span class="m">4</span><span class="w"> </span><span class="m">11</span>:48<span class="w"> </span>hello.go
$
$<span class="w"> </span>go<span class="w"> </span>build<span class="w"> </span>hello.go
$
$<span class="w"> </span>ls<span class="w"> </span>-l
total<span class="w"> </span><span class="m">1956</span>
-rwxrwxr-x.<span class="w"> </span><span class="m">1</span><span class="w"> </span>user<span class="w"> </span>user<span class="w"> </span><span class="m">1997284</span><span class="w"> </span>Jun<span class="w">  </span><span class="m">4</span><span class="w"> </span><span class="m">11</span>:54<span class="w"> </span>hello
-rw-rw-r--.<span class="w"> </span><span class="m">1</span><span class="w"> </span>user<span class="w"> </span>user<span class="w">      </span><span class="m">74</span><span class="w"> </span>Jun<span class="w">  </span><span class="m">4</span><span class="w"> </span><span class="m">11</span>:48<span class="w"> </span>hello.go
$
$<span class="w"> </span>dlv<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>./hello
Type<span class="w"> </span><span class="s1">&#39;help&#39;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>list<span class="w"> </span>of<span class="w"> </span>commands.
<span class="o">(</span>dlv<span class="o">)</span>
</code></pre></div>

<h3>查看 delve 帮助信息</h3>
<p>在 <code>dlv</code> 提示符中，你可以运行 <code>help</code> 来查看 Delve 提供的多种帮助选项。命令列表相当长，这里我们只列举一些重要的功能。下面是 Delve 的功能概览。</p>
<div class="highlight"><pre><span></span><code><span class="p">(</span><span class="n">dlv</span><span class="p">)</span><span class="w"> </span><span class="n">help</span>
<span class="n">The</span><span class="w"> </span><span class="n">following</span><span class="w"> </span><span class="n">commands</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">available</span><span class="p">:</span>

<span class="n">Running</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">program</span><span class="p">:</span>

<span class="n">Manipulating</span><span class="w"> </span><span class="n">breakpoints</span><span class="p">:</span>

<span class="n">Viewing</span><span class="w"> </span><span class="n">program</span><span class="w"> </span><span class="n">variables</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">memory</span><span class="p">:</span>

<span class="n">Listing</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">switching</span><span class="w"> </span><span class="n">between</span><span class="w"> </span><span class="n">threads</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">goroutines</span><span class="p">:</span>

<span class="n">Viewing</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">call</span><span class="w"> </span><span class="n">stack</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">selecting</span><span class="w"> </span><span class="n">frames</span><span class="p">:</span>

<span class="n">Other</span><span class="w"> </span><span class="n">commands</span><span class="p">:</span>

<span class="n">Type</span><span class="w"> </span><span class="n">help</span><span class="w"> </span><span class="n">followed</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">full</span><span class="w"> </span><span class="n">documentation</span><span class="o">.</span>
<span class="p">(</span><span class="n">dlv</span><span class="p">)</span>
</code></pre></div>

<h4>设置断点</h4>
<p>现在我们已经把 hello.go 程序加载进了 Delve 调试器，我们在主函数处设置断点，稍后来确认它。在 Go 中，主程序从 <code>main.main</code> 处开始执行，因此你需要给这个名字提供个 <code>break</code> 命令。之后，我们可以用 <code>breakpoints</code> 命令来检查断点是否正确设置了。</p>
<p>不要忘了你还可以用命令简写，因此你可以用 <code>b main.main</code> 来代替 <code>break main.main</code>，两者效果相同，<code>bp</code> 和 <code>breakpoints</code> 同理。你可以通过运行 <code>help</code> 命令查看帮助信息来找到你想要的命令简写。</p>
<div class="highlight"><pre><span></span><code><span class="p">(</span><span class="n">dlv</span><span class="p">)</span><span class="w"> </span><span class="k">break</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">main</span>
<span class="n">Breakpoint</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="k">at</span><span class="w"> </span><span class="mh">0x4a228f</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">main</span><span class="p">()</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">hello</span><span class="p">.</span><span class="k">go</span><span class="err">:</span><span class="mi">5</span>
<span class="p">(</span><span class="n">dlv</span><span class="p">)</span><span class="w"> </span><span class="n">breakpoints</span>
<span class="n">Breakpoint</span><span class="w"> </span><span class="n">runtime</span><span class="o">-</span><span class="n">fatal</span><span class="o">-</span><span class="k">throw</span><span class="w"> </span><span class="k">at</span><span class="w"> </span><span class="mh">0x42c410</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">runtime</span><span class="p">.</span><span class="n">fatalthrow</span><span class="p">()</span><span class="w"> </span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">golang</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">panic</span><span class="p">.</span><span class="k">go</span><span class="err">:</span><span class="mi">663</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">Breakpoint</span><span class="w"> </span><span class="n">unrecovered</span><span class="o">-</span><span class="n">panic</span><span class="w"> </span><span class="k">at</span><span class="w"> </span><span class="mh">0x42c480</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">runtime</span><span class="p">.</span><span class="n">fatalpanic</span><span class="p">()</span><span class="w"> </span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">golang</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">panic</span><span class="p">.</span><span class="k">go</span><span class="err">:</span><span class="mi">690</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="w">        </span><span class="k">print</span><span class="w"> </span><span class="n">runtime</span><span class="p">.</span><span class="n">curg</span><span class="p">.</span><span class="n">_panic</span><span class="p">.</span><span class="n">arg</span>
<span class="n">Breakpoint</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">at</span><span class="w"> </span><span class="mh">0x4a228f</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">main</span><span class="p">()</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">hello</span><span class="p">.</span><span class="k">go</span><span class="err">:</span><span class="mi">5</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="p">(</span><span class="n">dlv</span><span class="p">)</span>
</code></pre></div>

<h4>程序继续执行</h4>
<p>现在，我们用 <code>continue</code> 来继续运行程序。它会运行到断点处中止，在我们的例子中，会运行到主函数的 <code>main.main</code> 处中止。从这里开始，我们可以用 <code>next</code> 命令来逐行执行程序。请注意，当我们运行到 <code>fmt.Println("Hello, world!")</code> 处时，即使我们还在调试器里，我们也能看到打印到屏幕的 <code>Hello, world!</code>。</p>
<div class="highlight"><pre><span></span><code><span class="p">(</span><span class="n">dlv</span><span class="p">)</span> <span class="k">continue</span>
<span class="o">&gt;</span> <span class="n">main</span><span class="o">.</span><span class="n">main</span><span class="p">()</span> <span class="o">./</span><span class="n">hello</span><span class="o">.</span><span class="n">go</span><span class="p">:</span><span class="mi">5</span> <span class="p">(</span><span class="n">hits</span> <span class="n">goroutine</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span><span class="mi">1</span> <span class="n">total</span><span class="p">:</span><span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="n">PC</span><span class="p">:</span> <span class="mh">0x4a228f</span><span class="p">)</span>
     <span class="mi">1</span><span class="p">:</span> <span class="n">package</span> <span class="n">main</span>
     <span class="mi">2</span><span class="p">:</span>
     <span class="mi">3</span><span class="p">:</span> <span class="kn">import</span> <span class="s2">&quot;fmt&quot;</span>
     <span class="mi">4</span><span class="p">:</span>
<span class="o">=&gt;</span>   <span class="mi">5</span><span class="p">:</span>      <span class="n">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
     <span class="mi">6</span><span class="p">:</span>         <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s2">&quot;Hello, world!&quot;</span><span class="p">)</span>
     <span class="mi">7</span><span class="p">:</span> <span class="p">}</span>
<span class="p">(</span><span class="n">dlv</span><span class="p">)</span> <span class="nb">next</span>
<span class="o">&gt;</span> <span class="n">main</span><span class="o">.</span><span class="n">main</span><span class="p">()</span> <span class="o">./</span><span class="n">hello</span><span class="o">.</span><span class="n">go</span><span class="p">:</span><span class="mi">6</span> <span class="p">(</span><span class="n">PC</span><span class="p">:</span> <span class="mh">0x4a229d</span><span class="p">)</span>
     <span class="mi">1</span><span class="p">:</span> <span class="n">package</span> <span class="n">main</span>
     <span class="mi">2</span><span class="p">:</span>
     <span class="mi">3</span><span class="p">:</span> <span class="kn">import</span> <span class="s2">&quot;fmt&quot;</span>
     <span class="mi">4</span><span class="p">:</span>
     <span class="mi">5</span><span class="p">:</span> <span class="n">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
<span class="o">=&gt;</span>   <span class="mi">6</span><span class="p">:</span>              <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s2">&quot;Hello, world!&quot;</span><span class="p">)</span>
     <span class="mi">7</span><span class="p">:</span> <span class="p">}</span>
<span class="p">(</span><span class="n">dlv</span><span class="p">)</span> <span class="nb">next</span>
<span class="n">Hello</span><span class="p">,</span> <span class="n">world</span><span class="err">!</span>
<span class="o">&gt;</span> <span class="n">main</span><span class="o">.</span><span class="n">main</span><span class="p">()</span> <span class="o">./</span><span class="n">hello</span><span class="o">.</span><span class="n">go</span><span class="p">:</span><span class="mi">7</span> <span class="p">(</span><span class="n">PC</span><span class="p">:</span> <span class="mh">0x4a22ff</span><span class="p">)</span>
     <span class="mi">2</span><span class="p">:</span>
     <span class="mi">3</span><span class="p">:</span> <span class="kn">import</span> <span class="s2">&quot;fmt&quot;</span>
     <span class="mi">4</span><span class="p">:</span>
     <span class="mi">5</span><span class="p">:</span> <span class="n">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
     <span class="mi">6</span><span class="p">:</span>         <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s2">&quot;Hello, world!&quot;</span><span class="p">)</span>
<span class="o">=&gt;</span>   <span class="mi">7</span><span class="p">:</span>      <span class="p">}</span>
<span class="p">(</span><span class="n">dlv</span><span class="p">)</span>
</code></pre></div>

<h4>退出 Delve</h4>
<p>你随时可以运行 <code>quit</code> 命令来退出调试器，退出之后你会回到 shell 提示符。相当简单，对吗？</p>
<div class="highlight"><pre><span></span><code><span class="p">(</span><span class="nv">dlv</span><span class="p">)</span><span class="w"> </span><span class="nv">quit</span>
<span class="p">$</span>
</code></pre></div>

<h3>Delve 的其他功能</h3>
<p>我们用其他的 Go 程序来探索下 Delve 的其他功能。这次，我们从 <a href="https://tour.golang.org/basics/4">golang 教程</a> 中找了一个程序。如果你要学习 Go 语言，那么 Golang 教程应该是你的第一站。</p>
<p>下面的程序，<code>functions.go</code> 中简单展示了 Go 程序中是怎样定义和调用函数的。这里，我们有一个简单的把两数相加并返回和值的 <code>add()</code> 函数。你可以像下面那样构建程序并运行它。</p>
<div class="highlight"><pre><span></span><code><span class="err">$</span> <span class="n">cat</span> <span class="n">functions</span><span class="o">.</span><span class="n">go</span>
<span class="n">package</span> <span class="n">main</span>

<span class="kn">import</span> <span class="s2">&quot;fmt&quot;</span>

<span class="n">func</span> <span class="n">add</span><span class="p">(</span><span class="n">x</span> <span class="nb">int</span><span class="p">,</span> <span class="n">y</span> <span class="nb">int</span><span class="p">)</span> <span class="nb">int</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
<span class="p">}</span>

<span class="n">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">add</span><span class="p">(</span><span class="mi">42</span><span class="p">,</span> <span class="mi">13</span><span class="p">))</span>
<span class="p">}</span>
<span class="err">$</span>
</code></pre></div>

<p>你可以像下面那样构建和运行程序。</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>go<span class="w"> </span>build<span class="w"> </span>functions.go<span class="w">  </span><span class="o">&amp;&amp;</span><span class="w"> </span>./functions
<span class="m">55</span>
$
</code></pre></div>

<h4>进入函数</h4>
<p>跟前面展示的一样，我们用前面提到的一个选项来把二进制文件加载进 Delve 调试器，再一次在 <code>main.main</code> 处设置断点，继续运行程序直到断点处。然后执行 <code>next</code> 直到 <code>fmt.Println(add(42, 13))</code> 处；这里我们调用了 <code>add()</code> 函数。我们可以像下面展示的那样，用 Delve 的 <code>step</code> 命令从 <code>main</code> 函数进入 <code>add()</code> 函数。</p>
<div class="highlight"><pre><span></span><code><span class="err">$</span> <span class="n">dlv</span> <span class="n">debug</span>
<span class="n">Type</span> <span class="s1">&#39;help&#39;</span> <span class="k">for</span> <span class="nb">list</span> <span class="n">of</span> <span class="n">commands</span><span class="o">.</span>
<span class="p">(</span><span class="n">dlv</span><span class="p">)</span> <span class="k">break</span> <span class="n">main</span><span class="o">.</span><span class="n">main</span>
<span class="n">Breakpoint</span> <span class="mi">1</span> <span class="nb">set</span> <span class="n">at</span> <span class="mh">0x4a22b3</span> <span class="k">for</span> <span class="n">main</span><span class="o">.</span><span class="n">main</span><span class="p">()</span> <span class="o">./</span><span class="n">functions</span><span class="o">.</span><span class="n">go</span><span class="p">:</span><span class="mi">9</span>
<span class="p">(</span><span class="n">dlv</span><span class="p">)</span> <span class="n">c</span>
<span class="o">&gt;</span> <span class="n">main</span><span class="o">.</span><span class="n">main</span><span class="p">()</span> <span class="o">./</span><span class="n">functions</span><span class="o">.</span><span class="n">go</span><span class="p">:</span><span class="mi">9</span> <span class="p">(</span><span class="n">hits</span> <span class="n">goroutine</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span><span class="mi">1</span> <span class="n">total</span><span class="p">:</span><span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="n">PC</span><span class="p">:</span> <span class="mh">0x4a22b3</span><span class="p">)</span>
     <span class="mi">4</span><span class="p">:</span>
     <span class="mi">5</span><span class="p">:</span> <span class="n">func</span> <span class="n">add</span><span class="p">(</span><span class="n">x</span> <span class="nb">int</span><span class="p">,</span> <span class="n">y</span> <span class="nb">int</span><span class="p">)</span> <span class="nb">int</span> <span class="p">{</span>
     <span class="mi">6</span><span class="p">:</span>         <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
     <span class="mi">7</span><span class="p">:</span> <span class="p">}</span>
     <span class="mi">8</span><span class="p">:</span>
<span class="o">=&gt;</span>   <span class="mi">9</span><span class="p">:</span>      <span class="n">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="mi">10</span><span class="p">:</span>         <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">add</span><span class="p">(</span><span class="mi">42</span><span class="p">,</span> <span class="mi">13</span><span class="p">))</span>
    <span class="mi">11</span><span class="p">:</span> <span class="p">}</span>
<span class="p">(</span><span class="n">dlv</span><span class="p">)</span> <span class="nb">next</span>
<span class="o">&gt;</span> <span class="n">main</span><span class="o">.</span><span class="n">main</span><span class="p">()</span> <span class="o">./</span><span class="n">functions</span><span class="o">.</span><span class="n">go</span><span class="p">:</span><span class="mi">10</span> <span class="p">(</span><span class="n">PC</span><span class="p">:</span> <span class="mh">0x4a22c1</span><span class="p">)</span>
     <span class="mi">5</span><span class="p">:</span> <span class="n">func</span> <span class="n">add</span><span class="p">(</span><span class="n">x</span> <span class="nb">int</span><span class="p">,</span> <span class="n">y</span> <span class="nb">int</span><span class="p">)</span> <span class="nb">int</span> <span class="p">{</span>
     <span class="mi">6</span><span class="p">:</span>         <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
     <span class="mi">7</span><span class="p">:</span> <span class="p">}</span>
     <span class="mi">8</span><span class="p">:</span>
     <span class="mi">9</span><span class="p">:</span> <span class="n">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
<span class="o">=&gt;</span>  <span class="mi">10</span><span class="p">:</span>              <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">add</span><span class="p">(</span><span class="mi">42</span><span class="p">,</span> <span class="mi">13</span><span class="p">))</span>
    <span class="mi">11</span><span class="p">:</span> <span class="p">}</span>
<span class="p">(</span><span class="n">dlv</span><span class="p">)</span> <span class="n">step</span>
<span class="o">&gt;</span> <span class="n">main</span><span class="o">.</span><span class="n">add</span><span class="p">()</span> <span class="o">./</span><span class="n">functions</span><span class="o">.</span><span class="n">go</span><span class="p">:</span><span class="mi">5</span> <span class="p">(</span><span class="n">PC</span><span class="p">:</span> <span class="mh">0x4a2280</span><span class="p">)</span>
     <span class="mi">1</span><span class="p">:</span> <span class="n">package</span> <span class="n">main</span>
     <span class="mi">2</span><span class="p">:</span>
     <span class="mi">3</span><span class="p">:</span> <span class="kn">import</span> <span class="s2">&quot;fmt&quot;</span>
     <span class="mi">4</span><span class="p">:</span>
<span class="o">=&gt;</span>   <span class="mi">5</span><span class="p">:</span>      <span class="n">func</span> <span class="n">add</span><span class="p">(</span><span class="n">x</span> <span class="nb">int</span><span class="p">,</span> <span class="n">y</span> <span class="nb">int</span><span class="p">)</span> <span class="nb">int</span> <span class="p">{</span>
     <span class="mi">6</span><span class="p">:</span>         <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
     <span class="mi">7</span><span class="p">:</span> <span class="p">}</span>
     <span class="mi">8</span><span class="p">:</span>
     <span class="mi">9</span><span class="p">:</span> <span class="n">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="mi">10</span><span class="p">:</span>         <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">add</span><span class="p">(</span><span class="mi">42</span><span class="p">,</span> <span class="mi">13</span><span class="p">))</span>
<span class="p">(</span><span class="n">dlv</span><span class="p">)</span>
</code></pre></div>

<h4>使用<code>文件名:行号</code>来设置断点</h4>
<p>上面的例子中，我们经过 <code>main</code> 函数进入了 <code>add()</code> 函数，但是你也可以在你想加断点的地方直接使用“文件名:行号”的组合。下面是在 <code>add()</code> 函数开始处加断点的另一种方式。</p>
<div class="highlight"><pre><span></span><code><span class="p">(</span><span class="n">dlv</span><span class="p">)</span> <span class="k">break</span> <span class="n">functions</span><span class="o">.</span><span class="n">go</span><span class="p">:</span><span class="mi">5</span>
<span class="n">Breakpoint</span> <span class="mi">1</span> <span class="nb">set</span> <span class="n">at</span> <span class="mh">0x4a2280</span> <span class="k">for</span> <span class="n">main</span><span class="o">.</span><span class="n">add</span><span class="p">()</span> <span class="o">./</span><span class="n">functions</span><span class="o">.</span><span class="n">go</span><span class="p">:</span><span class="mi">5</span>
<span class="p">(</span><span class="n">dlv</span><span class="p">)</span> <span class="k">continue</span>
<span class="o">&gt;</span> <span class="n">main</span><span class="o">.</span><span class="n">add</span><span class="p">()</span> <span class="o">./</span><span class="n">functions</span><span class="o">.</span><span class="n">go</span><span class="p">:</span><span class="mi">5</span> <span class="p">(</span><span class="n">hits</span> <span class="n">goroutine</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span><span class="mi">1</span> <span class="n">total</span><span class="p">:</span><span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="n">PC</span><span class="p">:</span> <span class="mh">0x4a2280</span><span class="p">)</span>
     <span class="mi">1</span><span class="p">:</span> <span class="n">package</span> <span class="n">main</span>
     <span class="mi">2</span><span class="p">:</span>
     <span class="mi">3</span><span class="p">:</span> <span class="kn">import</span> <span class="s2">&quot;fmt&quot;</span>
     <span class="mi">4</span><span class="p">:</span>
<span class="o">=&gt;</span>   <span class="mi">5</span><span class="p">:</span>      <span class="n">func</span> <span class="n">add</span><span class="p">(</span><span class="n">x</span> <span class="nb">int</span><span class="p">,</span> <span class="n">y</span> <span class="nb">int</span><span class="p">)</span> <span class="nb">int</span> <span class="p">{</span>
     <span class="mi">6</span><span class="p">:</span>         <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
     <span class="mi">7</span><span class="p">:</span> <span class="p">}</span>
     <span class="mi">8</span><span class="p">:</span>
     <span class="mi">9</span><span class="p">:</span> <span class="n">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="mi">10</span><span class="p">:</span>         <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">add</span><span class="p">(</span><span class="mi">42</span><span class="p">,</span> <span class="mi">13</span><span class="p">))</span>
<span class="p">(</span><span class="n">dlv</span><span class="p">)</span>
</code></pre></div>

<h4>查看当前的栈信息</h4>
<p>现在我们运行到了 <code>add()</code> 函数，我们可以在 Delve 中用 <code>stack</code> 命令查看当前栈的内容。这里在 <code>0</code> 位置展示了栈顶的函数 <code>add()</code> ，紧接着在 <code>1</code> 位置展示了调用 <code>add()</code> 函数的 <code>main.main</code>。在 <code>main.main</code> 下面的函数属于 Go 运行时，是用来处理加载和执行该程序的。</p>
<div class="highlight"><pre><span></span><code><span class="p">(</span><span class="n">dlv</span><span class="p">)</span><span class="w"> </span><span class="n">stack</span>
<span class="mi">0</span><span class="w">  </span><span class="mh">0x00000000004a2280</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="k">add</span>
<span class="w">   </span><span class="k">at</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">functions</span><span class="p">.</span><span class="k">go</span><span class="err">:</span><span class="mi">5</span>
<span class="mi">1</span><span class="w">  </span><span class="mh">0x00000000004a22d7</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">main</span><span class="p">.</span><span class="n">main</span>
<span class="w">   </span><span class="k">at</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="n">functions</span><span class="p">.</span><span class="k">go</span><span class="err">:</span><span class="mi">10</span>
<span class="mi">2</span><span class="w">  </span><span class="mh">0x000000000042dd1f</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">runtime</span><span class="p">.</span><span class="n">main</span>
<span class="w">   </span><span class="k">at</span><span class="w"> </span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">golang</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="k">proc</span><span class="p">.</span><span class="k">go</span><span class="err">:</span><span class="mi">200</span>
<span class="mi">3</span><span class="w">  </span><span class="mh">0x0000000000458171</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">runtime</span><span class="p">.</span><span class="n">goexit</span>
<span class="w">   </span><span class="k">at</span><span class="w"> </span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">golang</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">asm_amd64</span><span class="p">.</span><span class="nl">s</span><span class="p">:</span><span class="mi">1337</span>
<span class="p">(</span><span class="n">dlv</span><span class="p">)</span>
</code></pre></div>

<h4>在帧之间跳转</h4>
<p>在 Delve 中我们可以用 <code>frame</code> 命令实现帧之间的跳转。在下面的例子中，我们用 <code>frame</code> 实现了从 <code>add()</code> 帧跳到 <code>main.main</code> 帧，以此类推。</p>
<div class="highlight"><pre><span></span><code><span class="p">(</span><span class="n">dlv</span><span class="p">)</span> <span class="n">frame</span> <span class="mi">0</span>
<span class="o">&gt;</span> <span class="n">main</span><span class="o">.</span><span class="n">add</span><span class="p">()</span> <span class="o">./</span><span class="n">functions</span><span class="o">.</span><span class="n">go</span><span class="p">:</span><span class="mi">5</span> <span class="p">(</span><span class="n">hits</span> <span class="n">goroutine</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span><span class="mi">1</span> <span class="n">total</span><span class="p">:</span><span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="n">PC</span><span class="p">:</span> <span class="mh">0x4a2280</span><span class="p">)</span>
<span class="n">Frame</span> <span class="mi">0</span><span class="p">:</span> <span class="o">./</span><span class="n">functions</span><span class="o">.</span><span class="n">go</span><span class="p">:</span><span class="mi">5</span> <span class="p">(</span><span class="n">PC</span><span class="p">:</span> <span class="mi">4</span><span class="n">a2280</span><span class="p">)</span>
     <span class="mi">1</span><span class="p">:</span> <span class="n">package</span> <span class="n">main</span>
     <span class="mi">2</span><span class="p">:</span>
     <span class="mi">3</span><span class="p">:</span> <span class="kn">import</span> <span class="s2">&quot;fmt&quot;</span>
     <span class="mi">4</span><span class="p">:</span>
<span class="o">=&gt;</span>   <span class="mi">5</span><span class="p">:</span>      <span class="n">func</span> <span class="n">add</span><span class="p">(</span><span class="n">x</span> <span class="nb">int</span><span class="p">,</span> <span class="n">y</span> <span class="nb">int</span><span class="p">)</span> <span class="nb">int</span> <span class="p">{</span>
     <span class="mi">6</span><span class="p">:</span>         <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
     <span class="mi">7</span><span class="p">:</span> <span class="p">}</span>
     <span class="mi">8</span><span class="p">:</span>
     <span class="mi">9</span><span class="p">:</span> <span class="n">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="mi">10</span><span class="p">:</span>         <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">add</span><span class="p">(</span><span class="mi">42</span><span class="p">,</span> <span class="mi">13</span><span class="p">))</span>
<span class="p">(</span><span class="n">dlv</span><span class="p">)</span> <span class="n">frame</span> <span class="mi">1</span>
<span class="o">&gt;</span> <span class="n">main</span><span class="o">.</span><span class="n">add</span><span class="p">()</span> <span class="o">./</span><span class="n">functions</span><span class="o">.</span><span class="n">go</span><span class="p">:</span><span class="mi">5</span> <span class="p">(</span><span class="n">hits</span> <span class="n">goroutine</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span><span class="mi">1</span> <span class="n">total</span><span class="p">:</span><span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="n">PC</span><span class="p">:</span> <span class="mh">0x4a2280</span><span class="p">)</span>
<span class="n">Frame</span> <span class="mi">1</span><span class="p">:</span> <span class="o">./</span><span class="n">functions</span><span class="o">.</span><span class="n">go</span><span class="p">:</span><span class="mi">10</span> <span class="p">(</span><span class="n">PC</span><span class="p">:</span> <span class="mi">4</span><span class="n">a22d7</span><span class="p">)</span>
     <span class="mi">5</span><span class="p">:</span> <span class="n">func</span> <span class="n">add</span><span class="p">(</span><span class="n">x</span> <span class="nb">int</span><span class="p">,</span> <span class="n">y</span> <span class="nb">int</span><span class="p">)</span> <span class="nb">int</span> <span class="p">{</span>
     <span class="mi">6</span><span class="p">:</span>         <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
     <span class="mi">7</span><span class="p">:</span> <span class="p">}</span>
     <span class="mi">8</span><span class="p">:</span>
     <span class="mi">9</span><span class="p">:</span> <span class="n">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
<span class="o">=&gt;</span>  <span class="mi">10</span><span class="p">:</span>              <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">add</span><span class="p">(</span><span class="mi">42</span><span class="p">,</span> <span class="mi">13</span><span class="p">))</span>
    <span class="mi">11</span><span class="p">:</span> <span class="p">}</span>
<span class="p">(</span><span class="n">dlv</span><span class="p">)</span>
</code></pre></div>

<h4>打印函数参数</h4>
<p>一个函数通常会接收多个参数。在 <code>add()</code> 函数中，它的入参是两个整型。Delve 有个便捷的 <code>args</code> 命令，它能打印出命令行传给函数的参数。</p>
<div class="highlight"><pre><span></span><code>(dlv) args
x = 42
y = 13
~r2 = 824633786832
(dlv)
</code></pre></div>

<h4>查看反汇编码</h4>
<p>由于我们是调试编译出的二进制文件，因此如果我们能查看编译器生成的汇编语言指令将会非常有用。Delve 提供了一个 <code>disassemble</code> 命令来查看这些指令。在下面的例子中，我们用它来查看 <code>add()</code> 函数的汇编指令。</p>
<div class="highlight"><pre><span></span><code><span class="p">(</span><span class="n">dlv</span><span class="p">)</span> <span class="n">step</span>
<span class="o">&gt;</span> <span class="n">main</span><span class="o">.</span><span class="n">add</span><span class="p">()</span> <span class="o">./</span><span class="n">functions</span><span class="o">.</span><span class="n">go</span><span class="p">:</span><span class="mi">5</span> <span class="p">(</span><span class="n">PC</span><span class="p">:</span> <span class="mh">0x4a2280</span><span class="p">)</span>
     <span class="mi">1</span><span class="p">:</span> <span class="n">package</span> <span class="n">main</span>
     <span class="mi">2</span><span class="p">:</span>
     <span class="mi">3</span><span class="p">:</span> <span class="kn">import</span> <span class="s2">&quot;fmt&quot;</span>
     <span class="mi">4</span><span class="p">:</span>
<span class="o">=&gt;</span>   <span class="mi">5</span><span class="p">:</span>      <span class="n">func</span> <span class="n">add</span><span class="p">(</span><span class="n">x</span> <span class="nb">int</span><span class="p">,</span> <span class="n">y</span> <span class="nb">int</span><span class="p">)</span> <span class="nb">int</span> <span class="p">{</span>
     <span class="mi">6</span><span class="p">:</span>         <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
     <span class="mi">7</span><span class="p">:</span> <span class="p">}</span>
     <span class="mi">8</span><span class="p">:</span>
     <span class="mi">9</span><span class="p">:</span> <span class="n">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="mi">10</span><span class="p">:</span>         <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">add</span><span class="p">(</span><span class="mi">42</span><span class="p">,</span> <span class="mi">13</span><span class="p">))</span>
<span class="p">(</span><span class="n">dlv</span><span class="p">)</span> <span class="n">disassemble</span>
<span class="n">TEXT</span> <span class="n">main</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">SB</span><span class="p">)</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">go</span><span class="o">/</span><span class="n">gobin</span><span class="o">/</span><span class="n">functions</span><span class="o">.</span><span class="n">go</span>
<span class="o">=&gt;</span>   <span class="n">functions</span><span class="o">.</span><span class="n">go</span><span class="p">:</span><span class="mi">5</span>  <span class="mh">0x4a2280</span>   <span class="mi">48</span><span class="n">c744241800000000</span>   <span class="n">mov</span> <span class="n">qword</span> <span class="n">ptr</span> <span class="p">[</span><span class="n">rsp</span><span class="o">+</span><span class="mh">0x18</span><span class="p">],</span> <span class="mh">0x0</span>
        <span class="n">functions</span><span class="o">.</span><span class="n">go</span><span class="p">:</span><span class="mi">6</span>  <span class="mh">0x4a2289</span>   <span class="mi">488</span><span class="n">b442408</span>           <span class="n">mov</span> <span class="n">rax</span><span class="p">,</span> <span class="n">qword</span> <span class="n">ptr</span> <span class="p">[</span><span class="n">rsp</span><span class="o">+</span><span class="mh">0x8</span><span class="p">]</span>
        <span class="n">functions</span><span class="o">.</span><span class="n">go</span><span class="p">:</span><span class="mi">6</span>  <span class="mh">0x4a228e</span>   <span class="mi">4803442410</span>           <span class="n">add</span> <span class="n">rax</span><span class="p">,</span> <span class="n">qword</span> <span class="n">ptr</span> <span class="p">[</span><span class="n">rsp</span><span class="o">+</span><span class="mh">0x10</span><span class="p">]</span>
        <span class="n">functions</span><span class="o">.</span><span class="n">go</span><span class="p">:</span><span class="mi">6</span>  <span class="mh">0x4a2293</span>   <span class="mi">4889442418</span>           <span class="n">mov</span> <span class="n">qword</span> <span class="n">ptr</span> <span class="p">[</span><span class="n">rsp</span><span class="o">+</span><span class="mh">0x18</span><span class="p">],</span> <span class="n">rax</span>
        <span class="n">functions</span><span class="o">.</span><span class="n">go</span><span class="p">:</span><span class="mi">6</span>  <span class="mh">0x4a2298</span>   <span class="n">c3</span>                   <span class="n">ret</span>
<span class="p">(</span><span class="n">dlv</span><span class="p">)</span>
</code></pre></div>

<h4>单步退出函数</h4>
<p>另一个功能是 <code>stepout</code>，这个功能可以让我们跳回到函数被调用的地方。在我们的例子中，如果我们想回到 <code>main.main</code> 函数，我们只需要简单地运行 <code>stepout</code> 命令，它就会把我们带回去。在我们调试大型代码库时，这个功能会是一个非常便捷的工具。</p>
<div class="highlight"><pre><span></span><code><span class="p">(</span><span class="n">dlv</span><span class="p">)</span><span class="w"> </span><span class="n">stepout</span>
<span class="o">&gt;</span><span class="w"> </span><span class="n">main</span><span class="o">.</span><span class="n">main</span><span class="p">()</span><span class="w"> </span><span class="o">./</span><span class="n">functions</span><span class="o">.</span><span class="n">go</span><span class="p">:</span><span class="mi">10</span><span class="w"> </span><span class="p">(</span><span class="n">PC</span><span class="p">:</span><span class="w"> </span><span class="mh">0x4a22d7</span><span class="p">)</span>
<span class="n">Values</span><span class="w"> </span><span class="n">returned</span><span class="p">:</span>
<span class="w">        </span><span class="o">~</span><span class="n">r2</span><span class="p">:</span><span class="w"> </span><span class="mi">55</span>

<span class="w">     </span><span class="mi">5</span><span class="p">:</span><span class="w"> </span><span class="k">func</span><span class="w"> </span><span class="n">add</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="nb nb-Type">int</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="nb nb-Type">int</span><span class="p">)</span><span class="w"> </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="p">{</span>
<span class="w">     </span><span class="mi">6</span><span class="p">:</span><span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">y</span>
<span class="w">     </span><span class="mi">7</span><span class="p">:</span><span class="w"> </span><span class="p">}</span>
<span class="w">     </span><span class="mi">8</span><span class="p">:</span>
<span class="w">     </span><span class="mi">9</span><span class="p">:</span><span class="w"> </span><span class="k">func</span><span class="w"> </span><span class="n">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="o">=&gt;</span><span class="w">  </span><span class="mi">10</span><span class="p">:</span><span class="w">              </span><span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">add</span><span class="p">(</span><span class="mi">42</span><span class="p">,</span><span class="w"> </span><span class="mi">13</span><span class="p">))</span>
<span class="w">    </span><span class="mi">11</span><span class="p">:</span><span class="w"> </span><span class="p">}</span>
<span class="p">(</span><span class="n">dlv</span><span class="p">)</span>
</code></pre></div>

<h4>打印变量信息</h4>
<p>我们一起通过 <a href="https://tour.golang.org/basics/9">Go 教程</a> 的另一个示例程序来看下 Delve 是怎么处理 Go 中的变量的。下面的示例程序定义和初始化了一些不同类型的变量。你可以构建和运行程序。</p>
<div class="highlight"><pre><span></span><code><span class="err">$</span> <span class="n">cat</span> <span class="n">variables</span><span class="o">.</span><span class="n">go</span>
<span class="n">package</span> <span class="n">main</span>

<span class="kn">import</span> <span class="s2">&quot;fmt&quot;</span>

<span class="n">var</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span>

<span class="n">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">var</span> <span class="n">c</span><span class="p">,</span> <span class="n">python</span><span class="p">,</span> <span class="n">java</span> <span class="o">=</span> <span class="n">true</span><span class="p">,</span> <span class="n">false</span><span class="p">,</span> <span class="s2">&quot;no!&quot;</span>
        <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">python</span><span class="p">,</span> <span class="n">java</span><span class="p">)</span>
<span class="p">}</span>
<span class="err">$</span>

<span class="err">$</span> <span class="n">go</span> <span class="n">build</span> <span class="n">variables</span><span class="o">.</span><span class="n">go</span> <span class="o">&amp;&amp;</span><span class="p">;</span> <span class="o">./</span><span class="n">variables</span>
<span class="mi">1</span> <span class="mi">2</span> <span class="n">true</span> <span class="n">false</span> <span class="n">no</span><span class="err">!</span>
<span class="err">$</span>
</code></pre></div>

<p>像前面说过的那样，用 <code>delve debug</code> 在调试器中加载程序。你可以在 Delve 中用 <code>print</code> 命令通过变量名来展示他们当前的值。</p>
<div class="highlight"><pre><span></span><code>(dlv) print c
true
(dlv) print java
&quot;no!&quot;
(dlv)
</code></pre></div>

<p>或者，你还可以用 <code>locals</code> 命令来打印函数内所有的局部变量。</p>
<div class="highlight"><pre><span></span><code>(dlv) locals
python = false
c = true
java = &quot;no!&quot;
(dlv)
</code></pre></div>

<p>如果你不知道变量的类型，你可以用 <code>whatis</code> 命令来通过变量名来打印它的类型。</p>
<div class="highlight"><pre><span></span><code>(dlv) whatis python
bool
(dlv) whatis c
bool
(dlv) whatis java
string
(dlv)
</code></pre></div>

<h3>总结</h3>
<p>现在我们只是了解了 Delve 所有功能的皮毛。你可以自己去查看帮助内容，尝试下其它的命令。你还可以把 Delve 绑定到运行中的 Go 程序上（守护进程！），如果你安装了 Go 源码库，你甚至可以用 Delve 导出 Golang 库内部的信息。勇敢去探索吧！</p>
    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>links</h2>
                        <ul>
                            <li><a href="https://getpelican.com/">Pelican</a></li>
                            <li><a href="https://www.python.org/">Python.org</a></li>
                            <li><a href="https://palletsprojects.com/p/jinja/">Jinja2</a></li>
                            <li><a href="#">You can modify those links in your config file</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>

                            <li><a href="#">You can add links in your config file</a></li>
                            <li><a href="#">Another social link</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a rel="nofollow" href="https://getpelican.com/">Pelican</a>, which takes great advantage of <a rel="nofollow" href="https://www.python.org/">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a rel="nofollow" href="https://www.smashingmagazine.com/2009/08/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>