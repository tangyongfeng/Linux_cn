<!DOCTYPE html>
<html lang="zh">
<head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="generator" content="Pelican" />
        <title>使用这个 Python 工具对网站 SEO 问题进行自动化测试</title>
        <link rel="stylesheet" href="/theme/css/main.css" />
        <meta name="description" content="Author: Jr Oakes SEODeploy 可以帮助我们在网站部署之前识别出 SEO 问题。 作为一个技术性搜索引擎优化开发者，我经常被请来协助做网站 …" />
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">linux_cn</a></h1>
                <nav><ul>
                    <li><a href="/category/chuan-shan-jia-zhuan-fang">穿山甲专访</a></li>
                    <li><a href="/category/dai-ma-ying-xiong">代码英雄</a></li>
                    <li><a href="/category/fen-xiang">分享</a></li>
                    <li><a href="/category/guan-dian">观点</a></li>
                    <li><a href="/category/huo-dong">活动</a></li>
                    <li><a href="/category/ji-ke-man-hua">极客漫画</a></li>
                    <li><a href="/category/ji-zhu">技术</a></li>
                    <li><a href="/category/kai-yuan-zhi-hui">开源智慧</a></li>
                    <li><a href="/category/linux-fa-xing-ban">Linux 发行版</a></li>
                    <li><a href="/category/mei-ri-an-quan-zi-xun">每日安全资讯</a></li>
                    <li><a href="/category/misc">Misc</a></li>
                    <li><a href="/category/qu-kuai-lian">区块链</a></li>
                    <li><a href="/category/rong-qi-yu-yun">容器与云</a></li>
                    <li class="active"><a href="/category/ruan-jian-kai-fa">软件开发</a></li>
                    <li><a href="/category/shu-mei-pai">树莓派</a></li>
                    <li><a href="/category/xi-tong-yun-wei">系统运维</a></li>
                    <li><a href="/category/xin-wen">新闻</a></li>
                    <li><a href="/category/ying-he-guan-cha">硬核观察</a></li>
                    <li><a href="/category/zhi-ye-sheng-ya">职业生涯</a></li>
                    <li><a href="/category/zhong-jiang-ming-dan">中奖名单</a></li>
                    <li><a href="/category/zhuo-mian-ying-yong">桌面应用</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="/2020/10/shi-yong-zhe-ge-python-gong-ju-dui-wang-zhan-seo-wen-ti-jin-xing-zi-dong-hua-ce-shi.html" rel="bookmark"
           title="Permalink to 使用这个 Python 工具对网站 SEO 问题进行自动化测试">使用这个 Python 工具对网站 SEO 问题进行自动化测试</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2020-10-09T19:49:00+02:00">
                Published: Fri 09 October 2020
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/linux-fans-from-china.html">linux fans from china</a>
        </address>
<p>In <a href="/category/ruan-jian-kai-fa">软件开发</a>.</p>

</footer><!-- /.post-info -->      <p>Author: Jr Oakes</p>
<blockquote>
<p>SEODeploy 可以帮助我们在网站部署之前识别出 SEO 问题。</p>
</blockquote>
<p><img alt="" src="/data/attachment/album/202010/09/194928xbqvdd81amapgdae.jpg"></p>
<p>作为一个技术性搜索引擎优化开发者，我经常被请来协助做网站迁移、新网站发布、分析实施和其他一些影响网站在线可见性和测量等领域，以控制风险。许多公司每月经常性收入的很大一部分来自用户通过搜索引擎找到他们的产品和服务。虽然搜索引擎已经能妥善地处理没有被良好格式化的代码，但在开发过程中还是会出问题，对搜索引擎如何索引和为用户显示页面产生不利影响。</p>
<p>我曾经也尝试通过评审各阶段会破坏 SEO（<ruby> 搜索引擎优化 <rt>  search engine optimization </rt></ruby>）的问题来手动降低这种风险。我的团队最终审查到的结果，决定了该项目是否可以上线。但这个过程通常很低效，只能用于有限的页面，而且很有可能出现人为错误。</p>
<p>长期以来，这个行业一直在寻找可用且值得信赖的方式来自动化这一过程，同时还能让开发人员和搜索引擎优化人员在必须测试的内容上获得有意义的发言权。这是非常重要的，因为这些团队在开发冲刺中优先级通常会发生冲突，搜索引擎优化者需要推动变化，而开发人员需要控制退化和预期之外的情况。</p>
<h3>常见的破坏 SEO 的问题</h3>
<p>我合作过的很多网站有成千上万的页面，甚至上百万。实在令人费解，为什么一个开发过程中的改动能影响这么多页面。在 SEO 的世界中，Google 或其他搜索引擎展示你的页面时，一个非常微小和看起来无关紧要的修改也可能导致全网站范围的变化。在部署到生产环境之前，必须要处理这类错误。</p>
<p>下面是我去年见过的几个例子。</p>
<h4>偶发的 noindex</h4>
<p>在部署到生产环境之后，我们用的一个专用的第三方 SEO 监控工具 <a href="https://www.contentkingapp.com/">ContentKing</a> 马上发现了这个问题。这个错误很隐蔽，因为它在 HTML 中是不可见的，确切地说，它隐藏在服务器响应头里，但它能很快导致搜索不可见。</p>
<div class="highlight"><pre><span></span><code><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Date</span><span class="o">:</span> <span class="l">Tue May 25 2010 21:12:42 GMT</span>
<span class="err">[...]</span>
X-Robots-Tag: noindex
[...]
</code></pre></div>

<h4>canonical 小写</h4>
<p>上线时错误地把整个网站的 <a href="https://en.wikipedia.org/wiki/Canonical_link_element">canonical 链接元素</a>全改成小写了。这个改动影响了接近 30000 个 URL。在修改之前，所有的 URL 大小写都正常（例如 <code>URL-Path</code> 这样）。这之所以是个问题是因为 <code>canonical</code> 链接元素是用来给 Google 提示一个网页真实的规范 URL 版本的。这个改动导致很多 URL 被从 Google 的索引中移除并用小写的版本（<code>/url-path</code>）重新建立索引。影响范围是流量损失了 10% 到 15%，也污染了未来几个星期的网页监控数据。</p>
<h4>源站退化</h4>
<p>有个网站的 React 实现复杂而奇特，它有个神奇的问题，<code>origin.domain.com</code> URL 退化显示为 CDN 服务器的源站。它会在网站元数据（如 <code>canonical</code> 链接元素、URL 和 Open Graph 链接）中间歇性地显示原始的主机而不是 CDN 边缘主机。这个问题在原始的 HTML 和渲染后的 HTML 中都存在。这个问题影响搜索的可见性和在社交媒体上的分享质量。</p>
<h3>SEODeploy 介绍</h3>
<p>SEO 通常使用差异测试工具来检测渲染后和原始的 HTML 的差异。差异测试是很理想的，因为它避免了肉眼测试的不确定性。你希望检查 Google 对你的页面的渲染过程的差异，而不是检查用户对你页面的渲染。你希望查看下原始的 HTML 是什么样的，而不是渲染后的 HTML，因为 Google 的渲染过程是有独立的两个阶段的。</p>
<p>这促使我和我的同事创造了 <a href="https://github.com/locomotive-agency/SEODeploy">SEODeploy</a> 这个“在部署流水线中用于自动化 SEO 测试的 Python 库。”我们的使命是：</p>
<blockquote>
<p>开发一个工具，让开发者能提供若干 URL 路径，并允许这些 URL 在生产环境和预演环境的主机上进行差异测试，尤其是对 SEO 相关数据的非预期的退化。</p>
</blockquote>
<p>SEODeploy 的机制很简单：提供一个每行内容都是 URL 路径的文本文件，SEODeploy 对那些路径运行一系列模块，对比<ruby> 生产环境 <rt>  production </rt></ruby>和<ruby> 预演环境 <rt>  staging </rt></ruby>的 URL，把检测到的所有的错误和改动信息报告出来。</p>
<p><img alt="SEODeploy overview" src="/data/attachment/album/202010/09/195003c2o3a3pt8yp9szc5.png" title="SEODeploy overview"></p>
<p>这个工具及其模块可以用一个 YAML 文件来配置，可以根据预期的变化进行定制。</p>
<p><img alt="SEODeploy output" src="/data/attachment/album/202010/09/195018bpgmxtrvgykrsaxx.png" title="SEODeploy output"></p>
<p>最初的发布版本包含下面的的核心功能和概念：</p>
<ol>
<li><strong>开源</strong>：我们坚信分享代码可以被大家批评、改进、扩展、分享和复用。</li>
<li><strong>模块化</strong>：Web 开发中有许多不同的堆栈和边缘案例。SEODeploy 工具在概念上很简单，因此采用模块化用来控制复杂性。我们提供了两个建好的模块和一个实例模块来简述基本结构。</li>
<li><strong>URL 抽样</strong>：由于它不是对所有 URL 都是可行和有效的，因此我们引入了一种随机抽取 XML 网站地图 URL 或被 ContentKing 监控的 URL 作为样本的方法。</li>
<li><strong>灵活的差异检测</strong>：Web 数据是凌乱的。无论被检测的数据是什么类型（如 ext、数组或列表、JSON 对象或字典、整数、浮点数等等），差异检测功能都会尝试将这些数据转换为差异信息。</li>
<li><strong>自动化</strong>: 你可以在命令行来调用抽样和运行方法，将 SEODeploy 融合到已有的流水线也很简单。</li>
</ol>
<h3>模块</h3>
<p>虽然核心功能很简单，但在设计上，SEODeploy 的强大功能和复杂度体现在模块上。模块用来处理更难的任务：获取、清理和组织预演服务器和生产服务器上的数据来作对比。</p>
<h4>Headless 模块</h4>
<p><a href="https://locomotive-agency.github.io/SEODeploy/modules/headless/">Headless 模块</a> 是为那些从库里获取数据时不想为第三方服务付费的开发者准备的。它可以运行任意版本的 Chrome，会从每组用来比较的 URL 中提取渲染的数据。</p>
<p>Headless 模块会提取下面的核心数据用来比较：</p>
<ol>
<li>SEO 内容，如标题、H1-H6、链接等等。</li>
<li>从 Chrome <ruby> 计时器 <rt>  Timings </rt></ruby>和 CDP（<ruby> Chrome 开发工具协议 <rt>  Chrome DevTools Protocol </rt></ruby>）性能 API 中提取性能数据</li>
<li>计算出的性能指标，包括 CLS（<ruby> 累积布局偏移 <rt>  Cumulative Layout Shift </rt></ruby>），这是 Google 最近发布的一个很受欢迎的 <a href="https://web.dev/vitals/">Web 核心数据</a></li>
<li>从上述 CDP 的覆盖率 API 获取的 CSS 和 JavaScript 的覆盖率数据</li>
</ol>
<p>这个模块引入了处理预演环境、网络速度预设（为了让对比更规范化）等功能，也引入了一个处理在预演对比数据中替换预演主机的方法。开发者也能很容易地扩展这个模块，以收集他们想要在每个页面上进行比较的任何其他数据。</p>
<h4>其他模块</h4>
<p>我们为开发者创建了一个<a href="https://locomotive-agency.github.io/SEODeploy/modules/creating/">示例模块</a>，开发者可以参照它来使用框架创建一个自定义的提取模块。另一个示例模块是与 ContentKing 结合的。ContentKing 模块需要有 ContentKing 订阅，而 Headless 可以在所有能运行 Chrome 的机器上运行。</p>
<h3>需要解决的问题</h3>
<p>我们有扩展和强化工具库的<a href="https://locomotive-agency.github.io/SEODeploy/todo/">计划</a>，但正在寻求开发人员的<a href="https://locomotive-agency.github.io/SEODeploy/about/#contact">反馈</a>，了解哪些是可行的，哪些是不符合他们的需求。我们正在解决的问题和条目有：</p>
<ol>
<li>对于某些对比元素（尤其是 schema），动态时间戳会产生误报。</li>
<li>把测试数据保存到数据库，以便查看部署历史以及与上次的预演推送进行差异测试。</li>
<li>通过云基础设施的渲染，强化提取的规模和速度。</li>
<li>把测试覆盖率从现在的 46% 提高到 99% 以上。</li>
<li>目前，我们依赖 <a href="https://python-poetry.org/">Poetry</a> 进行部署管理，但我们希望发布一个 PyPl 库，这样就可以用 <code>pip install</code> 轻松安装。</li>
<li>我们还在关注更多使用时的问题和相关数据。</li>
</ol>
<h3>开始使用</h3>
<p>这个项目在 <a href="https://github.com/locomotive-agency/SEODeploy">GitHub</a> 上，我们对大部分功能都提供了 <a href="https://locomotive-agency.github.io/SEODeploy/">文档</a>。</p>
<p>我们希望你能克隆 SEODeploy 并试试它。我们的目标是通过这个由技术性搜索引擎优化开发者开发的、经过开发者和工程师们验证的工具来支持开源社区。我们都见过验证复杂的预演问题需要多长时间，也都见过大量 URL 的微小改动能有什么样的业务影响。我们认为这个库可以为开发团队节省时间、降低部署过程中的风险。</p>
<p>如果你有问题或者想提交代码，请查看项目的<a href="https://locomotive-agency.github.io/SEODeploy/about/">关于</a>页面。</p>
    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>links</h2>
                        <ul>
                            <li><a href="https://getpelican.com/">Pelican</a></li>
                            <li><a href="https://www.python.org/">Python.org</a></li>
                            <li><a href="https://palletsprojects.com/p/jinja/">Jinja2</a></li>
                            <li><a href="#">You can modify those links in your config file</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>

                            <li><a href="#">You can add links in your config file</a></li>
                            <li><a href="#">Another social link</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a rel="nofollow" href="https://getpelican.com/">Pelican</a>, which takes great advantage of <a rel="nofollow" href="https://www.python.org/">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a rel="nofollow" href="https://www.smashingmagazine.com/2009/08/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>