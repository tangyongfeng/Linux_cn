<!DOCTYPE html>
<html lang="zh">
<head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="generator" content="Pelican" />
        <title>OpenGL 与 Go 教程（二）绘制游戏面板</title>
        <link rel="stylesheet" href="/theme/css/main.css" />
        <meta name="description" content="Author: Kylewbanks 第一节: Hello, OpenGL 第二节: 绘制游戏面板 第三节：实现游戏功能 这篇教程的所有源代码都可以在 GitHub 上找到。 欢迎回到《OpenGL 与 Go …" />
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">linux_cn</a></h1>
                <nav><ul>
                    <li><a href="/category/chuan-shan-jia-zhuan-fang">穿山甲专访</a></li>
                    <li><a href="/category/dai-ma-ying-xiong">代码英雄</a></li>
                    <li><a href="/category/fen-xiang">分享</a></li>
                    <li><a href="/category/guan-dian">观点</a></li>
                    <li><a href="/category/huo-dong">活动</a></li>
                    <li><a href="/category/ji-ke-man-hua">极客漫画</a></li>
                    <li><a href="/category/ji-zhu">技术</a></li>
                    <li><a href="/category/kai-yuan-zhi-hui">开源智慧</a></li>
                    <li><a href="/category/linux-fa-xing-ban">Linux 发行版</a></li>
                    <li><a href="/category/mei-ri-an-quan-zi-xun">每日安全资讯</a></li>
                    <li><a href="/category/misc">Misc</a></li>
                    <li><a href="/category/qu-kuai-lian">区块链</a></li>
                    <li><a href="/category/rong-qi-yu-yun">容器与云</a></li>
                    <li class="active"><a href="/category/ruan-jian-kai-fa">软件开发</a></li>
                    <li><a href="/category/shu-mei-pai">树莓派</a></li>
                    <li><a href="/category/xi-tong-yun-wei">系统运维</a></li>
                    <li><a href="/category/xin-wen">新闻</a></li>
                    <li><a href="/category/ying-he-guan-cha">硬核观察</a></li>
                    <li><a href="/category/zhi-ye-sheng-ya">职业生涯</a></li>
                    <li><a href="/category/zhong-jiang-ming-dan">中奖名单</a></li>
                    <li><a href="/category/zhuo-mian-ying-yong">桌面应用</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="/2017/10/opengl-yu-go-jiao-cheng-er-hui-zhi-you-xi-mian-ban.html" rel="bookmark"
           title="Permalink to OpenGL 与 Go 教程（二）绘制游戏面板">OpenGL 与 Go 教程（二）绘制游戏面板</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2017-10-07T22:35:00+02:00">
                Published: Sat 07 October 2017
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/linux-fans-from-china.html">linux fans from china</a>
        </address>
<p>In <a href="/category/ruan-jian-kai-fa">软件开发</a>.</p>

</footer><!-- /.post-info -->      <p>Author: Kylewbanks</p>
<p><img alt="" src="/data/attachment/album/201710/07/223453r5tqot1qsp0s6ga6.jpg"></p>
<ul>
<li><a href="/article-8933-1.html">第一节: Hello, OpenGL</a></li>
<li><a href="/article-8937-1.html">第二节: 绘制游戏面板</a></li>
<li><a href="/article-8969-1.html">第三节：实现游戏功能</a></li>
</ul>
<p>这篇教程的所有源代码都可以在 <a href="https://github.com/KyleBanks/conways-gol">GitHub</a> 上找到。</p>
<p>欢迎回到《OpenGL 与 Go 教程》。如果你还没有看过<a href="/article-8933-1.html">第一节</a>，那就要回过头去看看那一节。</p>
<p>你现在应该能够创造一个漂亮的白色三角形，但我们不会把三角形当成我们游戏的基本单元，是时候把三角形变成正方形了，然后我们会做出一个完整的方格。</p>
<p>让我们现在开始做吧！</p>
<h3>利用三角形绘制方形</h3>
<p>在我们绘制方形之前，先把三角形变成直角三角形。打开 <code>main.go</code> 文件，把 <code>triangle</code> 的定义改成像这个样子：</p>
<div class="highlight"><pre><span></span><code>triangle = []float32{
    -0.5, 0.5, 0,
    -0.5, -0.5, 0,
    0.5, -0.5, 0,
}
</code></pre></div>

<p>我们做的事情是，把最上面的顶点 X 坐标移动到左边（也就是变为 <code>-0.5</code>），这就变成了像这样的三角形：</p>
<p><img alt="Conway's Game of Life  - 右弦三角形" src="/data/attachment/album/201710/07/223511c84rhv985frva4vv.png"></p>
<p>很简单，对吧？现在让我们用两个这样的三角形顶点做成正方形。把 <code>triangle</code> 重命名为 <code>square</code>，然后添加第二个倒置的三角形的顶点数据，把直角三角形变成这样的：</p>
<div class="highlight"><pre><span></span><code>square = []float32{
    -0.5, 0.5, 0,
    -0.5, -0.5, 0,
    0.5, -0.5, 0,

    -0.5, 0.5, 0,
    0.5, 0.5, 0,
    0.5, -0.5, 0,
}
</code></pre></div>

<p>注意：你也要把在 <code>main</code> 和 <code>draw</code> 里面命名的 <code>triangle</code> 改为 <code>square</code>。</p>
<p>我们通过添加三个顶点，把顶点数增加了一倍，这三个顶点就是右上角的三角形，用来拼成方形。运行它看看效果：</p>
<p><img alt="Conway's Game of Life - 两个三角形构成方形" src="/data/attachment/album/201710/07/223511wghwhbgk6j1csvvh.png"></p>
<p>很好，现在我们能够绘制正方形了！OpenGL 一点都不难，对吧？</p>
<h3>在窗口中绘制方形格子</h3>
<p>现在我们能画一个方形，怎么画 100 个吗？我们来创建一个 <code>cell</code> 结构体，用来表示格子的每一个单元，因此我们能够很灵活的选择绘制的数量：</p>
<div class="highlight"><pre><span></span><code><span class="k">type</span><span class="w"> </span><span class="nx">cell</span><span class="w"> </span><span class="nx">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">drawable</span><span class="w"> </span><span class="nx">uint32</span>

<span class="w">    </span><span class="nx">x</span><span class="w"> </span><span class="nx">int</span>
<span class="w">    </span><span class="nx">y</span><span class="w"> </span><span class="nx">int</span>
<span class="p">}</span>
</code></pre></div>

<p><code>cell</code> 结构体包含一个 <code>drawable</code> 属性，这是一个顶点数组对象，就像我们在之前创建的一样，这个结构体还包含 X 和 Y 坐标，用来表示这个格子的位置。</p>
<p>我们还需要两个常量，用来设定格子的大小和形状：</p>
<div class="highlight"><pre><span></span><code><span class="k">const</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="o">...</span>

<span class="w">    </span><span class="n">rows</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span>
<span class="w">    </span><span class="n">columns</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span>
<span class="p">)</span>
</code></pre></div>

<p>现在我们添加一个创建格子的函数：</p>
<div class="highlight"><pre><span></span><code><span class="n">func</span><span class="w"> </span><span class="n">makeCells</span><span class="p">()</span><span class="w"> </span><span class="err">[][]</span><span class="o">*</span><span class="n">cell</span><span class="w"> </span><span class="err">{</span>
<span class="w">    </span><span class="n">cells</span><span class="w"> </span><span class="err">:</span><span class="o">=</span><span class="w"> </span><span class="n">make</span><span class="p">(</span><span class="err">[][]</span><span class="o">*</span><span class="n">cell</span><span class="p">,</span><span class="w"> </span><span class="k">rows</span><span class="p">,</span><span class="w"> </span><span class="k">rows</span><span class="p">)</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="err">:</span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="k">rows</span><span class="p">;</span><span class="w"> </span><span class="n">x</span><span class="o">++</span><span class="w"> </span><span class="err">{</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="err">:</span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">columns</span><span class="p">;</span><span class="w"> </span><span class="n">y</span><span class="o">++</span><span class="w"> </span><span class="err">{</span>
<span class="w">            </span><span class="n">c</span><span class="w"> </span><span class="err">:</span><span class="o">=</span><span class="w"> </span><span class="n">newCell</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">)</span>
<span class="w">            </span><span class="n">cells</span><span class="o">[</span><span class="n">x</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">append</span><span class="p">(</span><span class="n">cells</span><span class="o">[</span><span class="n">x</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">)</span>
<span class="w">        </span><span class="err">}</span>
<span class="w">    </span><span class="err">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">cells</span>
<span class="err">}</span>
</code></pre></div>

<p>这里我们创建多维的<ruby> 切片 <rt>  slice </rt></ruby>，代表我们的游戏面板，用名为 <code>newCell</code> 的新函数创建的 <code>cell</code> 来填充矩阵的每个元素，我们待会就来实现 <code>newCell</code> 这个函数。</p>
<p>在接着往下阅读前，我们先花一点时间来看看 <code>makeCells</code> 函数做了些什么。我们创造了一个切片，这个切片的长度和格子的行数相等，每一个切片里面都有一个<ruby> 细胞 <rt>  cell </rt></ruby>的切片，这些细胞的数量与列数相等。如果我们把 <code>rows</code> 和 <code>columns</code> 都设定成 2，那么就会创建如下的矩阵：</p>
<div class="highlight"><pre><span></span><code>[
    [cell, cell],
    [cell, cell]
]
</code></pre></div>

<p>还可以创建一个更大的矩阵，包含 <code>10x10</code> 个细胞：</p>
<div class="highlight"><pre><span></span><code>[
    [cell, cell, cell, cell, cell, cell, cell, cell, cell, cell],
    [cell, cell, cell, cell, cell, cell, cell, cell, cell, cell],
    [cell, cell, cell, cell, cell, cell, cell, cell, cell, cell],
    [cell, cell, cell, cell, cell, cell, cell, cell, cell, cell],
    [cell, cell, cell, cell, cell, cell, cell, cell, cell, cell],
    [cell, cell, cell, cell, cell, cell, cell, cell, cell, cell],
    [cell, cell, cell, cell, cell, cell, cell, cell, cell, cell],
    [cell, cell, cell, cell, cell, cell, cell, cell, cell, cell],
    [cell, cell, cell, cell, cell, cell, cell, cell, cell, cell],
    [cell, cell, cell, cell, cell, cell, cell, cell, cell, cell]
]
</code></pre></div>

<p>现在应该理解了我们创造的矩阵的形状和表示方法。让我们看看 <code>newCell</code> 函数到底是怎么填充矩阵的：</p>
<div class="highlight"><pre><span></span><code><span class="k">func</span><span class="w"> </span><span class="n">newCell</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="nb nb-Type">int</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="n">cell</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">points</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="n">make</span><span class="p">([]</span><span class="n">float32</span><span class="p">,</span><span class="w"> </span><span class="n">len</span><span class="p">(</span><span class="n">square</span><span class="p">),</span><span class="w"> </span><span class="n">len</span><span class="p">(</span><span class="n">square</span><span class="p">))</span>
<span class="w">    </span><span class="n">copy</span><span class="p">(</span><span class="n">points</span><span class="p">,</span><span class="w"> </span><span class="n">square</span><span class="p">)</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">len</span><span class="p">(</span><span class="n">points</span><span class="p">);</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">var</span><span class="w"> </span><span class="n">position</span><span class="w"> </span><span class="n">float32</span>
<span class="w">        </span><span class="k">var</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="n">float32</span>
<span class="w">        </span><span class="n">switch</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">case</span><span class="w"> </span><span class="mi">0</span><span class="p">:</span>
<span class="w">                </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">float32</span><span class="p">(</span><span class="n">columns</span><span class="p">)</span>
<span class="w">                </span><span class="n">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">float32</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">size</span>
<span class="w">        </span><span class="n">case</span><span class="w"> </span><span class="mi">1</span><span class="p">:</span>
<span class="w">                </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">float32</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span>
<span class="w">                </span><span class="n">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">float32</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">size</span>
<span class="w">        </span><span class="n">default</span><span class="p">:</span>
<span class="w">                </span><span class="k">continue</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">points</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">points</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">position</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">points</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">((</span><span class="n">position</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">size</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="n">cell</span><span class="p">{</span>
<span class="w">        </span><span class="n">drawable</span><span class="p">:</span><span class="w"> </span><span class="n">makeVao</span><span class="p">(</span><span class="n">points</span><span class="p">),</span>

<span class="w">        </span><span class="n">x</span><span class="p">:</span><span class="w"> </span><span class="n">x</span><span class="p">,</span>
<span class="w">        </span><span class="n">y</span><span class="p">:</span><span class="w"> </span><span class="n">y</span><span class="p">,</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>这个函数里有很多内容，我们把它分成几个部分。我们做的第一件事是复制了 <code>square</code> 的定义。这让我们能够修改该定义，定制当前的细胞位置，而不会影响其它使用 <code>square</code> 切片定义的细胞。然后我们基于当前索引迭代 <code>points</code> 副本。我们用求余数的方法来判断我们是在操作 X 坐标（<code>i % 3 == 0</code>），还是在操作 Y 坐标（<code>i % 3 == 1</code>）（跳过 Z 坐标是因为我们仅在二维层面上进行操作），跟着确定细胞的大小（也就是占据整个游戏面板的比例），当然它的位置是基于细胞在 <code>相对游戏面板的</code> X 和 Y 坐标。</p>
<p>接着，我们改变那些包含在 <code>square</code> 切片中定义的 <code>0.5</code>，<code>0</code>， <code>-0.5</code> 这样的点。如果点小于 0，我们就把它设置成原来的 2 倍（因为 OpenGL 坐标的范围在 <code>-1</code> 到 <code>1</code> 之间，范围大小是 2），减 1 是为了归一化 OpenGL 坐标。如果点大于等于 0，我们的做法还是一样的，不过要加上我们计算出的尺寸。</p>
<p>这样做是为了设置每个细胞的大小，这样它就能只填充它在面板中的部分。因为我们有 10 行 10 列，每一个格子能分到游戏面板的 10% 宽度和高度。</p>
<p>最后，确定了所有点的位置和大小，我们用提供的 X 和 Y 坐标创建一个 <code>cell</code>，并设置 <code>drawable</code> 字段与我们刚刚操作 <code>points</code> 得到的顶点数组对象（vao）一致。</p>
<p>好了，现在我们在 <code>main</code> 函数里可以移去对 <code>makeVao</code> 的调用了，用 <code>makeCells</code> 代替。我们还修改了 <code>draw</code>，让它绘制一系列的细胞而不是一个 <code>vao</code>。</p>
<div class="highlight"><pre><span></span><code><span class="k">func</span><span class="w"> </span><span class="n">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="o">...</span>

<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">vao</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="n">makeVao</span><span class="p">(</span><span class="n">square</span><span class="p">)</span>
<span class="w">    </span><span class="n">cells</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="n">makeCells</span><span class="p">()</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="o">!</span><span class="n">window</span><span class="o">.</span><span class="n">ShouldClose</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">draw</span><span class="p">(</span><span class="n">cells</span><span class="p">,</span><span class="w"> </span><span class="n">window</span><span class="p">,</span><span class="w"> </span><span class="n">program</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="k">func</span><span class="w"> </span><span class="n">draw</span><span class="p">(</span><span class="n">cells</span><span class="w"> </span><span class="p">[][]</span><span class="o">*</span><span class="n">cell</span><span class="p">,</span><span class="w"> </span><span class="n">window</span><span class="w"> </span><span class="o">*</span><span class="n">glfw</span><span class="o">.</span><span class="n">Window</span><span class="p">,</span><span class="w"> </span><span class="n">program</span><span class="w"> </span><span class="n">uint32</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">gl</span><span class="o">.</span><span class="n">Clear</span><span class="p">(</span><span class="n">gl</span><span class="o">.</span><span class="n">COLOR_BUFFER_BIT</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">gl</span><span class="o">.</span><span class="n">DEPTH_BUFFER_BIT</span><span class="p">)</span>
<span class="w">    </span><span class="n">gl</span><span class="o">.</span><span class="n">UseProgram</span><span class="p">(</span><span class="n">program</span><span class="p">)</span>

<span class="w">    </span><span class="o">//</span><span class="w"> </span><span class="n">TODO</span>

<span class="w">    </span><span class="n">glfw</span><span class="o">.</span><span class="n">PollEvents</span><span class="p">()</span>
<span class="w">    </span><span class="n">window</span><span class="o">.</span><span class="n">SwapBuffers</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div>

<p>现在我们要让每个细胞知道怎么绘制出自己。在 <code>cell</code> 里面添加一个 <code>draw</code> 函数：</p>
<div class="highlight"><pre><span></span><code><span class="k">func</span><span class="w"> </span><span class="p">(</span><span class="n">c</span><span class="w"> </span><span class="o">*</span><span class="n">cell</span><span class="p">)</span><span class="w"> </span><span class="n">draw</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">gl</span><span class="o">.</span><span class="n">BindVertexArray</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">drawable</span><span class="p">)</span>
<span class="w">    </span><span class="n">gl</span><span class="o">.</span><span class="n">DrawArrays</span><span class="p">(</span><span class="n">gl</span><span class="o">.</span><span class="n">TRIANGLES</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">int32</span><span class="p">(</span><span class="n">len</span><span class="p">(</span><span class="n">square</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">3</span><span class="p">))</span>
<span class="p">}</span>
</code></pre></div>

<p>这看上去很熟悉，它很像我们之前在 <code>vao</code> 里写的 <code>draw</code>，唯一的区别是我们的 <code>BindVertexArray</code> 函数用的是 <code>c.drawable</code>，这是我们在 <code>newCell</code> 中创造的细胞的 <code>vao</code>。</p>
<p>回到 main 中的 <code>draw</code> 函数上，我们可以循环每个细胞，让它们自己绘制自己：</p>
<div class="highlight"><pre><span></span><code><span class="n">func</span><span class="w"> </span><span class="n">draw</span><span class="p">(</span><span class="n">cells</span><span class="w"> </span><span class="err">[][]</span><span class="o">*</span><span class="n">cell</span><span class="p">,</span><span class="w"> </span><span class="k">window</span><span class="w"> </span><span class="o">*</span><span class="n">glfw</span><span class="p">.</span><span class="k">Window</span><span class="p">,</span><span class="w"> </span><span class="n">program</span><span class="w"> </span><span class="n">uint32</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">    </span><span class="n">gl</span><span class="p">.</span><span class="n">Clear</span><span class="p">(</span><span class="n">gl</span><span class="p">.</span><span class="n">COLOR_BUFFER_BIT</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">gl</span><span class="p">.</span><span class="n">DEPTH_BUFFER_BIT</span><span class="p">)</span>
<span class="w">    </span><span class="n">gl</span><span class="p">.</span><span class="n">UseProgram</span><span class="p">(</span><span class="n">program</span><span class="p">)</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="err">:</span><span class="o">=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="n">cells</span><span class="w"> </span><span class="err">{</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">_</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="err">:</span><span class="o">=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="n">cells</span><span class="o">[</span><span class="n">x</span><span class="o">]</span><span class="w"> </span><span class="err">{</span>
<span class="w">            </span><span class="n">c</span><span class="p">.</span><span class="n">draw</span><span class="p">()</span>
<span class="w">        </span><span class="err">}</span>
<span class="w">    </span><span class="err">}</span>

<span class="w">    </span><span class="n">glfw</span><span class="p">.</span><span class="n">PollEvents</span><span class="p">()</span>
<span class="w">    </span><span class="k">window</span><span class="p">.</span><span class="n">SwapBuffers</span><span class="p">()</span>
<span class="err">}</span>
</code></pre></div>

<p>如你所见，我们循环每一个细胞，调用它的 <code>draw</code> 函数。如果运行这段代码，你能看到像下面这样的东西：</p>
<p><img alt="Conway's Game of Life - 全部格子" src="/data/attachment/album/201710/07/223512fukkduvyxvxvj5d5.png"></p>
<p>这是你想看到的吗？我们做的是在格子里为每一行每一列创建了一个方块，然后给它上色，这就填满了整个面板！</p>
<p>注释掉 for 循环，我们就可以看到一个明显独立的细胞，像这样：</p>
<div class="highlight"><pre><span></span><code><span class="o">//</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="err">:</span><span class="o">=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="n">cells</span><span class="w"> </span><span class="err">{</span>
<span class="o">//</span><span class="w">     </span><span class="k">for</span><span class="w"> </span><span class="n">_</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="err">:</span><span class="o">=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="n">cells</span><span class="o">[</span><span class="n">x</span><span class="o">]</span><span class="w"> </span><span class="err">{</span>
<span class="o">//</span><span class="w">         </span><span class="n">c</span><span class="p">.</span><span class="n">draw</span><span class="p">()</span>
<span class="o">//</span><span class="w">     </span><span class="err">}</span>
<span class="o">//</span><span class="w"> </span><span class="err">}</span>

<span class="n">cells</span><span class="o">[</span><span class="n">2</span><span class="o">][</span><span class="n">3</span><span class="o">]</span><span class="p">.</span><span class="n">draw</span><span class="p">()</span>
</code></pre></div>

<p><img alt="Conway's Game of Life - 一个单独的细胞" src="/data/attachment/album/201710/07/223512yk5w3el05emzahzi.png"></p>
<p>这只绘制坐标在 <code>(X=2, Y=3)</code> 的格子。你可以看到，每一个独立的细胞占据着面板的一小块部分，并且负责绘制自己那部分空间。我们也能看到游戏面板有自己的原点，也就是坐标为 <code>(X=0, Y=0)</code> 的点，在窗口的左下方。这仅仅是我们的 <code>newCell</code> 函数计算位置的方式，也可以用右上角，右下角，左上角，中央，或者其它任何位置当作原点。</p>
<p>接着往下做，移除 <code>cells[2][3].draw()</code> 这一行，取消 for 循环的那部分注释，变成之前那样全部绘制的样子。</p>
<h3>总结</h3>
<p>好了，我们现在能用两个三角形画出一个正方形了，我们还有一个游戏的面板了！我们该为此自豪，目前为止我们已经接触到了很多零碎的内容，老实说，最难的部分还在前面等着我们！</p>
<p>在接下来的第三节，我们会实现游戏核心逻辑，看到很酷的东西！</p>
<h3>回顾</h3>
<p>这是这一部分教程中 <code>main.go</code> 文件的内容：</p>
<div class="highlight"><pre><span></span><code><span class="n">package</span> <span class="n">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s2">&quot;fmt&quot;</span>
    <span class="s2">&quot;log&quot;</span>
    <span class="s2">&quot;runtime&quot;</span>
    <span class="s2">&quot;strings&quot;</span>

    <span class="s2">&quot;github.com/go-gl/gl/v4.1-core/gl&quot;</span> <span class="o">//</span> <span class="n">OR</span><span class="p">:</span> <span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">go</span><span class="o">-</span><span class="n">gl</span><span class="o">/</span><span class="n">gl</span><span class="o">/</span><span class="n">v2</span><span class="mf">.1</span><span class="o">/</span><span class="n">gl</span>
    <span class="s2">&quot;github.com/go-gl/glfw/v3.2/glfw&quot;</span>
<span class="p">)</span>

<span class="n">const</span> <span class="p">(</span>
    <span class="n">width</span>  <span class="o">=</span> <span class="mi">500</span>
    <span class="n">height</span> <span class="o">=</span> <span class="mi">500</span>

    <span class="n">vertexShaderSource</span> <span class="o">=</span> <span class="err">`</span>
        <span class="c1">#version 410</span>
        <span class="ow">in</span> <span class="n">vec3</span> <span class="n">vp</span><span class="p">;</span>
        <span class="n">void</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
            <span class="n">gl_Position</span> <span class="o">=</span> <span class="n">vec4</span><span class="p">(</span><span class="n">vp</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="err">`</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\x00</span><span class="s2">&quot;</span>

    <span class="n">fragmentShaderSource</span> <span class="o">=</span> <span class="err">`</span>
        <span class="c1">#version 410</span>
        <span class="n">out</span> <span class="n">vec4</span> <span class="n">frag_colour</span><span class="p">;</span>
        <span class="n">void</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
            <span class="n">frag_colour</span> <span class="o">=</span> <span class="n">vec4</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="err">`</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\x00</span><span class="s2">&quot;</span>

    <span class="n">rows</span>    <span class="o">=</span> <span class="mi">10</span>
    <span class="n">columns</span> <span class="o">=</span> <span class="mi">10</span>
<span class="p">)</span>

<span class="n">var</span> <span class="p">(</span>
    <span class="n">square</span> <span class="o">=</span> <span class="p">[]</span><span class="n">float32</span><span class="p">{</span>
        <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
        <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
        <span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>

        <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
        <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
        <span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">)</span>

<span class="nb">type</span> <span class="n">cell</span> <span class="n">struct</span> <span class="p">{</span>
    <span class="n">drawable</span> <span class="n">uint32</span>

    <span class="n">x</span> <span class="nb">int</span>
    <span class="n">y</span> <span class="nb">int</span>
<span class="p">}</span>

<span class="n">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">runtime</span><span class="o">.</span><span class="n">LockOSThread</span><span class="p">()</span>

    <span class="n">window</span> <span class="o">:=</span> <span class="n">initGlfw</span><span class="p">()</span>
    <span class="n">defer</span> <span class="n">glfw</span><span class="o">.</span><span class="n">Terminate</span><span class="p">()</span>
    <span class="n">program</span> <span class="o">:=</span> <span class="n">initOpenGL</span><span class="p">()</span>

    <span class="n">cells</span> <span class="o">:=</span> <span class="n">makeCells</span><span class="p">()</span>
    <span class="k">for</span> <span class="err">!</span><span class="n">window</span><span class="o">.</span><span class="n">ShouldClose</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">draw</span><span class="p">(</span><span class="n">cells</span><span class="p">,</span> <span class="n">window</span><span class="p">,</span> <span class="n">program</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="n">func</span> <span class="n">draw</span><span class="p">(</span><span class="n">cells</span> <span class="p">[][]</span><span class="o">*</span><span class="n">cell</span><span class="p">,</span> <span class="n">window</span> <span class="o">*</span><span class="n">glfw</span><span class="o">.</span><span class="n">Window</span><span class="p">,</span> <span class="n">program</span> <span class="n">uint32</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">gl</span><span class="o">.</span><span class="n">Clear</span><span class="p">(</span><span class="n">gl</span><span class="o">.</span><span class="n">COLOR_BUFFER_BIT</span> <span class="o">|</span> <span class="n">gl</span><span class="o">.</span><span class="n">DEPTH_BUFFER_BIT</span><span class="p">)</span>
    <span class="n">gl</span><span class="o">.</span><span class="n">UseProgram</span><span class="p">(</span><span class="n">program</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">x</span> <span class="o">:=</span> <span class="nb">range</span> <span class="n">cells</span> <span class="p">{</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">c</span> <span class="o">:=</span> <span class="nb">range</span> <span class="n">cells</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="p">{</span>
            <span class="n">c</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="n">glfw</span><span class="o">.</span><span class="n">PollEvents</span><span class="p">()</span>
    <span class="n">window</span><span class="o">.</span><span class="n">SwapBuffers</span><span class="p">()</span>
<span class="p">}</span>

<span class="n">func</span> <span class="n">makeCells</span><span class="p">()</span> <span class="p">[][]</span><span class="o">*</span><span class="n">cell</span> <span class="p">{</span>
    <span class="n">cells</span> <span class="o">:=</span> <span class="n">make</span><span class="p">([][]</span><span class="o">*</span><span class="n">cell</span><span class="p">,</span> <span class="n">rows</span><span class="p">,</span> <span class="n">rows</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">x</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">rows</span><span class="p">;</span> <span class="n">x</span><span class="o">++</span> <span class="p">{</span>
        <span class="k">for</span> <span class="n">y</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">y</span> <span class="o">&lt;</span> <span class="n">columns</span><span class="p">;</span> <span class="n">y</span><span class="o">++</span> <span class="p">{</span>
            <span class="n">c</span> <span class="o">:=</span> <span class="n">newCell</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
            <span class="n">cells</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">append</span><span class="p">(</span><span class="n">cells</span><span class="p">[</span><span class="n">x</span><span class="p">],</span> <span class="n">c</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">cells</span>
<span class="p">}</span>

<span class="n">func</span> <span class="n">newCell</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="nb">int</span><span class="p">)</span> <span class="o">*</span><span class="n">cell</span> <span class="p">{</span>
    <span class="n">points</span> <span class="o">:=</span> <span class="n">make</span><span class="p">([]</span><span class="n">float32</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">square</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">square</span><span class="p">))</span>
    <span class="n">copy</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">square</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">);</span> <span class="n">i</span><span class="o">++</span> <span class="p">{</span>
        <span class="n">var</span> <span class="n">position</span> <span class="n">float32</span>
        <span class="n">var</span> <span class="n">size</span> <span class="n">float32</span>
        <span class="n">switch</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">3</span> <span class="p">{</span>
        <span class="k">case</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">size</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">float32</span><span class="p">(</span><span class="n">columns</span><span class="p">)</span>
            <span class="n">position</span> <span class="o">=</span> <span class="n">float32</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="n">size</span>
        <span class="k">case</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">size</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">float32</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span>
            <span class="n">position</span> <span class="o">=</span> <span class="n">float32</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">*</span> <span class="n">size</span>
        <span class="n">default</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="n">points</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="p">{</span>
            <span class="n">points</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">position</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="n">points</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">position</span> <span class="o">+</span> <span class="n">size</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="o">&amp;</span><span class="n">cell</span><span class="p">{</span>
        <span class="n">drawable</span><span class="p">:</span> <span class="n">makeVao</span><span class="p">(</span><span class="n">points</span><span class="p">),</span>

        <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">,</span>
        <span class="n">y</span><span class="p">:</span> <span class="n">y</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="n">func</span> <span class="p">(</span><span class="n">c</span> <span class="o">*</span><span class="n">cell</span><span class="p">)</span> <span class="n">draw</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">gl</span><span class="o">.</span><span class="n">BindVertexArray</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">drawable</span><span class="p">)</span>
    <span class="n">gl</span><span class="o">.</span><span class="n">DrawArrays</span><span class="p">(</span><span class="n">gl</span><span class="o">.</span><span class="n">TRIANGLES</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">int32</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">square</span><span class="p">)</span><span class="o">/</span><span class="mi">3</span><span class="p">))</span>
<span class="p">}</span>

<span class="o">//</span> <span class="n">初始化</span> <span class="n">glfw</span><span class="err">，</span><span class="n">返回一个可用的</span> <span class="n">Window</span>
<span class="n">func</span> <span class="n">initGlfw</span><span class="p">()</span> <span class="o">*</span><span class="n">glfw</span><span class="o">.</span><span class="n">Window</span> <span class="p">{</span>
    <span class="k">if</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">glfw</span><span class="o">.</span><span class="n">Init</span><span class="p">();</span> <span class="n">err</span> <span class="o">!=</span> <span class="n">nil</span> <span class="p">{</span>
        <span class="n">panic</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="n">glfw</span><span class="o">.</span><span class="n">WindowHint</span><span class="p">(</span><span class="n">glfw</span><span class="o">.</span><span class="n">Resizable</span><span class="p">,</span> <span class="n">glfw</span><span class="o">.</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">glfw</span><span class="o">.</span><span class="n">WindowHint</span><span class="p">(</span><span class="n">glfw</span><span class="o">.</span><span class="n">ContextVersionMajor</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
    <span class="n">glfw</span><span class="o">.</span><span class="n">WindowHint</span><span class="p">(</span><span class="n">glfw</span><span class="o">.</span><span class="n">ContextVersionMinor</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">glfw</span><span class="o">.</span><span class="n">WindowHint</span><span class="p">(</span><span class="n">glfw</span><span class="o">.</span><span class="n">OpenGLProfile</span><span class="p">,</span> <span class="n">glfw</span><span class="o">.</span><span class="n">OpenGLCoreProfile</span><span class="p">)</span>
    <span class="n">glfw</span><span class="o">.</span><span class="n">WindowHint</span><span class="p">(</span><span class="n">glfw</span><span class="o">.</span><span class="n">OpenGLForwardCompatible</span><span class="p">,</span> <span class="n">glfw</span><span class="o">.</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">window</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">glfw</span><span class="o">.</span><span class="n">CreateWindow</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="s2">&quot;Conway&#39;s Game of Life&quot;</span><span class="p">,</span> <span class="n">nil</span><span class="p">,</span> <span class="n">nil</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="n">nil</span> <span class="p">{</span>
        <span class="n">panic</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="n">window</span><span class="o">.</span><span class="n">MakeContextCurrent</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">window</span>
<span class="p">}</span>

<span class="o">//</span> <span class="n">初始化</span> <span class="n">OpenGL</span> <span class="n">并返回一个可用的着色器程序</span>
<span class="n">func</span> <span class="n">initOpenGL</span><span class="p">()</span> <span class="n">uint32</span> <span class="p">{</span>
    <span class="k">if</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">gl</span><span class="o">.</span><span class="n">Init</span><span class="p">();</span> <span class="n">err</span> <span class="o">!=</span> <span class="n">nil</span> <span class="p">{</span>
        <span class="n">panic</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="n">version</span> <span class="o">:=</span> <span class="n">gl</span><span class="o">.</span><span class="n">GoStr</span><span class="p">(</span><span class="n">gl</span><span class="o">.</span><span class="n">GetString</span><span class="p">(</span><span class="n">gl</span><span class="o">.</span><span class="n">VERSION</span><span class="p">))</span>
    <span class="n">log</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s2">&quot;OpenGL version&quot;</span><span class="p">,</span> <span class="n">version</span><span class="p">)</span>

    <span class="n">vertexShader</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">compileShader</span><span class="p">(</span><span class="n">vertexShaderSource</span><span class="p">,</span> <span class="n">gl</span><span class="o">.</span><span class="n">VERTEX_SHADER</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="n">nil</span> <span class="p">{</span>
        <span class="n">panic</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="n">fragmentShader</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">compileShader</span><span class="p">(</span><span class="n">fragmentShaderSource</span><span class="p">,</span> <span class="n">gl</span><span class="o">.</span><span class="n">FRAGMENT_SHADER</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="n">nil</span> <span class="p">{</span>
        <span class="n">panic</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="n">prog</span> <span class="o">:=</span> <span class="n">gl</span><span class="o">.</span><span class="n">CreateProgram</span><span class="p">()</span>
    <span class="n">gl</span><span class="o">.</span><span class="n">AttachShader</span><span class="p">(</span><span class="n">prog</span><span class="p">,</span> <span class="n">vertexShader</span><span class="p">)</span>
    <span class="n">gl</span><span class="o">.</span><span class="n">AttachShader</span><span class="p">(</span><span class="n">prog</span><span class="p">,</span> <span class="n">fragmentShader</span><span class="p">)</span>
    <span class="n">gl</span><span class="o">.</span><span class="n">LinkProgram</span><span class="p">(</span><span class="n">prog</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">prog</span>
<span class="p">}</span>

<span class="o">//</span> <span class="n">初始化并返回由</span> <span class="n">points</span> <span class="n">提供的顶点数组</span>
<span class="n">func</span> <span class="n">makeVao</span><span class="p">(</span><span class="n">points</span> <span class="p">[]</span><span class="n">float32</span><span class="p">)</span> <span class="n">uint32</span> <span class="p">{</span>
    <span class="n">var</span> <span class="n">vbo</span> <span class="n">uint32</span>
    <span class="n">gl</span><span class="o">.</span><span class="n">GenBuffers</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">vbo</span><span class="p">)</span>
    <span class="n">gl</span><span class="o">.</span><span class="n">BindBuffer</span><span class="p">(</span><span class="n">gl</span><span class="o">.</span><span class="n">ARRAY_BUFFER</span><span class="p">,</span> <span class="n">vbo</span><span class="p">)</span>
    <span class="n">gl</span><span class="o">.</span><span class="n">BufferData</span><span class="p">(</span><span class="n">gl</span><span class="o">.</span><span class="n">ARRAY_BUFFER</span><span class="p">,</span> <span class="mi">4</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">),</span> <span class="n">gl</span><span class="o">.</span><span class="n">Ptr</span><span class="p">(</span><span class="n">points</span><span class="p">),</span> <span class="n">gl</span><span class="o">.</span><span class="n">STATIC_DRAW</span><span class="p">)</span>

    <span class="n">var</span> <span class="n">vao</span> <span class="n">uint32</span>
    <span class="n">gl</span><span class="o">.</span><span class="n">GenVertexArrays</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">vao</span><span class="p">)</span>
    <span class="n">gl</span><span class="o">.</span><span class="n">BindVertexArray</span><span class="p">(</span><span class="n">vao</span><span class="p">)</span>
    <span class="n">gl</span><span class="o">.</span><span class="n">EnableVertexAttribArray</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">gl</span><span class="o">.</span><span class="n">BindBuffer</span><span class="p">(</span><span class="n">gl</span><span class="o">.</span><span class="n">ARRAY_BUFFER</span><span class="p">,</span> <span class="n">vbo</span><span class="p">)</span>
    <span class="n">gl</span><span class="o">.</span><span class="n">VertexAttribPointer</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">gl</span><span class="o">.</span><span class="n">FLOAT</span><span class="p">,</span> <span class="n">false</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">nil</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">vao</span>
<span class="p">}</span>

<span class="n">func</span> <span class="n">compileShader</span><span class="p">(</span><span class="n">source</span> <span class="n">string</span><span class="p">,</span> <span class="n">shaderType</span> <span class="n">uint32</span><span class="p">)</span> <span class="p">(</span><span class="n">uint32</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">shader</span> <span class="o">:=</span> <span class="n">gl</span><span class="o">.</span><span class="n">CreateShader</span><span class="p">(</span><span class="n">shaderType</span><span class="p">)</span>

    <span class="n">csources</span><span class="p">,</span> <span class="n">free</span> <span class="o">:=</span> <span class="n">gl</span><span class="o">.</span><span class="n">Strs</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
    <span class="n">gl</span><span class="o">.</span><span class="n">ShaderSource</span><span class="p">(</span><span class="n">shader</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">csources</span><span class="p">,</span> <span class="n">nil</span><span class="p">)</span>
    <span class="n">free</span><span class="p">()</span>
    <span class="n">gl</span><span class="o">.</span><span class="n">CompileShader</span><span class="p">(</span><span class="n">shader</span><span class="p">)</span>

    <span class="n">var</span> <span class="n">status</span> <span class="n">int32</span>
    <span class="n">gl</span><span class="o">.</span><span class="n">GetShaderiv</span><span class="p">(</span><span class="n">shader</span><span class="p">,</span> <span class="n">gl</span><span class="o">.</span><span class="n">COMPILE_STATUS</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">status</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="n">gl</span><span class="o">.</span><span class="n">FALSE</span> <span class="p">{</span>
        <span class="n">var</span> <span class="n">logLength</span> <span class="n">int32</span>
        <span class="n">gl</span><span class="o">.</span><span class="n">GetShaderiv</span><span class="p">(</span><span class="n">shader</span><span class="p">,</span> <span class="n">gl</span><span class="o">.</span><span class="n">INFO_LOG_LENGTH</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">logLength</span><span class="p">)</span>

        <span class="n">log</span> <span class="o">:=</span> <span class="n">strings</span><span class="o">.</span><span class="n">Repeat</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\x00</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">logLength</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">gl</span><span class="o">.</span><span class="n">GetShaderInfoLog</span><span class="p">(</span><span class="n">shader</span><span class="p">,</span> <span class="n">logLength</span><span class="p">,</span> <span class="n">nil</span><span class="p">,</span> <span class="n">gl</span><span class="o">.</span><span class="n">Str</span><span class="p">(</span><span class="n">log</span><span class="p">))</span>

        <span class="k">return</span> <span class="mi">0</span><span class="p">,</span> <span class="n">fmt</span><span class="o">.</span><span class="n">Errorf</span><span class="p">(</span><span class="s2">&quot;failed to compile %v: %v&quot;</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">log</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">shader</span><span class="p">,</span> <span class="n">nil</span>
<span class="p">}</span>
</code></pre></div>

<p>让我知道这篇文章对你有没有帮助，在 Twitter <a href="https://twitter.com/kylewbanks">@kylewbanks</a> 或者下方的连接，关注我以便获取最新的文章！</p>
    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>links</h2>
                        <ul>
                            <li><a href="https://getpelican.com/">Pelican</a></li>
                            <li><a href="https://www.python.org/">Python.org</a></li>
                            <li><a href="https://palletsprojects.com/p/jinja/">Jinja2</a></li>
                            <li><a href="#">You can modify those links in your config file</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>

                            <li><a href="#">You can add links in your config file</a></li>
                            <li><a href="#">Another social link</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a rel="nofollow" href="https://getpelican.com/">Pelican</a>, which takes great advantage of <a rel="nofollow" href="https://www.python.org/">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a rel="nofollow" href="https://www.smashingmagazine.com/2009/08/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>