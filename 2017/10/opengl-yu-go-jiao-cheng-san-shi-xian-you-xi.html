<!DOCTYPE html>
<html lang="zh">
<head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="generator" content="Pelican" />
        <title>OpenGL 与 Go 教程（三）实现游戏</title>
        <link rel="stylesheet" href="/theme/css/main.css" />
        <meta name="description" content="Author: Kylewbanks 第一节: Hello, OpenGL 第二节: 绘制游戏面板 第三节：实现游戏功能 该教程的完整源代码可以从 GitHub 上找到。 欢迎回到《OpenGL 与 Go 教程 …" />
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">linux_cn</a></h1>
                <nav><ul>
                    <li><a href="/category/chuan-shan-jia-zhuan-fang">穿山甲专访</a></li>
                    <li><a href="/category/dai-ma-ying-xiong">代码英雄</a></li>
                    <li><a href="/category/fen-xiang">分享</a></li>
                    <li><a href="/category/guan-dian">观点</a></li>
                    <li><a href="/category/huo-dong">活动</a></li>
                    <li><a href="/category/ji-ke-man-hua">极客漫画</a></li>
                    <li><a href="/category/ji-zhu">技术</a></li>
                    <li><a href="/category/kai-yuan-zhi-hui">开源智慧</a></li>
                    <li><a href="/category/linux-fa-xing-ban">Linux 发行版</a></li>
                    <li><a href="/category/mei-ri-an-quan-zi-xun">每日安全资讯</a></li>
                    <li><a href="/category/misc">Misc</a></li>
                    <li><a href="/category/qu-kuai-lian">区块链</a></li>
                    <li><a href="/category/rong-qi-yu-yun">容器与云</a></li>
                    <li class="active"><a href="/category/ruan-jian-kai-fa">软件开发</a></li>
                    <li><a href="/category/shu-mei-pai">树莓派</a></li>
                    <li><a href="/category/xi-tong-yun-wei">系统运维</a></li>
                    <li><a href="/category/xin-wen">新闻</a></li>
                    <li><a href="/category/ying-he-guan-cha">硬核观察</a></li>
                    <li><a href="/category/zhi-ye-sheng-ya">职业生涯</a></li>
                    <li><a href="/category/zhong-jiang-ming-dan">中奖名单</a></li>
                    <li><a href="/category/zhuo-mian-ying-yong">桌面应用</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="/2017/10/opengl-yu-go-jiao-cheng-san-shi-xian-you-xi.html" rel="bookmark"
           title="Permalink to OpenGL 与 Go 教程（三）实现游戏">OpenGL 与 Go 教程（三）实现游戏</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2017-10-18T09:43:00+02:00">
                Published: Wed 18 October 2017
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/linux-fans-from-china.html">linux fans from china</a>
        </address>
<p>In <a href="/category/ruan-jian-kai-fa">软件开发</a>.</p>

</footer><!-- /.post-info -->      <p>Author: Kylewbanks</p>
<p><img alt="" src="/data/attachment/album/201710/17/154427lifqhohyri5frun0.jpg"></p>
<ul>
<li><a href="/article-8933-1.html">第一节: Hello, OpenGL</a></li>
<li><a href="/article-8937-1.html">第二节: 绘制游戏面板</a></li>
<li><a href="/article-8969-1.html">第三节：实现游戏功能</a></li>
</ul>
<p>该教程的完整源代码可以从 <a href="https://github.com/KyleBanks/conways-gol">GitHub</a> 上找到。</p>
<p>欢迎回到《OpenGL 与 Go 教程》！如果你还没有看过 <a href="/article-8933-1.html">第一节</a> 和 <a href="https://kylewbanks.com/blog/%5BPart%202:%20Drawing%20the%20Game%20Board%5D(/blog/tutorial-opengl-with-golang-part-2-drawing-the-game-board)">第二节</a>，那就要回过头去看一看。</p>
<p>到目前为止，你应该懂得如何创建网格系统以及创建代表方格中每一个单元的格子阵列。现在可以开始把网格当作游戏面板实现<ruby> 康威生命游戏 <rt>  Conway's Game of Life </rt></ruby>。</p>
<p>开始吧！</p>
<h3>实现康威生命游戏</h3>
<p>康威生命游戏的其中一个要点是所有<ruby> 细胞 <rt>  cell </rt></ruby>必须同时基于当前细胞在面板中的状态确定下一个细胞的状态。也就是说如果细胞 <code>(X=3,Y=4)</code> 在计算过程中状态发生了改变，那么邻近的细胞 <code>(X=4,Y=4)</code> 必须基于 <code>(X=3,Y=4)</code> 的状态决定自己的状态变化，而不是基于自己现在的状态。简单的讲，这意味着我们必须遍历细胞，确定下一个细胞的状态，而在绘制之前不改变他们的当前状态，然后在下一次循环中我们将新状态应用到游戏里，依此循环往复。</p>
<p>为了完成这个功能，我们需要在 <code>cell</code> 结构体中添加两个布尔型变量：</p>
<div class="highlight"><pre><span></span><code><span class="k">type</span><span class="w"> </span><span class="nx">cell</span><span class="w"> </span><span class="nx">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">drawable</span><span class="w"> </span><span class="nx">uint32</span>

<span class="w">    </span><span class="nx">alive</span><span class="w">     </span><span class="kt">bool</span>
<span class="w">    </span><span class="nx">aliveNext</span><span class="w"> </span><span class="kt">bool</span>

<span class="w">    </span><span class="nx">x</span><span class="w"> </span><span class="nx">int</span>
<span class="w">    </span><span class="nx">y</span><span class="w"> </span><span class="nx">int</span>
<span class="p">}</span>
</code></pre></div>

<p>这里我们添加了 <code>alive</code> 和 <code>aliveNext</code>，前一个是细胞当前的专题，后一个是经过计算后下一回合的状态。</p>
<p>现在添加两个函数，我们会用它们来确定 cell 的状态：</p>
<div class="highlight"><pre><span></span><code><span class="o">//</span><span class="w"> </span><span class="n">checkState</span><span class="w"> </span><span class="err">函数决定下一次游戏循环时的</span><span class="w"> </span><span class="n">cell</span><span class="w"> </span><span class="err">状态</span>
<span class="k">func</span><span class="w"> </span><span class="p">(</span><span class="n">c</span><span class="w"> </span><span class="o">*</span><span class="n">cell</span><span class="p">)</span><span class="w"> </span><span class="n">checkState</span><span class="p">(</span><span class="n">cells</span><span class="w"> </span><span class="p">[][]</span><span class="o">*</span><span class="n">cell</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">c</span><span class="o">.</span><span class="n">alive</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c</span><span class="o">.</span><span class="n">aliveNext</span>
<span class="w">    </span><span class="n">c</span><span class="o">.</span><span class="n">aliveNext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c</span><span class="o">.</span><span class="n">alive</span>

<span class="w">    </span><span class="n">liveCount</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="n">c</span><span class="o">.</span><span class="n">liveNeighbors</span><span class="p">(</span><span class="n">cells</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">c</span><span class="o">.</span><span class="n">alive</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="mf">1.</span><span class="w"> </span><span class="err">当任何一个存活的</span><span class="w"> </span><span class="n">cell</span><span class="w"> </span><span class="err">的附近少于</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="err">个存活的</span><span class="w"> </span><span class="n">cell</span><span class="w"> </span><span class="err">时，该</span><span class="w"> </span><span class="n">cell</span><span class="w"> </span><span class="err">将会消亡，就像人口过少所导致的结果一样</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">liveCount</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">c</span><span class="o">.</span><span class="n">aliveNext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">false</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="mf">2.</span><span class="w"> </span><span class="err">当任何一个存活的</span><span class="w"> </span><span class="n">cell</span><span class="w"> </span><span class="err">的附近有</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="err">至</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="err">个存活的</span><span class="w"> </span><span class="n">cell</span><span class="w"> </span><span class="err">时，该</span><span class="w"> </span><span class="n">cell</span><span class="w"> </span><span class="err">在下一代中仍然存活。</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">liveCount</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">liveCount</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">c</span><span class="o">.</span><span class="n">aliveNext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">true</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="mf">3.</span><span class="w"> </span><span class="err">当任何一个存活的</span><span class="w"> </span><span class="n">cell</span><span class="w"> </span><span class="err">的附近多于</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="err">个存活的</span><span class="w"> </span><span class="n">cell</span><span class="w"> </span><span class="err">时，该</span><span class="w"> </span><span class="n">cell</span><span class="w"> </span><span class="err">将会消亡，就像人口过多所导致的结果一样</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">liveCount</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">c</span><span class="o">.</span><span class="n">aliveNext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">false</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="mf">4.</span><span class="w"> </span><span class="err">任何一个消亡的</span><span class="w"> </span><span class="n">cell</span><span class="w"> </span><span class="err">附近刚好有</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="err">个存活的</span><span class="w"> </span><span class="n">cell</span><span class="err">，该</span><span class="w"> </span><span class="n">cell</span><span class="w"> </span><span class="err">会变为存活的状态，就像重生一样。</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">liveCount</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">c</span><span class="o">.</span><span class="n">aliveNext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">true</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="o">//</span><span class="w"> </span><span class="n">liveNeighbors</span><span class="w"> </span><span class="err">函数返回当前</span><span class="w"> </span><span class="n">cell</span><span class="w"> </span><span class="err">附近存活的</span><span class="w"> </span><span class="n">cell</span><span class="w"> </span><span class="err">数</span>
<span class="k">func</span><span class="w"> </span><span class="p">(</span><span class="n">c</span><span class="w"> </span><span class="o">*</span><span class="n">cell</span><span class="p">)</span><span class="w"> </span><span class="n">liveNeighbors</span><span class="p">(</span><span class="n">cells</span><span class="w"> </span><span class="p">[][]</span><span class="o">*</span><span class="n">cell</span><span class="p">)</span><span class="w"> </span><span class="nb nb-Type">int</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">var</span><span class="w"> </span><span class="n">liveCount</span><span class="w"> </span><span class="nb nb-Type">int</span>
<span class="w">    </span><span class="n">add</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="k">func</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="nb nb-Type">int</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="n">If</span><span class="w"> </span><span class="n">we</span><span class="s1">&#39;re at an edge, check the other side of the board.</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">len</span><span class="p">(</span><span class="n">cells</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">len</span><span class="p">(</span><span class="n">cells</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">len</span><span class="p">(</span><span class="n">cells</span><span class="p">[</span><span class="n">x</span><span class="p">])</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">len</span><span class="p">(</span><span class="n">cells</span><span class="p">[</span><span class="n">x</span><span class="p">])</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">cells</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="n">y</span><span class="p">]</span><span class="o">.</span><span class="n">alive</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">liveCount</span><span class="o">++</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">add</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">x</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="o">.</span><span class="n">y</span><span class="p">)</span><span class="w">   </span><span class="o">//</span><span class="w"> </span><span class="n">To</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">left</span>
<span class="w">    </span><span class="n">add</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">x</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="o">.</span><span class="n">y</span><span class="p">)</span><span class="w">   </span><span class="o">//</span><span class="w"> </span><span class="n">To</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">right</span>
<span class="w">    </span><span class="n">add</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="o">.</span><span class="n">y</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w">   </span><span class="o">//</span><span class="w"> </span><span class="n">up</span>
<span class="w">    </span><span class="n">add</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="o">.</span><span class="n">y</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w">   </span><span class="o">//</span><span class="w"> </span><span class="n">down</span>
<span class="w">    </span><span class="n">add</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">x</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="o">.</span><span class="n">y</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">top</span><span class="o">-</span><span class="n">left</span>
<span class="w">    </span><span class="n">add</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">x</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="o">.</span><span class="n">y</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">top</span><span class="o">-</span><span class="n">right</span>
<span class="w">    </span><span class="n">add</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">x</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="o">.</span><span class="n">y</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">bottom</span><span class="o">-</span><span class="n">left</span>
<span class="w">    </span><span class="n">add</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">x</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="o">.</span><span class="n">y</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">bottom</span><span class="o">-</span><span class="n">right</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">liveCount</span>
<span class="p">}</span>
</code></pre></div>

<p>在 <code>checkState</code> 中我们设置当前状态（<code>alive</code>） 等于我们最近迭代结果（<code>aliveNext</code>）。接下来我们计数邻居数量，并根据游戏的规则来决定 <code>aliveNext</code> 状态。该规则是比较清晰的，而且我们在上面的代码当中也有说明，所以这里不再赘述。</p>
<p>更加值得注意的是 <code>liveNeighbors</code> 函数里，我们返回的是当前处于存活（<code>alive</code>）状态的细胞的邻居个数。我们定义了一个叫做 <code>add</code> 的内嵌函数，它会对 <code>X</code> 和 <code>Y</code> 坐标做一些重复性的验证。它所做的事情是检查我们传递的数字是否超出了范围——比如说，如果细胞 <code>(X=0,Y=5)</code> 想要验证它左边的细胞，它就得验证面板另一边的细胞 <code>(X=9,Y=5)</code>，Y 轴与之类似。</p>
<p>在 <code>add</code> 内嵌函数后面，我们给当前细胞附近的八个细胞分别调用 <code>add</code> 函数，示意如下：</p>
<div class="highlight"><pre><span></span><code>[
    [-, -, -],
    [N, N, N],
    [N, C, N],
    [N, N, N],
    [-, -, -]
]
</code></pre></div>

<p>在该示意中，每一个叫做 N 的细胞是 C 的邻居。</p>
<p>现在是我们的 <code>main</code> 函数，这里我们执行核心游戏循环，调用每个细胞的 <code>checkState</code> 函数进行绘制：</p>
<div class="highlight"><pre><span></span><code><span class="n">func</span><span class="w"> </span><span class="n">main</span><span class="p">()</span><span class="w"> </span><span class="err">{</span>
<span class="w">    </span><span class="p">...</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="err">!</span><span class="k">window</span><span class="p">.</span><span class="n">ShouldClose</span><span class="p">()</span><span class="w"> </span><span class="err">{</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="err">:</span><span class="o">=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="n">cells</span><span class="w"> </span><span class="err">{</span>
<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="n">_</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="err">:</span><span class="o">=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="n">cells</span><span class="o">[</span><span class="n">x</span><span class="o">]</span><span class="w"> </span><span class="err">{</span>
<span class="w">                </span><span class="n">c</span><span class="p">.</span><span class="n">checkState</span><span class="p">(</span><span class="n">cells</span><span class="p">)</span>
<span class="w">            </span><span class="err">}</span>
<span class="w">        </span><span class="err">}</span>

<span class="w">        </span><span class="n">draw</span><span class="p">(</span><span class="n">cells</span><span class="p">,</span><span class="w"> </span><span class="k">window</span><span class="p">,</span><span class="w"> </span><span class="n">program</span><span class="p">)</span>
<span class="w">    </span><span class="err">}</span>
<span class="err">}</span>
</code></pre></div>

<p>现在我们的游戏逻辑全都设置好了，我们需要修改细胞绘制函数来跳过绘制不存活的细胞：</p>
<div class="highlight"><pre><span></span><code><span class="k">func</span><span class="w"> </span><span class="p">(</span><span class="n">c</span><span class="w"> </span><span class="o">*</span><span class="n">cell</span><span class="p">)</span><span class="w"> </span><span class="n">draw</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">!</span><span class="n">c</span><span class="o">.</span><span class="n">alive</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">gl</span><span class="o">.</span><span class="n">BindVertexArray</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">drawable</span><span class="p">)</span>
<span class="w">    </span><span class="n">gl</span><span class="o">.</span><span class="n">DrawArrays</span><span class="p">(</span><span class="n">gl</span><span class="o">.</span><span class="n">TRIANGLES</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">int32</span><span class="p">(</span><span class="n">len</span><span class="p">(</span><span class="n">square</span><span class="p">)</span><span class="o">/</span><span class="mi">3</span><span class="p">))</span>
<span class="p">}</span>
</code></pre></div>

<p>如果我们现在运行这个游戏，你将看到一个纯黑的屏幕，而不是我们辛苦工作后应该看到生命模拟。为什么呢？其实这正是模拟在工作。因为我们没有活着的细胞，所以就一个都不会绘制出来。</p>
<p>现在完善这个函数。回到 <code>makeCells</code> 函数，我们用 <code>0.0</code> 到 <code>1.0</code> 之间的一个随机数来设置游戏的初始状态。我们会定义一个大小为 <code>0.15</code> 的常量阈值，也就是说每个细胞都有 15% 的几率处于存活状态。</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="p">(</span>
    <span class="s2">&quot;math/rand&quot;</span>
    <span class="s2">&quot;time&quot;</span>
    <span class="o">...</span>
<span class="p">)</span>

<span class="n">const</span> <span class="p">(</span>
    <span class="o">...</span>

    <span class="n">threshold</span> <span class="o">=</span> <span class="mf">0.15</span>
<span class="p">)</span>

<span class="n">func</span> <span class="n">makeCells</span><span class="p">()</span> <span class="p">[][]</span><span class="o">*</span><span class="n">cell</span> <span class="p">{</span>
    <span class="n">rand</span><span class="o">.</span><span class="n">Seed</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">Now</span><span class="p">()</span><span class="o">.</span><span class="n">UnixNano</span><span class="p">())</span>

    <span class="n">cells</span> <span class="o">:=</span> <span class="n">make</span><span class="p">([][]</span><span class="o">*</span><span class="n">cell</span><span class="p">,</span> <span class="n">rows</span><span class="p">,</span> <span class="n">rows</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">x</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">rows</span><span class="p">;</span> <span class="n">x</span><span class="o">++</span> <span class="p">{</span>
        <span class="k">for</span> <span class="n">y</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">y</span> <span class="o">&lt;</span> <span class="n">columns</span><span class="p">;</span> <span class="n">y</span><span class="o">++</span> <span class="p">{</span>
            <span class="n">c</span> <span class="o">:=</span> <span class="n">newCell</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

            <span class="n">c</span><span class="o">.</span><span class="n">alive</span> <span class="o">=</span> <span class="n">rand</span><span class="o">.</span><span class="n">Float64</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">threshold</span>
            <span class="n">c</span><span class="o">.</span><span class="n">aliveNext</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">alive</span>

            <span class="n">cells</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">append</span><span class="p">(</span><span class="n">cells</span><span class="p">[</span><span class="n">x</span><span class="p">],</span> <span class="n">c</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">cells</span>
<span class="p">}</span>
</code></pre></div>

<p>我们首先增加两个引入：随机（<code>math/rand</code>）和时间（<code>time</code>），并定义我们的常量阈值。然后在 <code>makeCells</code> 中我们使用当前时间作为随机种子，给每个游戏一个独特的起始状态。你也可也指定一个特定的种子值，来始终得到一个相同的游戏，这在你想重放某个有趣的模拟时很有用。</p>
<p>接下来在循环中，在用 <code>newCell</code> 函数创造一个新的细胞时，我们根据随机浮点数的大小设置它的存活状态，随机数在 <code>0.0</code> 到 <code>1.0</code> 之间，如果比阈值（<code>0.15</code>）小，就是存活状态。再次强调，这意味着每个细胞在开始时都有 15% 的几率是存活的。你可以修改数值大小，增加或者减少当前游戏中存活的细胞。我们还把 <code>aliveNext</code> 设成 <code>alive</code> 状态，否则在第一次迭代之后我们会发现一大片细胞消亡了，这是因为 <code>aliveNext</code> 将永远是 <code>false</code>。</p>
<p>现在继续运行它，你很有可能看到细胞们一闪而过，但你却无法理解这是为什么。原因可能在于你的电脑太快了，在你能够看清楚之前就运行了（甚至完成了）模拟过程。</p>
<p>让我们降低游戏速度，在主循环中引入一个帧率（FPS）限制：</p>
<div class="highlight"><pre><span></span><code><span class="k">const</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="o">...</span>

<span class="w">    </span><span class="n">fps</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span>
<span class="p">)</span>

<span class="k">func</span><span class="w"> </span><span class="n">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="o">...</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="o">!</span><span class="n">window</span><span class="o">.</span><span class="n">ShouldClose</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">t</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="n">time</span><span class="o">.</span><span class="n">Now</span><span class="p">()</span>

<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="nb">range</span><span class="w"> </span><span class="n">cells</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="n">_</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="nb">range</span><span class="w"> </span><span class="n">cells</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">c</span><span class="o">.</span><span class="n">checkState</span><span class="p">(</span><span class="n">cells</span><span class="p">)</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="n">draw</span><span class="p">(</span><span class="n">prog</span><span class="p">,</span><span class="w"> </span><span class="n">window</span><span class="p">,</span><span class="w"> </span><span class="n">cells</span><span class="p">);</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">panic</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="n">time</span><span class="o">.</span><span class="n">Sleep</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">Second</span><span class="o">/</span><span class="n">time</span><span class="o">.</span><span class="n">Duration</span><span class="p">(</span><span class="n">fps</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">time</span><span class="o">.</span><span class="n">Since</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>现在你能给看出一些图案了，尽管它变换的很慢。把 FPS 加到 10，把方格的尺寸加到 100x100，你就能看到更真实的模拟：</p>
<div class="highlight"><pre><span></span><code><span class="k">const</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="o">...</span>

<span class="w">    </span><span class="n">rows</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">100</span>
<span class="w">    </span><span class="n">columns</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">100</span>

<span class="w">    </span><span class="n">fps</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span>

<span class="w">    </span><span class="o">...</span>
<span class="p">)</span>
</code></pre></div>

<p><img alt=" “Conway's Game of Life” - 示例游戏" src="/data/attachment/album/201710/17/154537s5hgt5z95e5gc55w.gif"></p>
<p>试着修改常量，看看它们是怎么影响模拟过程的 —— 这是你用 Go 语言写的第一个 OpenGL 程序，很酷吧？</p>
<h3>进阶内容？</h3>
<p>这是《OpenGL 与 Go 教程》的最后一节，但是这不意味着到此而止。这里有些新的挑战，能够增进你对 OpenGL （以及 Go）的理解。</p>
<ol>
<li>给每个细胞一种不同的颜色。</li>
<li>让用户能够通过命令行参数指定格子尺寸、帧率、种子和阈值。在 GitHub 上的 <a href="https://github.com/KyleBanks/conways-gol">github.com/KyleBanks/conways-gol</a> 里你可以看到一个已经实现的程序。</li>
<li>把格子的形状变成其它更有意思的，比如六边形。</li>
<li>用颜色表示细胞的状态 —— 比如，在第一帧把存活状态的格子设成绿色，如果它们存活了超过三帧的时间，就变成黄色。</li>
<li>如果模拟过程结束了，就自动关闭窗口，也就是说所有细胞都消亡了，或者是最后两帧里没有格子的状态有改变。</li>
<li>将着色器源代码放到单独的文件中，而不是把它们用字符串的形式放在 Go 的源代码中。</li>
</ol>
<h3>总结</h3>
<p>希望这篇教程对想要入门 OpenGL （或者是 Go）的人有所帮助！这很有趣，因此我也希望理解学习它也很有趣。</p>
<p>正如我所说的，OpenGL 可能是非常恐怖的，但只要你开始着手了就不会太差。你只用制定一个个可达成的小目标，然后享受每一次成功，因为尽管 OpenGL 不会总像它看上去的那么难，但也肯定有些难懂的东西。我发现，当遇到一个难于理解用 go-gl 生成的代码的 OpenGL 问题时，你总是可以参考一下在网上更流行的当作教程的 C 语言代码，这很有用。通常 C 语言和 Go 语言的唯一区别是在 Go 中，gl 函数的前缀是 <code>gl.</code> 而不是 <code>gl</code>，常量的前缀是 <code>gl</code> 而不是 <code>GL_</code>。这可以极大地增加了你的绘制知识！</p>
<p>该教程的完整源代码可从 <a href="https://github.com/KyleBanks/conways-gol">GitHub</a> 上获得。</p>
<h3>回顾</h3>
<p>这是 main.go 文件最终的内容：</p>
<div class="highlight"><pre><span></span><code><span class="n">package</span> <span class="n">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s2">&quot;fmt&quot;</span>
    <span class="s2">&quot;log&quot;</span>
    <span class="s2">&quot;math/rand&quot;</span>
    <span class="s2">&quot;runtime&quot;</span>
    <span class="s2">&quot;strings&quot;</span>
    <span class="s2">&quot;time&quot;</span>

    <span class="s2">&quot;github.com/go-gl/gl/v4.1-core/gl&quot;</span> <span class="o">//</span> <span class="n">OR</span><span class="p">:</span> <span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">go</span><span class="o">-</span><span class="n">gl</span><span class="o">/</span><span class="n">gl</span><span class="o">/</span><span class="n">v2</span><span class="mf">.1</span><span class="o">/</span><span class="n">gl</span>
    <span class="s2">&quot;github.com/go-gl/glfw/v3.2/glfw&quot;</span>
<span class="p">)</span>

<span class="n">const</span> <span class="p">(</span>
    <span class="n">width</span>  <span class="o">=</span> <span class="mi">500</span>
    <span class="n">height</span> <span class="o">=</span> <span class="mi">500</span>

    <span class="n">vertexShaderSource</span> <span class="o">=</span> <span class="err">`</span>
        <span class="c1">#version 410</span>
        <span class="ow">in</span> <span class="n">vec3</span> <span class="n">vp</span><span class="p">;</span>
        <span class="n">void</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
            <span class="n">gl_Position</span> <span class="o">=</span> <span class="n">vec4</span><span class="p">(</span><span class="n">vp</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="err">`</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\x00</span><span class="s2">&quot;</span>

    <span class="n">fragmentShaderSource</span> <span class="o">=</span> <span class="err">`</span>
        <span class="c1">#version 410</span>
        <span class="n">out</span> <span class="n">vec4</span> <span class="n">frag_colour</span><span class="p">;</span>
        <span class="n">void</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
            <span class="n">frag_colour</span> <span class="o">=</span> <span class="n">vec4</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="err">`</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\x00</span><span class="s2">&quot;</span>

    <span class="n">rows</span>    <span class="o">=</span> <span class="mi">100</span>
    <span class="n">columns</span> <span class="o">=</span> <span class="mi">100</span>

    <span class="n">threshold</span> <span class="o">=</span> <span class="mf">0.15</span>
    <span class="n">fps</span>       <span class="o">=</span> <span class="mi">10</span>
<span class="p">)</span>

<span class="n">var</span> <span class="p">(</span>
    <span class="n">square</span> <span class="o">=</span> <span class="p">[]</span><span class="n">float32</span><span class="p">{</span>
        <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
        <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
        <span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>

        <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
        <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
        <span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">)</span>

<span class="nb">type</span> <span class="n">cell</span> <span class="n">struct</span> <span class="p">{</span>
    <span class="n">drawable</span> <span class="n">uint32</span>

    <span class="n">alive</span>     <span class="nb">bool</span>
    <span class="n">aliveNext</span> <span class="nb">bool</span>

    <span class="n">x</span> <span class="nb">int</span>
    <span class="n">y</span> <span class="nb">int</span>
<span class="p">}</span>

<span class="n">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">runtime</span><span class="o">.</span><span class="n">LockOSThread</span><span class="p">()</span>

    <span class="n">window</span> <span class="o">:=</span> <span class="n">initGlfw</span><span class="p">()</span>
    <span class="n">defer</span> <span class="n">glfw</span><span class="o">.</span><span class="n">Terminate</span><span class="p">()</span>
    <span class="n">program</span> <span class="o">:=</span> <span class="n">initOpenGL</span><span class="p">()</span>

    <span class="n">cells</span> <span class="o">:=</span> <span class="n">makeCells</span><span class="p">()</span>
    <span class="k">for</span> <span class="err">!</span><span class="n">window</span><span class="o">.</span><span class="n">ShouldClose</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">t</span> <span class="o">:=</span> <span class="n">time</span><span class="o">.</span><span class="n">Now</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">x</span> <span class="o">:=</span> <span class="nb">range</span> <span class="n">cells</span> <span class="p">{</span>
            <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">c</span> <span class="o">:=</span> <span class="nb">range</span> <span class="n">cells</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="p">{</span>
                <span class="n">c</span><span class="o">.</span><span class="n">checkState</span><span class="p">(</span><span class="n">cells</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="n">draw</span><span class="p">(</span><span class="n">cells</span><span class="p">,</span> <span class="n">window</span><span class="p">,</span> <span class="n">program</span><span class="p">)</span>

        <span class="n">time</span><span class="o">.</span><span class="n">Sleep</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">Second</span><span class="o">/</span><span class="n">time</span><span class="o">.</span><span class="n">Duration</span><span class="p">(</span><span class="n">fps</span><span class="p">)</span> <span class="o">-</span> <span class="n">time</span><span class="o">.</span><span class="n">Since</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="n">func</span> <span class="n">draw</span><span class="p">(</span><span class="n">cells</span> <span class="p">[][]</span><span class="o">*</span><span class="n">cell</span><span class="p">,</span> <span class="n">window</span> <span class="o">*</span><span class="n">glfw</span><span class="o">.</span><span class="n">Window</span><span class="p">,</span> <span class="n">program</span> <span class="n">uint32</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">gl</span><span class="o">.</span><span class="n">Clear</span><span class="p">(</span><span class="n">gl</span><span class="o">.</span><span class="n">COLOR_BUFFER_BIT</span> <span class="o">|</span> <span class="n">gl</span><span class="o">.</span><span class="n">DEPTH_BUFFER_BIT</span><span class="p">)</span>
    <span class="n">gl</span><span class="o">.</span><span class="n">UseProgram</span><span class="p">(</span><span class="n">program</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">x</span> <span class="o">:=</span> <span class="nb">range</span> <span class="n">cells</span> <span class="p">{</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">c</span> <span class="o">:=</span> <span class="nb">range</span> <span class="n">cells</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="p">{</span>
            <span class="n">c</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="n">glfw</span><span class="o">.</span><span class="n">PollEvents</span><span class="p">()</span>
    <span class="n">window</span><span class="o">.</span><span class="n">SwapBuffers</span><span class="p">()</span>
<span class="p">}</span>

<span class="n">func</span> <span class="n">makeCells</span><span class="p">()</span> <span class="p">[][]</span><span class="o">*</span><span class="n">cell</span> <span class="p">{</span>
    <span class="n">rand</span><span class="o">.</span><span class="n">Seed</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">Now</span><span class="p">()</span><span class="o">.</span><span class="n">UnixNano</span><span class="p">())</span>

    <span class="n">cells</span> <span class="o">:=</span> <span class="n">make</span><span class="p">([][]</span><span class="o">*</span><span class="n">cell</span><span class="p">,</span> <span class="n">rows</span><span class="p">,</span> <span class="n">rows</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">x</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">rows</span><span class="p">;</span> <span class="n">x</span><span class="o">++</span> <span class="p">{</span>
        <span class="k">for</span> <span class="n">y</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">y</span> <span class="o">&lt;</span> <span class="n">columns</span><span class="p">;</span> <span class="n">y</span><span class="o">++</span> <span class="p">{</span>
            <span class="n">c</span> <span class="o">:=</span> <span class="n">newCell</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

            <span class="n">c</span><span class="o">.</span><span class="n">alive</span> <span class="o">=</span> <span class="n">rand</span><span class="o">.</span><span class="n">Float64</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">threshold</span>
            <span class="n">c</span><span class="o">.</span><span class="n">aliveNext</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">alive</span>

            <span class="n">cells</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">append</span><span class="p">(</span><span class="n">cells</span><span class="p">[</span><span class="n">x</span><span class="p">],</span> <span class="n">c</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">cells</span>
<span class="p">}</span>
<span class="n">func</span> <span class="n">newCell</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="nb">int</span><span class="p">)</span> <span class="o">*</span><span class="n">cell</span> <span class="p">{</span>
    <span class="n">points</span> <span class="o">:=</span> <span class="n">make</span><span class="p">([]</span><span class="n">float32</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">square</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">square</span><span class="p">))</span>
    <span class="n">copy</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">square</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">);</span> <span class="n">i</span><span class="o">++</span> <span class="p">{</span>
        <span class="n">var</span> <span class="n">position</span> <span class="n">float32</span>
        <span class="n">var</span> <span class="n">size</span> <span class="n">float32</span>
        <span class="n">switch</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">3</span> <span class="p">{</span>
        <span class="k">case</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">size</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">float32</span><span class="p">(</span><span class="n">columns</span><span class="p">)</span>
            <span class="n">position</span> <span class="o">=</span> <span class="n">float32</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="n">size</span>
        <span class="k">case</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">size</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">float32</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span>
            <span class="n">position</span> <span class="o">=</span> <span class="n">float32</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">*</span> <span class="n">size</span>
        <span class="n">default</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="n">points</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="p">{</span>
            <span class="n">points</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">position</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="n">points</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">position</span> <span class="o">+</span> <span class="n">size</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="o">&amp;</span><span class="n">cell</span><span class="p">{</span>
        <span class="n">drawable</span><span class="p">:</span> <span class="n">makeVao</span><span class="p">(</span><span class="n">points</span><span class="p">),</span>

        <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">,</span>
        <span class="n">y</span><span class="p">:</span> <span class="n">y</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="n">func</span> <span class="p">(</span><span class="n">c</span> <span class="o">*</span><span class="n">cell</span><span class="p">)</span> <span class="n">draw</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="err">!</span><span class="n">c</span><span class="o">.</span><span class="n">alive</span> <span class="p">{</span>
        <span class="k">return</span>
    <span class="p">}</span>

    <span class="n">gl</span><span class="o">.</span><span class="n">BindVertexArray</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">drawable</span><span class="p">)</span>
    <span class="n">gl</span><span class="o">.</span><span class="n">DrawArrays</span><span class="p">(</span><span class="n">gl</span><span class="o">.</span><span class="n">TRIANGLES</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">int32</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">square</span><span class="p">)</span><span class="o">/</span><span class="mi">3</span><span class="p">))</span>
<span class="p">}</span>

<span class="o">//</span> <span class="n">checkState</span> <span class="n">函数决定下一次游戏循环时的</span> <span class="n">cell</span> <span class="n">状态</span>
<span class="n">func</span> <span class="p">(</span><span class="n">c</span> <span class="o">*</span><span class="n">cell</span><span class="p">)</span> <span class="n">checkState</span><span class="p">(</span><span class="n">cells</span> <span class="p">[][]</span><span class="o">*</span><span class="n">cell</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">c</span><span class="o">.</span><span class="n">alive</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">aliveNext</span>
    <span class="n">c</span><span class="o">.</span><span class="n">aliveNext</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">alive</span>

    <span class="n">liveCount</span> <span class="o">:=</span> <span class="n">c</span><span class="o">.</span><span class="n">liveNeighbors</span><span class="p">(</span><span class="n">cells</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">alive</span> <span class="p">{</span>
        <span class="o">//</span> <span class="mf">1.</span> <span class="n">当任何一个存活的</span> <span class="n">cell</span> <span class="n">的附近少于</span> <span class="mi">2</span> <span class="n">个存活的</span> <span class="n">cell</span> <span class="n">时</span><span class="err">，</span><span class="n">该</span> <span class="n">cell</span> <span class="n">将会消亡</span><span class="err">，</span><span class="n">就像人口过少所导致的结果一样</span>
        <span class="k">if</span> <span class="n">liveCount</span> <span class="o">&lt;</span> <span class="mi">2</span> <span class="p">{</span>
            <span class="n">c</span><span class="o">.</span><span class="n">aliveNext</span> <span class="o">=</span> <span class="n">false</span>
        <span class="p">}</span>

        <span class="o">//</span> <span class="mf">2.</span> <span class="n">当任何一个存活的</span> <span class="n">cell</span> <span class="n">的附近有</span> <span class="mi">2</span> <span class="n">至</span> <span class="mi">3</span> <span class="n">个存活的</span> <span class="n">cell</span> <span class="n">时</span><span class="err">，</span><span class="n">该</span> <span class="n">cell</span> <span class="n">在下一代中仍然存活</span><span class="err">。</span>
        <span class="k">if</span> <span class="n">liveCount</span> <span class="o">==</span> <span class="mi">2</span> <span class="o">||</span> <span class="n">liveCount</span> <span class="o">==</span> <span class="mi">3</span> <span class="p">{</span>
            <span class="n">c</span><span class="o">.</span><span class="n">aliveNext</span> <span class="o">=</span> <span class="n">true</span>
        <span class="p">}</span>

        <span class="o">//</span> <span class="mf">3.</span> <span class="n">当任何一个存活的</span> <span class="n">cell</span> <span class="n">的附近多于</span> <span class="mi">3</span> <span class="n">个存活的</span> <span class="n">cell</span> <span class="n">时</span><span class="err">，</span><span class="n">该</span> <span class="n">cell</span> <span class="n">将会消亡</span><span class="err">，</span><span class="n">就像人口过多所导致的结果一样</span>
        <span class="k">if</span> <span class="n">liveCount</span> <span class="o">&gt;</span> <span class="mi">3</span> <span class="p">{</span>
            <span class="n">c</span><span class="o">.</span><span class="n">aliveNext</span> <span class="o">=</span> <span class="n">false</span>
        <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="o">//</span> <span class="mf">4.</span> <span class="n">任何一个消亡的</span> <span class="n">cell</span> <span class="n">附近刚好有</span> <span class="mi">3</span> <span class="n">个存活的</span> <span class="n">cell</span><span class="err">，</span><span class="n">该</span> <span class="n">cell</span> <span class="n">会变为存活的状态</span><span class="err">，</span><span class="n">就像重生一样</span><span class="err">。</span>
        <span class="k">if</span> <span class="n">liveCount</span> <span class="o">==</span> <span class="mi">3</span> <span class="p">{</span>
            <span class="n">c</span><span class="o">.</span><span class="n">aliveNext</span> <span class="o">=</span> <span class="n">true</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="o">//</span> <span class="n">liveNeighbors</span> <span class="n">函数返回当前</span> <span class="n">cell</span> <span class="n">附近存活的</span> <span class="n">cell</span> <span class="n">数</span>
<span class="n">func</span> <span class="p">(</span><span class="n">c</span> <span class="o">*</span><span class="n">cell</span><span class="p">)</span> <span class="n">liveNeighbors</span><span class="p">(</span><span class="n">cells</span> <span class="p">[][]</span><span class="o">*</span><span class="n">cell</span><span class="p">)</span> <span class="nb">int</span> <span class="p">{</span>
    <span class="n">var</span> <span class="n">liveCount</span> <span class="nb">int</span>
    <span class="n">add</span> <span class="o">:=</span> <span class="n">func</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="nb">int</span><span class="p">)</span> <span class="p">{</span>
        <span class="o">//</span> <span class="n">If</span> <span class="n">we</span><span class="s1">&#39;re at an edge, check the other side of the board.</span>
        <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">cells</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="p">{</span>
            <span class="n">x</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cells</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="n">y</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">cells</span><span class="p">[</span><span class="n">x</span><span class="p">])</span> <span class="p">{</span>
            <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="n">y</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="p">{</span>
            <span class="n">y</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cells</span><span class="p">[</span><span class="n">x</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="n">cells</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="n">y</span><span class="p">]</span><span class="o">.</span><span class="n">alive</span> <span class="p">{</span>
            <span class="n">liveCount</span><span class="o">++</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="n">add</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">x</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>   <span class="o">//</span> <span class="n">To</span> <span class="n">the</span> <span class="n">left</span>
    <span class="n">add</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">x</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>   <span class="o">//</span> <span class="n">To</span> <span class="n">the</span> <span class="n">right</span>
    <span class="n">add</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">y</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>   <span class="o">//</span> <span class="n">up</span>
    <span class="n">add</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">y</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>   <span class="o">//</span> <span class="n">down</span>
    <span class="n">add</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">x</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">y</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="n">top</span><span class="o">-</span><span class="n">left</span>
    <span class="n">add</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">x</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">y</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="n">top</span><span class="o">-</span><span class="n">right</span>
    <span class="n">add</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">x</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">y</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="n">bottom</span><span class="o">-</span><span class="n">left</span>
    <span class="n">add</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">x</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">y</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="n">bottom</span><span class="o">-</span><span class="n">right</span>

    <span class="k">return</span> <span class="n">liveCount</span>
<span class="p">}</span>

<span class="o">//</span> <span class="n">initGlfw</span> <span class="n">初始化</span> <span class="n">glfw</span><span class="err">，</span><span class="n">返回一个可用的</span> <span class="n">Window</span>
<span class="n">func</span> <span class="n">initGlfw</span><span class="p">()</span> <span class="o">*</span><span class="n">glfw</span><span class="o">.</span><span class="n">Window</span> <span class="p">{</span>
    <span class="k">if</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">glfw</span><span class="o">.</span><span class="n">Init</span><span class="p">();</span> <span class="n">err</span> <span class="o">!=</span> <span class="n">nil</span> <span class="p">{</span>
        <span class="n">panic</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="n">glfw</span><span class="o">.</span><span class="n">WindowHint</span><span class="p">(</span><span class="n">glfw</span><span class="o">.</span><span class="n">Resizable</span><span class="p">,</span> <span class="n">glfw</span><span class="o">.</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">glfw</span><span class="o">.</span><span class="n">WindowHint</span><span class="p">(</span><span class="n">glfw</span><span class="o">.</span><span class="n">ContextVersionMajor</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
    <span class="n">glfw</span><span class="o">.</span><span class="n">WindowHint</span><span class="p">(</span><span class="n">glfw</span><span class="o">.</span><span class="n">ContextVersionMinor</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">glfw</span><span class="o">.</span><span class="n">WindowHint</span><span class="p">(</span><span class="n">glfw</span><span class="o">.</span><span class="n">OpenGLProfile</span><span class="p">,</span> <span class="n">glfw</span><span class="o">.</span><span class="n">OpenGLCoreProfile</span><span class="p">)</span>
    <span class="n">glfw</span><span class="o">.</span><span class="n">WindowHint</span><span class="p">(</span><span class="n">glfw</span><span class="o">.</span><span class="n">OpenGLForwardCompatible</span><span class="p">,</span> <span class="n">glfw</span><span class="o">.</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">window</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">glfw</span><span class="o">.</span><span class="n">CreateWindow</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="s2">&quot;Conway&#39;s Game of Life&quot;</span><span class="p">,</span> <span class="n">nil</span><span class="p">,</span> <span class="n">nil</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="n">nil</span> <span class="p">{</span>
        <span class="n">panic</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="n">window</span><span class="o">.</span><span class="n">MakeContextCurrent</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">window</span>
<span class="p">}</span>

<span class="o">//</span> <span class="n">initOpenGL</span> <span class="n">初始化</span> <span class="n">OpenGL</span> <span class="n">并返回一个已经编译好的着色器程序</span>
<span class="n">func</span> <span class="n">initOpenGL</span><span class="p">()</span> <span class="n">uint32</span> <span class="p">{</span>
    <span class="k">if</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">gl</span><span class="o">.</span><span class="n">Init</span><span class="p">();</span> <span class="n">err</span> <span class="o">!=</span> <span class="n">nil</span> <span class="p">{</span>
        <span class="n">panic</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="n">version</span> <span class="o">:=</span> <span class="n">gl</span><span class="o">.</span><span class="n">GoStr</span><span class="p">(</span><span class="n">gl</span><span class="o">.</span><span class="n">GetString</span><span class="p">(</span><span class="n">gl</span><span class="o">.</span><span class="n">VERSION</span><span class="p">))</span>
    <span class="n">log</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s2">&quot;OpenGL version&quot;</span><span class="p">,</span> <span class="n">version</span><span class="p">)</span>

    <span class="n">vertexShader</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">compileShader</span><span class="p">(</span><span class="n">vertexShaderSource</span><span class="p">,</span> <span class="n">gl</span><span class="o">.</span><span class="n">VERTEX_SHADER</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="n">nil</span> <span class="p">{</span>
        <span class="n">panic</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="n">fragmentShader</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">compileShader</span><span class="p">(</span><span class="n">fragmentShaderSource</span><span class="p">,</span> <span class="n">gl</span><span class="o">.</span><span class="n">FRAGMENT_SHADER</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="n">nil</span> <span class="p">{</span>
        <span class="n">panic</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="n">prog</span> <span class="o">:=</span> <span class="n">gl</span><span class="o">.</span><span class="n">CreateProgram</span><span class="p">()</span>
    <span class="n">gl</span><span class="o">.</span><span class="n">AttachShader</span><span class="p">(</span><span class="n">prog</span><span class="p">,</span> <span class="n">vertexShader</span><span class="p">)</span>
    <span class="n">gl</span><span class="o">.</span><span class="n">AttachShader</span><span class="p">(</span><span class="n">prog</span><span class="p">,</span> <span class="n">fragmentShader</span><span class="p">)</span>
    <span class="n">gl</span><span class="o">.</span><span class="n">LinkProgram</span><span class="p">(</span><span class="n">prog</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">prog</span>
<span class="p">}</span>

<span class="o">//</span> <span class="n">makeVao</span> <span class="n">初始化并从提供的点里面返回一个顶点数组</span>
<span class="n">func</span> <span class="n">makeVao</span><span class="p">(</span><span class="n">points</span> <span class="p">[]</span><span class="n">float32</span><span class="p">)</span> <span class="n">uint32</span> <span class="p">{</span>
    <span class="n">var</span> <span class="n">vbo</span> <span class="n">uint32</span>
    <span class="n">gl</span><span class="o">.</span><span class="n">GenBuffers</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">vbo</span><span class="p">)</span>
    <span class="n">gl</span><span class="o">.</span><span class="n">BindBuffer</span><span class="p">(</span><span class="n">gl</span><span class="o">.</span><span class="n">ARRAY_BUFFER</span><span class="p">,</span> <span class="n">vbo</span><span class="p">)</span>
    <span class="n">gl</span><span class="o">.</span><span class="n">BufferData</span><span class="p">(</span><span class="n">gl</span><span class="o">.</span><span class="n">ARRAY_BUFFER</span><span class="p">,</span> <span class="mi">4</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">),</span> <span class="n">gl</span><span class="o">.</span><span class="n">Ptr</span><span class="p">(</span><span class="n">points</span><span class="p">),</span> <span class="n">gl</span><span class="o">.</span><span class="n">STATIC_DRAW</span><span class="p">)</span>

    <span class="n">var</span> <span class="n">vao</span> <span class="n">uint32</span>
    <span class="n">gl</span><span class="o">.</span><span class="n">GenVertexArrays</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">vao</span><span class="p">)</span>
    <span class="n">gl</span><span class="o">.</span><span class="n">BindVertexArray</span><span class="p">(</span><span class="n">vao</span><span class="p">)</span>
    <span class="n">gl</span><span class="o">.</span><span class="n">EnableVertexAttribArray</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">gl</span><span class="o">.</span><span class="n">BindBuffer</span><span class="p">(</span><span class="n">gl</span><span class="o">.</span><span class="n">ARRAY_BUFFER</span><span class="p">,</span> <span class="n">vbo</span><span class="p">)</span>
    <span class="n">gl</span><span class="o">.</span><span class="n">VertexAttribPointer</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">gl</span><span class="o">.</span><span class="n">FLOAT</span><span class="p">,</span> <span class="n">false</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">nil</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">vao</span>
<span class="p">}</span>

<span class="n">func</span> <span class="n">compileShader</span><span class="p">(</span><span class="n">source</span> <span class="n">string</span><span class="p">,</span> <span class="n">shaderType</span> <span class="n">uint32</span><span class="p">)</span> <span class="p">(</span><span class="n">uint32</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">shader</span> <span class="o">:=</span> <span class="n">gl</span><span class="o">.</span><span class="n">CreateShader</span><span class="p">(</span><span class="n">shaderType</span><span class="p">)</span>

    <span class="n">csources</span><span class="p">,</span> <span class="n">free</span> <span class="o">:=</span> <span class="n">gl</span><span class="o">.</span><span class="n">Strs</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
    <span class="n">gl</span><span class="o">.</span><span class="n">ShaderSource</span><span class="p">(</span><span class="n">shader</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">csources</span><span class="p">,</span> <span class="n">nil</span><span class="p">)</span>
    <span class="n">free</span><span class="p">()</span>
    <span class="n">gl</span><span class="o">.</span><span class="n">CompileShader</span><span class="p">(</span><span class="n">shader</span><span class="p">)</span>

    <span class="n">var</span> <span class="n">status</span> <span class="n">int32</span>
    <span class="n">gl</span><span class="o">.</span><span class="n">GetShaderiv</span><span class="p">(</span><span class="n">shader</span><span class="p">,</span> <span class="n">gl</span><span class="o">.</span><span class="n">COMPILE_STATUS</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">status</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="n">gl</span><span class="o">.</span><span class="n">FALSE</span> <span class="p">{</span>
        <span class="n">var</span> <span class="n">logLength</span> <span class="n">int32</span>
        <span class="n">gl</span><span class="o">.</span><span class="n">GetShaderiv</span><span class="p">(</span><span class="n">shader</span><span class="p">,</span> <span class="n">gl</span><span class="o">.</span><span class="n">INFO_LOG_LENGTH</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">logLength</span><span class="p">)</span>

        <span class="n">log</span> <span class="o">:=</span> <span class="n">strings</span><span class="o">.</span><span class="n">Repeat</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\x00</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">logLength</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">gl</span><span class="o">.</span><span class="n">GetShaderInfoLog</span><span class="p">(</span><span class="n">shader</span><span class="p">,</span> <span class="n">logLength</span><span class="p">,</span> <span class="n">nil</span><span class="p">,</span> <span class="n">gl</span><span class="o">.</span><span class="n">Str</span><span class="p">(</span><span class="n">log</span><span class="p">))</span>

        <span class="k">return</span> <span class="mi">0</span><span class="p">,</span> <span class="n">fmt</span><span class="o">.</span><span class="n">Errorf</span><span class="p">(</span><span class="s2">&quot;failed to compile %v: %v&quot;</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">log</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">shader</span><span class="p">,</span> <span class="n">nil</span>
<span class="p">}</span>
</code></pre></div>

<p>请在 Twitter <a href="https://twitter.com/kylewbanks">@kylewbanks</a> 告诉我这篇文章对你是否有帮助，或者在 Twitter 下方关注我以便及时获取最新文章！</p>
    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>links</h2>
                        <ul>
                            <li><a href="https://getpelican.com/">Pelican</a></li>
                            <li><a href="https://www.python.org/">Python.org</a></li>
                            <li><a href="https://palletsprojects.com/p/jinja/">Jinja2</a></li>
                            <li><a href="#">You can modify those links in your config file</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>

                            <li><a href="#">You can add links in your config file</a></li>
                            <li><a href="#">Another social link</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a rel="nofollow" href="https://getpelican.com/">Pelican</a>, which takes great advantage of <a rel="nofollow" href="https://www.python.org/">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a rel="nofollow" href="https://www.smashingmagazine.com/2009/08/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>