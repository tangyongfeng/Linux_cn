<!DOCTYPE html>
<html lang="zh">
<head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="generator" content="Pelican" />
        <title>如何在 Windows 上运行 Linux 容器</title>
        <link rel="stylesheet" href="/theme/css/main.css" />
        <meta name="description" content="Author: Ubuntu 1、概述 现在能够在 Windows 10 和 Windows 服务器上运行 Docker 容器了，它是以 Ubuntu 作为宿主基础的。 想象一下，使用你喜欢的 Linux 发行版——比 …" />
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">linux_cn</a></h1>
                <nav><ul>
                    <li><a href="/category/chuan-shan-jia-zhuan-fang">穿山甲专访</a></li>
                    <li><a href="/category/dai-ma-ying-xiong">代码英雄</a></li>
                    <li><a href="/category/fen-xiang">分享</a></li>
                    <li><a href="/category/guan-dian">观点</a></li>
                    <li><a href="/category/huo-dong">活动</a></li>
                    <li><a href="/category/ji-ke-man-hua">极客漫画</a></li>
                    <li><a href="/category/ji-zhu">技术</a></li>
                    <li><a href="/category/kai-yuan-zhi-hui">开源智慧</a></li>
                    <li><a href="/category/linux-fa-xing-ban">Linux 发行版</a></li>
                    <li><a href="/category/mei-ri-an-quan-zi-xun">每日安全资讯</a></li>
                    <li><a href="/category/misc">Misc</a></li>
                    <li><a href="/category/qu-kuai-lian">区块链</a></li>
                    <li class="active"><a href="/category/rong-qi-yu-yun">容器与云</a></li>
                    <li><a href="/category/ruan-jian-kai-fa">软件开发</a></li>
                    <li><a href="/category/shu-mei-pai">树莓派</a></li>
                    <li><a href="/category/xi-tong-yun-wei">系统运维</a></li>
                    <li><a href="/category/xin-wen">新闻</a></li>
                    <li><a href="/category/ying-he-guan-cha">硬核观察</a></li>
                    <li><a href="/category/zhi-ye-sheng-ya">职业生涯</a></li>
                    <li><a href="/category/zhong-jiang-ming-dan">中奖名单</a></li>
                    <li><a href="/category/zhuo-mian-ying-yong">桌面应用</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="/2017/09/ru-he-zai-windows-shang-yun-xing-linux-rong-qi.html" rel="bookmark"
           title="Permalink to 如何在 Windows 上运行 Linux 容器">如何在 Windows 上运行 Linux 容器</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2017-09-17T10:56:00+02:00">
                Published: Sun 17 September 2017
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/linux-fans-from-china.html">linux fans from china</a>
        </address>
<p>In <a href="/category/rong-qi-yu-yun">容器与云</a>.</p>

</footer><!-- /.post-info -->      <p>Author: Ubuntu</p>
<h3>1、概述</h3>
<p>现在能够在 Windows 10 和 Windows 服务器上运行 Docker 容器了，它是以 Ubuntu 作为宿主基础的。</p>
<p>想象一下，使用你喜欢的 Linux 发行版——比如 Ubuntu——在 Windows 上运行你自己的 Linux 应用。</p>
<p>现在，借助 Docker 技术和 Windows 上的 Hyper-V 虚拟化的力量，这一切成为了可能。</p>
<p><img alt="" src="/data/attachment/album/201709/17/105627lic1ifnc1ellldyq.png"></p>
<h3>2、前置需求</h3>
<p>你需要一个 8GB 内存的 64 位 x86 PC，运行 Windows 10 或 Windows Server。</p>
<p>只有加入了 <a href="https://insider.windows.com/zh-cn/">Windows 预览体验计划（Insider）</a>，才能运行带有 Hyper-V 支持的 Linux 容器。该计划可以让你测试预发布软件和即将发布的 Windows。</p>
<p>如果你特别在意稳定性和隐私（Windows 预览体验计划允许微软收集使用信息），你可以考虑等待 2017 年 10 月发布的<a href="https://www.microsoft.com/zh-cn/windows/upcoming-features">Windows 10 Fall Creator update</a>，这个版本可以让你无需 Windows 预览体验身份即可使用带有 Hyper-V 支持的 Docker 技术。</p>
<p>你也需要最新版本的 Docker，它可以从 <a href="http://dockerproject.org/">http://dockerproject.org</a> 下载得到。</p>
<p>最后，你还需要确认你安装了 <a href="https://tukaani.org/xz/">XZ 工具</a>，解压 Ubuntu 宿主容器镜像时需要它。</p>
<h3>3、加入 Windows 预览体验计划（Insider）</h3>
<p>如果你已经是 Windows 预览体验计划（Insider）成员，你可以跳过此步。否则在浏览器中打开如下链接：</p>
<p><a href="https://insider.windows.com/zh-cn/getting-started/">https://insider.windows.com/zh-cn/getting-started/</a></p>
<p><img alt="" src="/data/attachment/album/201709/17/105628r1f5llb715oe74ev.png"></p>
<p>要注册该计划，使用你在 Windows 10 中的微软个人账户登录，并在预览体验计划首页点击“注册”，接受条款并完成注册。</p>
<p>然后你需要打开 Windows 开始菜单中的“更新和安全”菜单，并在菜单左侧选择“Windows 预览体验计划”。</p>
<p><img alt="" src="/data/attachment/album/201709/17/105629vaj0lxjlisjxbxxi.png"></p>
<p>如果需要的话，在 Windows 提示“你的 Windows 预览体验计划账户需要关注”时，点击“修复”按钮。</p>
<h3>4、 Windows 预览体验（Insider）的内容</h3>
<p>从 Windows 预览体验计划面板，选择“开始使用”。如果你的微软账户没有关联到你的 Windows 10 系统，当提示时使用你要关联的账户进行登录。</p>
<p>然后你可以选择你希望从 Windows 预览体验计划中收到何种内容。要得到 Docker 技术所需要的 Hyper-V 隔离功能，你需要加入“快圈”，两次确认后，重启 Windows。重启后，你需要等待你的机器安装各种更新后才能进行下一步。</p>
<p><img alt="" src="/data/attachment/album/201709/17/105629f4eztyygtllys353.png"></p>
<h3>5、安装 Docker for Windows</h3>
<p>从 <a href="https://store.docker.com/editions/community/docker-ce-desktop-windows">Docker Store</a> 下载 Docker for Windows。</p>
<p><img alt="" src="/data/attachment/album/201709/17/105630dkytkjadteopjkyj.png"></p>
<p>下载完成后，安装，并在需要时重启。</p>
<p><img alt="" src="/data/attachment/album/201709/17/105630g593jnjjnsh9zsvd.png"></p>
<p>重启后，Docker 就已经启动了。Docker 要求启用 Hyper-V 功能，因此它会提示你启用并重启。点击“OK”来为 Docker 启用它并重启系统。</p>
<p><img alt="" src="/data/attachment/album/201709/17/105631czj3e9y3tt5t99ky.png"></p>
<h3>6、下载 Ubuntu 容器镜像</h3>
<p>从 <a href="https://partner-images.canonical.com/hyper-v/linux-containers/xenial/current/">Canonical 合作伙伴镜像网站</a>下载用于 Windows 的最新的 Ubuntu 容器镜像。</p>
<p>下载后，使用 XZ 工具解压：</p>
<div class="highlight"><pre><span></span><code>C:\Users\mathi\&gt; .\xz.exe -d xenial-container-hyper-v.vhdx.xz
C:\Users\mathi\&gt;
</code></pre></div>

<h3>7、准备容器环境</h3>
<p>首先创建两个目录：</p>
<p><img alt="" src="/data/attachment/album/201709/17/105631e5ifc5qqsb1skk8t.png"></p>
<p>创建 <code>C:\lcow</code><em>，</em>它将用于 Docker 准备容器时的临时空间。</p>
<p><img alt="" src="/data/attachment/album/201709/17/105632r3pp4nxx5ixyw6l5.png"></p>
<p>再创建一个 <code>C:\Program Files\Linux Containers</code> ，这是存放 Ubuntu 容器镜像的地方。</p>
<p>你需要给这个目录额外的权限以允许 Docker 在其中使用镜像。在管理员权限的 Powershell 窗口中运行如下 Powershell 脚本：</p>
<div class="highlight"><pre><span></span><code><span class="n">param</span><span class="p">(</span>
<span class="o">[</span><span class="n">string</span><span class="o">]</span><span class="w"> </span><span class="err">$</span><span class="n">Root</span>
<span class="p">)</span>
<span class="err">#</span><span class="w"> </span><span class="n">Give</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">virtual</span><span class="w"> </span><span class="n">machines</span><span class="w"> </span><span class="k">group</span><span class="w"> </span><span class="k">full</span><span class="w"> </span><span class="n">control</span>
<span class="err">$</span><span class="n">acl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">Get</span><span class="o">-</span><span class="n">Acl</span><span class="w"> </span><span class="o">-</span><span class="k">Path</span><span class="w"> </span><span class="err">$</span><span class="n">Root</span>
<span class="err">$</span><span class="n">vmGroupRule</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="o">-</span><span class="k">object</span><span class="w"> </span><span class="k">System</span><span class="p">.</span><span class="n">Security</span><span class="p">.</span><span class="n">AccessControl</span><span class="p">.</span><span class="n">FileSystemAccessRule</span><span class="p">(</span><span class="ss">&quot;NT VIRTUAL MACHINE\Virtual Machines&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;FullControl&quot;</span><span class="p">,</span><span class="ss">&quot;ContainerInherit,ObjectInherit&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;None&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;Allow&quot;</span><span class="p">)</span>
<span class="err">$</span><span class="n">acl</span><span class="p">.</span><span class="n">SetAccessRule</span><span class="p">(</span><span class="err">$</span><span class="n">vmGroupRule</span><span class="p">)</span>
<span class="k">Set</span><span class="o">-</span><span class="n">Acl</span><span class="w"> </span><span class="o">-</span><span class="n">AclObject</span><span class="w"> </span><span class="err">$</span><span class="n">acl</span><span class="w"> </span><span class="o">-</span><span class="k">Path</span><span class="w"> </span><span class="err">$</span><span class="n">Root</span>
</code></pre></div>

<p>将其保存为<code>set_perms.ps1</code>并运行它。</p>
<p>提示<strong>，你也许需要运行</strong> <code>Set-ExecutionPolicy -Scope process unrestricted</code> 来允许运行未签名的 Powershell 脚本。</p>
<p><img alt="" src="/data/attachment/album/201709/17/105632ds3k6bsnfeg33nga.png"></p>
<div class="highlight"><pre><span></span><code>C:\Users\mathi\&gt; .\set_perms.ps1 &quot;C:\Program Files\Linux Containers&quot;
C:\Users\mathi\&gt;
</code></pre></div>

<p>现在，将上一步解压得到的 Ubuntu 容器镜像（.vhdx）复制到 <code>C:\Program Files\Linux Containers</code> 下的 <code>uvm.vhdx</code>。</p>
<h3>8、更多的 Docker 准备工作</h3>
<p>Docker for Windows 要求一些预发布的功能才能与 Hyper-V 隔离相配合工作。这些功能在之前的 Docker CE 版本中还不可用，这些所需的文件可以从 <a href="https://master.dockerproject.org/">master.dockerproject.org</a> 下载。</p>
<p><img alt="" src="/data/attachment/album/201709/17/105632min17nhnghyls827.png"></p>
<p>从 <a href="https://master.dockerproject.org/">master.dockerproject.org</a> 下载 <code>dockerd.exe</code> 和 <code>docker.exe</code>，并将其放到安全的地方，比如你自己的文件夹中。它们用于在下一步中启动 Ubuntu 容器。</p>
<h3>9、 在 Hyper-V 上运行 Ubuntu 容器</h3>
<p>你现在已经准备好启动你的容器了。首先以管理员身份打开命令行（<code>cmd.exe</code>），然后以正确的环境变量启动 <code>dockerd.exe</code>。</p>
<div class="highlight"><pre><span></span><code>C:\Users\mathi\&gt; set LCOW_SUPPORTED=1
C:\Users\mathi\&gt; .\dockerd.exe -D --data-root C:\lcow
</code></pre></div>

<p>然后，以管理员身份启动 Powershell 窗口，并运行 <code>docker.exe</code> 为你的容器拉取镜像：</p>
<div class="highlight"><pre><span></span><code>C:\Users\mathi\&gt; .\docker.exe pull ubuntu
</code></pre></div>

<p><img alt="" src="/data/attachment/album/201709/17/105633miwxzgigxipj6gpq.png"><img alt="" src="/data/attachment/album/201709/17/105634p351gz3sy5g1zzgy.png"><img alt="" src="/data/attachment/album/201709/17/105634uv6sjxloxl0xv6ym.png"></p>
<p>现在你终于启动了容器，再次运行 <code>docker.exe</code>，让它运行这个新镜像：</p>
<div class="highlight"><pre><span></span><code>C:\Users\mathi\&gt; .\docker.exe run -it ubuntu
</code></pre></div>

<p><img alt="" src="/data/attachment/album/201709/17/105627lic1ifnc1ellldyq.png"></p>
<p>恭喜你！你已经成功地在 Windows 上让你的系统运行了带有 Hyper-V 隔离的容器，并且跑的是你非常喜欢的 Ubuntu 容器。</p>
<h3>10、获取帮助</h3>
<p>如果你需要一些 Hyper-V Ubuntu 容器的起步指导，或者你遇到一些问题，你可以在这里寻求帮助：</p>
<ul>
<li><a href="https://askubuntu.com/">Ask Ubuntu</a></li>
<li><a href="https://ubuntuforums.org/">Ubuntu Forums</a></li>
<li><a href="https://wiki.ubuntu.com/IRC/ChannelList">IRC-based support</a></li>
</ul>
    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>links</h2>
                        <ul>
                            <li><a href="https://getpelican.com/">Pelican</a></li>
                            <li><a href="https://www.python.org/">Python.org</a></li>
                            <li><a href="https://palletsprojects.com/p/jinja/">Jinja2</a></li>
                            <li><a href="#">You can modify those links in your config file</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>

                            <li><a href="#">You can add links in your config file</a></li>
                            <li><a href="#">Another social link</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a rel="nofollow" href="https://getpelican.com/">Pelican</a>, which takes great advantage of <a rel="nofollow" href="https://www.python.org/">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a rel="nofollow" href="https://www.smashingmagazine.com/2009/08/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>