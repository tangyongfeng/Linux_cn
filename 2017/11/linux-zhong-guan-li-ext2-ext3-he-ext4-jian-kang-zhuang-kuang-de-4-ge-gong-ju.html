<!DOCTYPE html>
<html lang="zh">
<head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="generator" content="Pelican" />
        <title>Linux 中管理 EXT2、 EXT3 和 EXT4 健康状况的 4 个工具</title>
        <link rel="stylesheet" href="/theme/css/main.css" />
        <meta name="description" content="Author: Aaron Kili 文件系统是一个在计算机上帮你去管理数据怎么去存储和检索的数据结构。文件系统也可以被视作是磁盘上的 …" />
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">linux_cn</a></h1>
                <nav><ul>
                    <li><a href="/category/chuan-shan-jia-zhuan-fang">穿山甲专访</a></li>
                    <li><a href="/category/dai-ma-ying-xiong">代码英雄</a></li>
                    <li><a href="/category/fen-xiang">分享</a></li>
                    <li><a href="/category/guan-dian">观点</a></li>
                    <li><a href="/category/huo-dong">活动</a></li>
                    <li><a href="/category/ji-ke-man-hua">极客漫画</a></li>
                    <li class="active"><a href="/category/ji-zhu">技术</a></li>
                    <li><a href="/category/kai-yuan-zhi-hui">开源智慧</a></li>
                    <li><a href="/category/linux-fa-xing-ban">Linux 发行版</a></li>
                    <li><a href="/category/mei-ri-an-quan-zi-xun">每日安全资讯</a></li>
                    <li><a href="/category/misc">Misc</a></li>
                    <li><a href="/category/qu-kuai-lian">区块链</a></li>
                    <li><a href="/category/rong-qi-yu-yun">容器与云</a></li>
                    <li><a href="/category/ruan-jian-kai-fa">软件开发</a></li>
                    <li><a href="/category/shu-mei-pai">树莓派</a></li>
                    <li><a href="/category/xi-tong-yun-wei">系统运维</a></li>
                    <li><a href="/category/xin-wen">新闻</a></li>
                    <li><a href="/category/ying-he-guan-cha">硬核观察</a></li>
                    <li><a href="/category/zhi-ye-sheng-ya">职业生涯</a></li>
                    <li><a href="/category/zhong-jiang-ming-dan">中奖名单</a></li>
                    <li><a href="/category/zhuo-mian-ying-yong">桌面应用</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="/2017/11/linux-zhong-guan-li-ext2-ext3-he-ext4-jian-kang-zhuang-kuang-de-4-ge-gong-ju.html" rel="bookmark"
           title="Permalink to Linux 中管理 EXT2、 EXT3 和 EXT4 健康状况的 4 个工具">Linux 中管理 EXT2、 EXT3 和 EXT4 健康状况的 4 个工具</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2017-11-16T16:44:45+01:00">
                Published: Thu 16 November 2017
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/linux-fans-from-china.html">linux fans from china</a>
        </address>
<p>In <a href="/category/ji-zhu">技术</a>.</p>

</footer><!-- /.post-info -->      <p>Author: Aaron Kili</p>
<p><img alt="" src="/data/attachment/album/201711/16/164437f1c3321d0kg3oil0.jpg"></p>
<p>文件系统是一个在计算机上帮你去管理数据怎么去存储和检索的数据结构。文件系统也可以被视作是磁盘上的物理（或扩展）分区。如果它没有很好地被维护或定期监视，它可能在长期运行中出现各种各样的错误或损坏。</p>
<p>这里有几个可能导致文件系统出问题的因素：系统崩溃、硬件或软件故障、 有问题的驱动和程序、不正确的优化、大量的数据过载加上一些小故障。</p>
<p>这其中的任何一个问题都可以导致 Linux 不能顺利地挂载（或卸载）一个文件系统，从而导致系统故障。</p>
<p>扩展阅读：<a href="/article-8289-1.html">Linux 中判断文件系统类型（Ext2, Ext3 或 Ext4）的 7 种方法</a></p>
<p>另外，受损的文件系统运行在你的系统上可能导致操作系统中的组件或用户应用程序的运行时错误，它可能会进一步扩大到服务器数据的丢失。为避免文件系统错误或损坏，你需要去持续关注它的健康状况。</p>
<p>在这篇文章中，我们将介绍监视或维护一个 ext2、ext3 和 ext4 文件系统健康状况的工具。在这里描述的所有工具都需要 root 用户权限，因此，需要使用 <a href="/article-8278-1.html">sudo 命令</a>去运行它们。</p>
<h3>怎么去查看 EXT2/EXT3/EXT4 文件系统信息</h3>
<p><code>dumpe2fs</code> 是一个命令行工具，用于去转储 ext2/ext3/ext4 文件系统信息，这意味着它可以显示设备上文件系统的超级块和块组信息。</p>
<p>在运行 <code>dumpe2fs</code> 之前，先去运行 <a href="https://www.tecmint.com/how-to-check-disk-space-in-linux/">df -hT</a> 命令，确保知道文件系统的设备名。</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>sudo<span class="w"> </span>dumpe2fs<span class="w"> </span>/dev/sda10
</code></pre></div>

<p><strong>示例输出：</strong></p>
<div class="highlight"><pre><span></span><code><span class="nx">dumpe2fs</span><span class="w"> </span><span class="m m-Double">1.42.13</span><span class="w"> </span><span class="p">(</span><span class="mi">17</span><span class="o">-</span><span class="nx">May</span><span class="o">-</span><span class="mi">2015</span><span class="p">)</span>
<span class="nx">Filesystem</span><span class="w"> </span><span class="nx">volume</span><span class="w"> </span><span class="nx">name</span><span class="p">:</span><span class="w">   </span>
<span class="nx">Last</span><span class="w"> </span><span class="nx">mounted</span><span class="w"> </span><span class="nx">on</span><span class="p">:</span><span class="w">          </span><span class="o">/</span>
<span class="nx">Filesystem</span><span class="w"> </span><span class="nx">UUID</span><span class="p">:</span><span class="w">          </span><span class="nx">bb29dda3</span><span class="o">-</span><span class="nx">bdaa</span><span class="o">-</span><span class="mi">4</span><span class="nx">b39</span><span class="o">-</span><span class="mi">86</span><span class="nx">cf</span><span class="o">-</span><span class="mi">4</span><span class="nx">a6dc9634a1b</span>
<span class="nx">Filesystem</span><span class="w"> </span><span class="nx">magic</span><span class="w"> </span><span class="nx">number</span><span class="p">:</span><span class="w">  </span><span class="mh">0xEF53</span>
<span class="nx">Filesystem</span><span class="w"> </span><span class="nx">revision</span><span class="w"> </span><span class="err">#</span><span class="p">:</span><span class="w">    </span><span class="mi">1</span><span class="w"> </span><span class="p">(</span><span class="nx">dynamic</span><span class="p">)</span>
<span class="nx">Filesystem</span><span class="w"> </span><span class="nx">features</span><span class="p">:</span><span class="w">      </span><span class="nx">has_journal</span><span class="w"> </span><span class="nx">ext_attr</span><span class="w"> </span><span class="nx">resize_inode</span><span class="w"> </span><span class="nx">dir_index</span><span class="w"> </span><span class="nx">filetype</span><span class="w"> </span><span class="nx">needs_recovery</span><span class="w"> </span><span class="nx">extent</span><span class="w"> </span><span class="nx">flex_bg</span><span class="w"> </span><span class="nx">sparse_super</span><span class="w"> </span><span class="nx">large_file</span><span class="w"> </span><span class="nx">huge_file</span><span class="w"> </span><span class="nx">uninit_bg</span><span class="w"> </span><span class="nx">dir_nlink</span><span class="w"> </span><span class="nx">extra_isize</span>
<span class="nx">Filesystem</span><span class="w"> </span><span class="nx">flags</span><span class="p">:</span><span class="w">         </span><span class="nx">signed_directory_hash</span><span class="w"> </span>
<span class="nx">Default</span><span class="w"> </span><span class="nx">mount</span><span class="w"> </span><span class="nx">options</span><span class="p">:</span><span class="w">    </span><span class="nx">user_xattr</span><span class="w"> </span><span class="nx">acl</span>
<span class="nx">Filesystem</span><span class="w"> </span><span class="nx">state</span><span class="p">:</span><span class="w">         </span><span class="nx">clean</span>
<span class="nx">Errors</span><span class="w"> </span><span class="nx">behavior</span><span class="p">:</span><span class="w">          </span><span class="nx">Continue</span>
<span class="nx">Filesystem</span><span class="w"> </span><span class="nx">OS</span><span class="w"> </span><span class="k">type</span><span class="p">:</span><span class="w">       </span><span class="nx">Linux</span>
<span class="nx">Inode</span><span class="w"> </span><span class="nx">count</span><span class="p">:</span><span class="w">              </span><span class="mi">21544960</span>
<span class="nx">Block</span><span class="w"> </span><span class="nx">count</span><span class="p">:</span><span class="w">              </span><span class="mi">86154752</span>
<span class="nx">Reserved</span><span class="w"> </span><span class="nx">block</span><span class="w"> </span><span class="nx">count</span><span class="p">:</span><span class="w">     </span><span class="mi">4307737</span>
<span class="nx">Free</span><span class="w"> </span><span class="nx">blocks</span><span class="p">:</span><span class="w">              </span><span class="mi">22387732</span>
<span class="nx">Free</span><span class="w"> </span><span class="nx">inodes</span><span class="p">:</span><span class="w">              </span><span class="mi">21026406</span>
<span class="nx">First</span><span class="w"> </span><span class="nx">block</span><span class="p">:</span><span class="w">              </span><span class="mi">0</span>
<span class="nx">Block</span><span class="w"> </span><span class="nx">size</span><span class="p">:</span><span class="w">               </span><span class="mi">4096</span>
<span class="nx">Fragment</span><span class="w"> </span><span class="nx">size</span><span class="p">:</span><span class="w">            </span><span class="mi">4096</span>
<span class="nx">Reserved</span><span class="w"> </span><span class="nx">GDT</span><span class="w"> </span><span class="nx">blocks</span><span class="p">:</span><span class="w">      </span><span class="mi">1003</span>
<span class="nx">Blocks</span><span class="w"> </span><span class="nx">per</span><span class="w"> </span><span class="nx">group</span><span class="p">:</span><span class="w">         </span><span class="mi">32768</span>
<span class="nx">Fragments</span><span class="w"> </span><span class="nx">per</span><span class="w"> </span><span class="nx">group</span><span class="p">:</span><span class="w">      </span><span class="mi">32768</span>
<span class="nx">Inodes</span><span class="w"> </span><span class="nx">per</span><span class="w"> </span><span class="nx">group</span><span class="p">:</span><span class="w">         </span><span class="mi">8192</span>
<span class="nx">Inode</span><span class="w"> </span><span class="nx">blocks</span><span class="w"> </span><span class="nx">per</span><span class="w"> </span><span class="nx">group</span><span class="p">:</span><span class="w">   </span><span class="mi">512</span>
<span class="nx">Flex</span><span class="w"> </span><span class="nx">block</span><span class="w"> </span><span class="nx">group</span><span class="w"> </span><span class="nx">size</span><span class="p">:</span><span class="w">    </span><span class="mi">16</span>
<span class="nx">Filesystem</span><span class="w"> </span><span class="nx">created</span><span class="p">:</span><span class="w">       </span><span class="nx">Sun</span><span class="w"> </span><span class="nx">Jul</span><span class="w"> </span><span class="mi">31</span><span class="w"> </span><span class="mi">16</span><span class="p">:</span><span class="mi">19</span><span class="p">:</span><span class="mi">36</span><span class="w"> </span><span class="mi">2016</span>
<span class="nx">Last</span><span class="w"> </span><span class="nx">mount</span><span class="w"> </span><span class="nx">time</span><span class="p">:</span><span class="w">          </span><span class="nx">Mon</span><span class="w"> </span><span class="nx">Nov</span><span class="w">  </span><span class="mi">6</span><span class="w"> </span><span class="mi">10</span><span class="p">:</span><span class="mi">25</span><span class="p">:</span><span class="mi">28</span><span class="w"> </span><span class="mi">2017</span>
<span class="nx">Last</span><span class="w"> </span><span class="nx">write</span><span class="w"> </span><span class="nx">time</span><span class="p">:</span><span class="w">          </span><span class="nx">Mon</span><span class="w"> </span><span class="nx">Nov</span><span class="w">  </span><span class="mi">6</span><span class="w"> </span><span class="mi">10</span><span class="p">:</span><span class="mi">25</span><span class="p">:</span><span class="mi">19</span><span class="w"> </span><span class="mi">2017</span>
<span class="nx">Mount</span><span class="w"> </span><span class="nx">count</span><span class="p">:</span><span class="w">              </span><span class="mi">432</span>
<span class="nx">Maximum</span><span class="w"> </span><span class="nx">mount</span><span class="w"> </span><span class="nx">count</span><span class="p">:</span><span class="w">      </span><span class="o">-</span><span class="mi">1</span>
<span class="nx">Last</span><span class="w"> </span><span class="nx">checked</span><span class="p">:</span><span class="w">             </span><span class="nx">Sun</span><span class="w"> </span><span class="nx">Jul</span><span class="w"> </span><span class="mi">31</span><span class="w"> </span><span class="mi">16</span><span class="p">:</span><span class="mi">19</span><span class="p">:</span><span class="mi">36</span><span class="w"> </span><span class="mi">2016</span>
<span class="nx">Check</span><span class="w"> </span><span class="nx">interval</span><span class="p">:</span><span class="w">           </span><span class="mi">0</span><span class="w"> </span><span class="p">()</span>
<span class="nx">Lifetime</span><span class="w"> </span><span class="nx">writes</span><span class="p">:</span><span class="w">          </span><span class="mi">2834</span><span class="w"> </span><span class="nx">GB</span>
<span class="nx">Reserved</span><span class="w"> </span><span class="nx">blocks</span><span class="w"> </span><span class="nx">uid</span><span class="p">:</span><span class="w">      </span><span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="nx">user</span><span class="w"> </span><span class="nx">root</span><span class="p">)</span>
<span class="nx">Reserved</span><span class="w"> </span><span class="nx">blocks</span><span class="w"> </span><span class="nx">gid</span><span class="p">:</span><span class="w">      </span><span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="nx">group</span><span class="w"> </span><span class="nx">root</span><span class="p">)</span>
<span class="nx">First</span><span class="w"> </span><span class="nx">inode</span><span class="p">:</span><span class="w">              </span><span class="mi">11</span>
<span class="nx">Inode</span><span class="w"> </span><span class="nx">size</span><span class="p">:</span><span class="w">           </span><span class="mi">256</span>
<span class="nx">Required</span><span class="w"> </span><span class="nx">extra</span><span class="w"> </span><span class="nx">isize</span><span class="p">:</span><span class="w">     </span><span class="mi">28</span>
<span class="nx">Desired</span><span class="w"> </span><span class="nx">extra</span><span class="w"> </span><span class="nx">isize</span><span class="p">:</span><span class="w">      </span><span class="mi">28</span>
<span class="nx">Journal</span><span class="w"> </span><span class="nx">inode</span><span class="p">:</span><span class="w">            </span><span class="mi">8</span>
<span class="nx">First</span><span class="w"> </span><span class="nx">orphan</span><span class="w"> </span><span class="nx">inode</span><span class="p">:</span><span class="w">       </span><span class="mi">6947324</span>
<span class="nx">Default</span><span class="w"> </span><span class="nx">directory</span><span class="w"> </span><span class="nx">hash</span><span class="p">:</span><span class="w">   </span><span class="nx">half_md4</span>
<span class="nx">Directory</span><span class="w"> </span><span class="nx">Hash</span><span class="w"> </span><span class="nx">Seed</span><span class="p">:</span><span class="w">      </span><span class="mi">9</span><span class="nx">da5dafb</span><span class="o">-</span><span class="nx">bded</span><span class="o">-</span><span class="mi">494</span><span class="nx">d</span><span class="o">-</span><span class="nx">ba7f</span><span class="o">-</span><span class="mi">5</span><span class="nx">c0ff3d9b805</span>
<span class="nx">Journal</span><span class="w"> </span><span class="nx">backup</span><span class="p">:</span><span class="w">           </span><span class="nx">inode</span><span class="w"> </span><span class="nx">blocks</span>
<span class="nx">Journal</span><span class="w"> </span><span class="nx">features</span><span class="p">:</span><span class="w">         </span><span class="nx">journal_incompat_revoke</span>
<span class="nx">Journal</span><span class="w"> </span><span class="nx">size</span><span class="p">:</span><span class="w">             </span><span class="mi">128</span><span class="nx">M</span>
<span class="nx">Journal</span><span class="w"> </span><span class="nx">length</span><span class="p">:</span><span class="w">           </span><span class="mi">32768</span>
<span class="nx">Journal</span><span class="w"> </span><span class="nx">sequence</span><span class="p">:</span><span class="w">         </span><span class="mh">0x00580f0c</span>
<span class="nx">Journal</span><span class="w"> </span><span class="nx">start</span><span class="p">:</span><span class="w">            </span><span class="mi">12055</span>
</code></pre></div>

<p>你可以通过 <code>-b</code> 选项来显示文件系统中的任何保留块，比如坏块（无输出说明没有坏块）：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>sudo<span class="w"> </span>dumpe2fs<span class="w"> </span>-b
</code></pre></div>

<h3>检查 EXT2/EXT3/EXT4 文件系统的错误</h3>
<p><code>e2fsck</code> 用于去检查 ext2/ext3/ext4 文件系统的错误。<code>fsck</code> 可以检查并且可选地 <a href="https://www.tecmint.com/defragment-linux-system-partitions-and-directories/">修复 Linux 文件系统</a>；它实际上是底层 Linux 提供的一系列文件系统检查器 （fsck.fstype，例如 fsck.ext3、fsck.sfx 等等） 的前端程序。</p>
<p>记住，在系统引导时，Linux 会为 <code>/etc/fstab</code> 配置文件中被标为“检查”的分区自动运行 <code>e2fsck</code>/<code>fsck</code>。而在一个文件系统没有被干净地卸载时，一般也会运行它。</p>
<p>注意：不要在已挂载的文件系统上运行 e2fsck 或 fsck，在你运行这些工具之前，首先要去卸载分区，如下所示。</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>sudo<span class="w"> </span>unmount<span class="w"> </span>/dev/sda10
$<span class="w"> </span>sudo<span class="w"> </span>fsck<span class="w"> </span>/dev/sda10
</code></pre></div>

<p>此外，可以使用 <code>-V</code> 开关去启用详细输出，使用 <code>-t</code> 去指定文件系统类型，像这样：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>sudo<span class="w"> </span>fsck<span class="w"> </span>-Vt<span class="w"> </span>ext4<span class="w"> </span>/dev/sda10
</code></pre></div>

<h3>调优 EXT2/EXT3/EXT4 文件系统</h3>
<p>我们前面提到过，导致文件系统损坏的其中一个因素就是不正确的调优。你可以使用 <code>tune2fs</code> 实用程序去改变 ext2/ext3/ext4 文件系统的可调优参数，像下面讲的那样。</p>
<p>去查看文件系统的超级块，包括参数的当前值，使用 <code>-l</code> 选项，如下所示。</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>sudo<span class="w"> </span>tune2fs<span class="w"> </span>-l<span class="w"> </span>/dev/sda10
</code></pre></div>

<p><strong>示例输出：</strong></p>
<div class="highlight"><pre><span></span><code><span class="nx">tune2fs</span><span class="w"> </span><span class="m m-Double">1.42.13</span><span class="w"> </span><span class="p">(</span><span class="mi">17</span><span class="o">-</span><span class="nx">May</span><span class="o">-</span><span class="mi">2015</span><span class="p">)</span>
<span class="nx">Filesystem</span><span class="w"> </span><span class="nx">volume</span><span class="w"> </span><span class="nx">name</span><span class="p">:</span><span class="w">   </span>
<span class="nx">Last</span><span class="w"> </span><span class="nx">mounted</span><span class="w"> </span><span class="nx">on</span><span class="p">:</span><span class="w">          </span><span class="o">/</span>
<span class="nx">Filesystem</span><span class="w"> </span><span class="nx">UUID</span><span class="p">:</span><span class="w">          </span><span class="nx">bb29dda3</span><span class="o">-</span><span class="nx">bdaa</span><span class="o">-</span><span class="mi">4</span><span class="nx">b39</span><span class="o">-</span><span class="mi">86</span><span class="nx">cf</span><span class="o">-</span><span class="mi">4</span><span class="nx">a6dc9634a1b</span>
<span class="nx">Filesystem</span><span class="w"> </span><span class="nx">magic</span><span class="w"> </span><span class="nx">number</span><span class="p">:</span><span class="w">  </span><span class="mh">0xEF53</span>
<span class="nx">Filesystem</span><span class="w"> </span><span class="nx">revision</span><span class="w"> </span><span class="err">#</span><span class="p">:</span><span class="w">    </span><span class="mi">1</span><span class="w"> </span><span class="p">(</span><span class="nx">dynamic</span><span class="p">)</span>
<span class="nx">Filesystem</span><span class="w"> </span><span class="nx">features</span><span class="p">:</span><span class="w">      </span><span class="nx">has_journal</span><span class="w"> </span><span class="nx">ext_attr</span><span class="w"> </span><span class="nx">resize_inode</span><span class="w"> </span><span class="nx">dir_index</span><span class="w"> </span><span class="nx">filetype</span><span class="w"> </span><span class="nx">needs_recovery</span><span class="w"> </span><span class="nx">extent</span><span class="w"> </span><span class="nx">flex_bg</span><span class="w"> </span><span class="nx">sparse_super</span><span class="w"> </span><span class="nx">large_file</span><span class="w"> </span><span class="nx">huge_file</span><span class="w"> </span><span class="nx">uninit_bg</span><span class="w"> </span><span class="nx">dir_nlink</span><span class="w"> </span><span class="nx">extra_isize</span>
<span class="nx">Filesystem</span><span class="w"> </span><span class="nx">flags</span><span class="p">:</span><span class="w">         </span><span class="nx">signed_directory_hash</span><span class="w"> </span>
<span class="nx">Default</span><span class="w"> </span><span class="nx">mount</span><span class="w"> </span><span class="nx">options</span><span class="p">:</span><span class="w">    </span><span class="nx">user_xattr</span><span class="w"> </span><span class="nx">acl</span>
<span class="nx">Filesystem</span><span class="w"> </span><span class="nx">state</span><span class="p">:</span><span class="w">         </span><span class="nx">clean</span>
<span class="nx">Errors</span><span class="w"> </span><span class="nx">behavior</span><span class="p">:</span><span class="w">          </span><span class="nx">Continue</span>
<span class="nx">Filesystem</span><span class="w"> </span><span class="nx">OS</span><span class="w"> </span><span class="k">type</span><span class="p">:</span><span class="w">       </span><span class="nx">Linux</span>
<span class="nx">Inode</span><span class="w"> </span><span class="nx">count</span><span class="p">:</span><span class="w">              </span><span class="mi">21544960</span>
<span class="nx">Block</span><span class="w"> </span><span class="nx">count</span><span class="p">:</span><span class="w">              </span><span class="mi">86154752</span>
<span class="nx">Reserved</span><span class="w"> </span><span class="nx">block</span><span class="w"> </span><span class="nx">count</span><span class="p">:</span><span class="w">     </span><span class="mi">4307737</span>
<span class="nx">Free</span><span class="w"> </span><span class="nx">blocks</span><span class="p">:</span><span class="w">              </span><span class="mi">22387732</span>
<span class="nx">Free</span><span class="w"> </span><span class="nx">inodes</span><span class="p">:</span><span class="w">              </span><span class="mi">21026406</span>
<span class="nx">First</span><span class="w"> </span><span class="nx">block</span><span class="p">:</span><span class="w">              </span><span class="mi">0</span>
<span class="nx">Block</span><span class="w"> </span><span class="nx">size</span><span class="p">:</span><span class="w">               </span><span class="mi">4096</span>
<span class="nx">Fragment</span><span class="w"> </span><span class="nx">size</span><span class="p">:</span><span class="w">            </span><span class="mi">4096</span>
<span class="nx">Reserved</span><span class="w"> </span><span class="nx">GDT</span><span class="w"> </span><span class="nx">blocks</span><span class="p">:</span><span class="w">      </span><span class="mi">1003</span>
<span class="nx">Blocks</span><span class="w"> </span><span class="nx">per</span><span class="w"> </span><span class="nx">group</span><span class="p">:</span><span class="w">         </span><span class="mi">32768</span>
<span class="nx">Fragments</span><span class="w"> </span><span class="nx">per</span><span class="w"> </span><span class="nx">group</span><span class="p">:</span><span class="w">      </span><span class="mi">32768</span>
<span class="nx">Inodes</span><span class="w"> </span><span class="nx">per</span><span class="w"> </span><span class="nx">group</span><span class="p">:</span><span class="w">         </span><span class="mi">8192</span>
<span class="nx">Inode</span><span class="w"> </span><span class="nx">blocks</span><span class="w"> </span><span class="nx">per</span><span class="w"> </span><span class="nx">group</span><span class="p">:</span><span class="w">   </span><span class="mi">512</span>
<span class="nx">Flex</span><span class="w"> </span><span class="nx">block</span><span class="w"> </span><span class="nx">group</span><span class="w"> </span><span class="nx">size</span><span class="p">:</span><span class="w">    </span><span class="mi">16</span>
<span class="nx">Filesystem</span><span class="w"> </span><span class="nx">created</span><span class="p">:</span><span class="w">       </span><span class="nx">Sun</span><span class="w"> </span><span class="nx">Jul</span><span class="w"> </span><span class="mi">31</span><span class="w"> </span><span class="mi">16</span><span class="p">:</span><span class="mi">19</span><span class="p">:</span><span class="mi">36</span><span class="w"> </span><span class="mi">2016</span>
<span class="nx">Last</span><span class="w"> </span><span class="nx">mount</span><span class="w"> </span><span class="nx">time</span><span class="p">:</span><span class="w">          </span><span class="nx">Mon</span><span class="w"> </span><span class="nx">Nov</span><span class="w">  </span><span class="mi">6</span><span class="w"> </span><span class="mi">10</span><span class="p">:</span><span class="mi">25</span><span class="p">:</span><span class="mi">28</span><span class="w"> </span><span class="mi">2017</span>
<span class="nx">Last</span><span class="w"> </span><span class="nx">write</span><span class="w"> </span><span class="nx">time</span><span class="p">:</span><span class="w">          </span><span class="nx">Mon</span><span class="w"> </span><span class="nx">Nov</span><span class="w">  </span><span class="mi">6</span><span class="w"> </span><span class="mi">10</span><span class="p">:</span><span class="mi">25</span><span class="p">:</span><span class="mi">19</span><span class="w"> </span><span class="mi">2017</span>
<span class="nx">Mount</span><span class="w"> </span><span class="nx">count</span><span class="p">:</span><span class="w">              </span><span class="mi">432</span>
<span class="nx">Maximum</span><span class="w"> </span><span class="nx">mount</span><span class="w"> </span><span class="nx">count</span><span class="p">:</span><span class="w">      </span><span class="o">-</span><span class="mi">1</span>
<span class="nx">Last</span><span class="w"> </span><span class="nx">checked</span><span class="p">:</span><span class="w">             </span><span class="nx">Sun</span><span class="w"> </span><span class="nx">Jul</span><span class="w"> </span><span class="mi">31</span><span class="w"> </span><span class="mi">16</span><span class="p">:</span><span class="mi">19</span><span class="p">:</span><span class="mi">36</span><span class="w"> </span><span class="mi">2016</span>
<span class="nx">Check</span><span class="w"> </span><span class="nx">interval</span><span class="p">:</span><span class="w">           </span><span class="mi">0</span><span class="w"> </span><span class="p">()</span>
<span class="nx">Lifetime</span><span class="w"> </span><span class="nx">writes</span><span class="p">:</span><span class="w">          </span><span class="mi">2834</span><span class="w"> </span><span class="nx">GB</span>
<span class="nx">Reserved</span><span class="w"> </span><span class="nx">blocks</span><span class="w"> </span><span class="nx">uid</span><span class="p">:</span><span class="w">      </span><span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="nx">user</span><span class="w"> </span><span class="nx">root</span><span class="p">)</span>
<span class="nx">Reserved</span><span class="w"> </span><span class="nx">blocks</span><span class="w"> </span><span class="nx">gid</span><span class="p">:</span><span class="w">      </span><span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="nx">group</span><span class="w"> </span><span class="nx">root</span><span class="p">)</span>
<span class="nx">First</span><span class="w"> </span><span class="nx">inode</span><span class="p">:</span><span class="w">              </span><span class="mi">11</span>
<span class="nx">Inode</span><span class="w"> </span><span class="nx">size</span><span class="p">:</span><span class="w">           </span><span class="mi">256</span>
<span class="nx">Required</span><span class="w"> </span><span class="nx">extra</span><span class="w"> </span><span class="nx">isize</span><span class="p">:</span><span class="w">     </span><span class="mi">28</span>
<span class="nx">Desired</span><span class="w"> </span><span class="nx">extra</span><span class="w"> </span><span class="nx">isize</span><span class="p">:</span><span class="w">      </span><span class="mi">28</span>
<span class="nx">Journal</span><span class="w"> </span><span class="nx">inode</span><span class="p">:</span><span class="w">            </span><span class="mi">8</span>
<span class="nx">First</span><span class="w"> </span><span class="nx">orphan</span><span class="w"> </span><span class="nx">inode</span><span class="p">:</span><span class="w">       </span><span class="mi">6947324</span>
<span class="nx">Default</span><span class="w"> </span><span class="nx">directory</span><span class="w"> </span><span class="nx">hash</span><span class="p">:</span><span class="w">   </span><span class="nx">half_md4</span>
<span class="nx">Directory</span><span class="w"> </span><span class="nx">Hash</span><span class="w"> </span><span class="nx">Seed</span><span class="p">:</span><span class="w">      </span><span class="mi">9</span><span class="nx">da5dafb</span><span class="o">-</span><span class="nx">bded</span><span class="o">-</span><span class="mi">494</span><span class="nx">d</span><span class="o">-</span><span class="nx">ba7f</span><span class="o">-</span><span class="mi">5</span><span class="nx">c0ff3d9b805</span>
<span class="nx">Journal</span><span class="w"> </span><span class="nx">backup</span><span class="p">:</span><span class="w">           </span><span class="nx">inode</span><span class="w"> </span><span class="nx">blocks</span>
</code></pre></div>

<p>接下来，使用 <code>-c</code> 标识，你可以设置文件系统在挂载多少次后将进行 <code>e2fsck</code> 检查。下面这个命令指示系统每挂载 4 次之后，去对 <code>/dev/sda10</code> 运行 <code>e2fsck</code>。</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>sudo<span class="w"> </span>tune2fs<span class="w"> </span>-c<span class="w"> </span><span class="m">4</span><span class="w"> </span>/dev/sda10
tune2fs<span class="w"> </span><span class="m">1</span>.42.13<span class="w"> </span><span class="o">(</span><span class="m">17</span>-May-2015<span class="o">)</span>
Setting<span class="w"> </span>maximal<span class="w"> </span>mount<span class="w"> </span>count<span class="w"> </span>to<span class="w"> </span><span class="m">4</span>
</code></pre></div>

<p>你也可以使用 <code>-i</code> 选项定义两次文件系统检查的时间间隔。下列的命令在两次文件系统检查之间设置了一个 2 天的时间间隔。</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>sudo<span class="w"> </span>tune2fs<span class="w">  </span>-i<span class="w">  </span>2d<span class="w">  </span>/dev/sda10
tune2fs<span class="w"> </span><span class="m">1</span>.42.13<span class="w"> </span><span class="o">(</span><span class="m">17</span>-May-2015<span class="o">)</span>
Setting<span class="w"> </span>interval<span class="w"> </span>between<span class="w"> </span>checks<span class="w"> </span>to<span class="w"> </span><span class="m">172800</span><span class="w"> </span>seconds
</code></pre></div>

<p>现在，如果你运行下面的命令，你可以看到对 <code>/dev/sda10</code> 已经设置了文件系统检查的时间间隔。</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>sudo<span class="w"> </span>tune2fs<span class="w"> </span>-l<span class="w"> </span>/dev/sda10
</code></pre></div>

<p><strong>示例输出：</strong></p>
<div class="highlight"><pre><span></span><code>Filesystem created:       Sun Jul 31 16:19:36 2016
Last mount time:          Mon Nov  6 10:25:28 2017
Last write time:          Mon Nov  6 13:49:50 2017
Mount count:              432
Maximum mount count:      4
Last checked:             Sun Jul 31 16:19:36 2016
Check interval:           172800 (2 days)
Next check after:         Tue Aug  2 16:19:36 2016
Lifetime writes:          2834 GB
Reserved blocks uid:      0 (user root)
Reserved blocks gid:      0 (group root)
First inode:              11
Inode size:           256
Required extra isize:     28
Desired extra isize:      28
Journal inode:            8
First orphan inode:       6947324
Default directory hash:   half_md4
Directory Hash Seed:      9da5dafb-bded-494d-ba7f-5c0ff3d9b805
Journal backup:           inode blocks
</code></pre></div>

<p>要改变缺省的日志参数，可以使用 <code>-J</code> 选项。这个选项也有子选项： <code>size=journal-size</code> （设置日志的大小）、<code>device=external-journal</code> （指定日志存储的设备）和 <code>location=journal-location</code> （定义日志的位置）。</p>
<p>注意，这里一次仅可以为文件系统设置一个日志大小或设备选项：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>sudo<span class="w"> </span>tune2fs<span class="w"> </span>-J<span class="w"> </span><span class="nv">size</span><span class="o">=</span>4MB<span class="w"> </span>/dev/sda10
</code></pre></div>

<p>最后，同样重要的是，可以去使用 <code>-L</code> 选项设置文件系统的卷标，如下所示。</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>sudo<span class="w"> </span>tune2fs<span class="w"> </span>-L<span class="w"> </span><span class="s2">&quot;ROOT&quot;</span><span class="w"> </span>/dev/sda10
</code></pre></div>

<h3>调试 EXT2/EXT3/EXT4 文件系统</h3>
<p><code>debugfs</code> 是一个简单的、交互式的、基于 ext2/ext3/ext4 文件系统的命令行调试器。它允许你去交互式地修改文件系统参数。输入 <code>?</code> 查看子命令或请求。</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>sudo<span class="w"> </span>debugfs<span class="w"> </span>/dev/sda10
</code></pre></div>

<p>缺省情况下，文件系统将以只读模式打开，使用 <code>-w</code> 标识去以读写模式打开它。使用 <code>-c</code> 选项以灾难（catastrophic）模式打开它。</p>
<p><strong>示例输出：</strong></p>
<div class="highlight"><pre><span></span><code><span class="n">debugfs</span><span class="w"> </span><span class="mf">1.42.13</span><span class="w"> </span><span class="p">(</span><span class="mi">17</span><span class="o">-</span><span class="n">May</span><span class="o">-</span><span class="mi">2015</span><span class="p">)</span>
<span class="n">debugfs</span><span class="o">:</span><span class="w">  </span><span class="o">?</span>
<span class="n">Available</span><span class="w"> </span><span class="n">debugfs</span><span class="w"> </span><span class="n">requests</span><span class="o">:</span>
<span class="n">show_debugfs_params</span><span class="p">,</span><span class="w"> </span><span class="n">params</span>
<span class="n">Show</span><span class="w"> </span><span class="n">debugfs</span><span class="w"> </span><span class="n">parameters</span>
<span class="n">open_filesys</span><span class="p">,</span><span class="w"> </span><span class="n">open</span><span class="w">       </span><span class="n">Open</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">filesystem</span>
<span class="n">close_filesys</span><span class="p">,</span><span class="w"> </span><span class="n">close</span><span class="w">     </span><span class="n">Close</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">filesystem</span>
<span class="n">freefrag</span><span class="p">,</span><span class="w"> </span><span class="n">e2freefrag</span><span class="w">     </span><span class="n">Report</span><span class="w"> </span><span class="n">free</span><span class="w"> </span><span class="n">space</span><span class="w"> </span><span class="n">fragmentation</span>
<span class="n">feature</span><span class="p">,</span><span class="w"> </span><span class="n">features</span><span class="w">        </span><span class="nf">Set</span><span class="o">/</span><span class="n">print</span><span class="w"> </span><span class="n">superblock</span><span class="w"> </span><span class="n">features</span>
<span class="n">dirty_filesys</span><span class="p">,</span><span class="w"> </span><span class="n">dirty</span><span class="w">     </span><span class="n">Mark</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">filesystem</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="n">dirty</span>
<span class="n">init_filesys</span><span class="w">             </span><span class="n">Initialize</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">filesystem</span><span class="w"> </span><span class="p">(</span><span class="n">DESTROYS</span><span class="w"> </span><span class="n">DATA</span><span class="p">)</span>
<span class="n">show_super_stats</span><span class="p">,</span><span class="w"> </span><span class="n">stats</span><span class="w">  </span><span class="n">Show</span><span class="w"> </span><span class="n">superblock</span><span class="w"> </span><span class="n">statistics</span>
<span class="n">ncheck</span><span class="w">                   </span><span class="n">Do</span><span class="w"> </span><span class="n">inode</span><span class="o">-&gt;</span><span class="n">name</span><span class="w"> </span><span class="n">translation</span>
<span class="n">icheck</span><span class="w">                   </span><span class="n">Do</span><span class="w"> </span><span class="n">block</span><span class="o">-&gt;</span><span class="n">inode</span><span class="w"> </span><span class="n">translation</span>
<span class="n">change_root_directory</span><span class="p">,</span><span class="w"> </span><span class="n">chroot</span>
<span class="p">....</span>
</code></pre></div>

<p>要展示未使用空间的碎片，使用 <code>freefrag</code> 请求，像这样：</p>
<div class="highlight"><pre><span></span><code><span class="n">debugfs</span><span class="o">:</span><span class="w"> </span><span class="n">freefrag</span>
</code></pre></div>

<p><strong>示例输出：</strong></p>
<div class="highlight"><pre><span></span><code>Device: /dev/sda10
Blocksize: 4096 bytes
Total blocks: 86154752
Free blocks: 22387732 (26.0%)
Min. free extent: 4 KB 
Max. free extent: 2064256 KB
Avg. free extent: 2664 KB
Num. free extent: 33625
HISTOGRAM OF FREE EXTENT SIZES:
Extent Size Range :  Free extents   Free Blocks  Percent
4K...    8K-  :          4883          4883    0.02%
8K...   16K-  :          4029          9357    0.04%
16K...   32K-  :          3172         15824    0.07%
32K...   64K-  :          2523         27916    0.12%
64K...  128K-  :          2041         45142    0.20%
128K...  256K-  :          2088         95442    0.43%
256K...  512K-  :          2462        218526    0.98%
512K... 1024K-  :          3175        571055    2.55%
1M...    2M-  :          4551       1609188    7.19%
2M...    4M-  :          2870       1942177    8.68%
4M...    8M-  :          1065       1448374    6.47%
8M...   16M-  :           364        891633    3.98%
16M...   32M-  :           194        984448    4.40%
32M...   64M-  :            86        873181    3.90%
64M...  128M-  :            77       1733629    7.74%
128M...  256M-  :            11        490445    2.19%
256M...  512M-  :            10        889448    3.97%
512M... 1024M-  :             2        343904    1.54%
1G...    2G-  :            22      10217801   45.64%
debugfs:  
</code></pre></div>

<p>通过去简单浏览它所提供的简要描述，你可以试试更多的请求，比如，创建或删除文件或目录，改变当前工作目录等等。要退出 <code>debugfs</code>，使用 <code>q</code>。</p>
<p>现在就这些！我们收集了不同分类下的相关文章，你可以在里面找到对你有用的内容。</p>
<p><strong>文件系统使用信息：</strong></p>
<ol>
<li><a href="https://www.tecmint.com/how-to-check-disk-space-in-linux/">12 Useful “df” Commands to Check Disk Space in Linux</a></li>
<li><a href="https://www.tecmint.com/pyd-command-to-check-disk-usage/">Pydf an Alternative “df” Command to Check Disk Usage in Different Colours</a></li>
<li><a href="https://www.tecmint.com/check-linux-disk-usage-of-files-and-directories/">10 Useful du (Disk Usage) Commands to Find Disk Usage of Files and Directories</a></li>
</ol>
<p><strong>检查磁盘或分区健康状况：</strong></p>
<ol>
<li><a href="https://www.tecmint.com/linux-disk-scanning-tools/">3 Useful GUI and Terminal Based Linux Disk Scanning Tools</a></li>
<li><a href="https://www.tecmint.com/check-linux-hard-disk-bad-sectors-bad-blocks/">How to Check Bad Sectors or Bad Blocks on Hard Disk in Linux</a></li>
<li><a href="https://www.tecmint.com/defragment-linux-system-partitions-and-directories/">How to Repair and Defragment Linux System Partitions and Directories</a></li>
</ol>
<p>维护一个健康的文件系统可以提升你的 Linux 系统的整体性能。如果你有任何问题或更多的想法，可以使用下面的评论去分享。</p>
    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>links</h2>
                        <ul>
                            <li><a href="https://getpelican.com/">Pelican</a></li>
                            <li><a href="https://www.python.org/">Python.org</a></li>
                            <li><a href="https://palletsprojects.com/p/jinja/">Jinja2</a></li>
                            <li><a href="#">You can modify those links in your config file</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>

                            <li><a href="#">You can add links in your config file</a></li>
                            <li><a href="#">Another social link</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a rel="nofollow" href="https://getpelican.com/">Pelican</a>, which takes great advantage of <a rel="nofollow" href="https://www.python.org/">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a rel="nofollow" href="https://www.smashingmagazine.com/2009/08/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>