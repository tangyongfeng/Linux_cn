<!DOCTYPE html>
<html lang="zh">
<head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="generator" content="Pelican" />
        <title>在 Ubuntu 上安装世界上最先进的开源数据库 PostgreSQL 9.4 和 phpPgAdmin</title>
        <link rel="stylesheet" href="/theme/css/main.css" />
        <meta name="description" content="Author: SK 简介 PostgreSQL 是一款强大的，开源的，对象关系型数据库系统。它支持所有的主流操作系统，包括 Linux、Unix（AIX、BSD、HP-UX，SGI IRIX、Mac OS、Solaris、Tru64） 以 …" />
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">linux_cn</a></h1>
                <nav><ul>
                    <li><a href="/category/chuan-shan-jia-zhuan-fang">穿山甲专访</a></li>
                    <li><a href="/category/dai-ma-ying-xiong">代码英雄</a></li>
                    <li><a href="/category/fen-xiang">分享</a></li>
                    <li><a href="/category/guan-dian">观点</a></li>
                    <li><a href="/category/huo-dong">活动</a></li>
                    <li><a href="/category/ji-ke-man-hua">极客漫画</a></li>
                    <li><a href="/category/ji-zhu">技术</a></li>
                    <li><a href="/category/kai-yuan-zhi-hui">开源智慧</a></li>
                    <li><a href="/category/linux-fa-xing-ban">Linux 发行版</a></li>
                    <li><a href="/category/mei-ri-an-quan-zi-xun">每日安全资讯</a></li>
                    <li><a href="/category/misc">Misc</a></li>
                    <li><a href="/category/qu-kuai-lian">区块链</a></li>
                    <li><a href="/category/rong-qi-yu-yun">容器与云</a></li>
                    <li><a href="/category/ruan-jian-kai-fa">软件开发</a></li>
                    <li><a href="/category/shu-mei-pai">树莓派</a></li>
                    <li class="active"><a href="/category/xi-tong-yun-wei">系统运维</a></li>
                    <li><a href="/category/xin-wen">新闻</a></li>
                    <li><a href="/category/ying-he-guan-cha">硬核观察</a></li>
                    <li><a href="/category/zhi-ye-sheng-ya">职业生涯</a></li>
                    <li><a href="/category/zhong-jiang-ming-dan">中奖名单</a></li>
                    <li><a href="/category/zhuo-mian-ying-yong">桌面应用</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="/2015/12/zai-ubuntu-shang-an-zhuang-shi-jie-shang-zui-xian-jin-de-kai-yuan-shu-ju-ku-postgresql-94-he-phppgadmin.html" rel="bookmark"
           title="Permalink to 在 Ubuntu 上安装世界上最先进的开源数据库 PostgreSQL 9.4 和 phpPgAdmin">在 Ubuntu 上安装世界上最先进的开源数据库 PostgreSQL 9.4 和 phpPgAdmin</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2015-12-21T11:54:00+01:00">
                Published: Mon 21 December 2015
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/linux-fans-from-china.html">linux fans from china</a>
        </address>
<p>In <a href="/category/xi-tong-yun-wei">系统运维</a>.</p>

</footer><!-- /.post-info -->      <p>Author: SK</p>
<p><img alt="" src="/data/attachment/album/201512/21/115439lfjotemjk8fiqoq8.png"></p>
<h3>简介</h3>
<p><a href="http://www.postgresql.org/">PostgreSQL</a> 是一款强大的，开源的，对象关系型数据库系统。它支持所有的主流操作系统，包括 Linux、Unix（AIX、BSD、HP-UX，SGI IRIX、Mac OS、Solaris、Tru64） 以及 Windows 操作系统。</p>
<p>下面是 <strong>Ubuntu</strong> 发起者 <strong>Mark Shuttleworth</strong> 对 PostgreSQL 的一段评价。</p>
<blockquote>
<p>PostgreSQL 是一款极赞的数据库系统。刚开始我们在 Launchpad 上使用它的时候，并不确定它能否胜任工作。但我是错了。它很强壮、快速，在各个方面都很专业。</p>
<p>— Mark Shuttleworth.</p>
</blockquote>
<p>在这篇简短的指南中，让我们来看看如何在 Ubuntu 15.10 服务器中安装 PostgreSQL 9.4。</p>
<h3>安装 PostgreSQL</h3>
<p>默认仓库中就有可用的 PostgreSQL。在终端中输入下面的命令安装它。</p>
<div class="highlight"><pre><span></span><code>sudo apt-get install postgresql postgresql-contrib
</code></pre></div>

<p>如果你需要其它的版本，按照下面那样先添加 PostgreSQL 仓库然后再安装。</p>
<p><strong>PostgreSQL apt 仓库</strong> 支持 amd64 和 i386 架构的 Ubuntu 长期支持版（10.04、12.04 和 14.04），以及非长期支持版（14.10）。对于其它非长期支持版，该软件包虽然没有完全支持，但使用和 LTS 版本近似的也能正常工作。</p>
<h4>Ubuntu 14.10 系统：</h4>
<p>新建文件<strong>/etc/apt/sources.list.d/pgdg.list</strong>；</p>
<div class="highlight"><pre><span></span><code>sudo vi /etc/apt/sources.list.d/pgdg.list
</code></pre></div>

<p>用下面一行添加仓库：</p>
<div class="highlight"><pre><span></span><code><span class="k">deb</span><span class="w"> </span><span class="s">http://apt.postgresql.org/pub/repos/apt/</span><span class="w"> </span><span class="kp">utopic-pgdg</span><span class="w"> </span><span class="kp">main</span>
</code></pre></div>

<p><strong>注意</strong>： 上面的库只能用于 Ubuntu 14.10。还没有升级到 Ubuntu 15.04 和 15.10。</p>
<p>对于 <strong>Ubuntu 14.04</strong>，添加下面一行：</p>
<div class="highlight"><pre><span></span><code><span class="k">deb</span><span class="w"> </span><span class="s">http://apt.postgresql.org/pub/repos/apt/</span><span class="w"> </span><span class="kp">trusty-pgdg</span><span class="w"> </span><span class="kp">main</span>
</code></pre></div>

<p>对于 <strong>Ubuntu 12.04</strong>，添加下面一行：</p>
<div class="highlight"><pre><span></span><code><span class="k">deb</span><span class="w"> </span><span class="s">http://apt.postgresql.org/pub/repos/apt/</span><span class="w"> </span><span class="kp">precise-pgdg</span><span class="w"> </span><span class="kp">main</span>
</code></pre></div>

<p>导入库签名密钥：</p>
<div class="highlight"><pre><span></span><code>wget --quiet -O - https://www.postgresql.org/media/keys/ACCC4CF8.asc | sudo apt-key add -
</code></pre></div>

<p>更新软件包列表：</p>
<div class="highlight"><pre><span></span><code>sudo apt-get update
</code></pre></div>

<p>然后安装需要的版本。</p>
<div class="highlight"><pre><span></span><code>sudo apt-get install postgresql-9.4
</code></pre></div>

<h3>访问 PostgreSQL 命令窗口</h3>
<p>默认的数据库名称和数据库用户名称都是 “<strong>postgres</strong>”。切换到 postgres 用户进行 postgresql 相关的操作：</p>
<div class="highlight"><pre><span></span><code>sudo -u postgres psql postgres
</code></pre></div>

<h4>示例输出：</h4>
<div class="highlight"><pre><span></span><code><span class="nv">psql</span><span class="w"> </span><span class="ss">(</span><span class="mi">9</span>.<span class="mi">4</span>.<span class="mi">5</span><span class="ss">)</span>
<span class="nv">Type</span><span class="w"> </span><span class="s2">&quot;help&quot;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">help</span>.
<span class="nv">postgres</span><span class="o">=</span>#
</code></pre></div>

<p>要退出 postgresql 窗口，在 <strong>psql</strong> 窗口输入 <strong>\q</strong> 退出到终端。</p>
<h3>设置 “postgres” 用户密码</h3>
<p>登录到 postgresql 窗口，</p>
<div class="highlight"><pre><span></span><code>sudo -u postgres psql postgres
</code></pre></div>

<p>用下面的命令为用户 postgres 设置密码：</p>
<div class="highlight"><pre><span></span><code>postgres=# \password postgres 
Enter new password: 
Enter it again: 
postgres=# \q
</code></pre></div>

<p>要安装 PostgreSQL Adminpack 扩展，在 postgresql 窗口输入下面的命令：</p>
<div class="highlight"><pre><span></span><code>sudo -u postgres psql postgres
</code></pre></div>

<div class="highlight"><pre><span></span><code>sudo -u postgres createdb -O senthil mydb
</code></pre></div>

<h3>删除用户和数据库</h3>
<p>要删除数据库，首先切换到 postgres 用户：</p>
<div class="highlight"><pre><span></span><code>sudo -u postgres psql postgres
</code></pre></div>

<p>输入命令：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>drop<span class="w"> </span>database<span class="w"> </span>&lt;database-name&gt;
</code></pre></div>

<p>要删除一个用户，输入下面的命令：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>drop<span class="w"> </span>user<span class="w"> </span>&lt;user-name&gt;
</code></pre></div>

<h3>配置 PostgreSQL-MD5 验证</h3>
<p><strong>MD5 验证</strong> 要求用户提供一个 MD5 加密的密码用于认证。首先编辑 <strong>/etc/postgresql/9.4/main/pg_hba.conf</strong> 文件：</p>
<div class="highlight"><pre><span></span><code>sudo vi /etc/postgresql/9.4/main/pg_hba.conf
</code></pre></div>

<p>按照下面所示添加或修改行</p>
<div class="highlight"><pre><span></span><code><span class="k">[...]</span>
<span class="c1"># TYPE  DATABASE        USER            ADDRESS                 METHOD</span>
<span class="c1"># &quot;local&quot; is for Unix domain socket connections only</span>
<span class="na">local   all             all                                     md5</span>
<span class="c1"># IPv4 local connections:</span>
<span class="na">host    all             all             127.0.0.1/32            md5</span>
<span class="na">host    all             all             192.168.1.0/24          md5</span>
<span class="c1"># IPv6 local connections:</span>
<span class="na">host    all             all</span><span class="w">             </span><span class="o">:</span><span class="s">:1/128                 md5</span>
<span class="k">[...]</span>
</code></pre></div>

<p>其中， 192.168.1.0/24 是我的本地网络 IP 地址。用你自己的地址替换。</p>
<p>重启 postgresql 服务以使更改生效：</p>
<div class="highlight"><pre><span></span><code>sudo systemctl restart postgresql
</code></pre></div>

<p>或者，</p>
<div class="highlight"><pre><span></span><code>sudo service postgresql restart
</code></pre></div>

<h3>配置 PostgreSQL TCP/IP 配置</h3>
<p>默认情况下，没有启用 TCP/IP 连接，因此其它计算机的用户不能访问 postgresql。为了允许其它计算机的用户访问，编辑文件 <strong>/etc/postgresql/9.4/main/postgresql.conf:</strong></p>
<div class="highlight"><pre><span></span><code>sudo vi /etc/postgresql/9.4/main/postgresql.conf
</code></pre></div>

<p>找到下面一行：</p>
<div class="highlight"><pre><span></span><code><span class="k">[...]</span>
<span class="c1">#listen_addresses = &#39;localhost&#39;</span>
<span class="k">[...]</span>
<span class="c1">#port = 5432</span>
<span class="k">[...]</span>
</code></pre></div>

<p>取消该行的注释，然后设置你 postgresql 服务器的 IP 地址，或者设置为 ‘*’ 监听所有用户。你应该谨慎设置所有远程用户都可以访问 PostgreSQL。</p>
<div class="highlight"><pre><span></span><code><span class="k">[...]</span>
<span class="na">listen_addresses</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#39;*&#39;</span>
<span class="k">[...]</span>
<span class="na">port</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">5432</span>
<span class="k">[...]</span>
</code></pre></div>

<p>重启 postgresql 服务保存更改：</p>
<div class="highlight"><pre><span></span><code>sudo systemctl restart postgresql
</code></pre></div>

<p>或者，</p>
<div class="highlight"><pre><span></span><code>sudo service postgresql restart
</code></pre></div>

<h3>用 phpPgAdmin 管理 PostgreSQL</h3>
<p><a href="http://phppgadmin.sourceforge.net/doku.php"><strong>phpPgAdmin</strong></a> 是基于 web 用 PHP 写的 PostgreSQL 管理工具。</p>
<p>默认仓库中有可用的 phpPgAdmin。用下面的命令安装 phpPgAdmin：</p>
<div class="highlight"><pre><span></span><code>sudo apt-get install phppgadmin
</code></pre></div>

<p>默认情况下，你可以在本地系统的 web 浏览器用 <strong>http://localhost/phppgadmin</strong> 访问 phppgadmin。</p>
<p>要访问远程系统，在 Ubuntu 15.10 上做如下操作：</p>
<p>编辑文件 <strong>/etc/apache2/conf-available/phppgadmin.conf</strong>,</p>
<div class="highlight"><pre><span></span><code>sudo vi /etc/apache2/conf-available/phppgadmin.conf
</code></pre></div>

<p>找到 <strong>Require local</strong> 的一行在这行前面添加 <strong>#</strong> 注释掉它。</p>
<div class="highlight"><pre><span></span><code>#Require local
</code></pre></div>

<p>添加下面的一行：</p>
<div class="highlight"><pre><span></span><code>allow from all
</code></pre></div>

<p>保存并退出文件。</p>
<p>然后重启 apache 服务。</p>
<div class="highlight"><pre><span></span><code>sudo systemctl restart apache2
</code></pre></div>

<p>对于 Ubuntu 14.10 及之前版本：</p>
<p>编辑 <strong>/etc/apache2/conf.d/phppgadmin</strong>:</p>
<div class="highlight"><pre><span></span><code>sudo nano /etc/apache2/conf.d/phppgadmin
</code></pre></div>

<p>注释掉下面一行：</p>
<div class="highlight"><pre><span></span><code><span class="k">[...]</span>
<span class="c1">#allow from 127.0.0.0/255.0.0.0 ::1/128</span>
</code></pre></div>

<p>取消下面一行的注释使所有系统都可以访问 phppgadmin。</p>
<div class="highlight"><pre><span></span><code>allow from all
</code></pre></div>

<p>编辑 <strong>/etc/apache2/apache2.conf</strong>:</p>
<div class="highlight"><pre><span></span><code>sudo vi /etc/apache2/apache2.conf
</code></pre></div>

<p>添加下面一行：</p>
<div class="highlight"><pre><span></span><code><span class="k">Include</span><span class="w"> </span><span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">apache2</span><span class="o">/</span><span class="nv">conf</span>.<span class="nv">d</span><span class="o">/</span><span class="nv">phppgadmin</span>
</code></pre></div>

<p>然后重启 apache 服务。</p>
<div class="highlight"><pre><span></span><code>sudo service apache2 restart
</code></pre></div>

<h3>配置 phpPgAdmin</h3>
<p>编辑文件 <strong>/etc/phppgadmin/config.inc.php</strong>， 做以下更改。下面大部分选项都带有解释。认真阅读以便了解为什么要更改这些值。</p>
<div class="highlight"><pre><span></span><code>sudo nano /etc/phppgadmin/config.inc.php
</code></pre></div>

<p>找到下面一行：</p>
<div class="highlight"><pre><span></span><code>$conf[&#39;servers&#39;][0][&#39;host&#39;] = &#39;&#39;;
</code></pre></div>

<p>按照下面这样更改：</p>
<div class="highlight"><pre><span></span><code>$conf[&#39;servers&#39;][0][&#39;host&#39;] = &#39;localhost&#39;;
</code></pre></div>

<p>找到这一行：</p>
<div class="highlight"><pre><span></span><code>$conf[&#39;extra_login_security&#39;] = true;
</code></pre></div>

<p>更改值为 <strong>false</strong>。</p>
<div class="highlight"><pre><span></span><code>$conf[&#39;extra_login_security&#39;] = false;
</code></pre></div>

<p>找到这一行：</p>
<div class="highlight"><pre><span></span><code>$conf[&#39;owned_only&#39;] = false;
</code></pre></div>

<p>更改值为 <strong>true</strong>。</p>
<div class="highlight"><pre><span></span><code>$conf[&#39;owned_only&#39;] = true;
</code></pre></div>

<p>保存并关闭文件。重启 postgresql 服务和 Apache 服务。</p>
<div class="highlight"><pre><span></span><code>sudo systemctl restart postgresql

sudo systemctl restart apache2
</code></pre></div>

<p>或者，</p>
<div class="highlight"><pre><span></span><code>sudo service postgresql restart

sudo service apache2 restart
</code></pre></div>

<p>现在打开你的浏览器并导航到 <strong>http://ip-address/phppgadmin</strong>。你会看到以下截图。</p>
<p><img alt="phpPgAdmin " src="/data/attachment/album/201512/21/115440utwfg1u1kak1d717.jpg"></p>
<p>用你之前创建的用户登录。我之前已经创建了一个名为 “<strong>senthil</strong>” 的用户，密码是 “<strong>ubuntu</strong>”，因此我以 “senthil” 用户登录。</p>
<p><img alt="phpPgAdmin  " src="/data/attachment/album/201512/21/115440m44s566v6qit6w5w.jpg"></p>
<p>然后你就可以访问 phppgadmin 面板了。</p>
<p><img alt="phpPgAdmin " src="/data/attachment/album/201512/21/115441km9dd21oromlpcqm.jpg"></p>
<p>用 postgres 用户登录：</p>
<p><img alt="phpPgAdmin " src="/data/attachment/album/201512/21/115441x9ccp2leh0hlxndx.jpg"></p>
<p>就是这样。现在你可以用 phppgadmin 可视化创建、删除或者更改数据库了。</p>
<p>加油！</p>
    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>links</h2>
                        <ul>
                            <li><a href="https://getpelican.com/">Pelican</a></li>
                            <li><a href="https://www.python.org/">Python.org</a></li>
                            <li><a href="https://palletsprojects.com/p/jinja/">Jinja2</a></li>
                            <li><a href="#">You can modify those links in your config file</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>

                            <li><a href="#">You can add links in your config file</a></li>
                            <li><a href="#">Another social link</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a rel="nofollow" href="https://getpelican.com/">Pelican</a>, which takes great advantage of <a rel="nofollow" href="https://www.python.org/">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a rel="nofollow" href="https://www.smashingmagazine.com/2009/08/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>