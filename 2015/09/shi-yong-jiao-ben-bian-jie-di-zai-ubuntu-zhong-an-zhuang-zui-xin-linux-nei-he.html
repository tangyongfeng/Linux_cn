<!DOCTYPE html>
<html lang="zh">
<head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="generator" content="Pelican" />
        <title>使用脚本便捷地在 Ubuntu 中安装最新 Linux 内核</title>
        <link rel="stylesheet" href="/theme/css/main.css" />
        <meta name="description" content="Author: Ji m 想要安装最新的Linux内核吗？一个简单的脚本就可以在Ubuntu系统中方便的完成这项工作。 Michael Murphy 写了一个脚本用来将最新的候选版、标准版、或者低延时版的 …" />
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">linux_cn</a></h1>
                <nav><ul>
                    <li><a href="/category/chuan-shan-jia-zhuan-fang">穿山甲专访</a></li>
                    <li><a href="/category/dai-ma-ying-xiong">代码英雄</a></li>
                    <li><a href="/category/fen-xiang">分享</a></li>
                    <li><a href="/category/guan-dian">观点</a></li>
                    <li><a href="/category/huo-dong">活动</a></li>
                    <li><a href="/category/ji-ke-man-hua">极客漫画</a></li>
                    <li class="active"><a href="/category/ji-zhu">技术</a></li>
                    <li><a href="/category/kai-yuan-zhi-hui">开源智慧</a></li>
                    <li><a href="/category/linux-fa-xing-ban">Linux 发行版</a></li>
                    <li><a href="/category/mei-ri-an-quan-zi-xun">每日安全资讯</a></li>
                    <li><a href="/category/misc">Misc</a></li>
                    <li><a href="/category/qu-kuai-lian">区块链</a></li>
                    <li><a href="/category/rong-qi-yu-yun">容器与云</a></li>
                    <li><a href="/category/ruan-jian-kai-fa">软件开发</a></li>
                    <li><a href="/category/shu-mei-pai">树莓派</a></li>
                    <li><a href="/category/xi-tong-yun-wei">系统运维</a></li>
                    <li><a href="/category/xin-wen">新闻</a></li>
                    <li><a href="/category/ying-he-guan-cha">硬核观察</a></li>
                    <li><a href="/category/zhi-ye-sheng-ya">职业生涯</a></li>
                    <li><a href="/category/zhong-jiang-ming-dan">中奖名单</a></li>
                    <li><a href="/category/zhuo-mian-ying-yong">桌面应用</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="/2015/09/shi-yong-jiao-ben-bian-jie-di-zai-ubuntu-zhong-an-zhuang-zui-xin-linux-nei-he.html" rel="bookmark"
           title="Permalink to 使用脚本便捷地在 Ubuntu 中安装最新 Linux 内核">使用脚本便捷地在 Ubuntu 中安装最新 Linux 内核</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2015-09-15T10:36:00+02:00">
                Published: Tue 15 September 2015
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/linux-fans-from-china.html">linux fans from china</a>
        </address>
<p>In <a href="/category/ji-zhu">技术</a>.</p>

</footer><!-- /.post-info -->      <p>Author: Ji m</p>
<p><img alt="" src="/data/attachment/album/201509/14/233726upxtb524hpwbza2p.png"></p>
<p>想要安装最新的Linux内核吗？一个简单的脚本就可以在Ubuntu系统中方便的完成这项工作。</p>
<p>Michael Murphy 写了一个脚本用来将最新的候选版、标准版、或者低延时版的内核安装到 Ubuntu 系统中。这个脚本会在询问一些问题后从 <a href="http://kernel.ubuntu.com/%7Ekernel-ppa/mainline/">Ubuntu 内核主线页面</a> 下载安装最新的 Linux 内核包。</p>
<h3>通过脚本来安装、升级Linux内核:</h3>
<p>1、 点击这个 <a href="https://gist.github.com/mmstick/8493727">github 页面</a> 右上角的 “Download Zip” 来下载该脚本（注：此脚本在墙外，我已经搬运回来了，请参见下面。）。</p>
<p>2、鼠标右键单击用户下载目录下的 Zip 文件，选择 “在此展开” 将其解压。</p>
<p>3、右键点击解压后的文件夹，选择 “在终端中打开” 到此文件夹下。</p>
<p><img alt="" src="/data/attachment/album/201509/14/233727wx63yw3ze8403y0j.jpg"></p>
<p>此时将会打开一个终端，并且自动导航到目标文件夹下。如果你找不到 “在终端中打开” 选项的话，在 Ubuntu 软件中心搜索安装 <code>nautilus-open-terminal</code> ，然后重新登录系统即可（也可以再终端中运行 <code>nautilus -q</code> 来取代重新登录系统的操作）。</p>
<p>备注：此脚本如下，你可以将它保存为一个可执行的 shell 脚本：</p>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>
<span class="nb">cd</span><span class="w"> </span>/tmp

<span class="k">if</span><span class="w"> </span>!<span class="w"> </span>which<span class="w"> </span>lynx<span class="w"> </span>&gt;<span class="w"> </span>/dev/null<span class="p">;</span><span class="w"> </span><span class="k">then</span><span class="w"> </span>sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>lynx<span class="w"> </span>-y<span class="p">;</span><span class="w"> </span><span class="k">fi</span>

<span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="s2">&quot;</span><span class="k">$(</span>getconf<span class="w"> </span>LONG_BIT<span class="k">)</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;64&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="nv">arch</span><span class="o">=</span>amd64<span class="p">;</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="nv">arch</span><span class="o">=</span>i386<span class="p">;</span><span class="w"> </span><span class="k">fi</span>

<span class="k">function</span><span class="w"> </span>download<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">   </span>wget<span class="w"> </span><span class="k">$(</span>lynx<span class="w"> </span>-dump<span class="w"> </span>-listonly<span class="w"> </span>-dont-wrap-pre<span class="w"> </span><span class="nv">$kernelURL</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$2</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$arch</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>cut<span class="w"> </span>-d<span class="w"> </span><span class="s1">&#39; &#39;</span><span class="w"> </span>-f<span class="w"> </span><span class="m">4</span><span class="k">)</span>
<span class="o">}</span>

<span class="c1"># Kernel URL</span>
<span class="nb">read</span><span class="w"> </span>-p<span class="w"> </span><span class="s2">&quot;Do you want the latest RC?&quot;</span><span class="w"> </span>rc
<span class="k">case</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$rc</span><span class="s2">&quot;</span><span class="w"> </span><span class="k">in</span>
<span class="w">   </span>y*<span class="w"> </span><span class="p">|</span><span class="w"> </span>Y*<span class="o">)</span><span class="w"> </span><span class="nv">kernelURL</span><span class="o">=</span><span class="k">$(</span>lynx<span class="w"> </span>-dump<span class="w"> </span>-nonumbers<span class="w"> </span>http://kernel.ubuntu.com/~kernel-ppa/mainline/<span class="w"> </span><span class="p">|</span><span class="w"> </span>tail<span class="w"> </span>-1<span class="k">)</span><span class="w"> </span><span class="p">;;</span>
<span class="w">   </span>n*<span class="w"> </span><span class="p">|</span><span class="w"> </span>N*<span class="o">)</span><span class="w"> </span><span class="nv">kernelURL</span><span class="o">=</span><span class="k">$(</span>lynx<span class="w"> </span>-dump<span class="w"> </span>-nonumbers<span class="w"> </span>http://kernel.ubuntu.com/~kernel-ppa/mainline/<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-v<span class="w"> </span>rc<span class="w"> </span><span class="p">|</span><span class="w"> </span>tail<span class="w"> </span>-1<span class="k">)</span><span class="w"> </span><span class="p">;;</span>
<span class="w">   </span>*<span class="o">)</span><span class="w"> </span><span class="nb">exit</span><span class="w"> </span><span class="p">;;</span>
<span class="k">esac</span>

<span class="nb">read</span><span class="w"> </span>-p<span class="w"> </span><span class="s2">&quot;Do you want the lowlatency kernel?&quot;</span><span class="w"> </span>lowlatency
<span class="k">case</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$lowlatency</span><span class="s2">&quot;</span><span class="w"> </span><span class="k">in</span>
<span class="w">   </span>y*<span class="w"> </span><span class="p">|</span><span class="w"> </span>Y*<span class="o">)</span><span class="w"> </span><span class="nv">lowlatency</span><span class="o">=</span><span class="m">1</span><span class="w"> </span><span class="p">;;</span>
<span class="w">   </span>n*<span class="w"> </span><span class="p">|</span><span class="w"> </span>n*<span class="o">)</span><span class="w"> </span><span class="nv">lowlatency</span><span class="o">=</span><span class="m">0</span><span class="w"> </span><span class="p">;;</span>
<span class="w">   </span>*<span class="o">)</span><span class="w"> </span><span class="nb">exit</span><span class="w"> </span><span class="p">;;</span>
<span class="k">esac</span>

<span class="c1"># Download Kernel</span>
<span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$lowlatency</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;0&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">   </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Downloading the latest generic kernel.&quot;</span>
<span class="w">   </span>download<span class="w"> </span>generic<span class="w"> </span>header
<span class="w">   </span>download<span class="w"> </span>generic<span class="w"> </span>image
<span class="k">elif</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$lowlatency</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;1&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">   </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Downloading the latest lowlatency kernel.&quot;</span>
<span class="w">   </span>download<span class="w"> </span>lowlatency<span class="w"> </span>header
<span class="w">   </span>download<span class="w"> </span>lowlatency<span class="w"> </span>image
<span class="k">fi</span>

<span class="c1"># Shared Kernel Header</span>
wget<span class="w"> </span><span class="k">$(</span>lynx<span class="w"> </span>-dump<span class="w"> </span>-listonly<span class="w"> </span>-dont-wrap-pre<span class="w"> </span><span class="nv">$kernelURL</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>all<span class="w"> </span><span class="p">|</span><span class="w"> </span>cut<span class="w"> </span>-d<span class="w"> </span><span class="s1">&#39; &#39;</span><span class="w"> </span>-f<span class="w"> </span><span class="m">4</span><span class="k">)</span>

<span class="c1"># Install Kernel</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Installing Linux Kernel&quot;</span>
sudo<span class="w"> </span>dpkg<span class="w"> </span>-i<span class="w"> </span>linux*.deb
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Done. You may now reboot.&quot;</span>
</code></pre></div>

<ol>
<li>当进入终端后，运行以下命令来赋予脚本执行本次操作的权限。</li>
</ol>
<div class="highlight"><pre><span></span><code>chmod +x *
</code></pre></div>

<p>最后，每当你想要安装或升级 Ubuntu 的 linux 内核时都可以运行此脚本。</p>
<div class="highlight"><pre><span></span><code>./*
</code></pre></div>

<p><img alt="" src="/data/attachment/album/201509/14/233729a1gi948vf1naaux4.jpg"></p>
<p>这里之所以使用 * 替代脚本名称是因为文件夹中只有它一个文件。</p>
<p>如果脚本运行成功，重启电脑即可。</p>
<h3>恢复并且卸载新版内核</h3>
<p>如果因为某些原因要恢复并且移除新版内核的话，请重启电脑，在 Grub 启动器的 <strong>高级选项</strong> 菜单下选择旧版内核来启动系统。</p>
<p>当系统启动后，参照下边章节继续执行。</p>
<h3>如何移除旧的（或新的）内核:</h3>
<ol>
<li>从 Ubuntu 软件中心安装 Synaptic Package Manager。</li>
<li>
<p>打开 Synaptic Package Manager 然后如下操作:</p>
</li>
<li>
<p>点击 <strong>Reload</strong> 按钮，让想要被删除的新内核显示出来.</p>
</li>
<li>在左侧面板中选择 <strong>Status -&gt; Installed</strong> ，让查找列表更清晰一些。</li>
<li>在 Quick filter 输入框中输入 <strong>linux-image-</strong> 用于查询。</li>
<li>选择一个内核镜像 “linux-image-x.xx.xx-generic” 然后将其标记为removal（或者Complete Removal）</li>
<li>最后，应用变更</li>
</ol>
<p><img alt="" src="/data/attachment/album/201509/14/233733apkb1dwbp77bbb5e.jpg"></p>
<p>重复以上操作直到移除所有你不需要的内核。注意，不要随意移除此刻正在运行的内核，你可以通过 <code>uname -r</code> 命令来查看运行的内核。</p>
<p>对于 Ubuntu 服务器来说，你可以一步步运行下面的命令：</p>
<div class="highlight"><pre><span></span><code>uname -r

dpkg -l | grep linux-image-

sudo apt-get autoremove KERNEL_IMAGE_NAME
</code></pre></div>

<p><img alt="" src="/data/attachment/album/201509/14/233736wb7ldfgsf73dekmi.jpg"></p>
    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>links</h2>
                        <ul>
                            <li><a href="https://getpelican.com/">Pelican</a></li>
                            <li><a href="https://www.python.org/">Python.org</a></li>
                            <li><a href="https://palletsprojects.com/p/jinja/">Jinja2</a></li>
                            <li><a href="#">You can modify those links in your config file</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>

                            <li><a href="#">You can add links in your config file</a></li>
                            <li><a href="#">Another social link</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a rel="nofollow" href="https://getpelican.com/">Pelican</a>, which takes great advantage of <a rel="nofollow" href="https://www.python.org/">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a rel="nofollow" href="https://www.smashingmagazine.com/2009/08/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>