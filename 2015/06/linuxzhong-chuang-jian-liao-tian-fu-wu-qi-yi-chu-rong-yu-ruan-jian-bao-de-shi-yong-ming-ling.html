<!DOCTYPE html>
<html lang="zh">
<head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="generator" content="Pelican" />
        <title>Linux中，创建聊天服务器、移除冗余软件包的实用命令</title>
        <link rel="stylesheet" href="/theme/css/main.css" />
        <meta name="description" content="Author: Avishek Kumar 这里,我们来看Linux命令行实用技巧的下一个部分。如果你错过了Linux Tracks之前的文章，可以从这里找到。 5个有趣的Linux命令行技巧 本篇中，我们将会介绍6个命令行小技巧，包括使用Netcat命令创建Linux命令行聊天，从某个命令的输出中 …" />
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">linux_cn</a></h1>
                <nav><ul>
                    <li><a href="/category/chuan-shan-jia-zhuan-fang">穿山甲专访</a></li>
                    <li><a href="/category/dai-ma-ying-xiong">代码英雄</a></li>
                    <li><a href="/category/fen-xiang">分享</a></li>
                    <li><a href="/category/guan-dian">观点</a></li>
                    <li><a href="/category/huo-dong">活动</a></li>
                    <li><a href="/category/ji-ke-man-hua">极客漫画</a></li>
                    <li class="active"><a href="/category/ji-zhu">技术</a></li>
                    <li><a href="/category/kai-yuan-zhi-hui">开源智慧</a></li>
                    <li><a href="/category/linux-fa-xing-ban">Linux 发行版</a></li>
                    <li><a href="/category/mei-ri-an-quan-zi-xun">每日安全资讯</a></li>
                    <li><a href="/category/misc">Misc</a></li>
                    <li><a href="/category/qu-kuai-lian">区块链</a></li>
                    <li><a href="/category/rong-qi-yu-yun">容器与云</a></li>
                    <li><a href="/category/ruan-jian-kai-fa">软件开发</a></li>
                    <li><a href="/category/shu-mei-pai">树莓派</a></li>
                    <li><a href="/category/xi-tong-yun-wei">系统运维</a></li>
                    <li><a href="/category/xin-wen">新闻</a></li>
                    <li><a href="/category/ying-he-guan-cha">硬核观察</a></li>
                    <li><a href="/category/zhi-ye-sheng-ya">职业生涯</a></li>
                    <li><a href="/category/zhong-jiang-ming-dan">中奖名单</a></li>
                    <li><a href="/category/zhuo-mian-ying-yong">桌面应用</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="/2015/06/linuxzhong-chuang-jian-liao-tian-fu-wu-qi-yi-chu-rong-yu-ruan-jian-bao-de-shi-yong-ming-ling.html" rel="bookmark"
           title="Permalink to Linux中，创建聊天服务器、移除冗余软件包的实用命令">Linux中，创建聊天服务器、移除冗余软件包的实用命令</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2015-06-17T10:21:37+02:00">
                Published: Wed 17 June 2015
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/linux-fans-from-china.html">linux fans from china</a>
        </address>
<p>In <a href="/category/ji-zhu">技术</a>.</p>

</footer><!-- /.post-info -->      <p>Author: Avishek Kumar</p>
<p>这里,我们来看Linux命令行实用技巧的下一个部分。如果你错过了Linux Tracks之前的文章，可以从这里找到。</p>
<ul>
<li><a href="/article-5485-1.html">5个有趣的Linux命令行技巧</a></li>
</ul>
<p>本篇中，我们将会介绍6个命令行小技巧，包括使用Netcat命令创建Linux命令行聊天，从某个命令的输出中对某一列做加法，移除Debian和CentOS上多余的包，从命令行中获取本地与远程的IP地址，在终端获得彩色的输出与解码各样的颜色，最后是Linux命令行里井号标签的使用。让我们来一个一个地看一下。</p>
<p><img alt="Linux Commandline Chat Server" src="/data/attachment/album/201506/17/102140dthy392tqz9thu9t.jpg"></p>
<p><em>6个实用的命令行技巧</em></p>
<h3>1. 创建Linux命令行聊天服务</h3>
<p>我们大家使用聊天服务都有很长一段时间了。对于Google Chat，Hangout，Facebook Chat，Whatsapp，Hike和其他一些应用与集成的聊天服务，我们都很熟悉了。那你知道Linux的nc命令可以使你的Linux机器变成一个聊天服务器，而仅仅只需要一行命令吗。什么是nc命令，它又是怎么工作的呢？</p>
<p>nc即Linux netcat命令。nc就像瑞士军刀一样，内建了大量的功能。nc可用做调式工具，调查工具，使用TCP/UDP读写网络连接，DNS正向/反向查询等等。</p>
<p>nc主要用在端口扫描，文件传输，后台和端口监听。nc可以使用任何闲置的端口和任何本地网络源地址。</p>
<p>使用nc命令（在192.168.0.7的服务器上）创建一个命令行即时信息传输服务器。</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>nc<span class="w"> </span>-l<span class="w"> </span>-vv<span class="w"> </span>-p<span class="w"> </span><span class="m">11119</span>
</code></pre></div>

<p>对上述命令的解释。</p>
<ul>
<li>-v : 显示冗余信息</li>
<li>-vv : 显示更多的冗余信息</li>
<li>-p : 本地端口号</li>
</ul>
<p>你可以用任何其他的本地端口号替换11119。</p>
<p>接下来在客户端机器（IP地址：192.168.0.15），运行下面的命令初始化聊天会话（这里需要上面提到的信息服务器正在运行）。</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>nc<span class="w"> </span><span class="m">192</span>.168.0.7:11119
</code></pre></div>

<p><img alt="Linux Commandline Chat with nc Command" src="/data/attachment/album/201506/17/102146jl23txdd73l3cvxx.gif"></p>
<p><strong>注意</strong>：你可以按下ctrl+c终止会话，同时nc聊天是一个一对一的服务。</p>
<h3>2. Linux中如何统计某一列的总值</h3>
<p>如何在终端里统计某个命令的输出中其中一列的数值总和，</p>
<p>‘ls -l’命令的输出。</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>ls<span class="w"> </span>-l
</code></pre></div>

<p><img alt="Sum Numerical Values" src="/data/attachment/album/201506/17/102150tn1ad88zd9d1agnc.gif"></p>
<p>注意到第二列代表软连接的数量，第五列则是文件的大小。假设我们需要汇总第五列的数值。</p>
<p>仅仅列出第五列的内容。我们会使用‘awk’命令做到这点。‘$5’即代表第五列。</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>ls<span class="w"> </span>-l<span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">&#39;{print $5}&#39;</span>
</code></pre></div>

<p><img alt="List Content Column" src="/data/attachment/album/201506/17/102152g44q5wuumoxquz5z.gif"></p>
<p>现在，通过管道连接，使用awk打印出第五列数值的总和。</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>ls<span class="w"> </span>-l<span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">&#39;{print $5}&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">&#39;{total = total + $1}END{print total}&#39;</span>
</code></pre></div>

<p><img alt="Sum and Print Columns" src="/data/attachment/album/201506/17/102153f452n5i9u22n24lv.gif"></p>
<h3>在Linux里如何移除废弃包</h3>
<p>废弃包是指那些作为其他包的依赖而被安装，但是当源包被移除之后就不再需要的包。</p>
<p>假设我们安装了一个叫gtprogram的软件包，其依赖是gtdependency。除非我们安装了gtdependency，否则安装不了gtprogram。</p>
<p>当我们移除gtprogram的时候，默认并不会移除gtdependency。并且如果我们不移除gtdependency的话，它就会遗留下来成为废弃包，与其他任何包再无联系。</p>
<div class="highlight"><pre><span></span><code># yum autoremove                [On RedHat Systems]
</code></pre></div>

<p><img alt="Remove Orphan Packages in CentOS" src="/data/attachment/album/201506/17/102213z73e7l203d0k32tt.gif"></p>
<div class="highlight"><pre><span></span><code># apt-get autoremove                [On Debian Systems]
</code></pre></div>

<p><img alt="Remove Orphan Packages in Debian" src="/data/attachment/album/201506/17/102215cwiroymqw04l5z5l.gif"></p>
<p>你应该经常移除废弃包，保持Linux机器仅仅加载一些需要的东西。</p>
<h3>4. 如何获得Linux服务器本地的与公网的IP地址</h3>
<p>为了获得本地IP地址，运行下面的一行脚本。</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>ifconfig<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s2">&quot;inet addr:&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">&#39;{print $2}&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-v<span class="w"> </span><span class="s1">&#39;127.0.0.1&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>cut<span class="w"> </span>-f2<span class="w"> </span>-d:
</code></pre></div>

<p>你必须安装了ifconfig，如果没有，使用apt或者yum工具安装需要的包。这里我们将会管道连接ifconfig的输出，并且结合grep命令找到包含“intel addr：”的字符串。</p>
<p>我们知道对于输出本地IP地址，ifconfig命令足够用了。但是ifconfig生成了许多的输出，而我们关注的地方仅仅是本地IP地址，不是其他的。</p>
<div class="highlight"><pre><span></span><code><span class="err">#</span><span class="w"> </span><span class="nx">ifconfig</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nx">grep</span><span class="w"> </span><span class="s">&quot;inet addr:&quot;</span>
</code></pre></div>

<p><img alt="Check Local IP Address" src="/data/attachment/album/201506/17/102217mmp5xqm5pbqzm0jf.gif"></p>
<p>尽管目前的输出好多了，但是我们需要过滤出本地的IP地址，不含其他东西。针对这个，我们将会使用awk打印出第二列输出，通过管道连接上述的脚本。</p>
<div class="highlight"><pre><span></span><code><span class="err">#</span><span class="w"> </span><span class="nx">ifconfig</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nx">grep</span><span class="w"> </span><span class="err">“</span><span class="nx">inet</span><span class="w"> </span><span class="kd">addr</span><span class="p">:</span><span class="err">”</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nx">awk</span><span class="w"> </span><span class="err">&#39;</span><span class="p">{</span><span class="nx">print</span><span class="w"> </span><span class="err">$</span><span class="mi">2</span><span class="p">}</span><span class="err">&#39;</span><span class="w"> </span>
</code></pre></div>

<p><img alt="Filter Only IP Address" src="/data/attachment/album/201506/17/102218hzz0dacv02x28yo8.gif"></p>
<p>上面图片清楚的表示，我们已经很大程度上自定义了输出，当仍然不是我们想要的。本地环路地址 127.0.0.1 仍然在结果中。</p>
<p>我们可以使用grep的-v选项，这样会打印出不匹配给定参数的其他行。每个机器都有同样的环路地址 127.0.0.1，所以使用grep -v打印出不包含127.0.0.1的行，通过管道连接前面的脚本。</p>
<div class="highlight"><pre><span></span><code><span class="err">#</span><span class="w"> </span><span class="nx">ifconfig</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nx">grep</span><span class="w"> </span><span class="s">&quot;inet addr&quot;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nx">awk</span><span class="w"> </span><span class="err">&#39;</span><span class="p">{</span><span class="nx">print</span><span class="w"> </span><span class="err">$</span><span class="mi">2</span><span class="p">}</span><span class="err">&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nx">grep</span><span class="w"> </span><span class="o">-</span><span class="nx">v</span><span class="w"> </span><span class="err">&#39;</span><span class="m m-Double">127.0.0.1</span><span class="err">&#39;</span>
</code></pre></div>

<p><img alt="Print IP Address" src="/data/attachment/album/201506/17/102219qbt9cc5ntgjh7ttc.gif"></p>
<p>我们差不多得到想要的输出了，仅仅需要从开头替换掉字符串<code>(addr:)</code>。我们将会使用cut命令单独打印出第二列。一二列之间并不是用tab分割，而是<code>(:)</code>，所以我们需要使用到域分割符选项<code>(-d)</code>，通过管道连接上面的输出。</p>
<div class="highlight"><pre><span></span><code><span class="err">#</span><span class="w"> </span><span class="nx">ifconfig</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nx">grep</span><span class="w"> </span><span class="s">&quot;inet addr:&quot;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nx">awk</span><span class="w"> </span><span class="err">&#39;</span><span class="p">{</span><span class="nx">print</span><span class="w"> </span><span class="err">$</span><span class="mi">2</span><span class="p">}</span><span class="err">&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nx">grep</span><span class="w"> </span><span class="o">-</span><span class="nx">v</span><span class="w"> </span><span class="err">&#39;</span><span class="m m-Double">127.0.0.1</span><span class="err">&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nx">cut</span><span class="w"> </span><span class="o">-</span><span class="nx">f2</span><span class="w"> </span><span class="o">-</span><span class="nx">d</span><span class="p">:</span>
</code></pre></div>

<p><img alt="Customized IP Address" src="/data/attachment/album/201506/17/102221sowoh2kxww24odbd.gif"></p>
<p>最后！期望的结果出来了。</p>
<h3>5.如何在Linux终端彩色输出</h3>
<p>你可能在终端看见过彩色的输出。同时你也可能知道在终端里允许/禁用彩色输出。如果都不知道的话，你可以参考下面的步骤。</p>
<p>在Linux中，每个用户都有<code>'.bashrc'</code>文件，被用来管理你的终端输出。打开并且编辑该文件，用你喜欢的编辑器。注意一下，这个文件是隐藏的（文件开头为点的代表隐藏文件）。</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>vi<span class="w"> </span>/home/<span class="nv">$USER</span>/.bashrc
</code></pre></div>

<p>确保以下的行没有被注释掉。即，行开头没有#。</p>
<div class="highlight"><pre><span></span><code><span class="k">if</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="o">-</span><span class="nv">x</span><span class="w"> </span><span class="o">/</span><span class="nv">usr</span><span class="o">/</span><span class="nv">bin</span><span class="o">/</span><span class="nv">dircolors</span><span class="w"> </span><span class="p">];</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span><span class="nv">test</span><span class="w"> </span><span class="o">-</span><span class="nv">r</span><span class="w"> </span>~<span class="o">/.</span><span class="nv">dircolors</span><span class="w"> </span>&amp;&amp;<span class="w"> </span><span class="nv">eval</span><span class="w"> </span><span class="s">&quot;$(dircolors -b ~/.dircolors)&quot;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nv">eval</span><span class="w"> </span>&quot;<span class="p">$(</span><span class="nv">dirc</span><span class="p">$</span>
<span class="w">    </span><span class="nv">alias</span><span class="w"> </span><span class="nv">ls</span><span class="o">=&#39;</span><span class="nv">ls</span><span class="w"> </span><span class="o">--</span><span class="nv">color</span><span class="o">=</span><span class="nv">auto</span><span class="o">&#39;</span>
<span class="w">    </span><span class="o">#</span><span class="nv">alias</span><span class="w"> </span><span class="nv">dir</span><span class="o">=&#39;</span><span class="nv">dir</span><span class="w"> </span><span class="o">--</span><span class="nv">color</span><span class="o">=</span><span class="nv">auto</span><span class="o">&#39;</span>
<span class="w">    </span><span class="o">#</span><span class="nv">alias</span><span class="w"> </span><span class="nv">vdir</span><span class="o">=&#39;</span><span class="nv">vdir</span><span class="w"> </span><span class="o">--</span><span class="nv">color</span><span class="o">=</span><span class="nv">auto</span><span class="o">&#39;</span>

<span class="w">    </span><span class="nv">alias</span><span class="w"> </span><span class="nv">grep</span><span class="o">=&#39;</span><span class="nv">grep</span><span class="w"> </span><span class="o">--</span><span class="nv">color</span><span class="o">=</span><span class="nv">auto</span><span class="o">&#39;</span>
<span class="w">    </span><span class="nv">alias</span><span class="w"> </span><span class="nv">fgrep</span><span class="o">=&#39;</span><span class="nv">fgrep</span><span class="w"> </span><span class="o">--</span><span class="nv">color</span><span class="o">=</span><span class="nv">auto</span><span class="o">&#39;</span>
<span class="w">    </span><span class="nv">alias</span><span class="w"> </span><span class="nv">egrep</span><span class="o">=&#39;</span><span class="nv">egrep</span><span class="w"> </span><span class="o">--</span><span class="nv">color</span><span class="o">=</span><span class="nv">auto</span><span class="o">&#39;</span>
<span class="nv">fi</span>
</code></pre></div>

<p><img alt="User .bashrc File" src="/data/attachment/album/201506/17/102222rzy77wp6jwubuh7t.gif"></p>
<p>完成后！保存并退出。为了让改动生效，需要注销账户后再次登录。</p>
<p>现在，你会看见列出的文件和文件夹名字有着不同的颜色，根据文件类型来决定。要了解所用的颜色代码，可以运行下面的命令。</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>dircolors<span class="w"> </span>-p<span class="w"> </span><span class="p">|</span><span class="w"> </span>less
</code></pre></div>

<p><img alt="Linux Color Output" src="/data/attachment/album/201506/17/102324fl0ot100ca5t7ctt.gif"></p>
<h3>6.如何用#号标记Linux命令和脚本</h3>
<p>我们一直在Twitter，Facebook和Google Plus（可能是其他我们没有提到的地方）上使用#号标签。那些#号标签使得其他人搜索一个标签更加容易。可是很少人知道，我们可以在Linux命令行使用#号标签。</p>
<p>我们已经知道配置文件里的<code>#</code>，在大多数的编程语言中，这个符号被用作注释行，即不被执行。</p>
<p>运行一个命令，然后为这个命令创建一个#号标签，这样之后我们就可以找到它。假设我们有一个很长的脚本，就上面第四点被执行的命令。现在为它创建一个#号标签。我们知道ifconfig可以被sudo或者root执行，因此用root来执行。</p>
<div class="highlight"><pre><span></span><code><span class="err">#</span><span class="w"> </span><span class="nx">ifconfig</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nx">grep</span><span class="w"> </span><span class="s">&quot;inet addr:&quot;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nx">awk</span><span class="w"> </span><span class="err">&#39;</span><span class="p">{</span><span class="nx">print</span><span class="w"> </span><span class="err">$</span><span class="mi">2</span><span class="p">}</span><span class="err">&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nx">grep</span><span class="w"> </span><span class="o">-</span><span class="nx">v</span><span class="w"> </span><span class="err">&#39;</span><span class="m m-Double">127.0.0.1</span><span class="err">&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nx">cut</span><span class="w"> </span><span class="o">-</span><span class="nx">f2</span><span class="w"> </span><span class="o">-</span><span class="nx">d</span><span class="p">:</span><span class="w"> </span><span class="err">#</span><span class="nx">myip</span>
</code></pre></div>

<p>上述脚本被’myip‘给标记了。现在在reverse-i-search（按下ctrl+r）搜索一下这个标签，在终端里，并输入’myip‘。你可以从这里开始执行。</p>
<p><img alt="Create Command Hash Tags" src="/data/attachment/album/201506/17/102325u8x57i5e7ks87xex.gif"></p>
<p>你可以为每个命令创建#号标签，之后使用reverse-i-search找到它。</p>
<p>目前就这么多了。我们一直在辛苦的工作，创造有趣的，有知识性的内容给你。你觉得我们是如何工作的呢？欢迎咨询任何问题。你可以在下面评论。保持联络！Kudox。</p>
    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>links</h2>
                        <ul>
                            <li><a href="https://getpelican.com/">Pelican</a></li>
                            <li><a href="https://www.python.org/">Python.org</a></li>
                            <li><a href="https://palletsprojects.com/p/jinja/">Jinja2</a></li>
                            <li><a href="#">You can modify those links in your config file</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>

                            <li><a href="#">You can add links in your config file</a></li>
                            <li><a href="#">Another social link</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a rel="nofollow" href="https://getpelican.com/">Pelican</a>, which takes great advantage of <a rel="nofollow" href="https://www.python.org/">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a rel="nofollow" href="https://www.smashingmagazine.com/2009/08/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>