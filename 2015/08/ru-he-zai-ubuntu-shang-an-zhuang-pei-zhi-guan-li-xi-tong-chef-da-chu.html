<!DOCTYPE html>
<html lang="zh">
<head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="generator" content="Pelican" />
        <title>如何在 Ubuntu 上安装配置管理系统 Chef （大厨）</title>
        <link rel="stylesheet" href="/theme/css/main.css" />
        <meta name="description" content="Author: Kashif Siddique Chef是面对IT专业人员的一款配置管理和自动化工具，它可以配置和管理你的基础设施（设备），无论它在本地还是在云上。它可以用于加速应用部署并协调多 …" />
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">linux_cn</a></h1>
                <nav><ul>
                    <li><a href="/category/chuan-shan-jia-zhuan-fang">穿山甲专访</a></li>
                    <li><a href="/category/dai-ma-ying-xiong">代码英雄</a></li>
                    <li><a href="/category/fen-xiang">分享</a></li>
                    <li><a href="/category/guan-dian">观点</a></li>
                    <li><a href="/category/huo-dong">活动</a></li>
                    <li><a href="/category/ji-ke-man-hua">极客漫画</a></li>
                    <li><a href="/category/ji-zhu">技术</a></li>
                    <li><a href="/category/kai-yuan-zhi-hui">开源智慧</a></li>
                    <li><a href="/category/linux-fa-xing-ban">Linux 发行版</a></li>
                    <li><a href="/category/mei-ri-an-quan-zi-xun">每日安全资讯</a></li>
                    <li><a href="/category/misc">Misc</a></li>
                    <li><a href="/category/qu-kuai-lian">区块链</a></li>
                    <li><a href="/category/rong-qi-yu-yun">容器与云</a></li>
                    <li><a href="/category/ruan-jian-kai-fa">软件开发</a></li>
                    <li><a href="/category/shu-mei-pai">树莓派</a></li>
                    <li class="active"><a href="/category/xi-tong-yun-wei">系统运维</a></li>
                    <li><a href="/category/xin-wen">新闻</a></li>
                    <li><a href="/category/ying-he-guan-cha">硬核观察</a></li>
                    <li><a href="/category/zhi-ye-sheng-ya">职业生涯</a></li>
                    <li><a href="/category/zhong-jiang-ming-dan">中奖名单</a></li>
                    <li><a href="/category/zhuo-mian-ying-yong">桌面应用</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="/2015/08/ru-he-zai-ubuntu-shang-an-zhuang-pei-zhi-guan-li-xi-tong-chef-da-chu.html" rel="bookmark"
           title="Permalink to 如何在 Ubuntu 上安装配置管理系统 Chef （大厨）">如何在 Ubuntu 上安装配置管理系统 Chef （大厨）</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2015-08-10T13:53:00+02:00">
                Published: Mon 10 August 2015
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/linux-fans-from-china.html">linux fans from china</a>
        </address>
<p>In <a href="/category/xi-tong-yun-wei">系统运维</a>.</p>

</footer><!-- /.post-info -->      <p>Author: Kashif Siddique</p>
<p><a href="https://www.chef.io">Chef</a>是面对IT专业人员的一款配置管理和自动化工具，它可以配置和管理你的基础设施（设备），无论它在本地还是在云上。它可以用于加速应用部署并协调多个系统管理员和开发人员的工作，这包括可支持大量的客户群的成百上千的服务器和程序。chef最有用的是让基础设施变成代码。一旦你掌握了Chef，你可以获得自动化管理你的云端基础设施或者终端用户的一流的网络IT支持。</p>
<p>下面是我们将要在本篇中要设置和配置Chef的主要组件。</p>
<p><img alt="" src="/data/attachment/album/201508/10/105503sh2ihhvha00kmymg.png"></p>
<h3>安装Chef的要求和版本</h3>
<p>我们将在下面的基础环境下设置Chef配置管理系统。</p>
<table>
<thead>
<tr>
<th>管理和配置工具：Chef</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>基础操作系统</td>
<td>Ubuntu 14.04.1 LTS (x86_64)</td>
</tr>
<tr>
<td>Chef Server</td>
<td>Version 12.1.0</td>
</tr>
<tr>
<td>Chef Manage</td>
<td>Version 1.17.0</td>
</tr>
<tr>
<td>Chef Development Kit</td>
<td>Version 0.6.2</td>
</tr>
<tr>
<td>内存和CPU</td>
<td>4 GB , 2.0+2.0 GHz</td>
</tr>
</tbody>
</table>
<h3>Chef服务端的安装和配置</h3>
<p>Chef服务端是核心组件，它存储配置以及其他和工作站交互的配置数据。让我们在他们的官网<a href="https://www.chef.io">https://www.chef.io</a>下载最新的安装文件。</p>
<p>我使用下面的命令来下载和安装它。</p>
<h4>1) 下载Chef服务端</h4>
<div class="highlight"><pre><span></span><code><span class="nx">root</span><span class="err">@</span><span class="nx">ubuntu</span><span class="o">-</span><span class="mi">14</span><span class="o">-</span><span class="nx">chef</span><span class="p">:</span><span class="o">/</span><span class="nx">tmp</span><span class="err">#</span><span class="w"> </span><span class="nx">wget</span><span class="w"> </span><span class="nx">https</span><span class="p">:</span><span class="c1">//web-dl.packagecloud.io/chef/stable/packages/ubuntu/trusty/chef-server-core_12.1.0-1_amd64.deb</span>
</code></pre></div>

<h4>2) 安装Chef服务端</h4>
<div class="highlight"><pre><span></span><code><span class="n">root</span><span class="nv">@ubuntu</span><span class="o">-</span><span class="mi">14</span><span class="o">-</span><span class="nl">chef</span><span class="p">:</span><span class="o">/</span><span class="n">tmp</span><span class="err">#</span><span class="w"> </span><span class="n">dpkg</span><span class="w"> </span><span class="o">-</span><span class="n">i</span><span class="w"> </span><span class="n">chef</span><span class="o">-</span><span class="n">server</span><span class="o">-</span><span class="n">core_12</span><span class="mf">.1.0</span><span class="o">-</span><span class="mi">1</span><span class="n">_amd64</span><span class="p">.</span><span class="n">deb</span>
</code></pre></div>

<h4>3) 重新配置Chef服务端</h4>
<p>现在运行下面的命令来启动所有的chef服务端服务，这一步也许会花费一些时间，因为它需要由许多不同一起工作的服务组成一个可正常运作的系统。</p>
<div class="highlight"><pre><span></span><code><span class="n">root</span><span class="nv">@ubuntu</span><span class="o">-</span><span class="mi">14</span><span class="o">-</span><span class="nl">chef</span><span class="p">:</span><span class="o">/</span><span class="n">tmp</span><span class="err">#</span><span class="w"> </span><span class="n">chef</span><span class="o">-</span><span class="n">server</span><span class="o">-</span><span class="n">ctl</span><span class="w"> </span><span class="k">reconfigure</span>
</code></pre></div>

<p>chef服务端启动命令'chef-server-ctl reconfigure'需要运行两次，这样就会在安装后看到这样的输出。</p>
<div class="highlight"><pre><span></span><code>Chef Client finished, 342/350 resources updated in 113.71139964 seconds
opscode Reconfigured!
</code></pre></div>

<h4>4) 重启系统</h4>
<p>安装完成后重启系统使系统能最好的工作，不然我们或许会在创建用户的时候看到下面的SSL连接错误。</p>
<div class="highlight"><pre><span></span><code><span class="n">ERROR</span><span class="o">:</span><span class="w"> </span><span class="n">Errno</span><span class="o">::</span><span class="n">ECONNRESET</span><span class="o">:</span><span class="w"> </span><span class="n">Connection</span><span class="w"> </span><span class="n">reset</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">peer</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">SSL_connect</span>
</code></pre></div>

<h4>5) 创建新的管理员</h4>
<p>运行下面的命令来创建一个新的管理员账户及其配置。创建过程中，用户的RSA私钥会自动生成，它需要保存到一个安全的地方。--file选项会保存RSA私钥到指定的路径下。</p>
<div class="highlight"><pre><span></span><code><span class="n">root</span><span class="nv">@ubuntu</span><span class="o">-</span><span class="mi">14</span><span class="o">-</span><span class="nl">chef</span><span class="p">:</span><span class="o">/</span><span class="n">tmp</span><span class="err">#</span><span class="w"> </span><span class="n">chef</span><span class="o">-</span><span class="n">server</span><span class="o">-</span><span class="n">ctl</span><span class="w"> </span><span class="k">user</span><span class="o">-</span><span class="k">create</span><span class="w"> </span><span class="n">kashi</span><span class="w"> </span><span class="n">kashi</span><span class="w"> </span><span class="n">kashi</span><span class="w"> </span><span class="n">kashif</span><span class="p">.</span><span class="n">fareedi</span><span class="nv">@gmail</span><span class="p">.</span><span class="n">com</span><span class="w"> </span><span class="n">kashi123</span><span class="w"> </span><span class="c1">--filename /root/kashi.pem</span>
</code></pre></div>

<h3>Chef服务端的管理设置</h3>
<p>Chef Manage是一个针对企业级Chef用户的管理控制台，它提供了可视化的web用户界面，可以管理节点、数据包、规则、环境、Cookbook 和基于角色的访问控制（RBAC）。</p>
<h4>1) 下载Chef Manage</h4>
<p>从官网复制链接并下载chef manage的安装包。</p>
<div class="highlight"><pre><span></span><code><span class="nx">root</span><span class="err">@</span><span class="nx">ubuntu</span><span class="o">-</span><span class="mi">14</span><span class="o">-</span><span class="nx">chef</span><span class="p">:</span><span class="o">~</span><span class="err">#</span><span class="w"> </span><span class="nx">wget</span><span class="w"> </span><span class="nx">https</span><span class="p">:</span><span class="c1">//web-dl.packagecloud.io/chef/stable/packages/ubuntu/trusty/opscode-manage_1.17.0-1_amd64.deb</span>
</code></pre></div>

<h4>2) 安装Chef Manage</h4>
<p>使用下面的命令在root的家目录下安装它。</p>
<div class="highlight"><pre><span></span><code><span class="n">root</span><span class="nv">@ubuntu</span><span class="o">-</span><span class="mi">14</span><span class="o">-</span><span class="nl">chef</span><span class="p">:</span><span class="o">~</span><span class="err">#</span><span class="w"> </span><span class="n">chef</span><span class="o">-</span><span class="n">server</span><span class="o">-</span><span class="n">ctl</span><span class="w"> </span><span class="n">install</span><span class="w"> </span><span class="n">opscode</span><span class="o">-</span><span class="n">manage</span><span class="w"> </span><span class="c1">--path /root</span>
</code></pre></div>

<h4>3) 重启Chef Manage和服务端</h4>
<p>安装完成后我们需要运行下面的命令来重启chef manage和服务端。</p>
<div class="highlight"><pre><span></span><code><span class="n">root</span><span class="nv">@ubuntu</span><span class="o">-</span><span class="mi">14</span><span class="o">-</span><span class="nl">chef</span><span class="p">:</span><span class="o">~</span><span class="err">#</span><span class="w"> </span><span class="n">opscode</span><span class="o">-</span><span class="n">manage</span><span class="o">-</span><span class="n">ctl</span><span class="w"> </span><span class="k">reconfigure</span>
<span class="n">root</span><span class="nv">@ubuntu</span><span class="o">-</span><span class="mi">14</span><span class="o">-</span><span class="nl">chef</span><span class="p">:</span><span class="o">~</span><span class="err">#</span><span class="w"> </span><span class="n">chef</span><span class="o">-</span><span class="n">server</span><span class="o">-</span><span class="n">ctl</span><span class="w"> </span><span class="k">reconfigure</span>
</code></pre></div>

<h3>Chef Manage网页控制台</h3>
<p>我们可以使用localhost或它的域名来访问网页控制台，并用已经创建的管理员登录</p>
<p><img alt="chef amanage" src="/data/attachment/album/201508/10/105504uh2d1gdgbzaw1bpd.png"></p>
<h4>1) Chef Manage创建新的组织</h4>
<p>你或许被要求创建新的组织，或者也可以接受其他组织的邀请。如下所示，使用缩写和全名来创建一个新的组织。</p>
<p><img alt="Create Org" src="/data/attachment/album/201508/10/105505u55y37954w5z48t4.png"></p>
<h4>2) 用命令行创建新的组织</h4>
<p>我们同样也可以运行下面的命令来创建新的组织。</p>
<div class="highlight"><pre><span></span><code><span class="n">root</span><span class="nv">@ubuntu</span><span class="o">-</span><span class="mi">14</span><span class="o">-</span><span class="nl">chef</span><span class="p">:</span><span class="o">~</span><span class="err">#</span><span class="w"> </span><span class="n">chef</span><span class="o">-</span><span class="n">server</span><span class="o">-</span><span class="n">ctl</span><span class="w"> </span><span class="n">org</span><span class="o">-</span><span class="k">create</span><span class="w"> </span><span class="n">linux</span><span class="w"> </span><span class="n">Linoxide</span><span class="w"> </span><span class="n">Linux</span><span class="w"> </span><span class="n">Org</span><span class="p">.</span><span class="w"> </span><span class="c1">--association_user kashi --filename linux.pem</span>
</code></pre></div>

<h3>设置工作站</h3>
<p>我们已经完成安装chef服务端，现在我们可以开始创建任何recipes（<a href="https://docs.chef.io/recipes.html">基础配置元素</a>）、cookbooks（<a href="https://docs.chef.io/cookbooks.html">基础配置集</a>）、attributes（<a href="https://docs.chef.io/attributes.html">节点属性</a>），以及做一些其他修改。</p>
<h4>1) 在Chef服务端上创建新的用户和组织</h4>
<p>为了设置工作站，我们需要用命令行创建一个新的用户和组织。</p>
<div class="highlight"><pre><span></span><code><span class="n">root</span><span class="nv">@ubuntu</span><span class="o">-</span><span class="mi">14</span><span class="o">-</span><span class="nl">chef</span><span class="p">:</span><span class="o">~</span><span class="err">#</span><span class="w"> </span><span class="n">chef</span><span class="o">-</span><span class="n">server</span><span class="o">-</span><span class="n">ctl</span><span class="w"> </span><span class="k">user</span><span class="o">-</span><span class="k">create</span><span class="w"> </span><span class="n">bloger</span><span class="w"> </span><span class="n">Bloger</span><span class="w"> </span><span class="n">Kashif</span><span class="w"> </span><span class="n">bloger</span><span class="p">.</span><span class="n">kashif</span><span class="nv">@gmail</span><span class="p">.</span><span class="n">com</span><span class="w"> </span><span class="n">bloger123</span><span class="w"> </span><span class="o">--</span><span class="n">filename</span><span class="w"> </span><span class="n">bloger</span><span class="p">.</span><span class="n">pem</span>

<span class="n">root</span><span class="nv">@ubuntu</span><span class="o">-</span><span class="mi">14</span><span class="o">-</span><span class="nl">chef</span><span class="p">:</span><span class="o">~</span><span class="err">#</span><span class="w"> </span><span class="n">chef</span><span class="o">-</span><span class="n">server</span><span class="o">-</span><span class="n">ctl</span><span class="w"> </span><span class="n">org</span><span class="o">-</span><span class="k">create</span><span class="w"> </span><span class="n">blogs</span><span class="w"> </span><span class="n">Linoxide</span><span class="w"> </span><span class="n">Blogs</span><span class="w"> </span><span class="n">Inc</span><span class="p">.</span><span class="w"> </span><span class="c1">--association_user bloger --filename blogs.pem</span>
</code></pre></div>

<h4>2) 下载工作站入门套件</h4>
<p>在工作站的网页控制台中下载并保存入门套件，它用于与服务端协同工作</p>
<p><img alt="Starter Kit" src="/data/attachment/album/201508/10/105506lvejbqj4et7n7v9t.png"></p>
<h4>3) 下载套件后，点击"Proceed"</h4>
<p><img alt="starter kit" src="/data/attachment/album/201508/10/105506ss48jdiq4si9qx58.png"></p>
<h3>用于工作站的Chef开发套件设置</h3>
<p>Chef开发套件是一款包含开发chef所需的所有工具的软件包。它捆绑了由Chef开发的带Chef客户端的工具。</p>
<h4>1) 下载 Chef DK</h4>
<p>我们可以从它的官网链接中下载开发包，并选择操作系统来下载chef开发包。</p>
<p><img alt="Chef DK" src="/data/attachment/album/201508/10/105507kibpgnnpbnxrngit.png"></p>
<p>复制链接并用wget下载</p>
<div class="highlight"><pre><span></span><code><span class="nx">root</span><span class="err">@</span><span class="nx">ubuntu</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="nx">WKS</span><span class="p">:</span><span class="o">~</span><span class="err">#</span><span class="w"> </span><span class="nx">wget</span><span class="w"> </span><span class="nx">https</span><span class="p">:</span><span class="c1">//opscode-omnibus-packages.s3.amazonaws.com/ubuntu/12.04/x86_64/chefdk_0.6.2-1_amd64.deb</span>
</code></pre></div>

<h4>2) Chef开发套件安装</h4>
<p>使用dpkg命令安装开发套件</p>
<div class="highlight"><pre><span></span><code><span class="n">root</span><span class="nv">@ubuntu</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="nl">WKS</span><span class="p">:</span><span class="o">~</span><span class="err">#</span><span class="w"> </span><span class="n">dpkg</span><span class="w"> </span><span class="o">-</span><span class="n">i</span><span class="w"> </span><span class="n">chefdk_0</span><span class="mf">.6.2</span><span class="o">-</span><span class="mi">1</span><span class="n">_amd64</span><span class="p">.</span><span class="n">deb</span>
</code></pre></div>

<h4>3) Chef DK 验证</h4>
<p>使用下面的命令验证客户端是否已经正确安装。</p>
<div class="highlight"><pre><span></span><code><span class="n">root</span><span class="nv">@ubuntu</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="nl">WKS</span><span class="p">:</span><span class="o">~</span><span class="err">#</span><span class="w"> </span><span class="n">chef</span><span class="w"> </span><span class="n">verify</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">root</span><span class="mf">@172.25.10.172</span><span class="err">&#39;</span><span class="n">s</span><span class="w"> </span><span class="n">password</span><span class="o">:</span>
<span class="n">bloger</span><span class="p">.</span><span class="n">pem</span><span class="w"> </span><span class="mi">100</span><span class="o">%</span><span class="w"> </span><span class="mi">1674</span><span class="w"> </span><span class="mf">1.6</span><span class="n">KB</span><span class="o">/</span><span class="n">s</span><span class="w"> </span><span class="mo">00</span><span class="o">:</span><span class="mo">00</span>
<span class="n">blogs</span><span class="p">.</span><span class="n">pem</span><span class="w"> </span><span class="mi">100</span><span class="o">%</span><span class="w"> </span><span class="mi">1674</span><span class="w"> </span><span class="mf">1.6</span><span class="n">KB</span><span class="o">/</span><span class="n">s</span><span class="w"> </span><span class="mo">00</span><span class="o">:</span><span class="mo">00</span>
<span class="n">kashi</span><span class="p">.</span><span class="n">pem</span><span class="w"> </span><span class="mi">100</span><span class="o">%</span><span class="w"> </span><span class="mi">1678</span><span class="w"> </span><span class="mf">1.6</span><span class="n">KB</span><span class="o">/</span><span class="n">s</span><span class="w"> </span><span class="mo">00</span><span class="o">:</span><span class="mo">00</span>
<span class="n">linux</span><span class="p">.</span><span class="n">pem</span><span class="w"> </span><span class="mi">100</span><span class="o">%</span><span class="w"> </span><span class="mi">1678</span><span class="w"> </span><span class="mf">1.6</span><span class="n">KB</span><span class="o">/</span><span class="n">s</span><span class="w"> </span><span class="mo">00</span><span class="o">:</span><span class="mo">00</span>
</code></pre></div>

<h4>5) 编辑配置来管理chef环境 **</h4>
<p>现在使用下面的内容创建"~/.chef/knife.rb"。</p>
<div class="highlight"><pre><span></span><code><span class="nx">root</span><span class="err">@</span><span class="nx">ubuntu</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="nx">WKS</span><span class="p">:</span><span class="o">/</span><span class="p">.</span><span class="nx">chef</span><span class="err">#</span><span class="w"> </span><span class="nx">vim</span><span class="w"> </span><span class="nx">knife</span><span class="p">.</span><span class="nx">rb</span>
<span class="nx">current_dir</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">File</span><span class="p">.</span><span class="nx">dirname</span><span class="p">(</span><span class="nx">__FILE__</span><span class="p">)</span>

<span class="nx">log_level</span><span class="w"> </span><span class="p">:</span><span class="nx">info</span>
<span class="nx">log_location</span><span class="w"> </span><span class="nx">STDOUT</span>
<span class="nx">node_name</span><span class="w"> </span><span class="s">&quot;kashi&quot;</span>
<span class="nx">client_key</span><span class="w"> </span><span class="s">&quot;#{current_dir}/kashi.pem&quot;</span>
<span class="nx">validation_client_name</span><span class="w"> </span><span class="s">&quot;kashi-linux&quot;</span>
<span class="nx">validation_key</span><span class="w"> </span><span class="s">&quot;#{current_dir}/linux.pem&quot;</span>
<span class="nx">chef_server_url</span><span class="w"> </span><span class="s">&quot;https://172.25.10.173/organizations/linux&quot;</span>
<span class="nx">cache_type</span><span class="w"> </span><span class="err">&#39;</span><span class="nx">BasicFile</span><span class="err">&#39;</span>
<span class="nx">cache_options</span><span class="p">(</span><span class="w"> </span><span class="p">:</span><span class="nx">path</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="s">&quot;#{ENV[&#39;HOME&#39;]}/.chef/checksums&quot;</span><span class="w"> </span><span class="p">)</span>
<span class="nx">cookbook_path</span><span class="w"> </span><span class="p">[</span><span class="s">&quot;#{current_dir}/../cookbooks&quot;</span><span class="p">]</span>
</code></pre></div>

<p>创建knife.rb中指定的“~/cookbooks”文件夹。</p>
<div class="highlight"><pre><span></span><code><span class="n">root</span><span class="nv">@ubuntu</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="nl">WKS</span><span class="p">:</span><span class="o">/</span><span class="err">#</span><span class="w"> </span><span class="n">mkdir</span><span class="w"> </span><span class="n">cookbooks</span>
</code></pre></div>

<h4>6) 测试Knife配置</h4>
<p>运行“knife user list”和“knife client list”来验证knife是否工作。</p>
<div class="highlight"><pre><span></span><code><span class="n">root</span><span class="nv">@ubuntu</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="nl">WKS</span><span class="p">:</span><span class="o">/</span><span class="p">.</span><span class="n">chef</span><span class="err">#</span><span class="w"> </span><span class="n">knife</span><span class="w"> </span><span class="k">user</span><span class="w"> </span><span class="n">list</span>
</code></pre></div>

<p>第一次运行的时候可能会看到下面的错误，这是因为工作站上还没有chef服务端的SSL证书。</p>
<div class="highlight"><pre><span></span><code><span class="n">ERROR</span><span class="o">:</span><span class="w"> </span><span class="n">SSL</span><span class="w"> </span><span class="n">Validation</span><span class="w"> </span><span class="n">failure</span><span class="w"> </span><span class="n">connecting</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">host</span><span class="o">:</span><span class="w"> </span><span class="mf">172.25</span><span class="o">.</span><span class="mf">10.173</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">SSL_connect</span><span class="w"> </span><span class="n">returned</span><span class="o">=</span><span class="mi">1</span><span class="w"> </span><span class="n">errno</span><span class="o">=</span><span class="mi">0</span><span class="w"> </span><span class="n">state</span><span class="o">=</span><span class="n">SSLv3</span><span class="w"> </span><span class="n">read</span><span class="w"> </span><span class="n">server</span><span class="w"> </span><span class="n">certificate</span><span class="w"> </span><span class="n">B</span><span class="o">:</span><span class="w"> </span><span class="n">certificate</span><span class="w"> </span><span class="n">verify</span><span class="w"> </span><span class="n">failed</span>
<span class="n">ERROR</span><span class="o">:</span><span class="w"> </span><span class="n">Could</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">establish</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">secure</span><span class="w"> </span><span class="n">connection</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">server</span><span class="o">.</span>
<span class="n">Use</span><span class="w"> </span><span class="err">`</span><span class="n">knife</span><span class="w"> </span><span class="n">ssl</span><span class="w"> </span><span class="n">check</span><span class="err">`</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">troubleshoot</span><span class="w"> </span><span class="n">your</span><span class="w"> </span><span class="n">SSL</span><span class="w"> </span><span class="n">configuration</span><span class="o">.</span>
<span class="n">If</span><span class="w"> </span><span class="n">your</span><span class="w"> </span><span class="n">Chef</span><span class="w"> </span><span class="n">Server</span><span class="w"> </span><span class="n">uses</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">self</span><span class="o">-</span><span class="n">signed</span><span class="w"> </span><span class="n">certificate</span><span class="o">,</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">use</span>
<span class="err">`</span><span class="n">knife</span><span class="w"> </span><span class="n">ssl</span><span class="w"> </span><span class="n">fetch</span><span class="err">`</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">make</span><span class="w"> </span><span class="n">knife</span><span class="w"> </span><span class="n">trust</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">server</span><span class="err">&#39;</span><span class="n">s</span><span class="w"> </span><span class="n">certificates</span><span class="o">.</span>
</code></pre></div>

<p>要解决上面的命令的错误，运行下面的命令来获取ssl证书，并重新运行knife user和client list，这时候应该就可以了。</p>
<div class="highlight"><pre><span></span><code><span class="n">root</span><span class="nv">@ubuntu</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="nl">WKS</span><span class="p">:</span><span class="o">/</span><span class="p">.</span><span class="n">chef</span><span class="err">#</span><span class="w"> </span><span class="n">knife</span><span class="w"> </span><span class="n">ssl</span><span class="w"> </span><span class="k">fetch</span>
<span class="nl">WARNING</span><span class="p">:</span><span class="w"> </span><span class="n">Certificates</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="mf">172.25.10.173</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">fetched</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">placed</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">your</span><span class="w"> </span><span class="n">trusted_cert</span>
<span class="n">directory</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="p">.</span><span class="n">chef</span><span class="o">/</span><span class="n">trusted_certs</span><span class="p">).</span>
</code></pre></div>

<p>knife没有办法验证这些是否是有效的证书。你应该在下载时验证这些证书的真实性。</p>
<p>在/.chef/trusted_certs/ubuntu-14-chef_test_com.crt下面添加ubuntu-14-chef.test.com的证书。</p>
<p>在上面的命令取得ssl证书后，接着运行下面的命令。</p>
<div class="highlight"><pre><span></span><code><span class="n">root</span><span class="nv">@ubuntu</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="nl">WKS</span><span class="p">:</span><span class="o">/</span><span class="p">.</span><span class="n">chef#knife</span><span class="w"> </span><span class="n">client</span><span class="w"> </span><span class="n">list</span>
<span class="n">kashi</span><span class="o">-</span><span class="n">linux</span>
</code></pre></div>

<h3>配置与chef服务端交互的新节点</h3>
<p>节点是执行所有基础设施自动化的chef客户端。因此，在配置完chef-server和knife工作站后，通过配置与chef-server交互的新节点，来将新的服务端添加到我们的chef环境下。</p>
<p>我们使用下面的命令来添加与chef服务端协同工作的新节点。</p>
<div class="highlight"><pre><span></span><code><span class="n">root</span><span class="nv">@ubuntu</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="nl">WKS</span><span class="p">:</span><span class="o">~</span><span class="err">#</span><span class="w"> </span><span class="n">knife</span><span class="w"> </span><span class="n">bootstrap</span><span class="w"> </span><span class="mf">172.25.10.170</span><span class="w"> </span><span class="c1">--ssh-user root --ssh-password kashi123 --node-name mydns</span>
</code></pre></div>

<p>via: <a href="http://linoxide.com/ubuntu-how-to/install-configure-chef-ubuntu-14-04-15-04/">http://linoxide.com/ubuntu-how-to/install-configure-chef-ubuntu-14-04-15-04/</a></p>
<p>作者：<a href="http://linoxide.com/author/kashifs/">Kashif Siddique</a> 译者：<a href="https://github.com/geekpi">geekpi</a> 校对：<a href="https://github.com/wxy">wxy</a></p>
<p>本文由 <a href="https://github.com/LCTT/TranslateProject">LCTT</a> 原创翻译，<a href="https://linux.cn/">Linux中国</a> 荣誉推出</p>
    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>links</h2>
                        <ul>
                            <li><a href="https://getpelican.com/">Pelican</a></li>
                            <li><a href="https://www.python.org/">Python.org</a></li>
                            <li><a href="https://palletsprojects.com/p/jinja/">Jinja2</a></li>
                            <li><a href="#">You can modify those links in your config file</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>

                            <li><a href="#">You can add links in your config file</a></li>
                            <li><a href="#">Another social link</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a rel="nofollow" href="https://getpelican.com/">Pelican</a>, which takes great advantage of <a rel="nofollow" href="https://www.python.org/">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a rel="nofollow" href="https://www.smashingmagazine.com/2009/08/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>