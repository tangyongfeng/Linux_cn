<!DOCTYPE html>
<html lang="zh">
<head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="generator" content="Pelican" />
        <title>一些 Shell 脚本的基本概念</title>
        <link rel="stylesheet" href="/theme/css/main.css" />
        <meta name="description" content="Author: Sathyanarayanan Thangavelu 如果你希望自动执行常规任务并使你的生活更轻松，那么使用 Shell 脚本是一个很好的选择。本文将向你介绍一些基 …" />
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">linux_cn</a></h1>
                <nav><ul>
                    <li><a href="/category/chuan-shan-jia-zhuan-fang">穿山甲专访</a></li>
                    <li><a href="/category/dai-ma-ying-xiong">代码英雄</a></li>
                    <li><a href="/category/fen-xiang">分享</a></li>
                    <li><a href="/category/guan-dian">观点</a></li>
                    <li><a href="/category/huo-dong">活动</a></li>
                    <li><a href="/category/ji-ke-man-hua">极客漫画</a></li>
                    <li class="active"><a href="/category/ji-zhu">技术</a></li>
                    <li><a href="/category/kai-yuan-zhi-hui">开源智慧</a></li>
                    <li><a href="/category/linux-fa-xing-ban">Linux 发行版</a></li>
                    <li><a href="/category/mei-ri-an-quan-zi-xun">每日安全资讯</a></li>
                    <li><a href="/category/misc">Misc</a></li>
                    <li><a href="/category/qu-kuai-lian">区块链</a></li>
                    <li><a href="/category/rong-qi-yu-yun">容器与云</a></li>
                    <li><a href="/category/ruan-jian-kai-fa">软件开发</a></li>
                    <li><a href="/category/shu-mei-pai">树莓派</a></li>
                    <li><a href="/category/xi-tong-yun-wei">系统运维</a></li>
                    <li><a href="/category/xin-wen">新闻</a></li>
                    <li><a href="/category/ying-he-guan-cha">硬核观察</a></li>
                    <li><a href="/category/zhi-ye-sheng-ya">职业生涯</a></li>
                    <li><a href="/category/zhong-jiang-ming-dan">中奖名单</a></li>
                    <li><a href="/category/zhuo-mian-ying-yong">桌面应用</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="/2022/09/yi-xie-shell-jiao-ben-de-ji-ben-gai-nian.html" rel="bookmark"
           title="Permalink to 一些 Shell 脚本的基本概念">一些 Shell 脚本的基本概念</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2022-09-08T22:59:45+02:00">
                Published: Thu 08 September 2022
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/linux-fans-from-china.html">linux fans from china</a>
        </address>
<p>In <a href="/category/ji-zhu">技术</a>.</p>

</footer><!-- /.post-info -->      <p>Author: Sathyanarayanan Thangavelu</p>
<blockquote>
<p>如果你希望自动执行常规任务并使你的生活更轻松，那么使用 Shell 脚本是一个很好的选择。本文将向你介绍一些基本概念，这些概念将帮助你编写高效的 Shell 脚本。</p>
</blockquote>
<p><img alt="Shell-scripting" src="/data/attachment/album/202209/08/225945wt1f17fet17yt1e6.jpg"></p>
<p>Shell 脚本是一种被设计用来运行命令行解释器 UNIX Shell 的计算机程序。Shell 脚本的各类变种被视作脚本语言。Shell 脚本执行的典型操作包括文件操作、程序执行和文本打印。设置环境、运行程序并执行任何必要的清理或日志记录的脚本称为封装。</p>
<h3>识别 Shell 命令提示符</h3>
<p>你可以通过查看终端窗口中的提示符符号来识别 Linux 系统的计算机上的 Shell 命令提示符的用户是普通用户还是超级用户。<code>#</code> 符号用于超级用户，<code>$</code> 符号用于具有标准权限的用户。</p>
<h3>基本命令</h3>
<p>脚本附带了很多可以在终端窗口上执行的、用以管理您的计算机的命令。每个命令的详细信息可以在该命令附带的使用手册中找到。你可以使用如下命令来查看手册：</p>
<div class="highlight"><pre><span></span><code>man &lt;command&gt;
</code></pre></div>

<p>一些常用的命令有：</p>
<div class="highlight"><pre><span></span><code>date # 显示当前日期和时间
cal # 显示当前月份日历
df # 显示磁盘使用情况
free # 显示内存使用情况
ls # 列出文件和目录
mkdir # 创建目录
</code></pre></div>

<p>每个命令都附带了几个可以一起使用的选项。你可以参考使用手册以了解更多的细节。<code>man date</code> 的输出如图 1 所示。</p>
<p><img alt="Figure 1: Manual of date command" src="/data/attachment/album/202209/08/225946hqnb3onno11dxxu1.jpg"></p>
<h3>重定向操作符</h3>
<p>当你希望捕获文件中的命令输出或重定向到文件时，可以使用重定向操作符。</p>
<table>
<thead>
<tr>
<th>命令</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ls -l /usr/bin &gt;file</code></td>
<td>默认标准输出到文件</td>
</tr>
<tr>
<td><code>ls -l /usr/bin 2&gt;file</code></td>
<td>重定向标准错误到文件</td>
</tr>
<tr>
<td><code>ls -l /usr/bin &gt; ls-output 2&gt;&amp;1</code></td>
<td>重定向标准错误和标准输出到文件</td>
</tr>
<tr>
<td><code>ls -l /usr/bin &amp;&gt; ls-output</code></td>
<td>重定向标准错误和标准输出到文件</td>
</tr>
<tr>
<td><code>ls -l /usr/bin 2&gt; /dev/null</code></td>
<td>写入 <code>/dev/null</code>，丢弃输出</td>
</tr>
</tbody>
</table>
<h3>大括号扩展</h3>
<p>大括号扩展是 UNIX 提供的强大选项之一。它有助于在一行指令中使用最少的命令完成大量操作。例如：</p>
<div class="highlight"><pre><span></span><code>$echo Front-{A,B,C}-Back
Front-A-Back, Front-B-Back, Front-C-Back
</code></pre></div>

<div class="highlight"><pre><span></span><code>$echo {Z..A}
Z Y X W V U T S R Q P O N M L K J I H G F E D C B A
</code></pre></div>

<div class="highlight"><pre><span></span><code>$mkdir {2009..2011}-0{1..9} {2009..2011}-{10..12}
</code></pre></div>

<p>这条命令会为 2009 到 2011 年里的每个月建立一个目录。</p>
<h3>环境变量</h3>
<p>环境变量是一个动态命名的值，它可以影响计算机上运行的进程的行为方式。此变量是进程运行环境的一部分。</p>
<table>
<thead>
<tr>
<th>命令</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>printenv</code></td>
<td>打印出所有环境变量的值。</td>
</tr>
<tr>
<td><code>set</code></td>
<td>设置 Shell 选项</td>
</tr>
<tr>
<td><code>export</code></td>
<td>导出环境到随后执行的程序</td>
</tr>
<tr>
<td><code>alias</code></td>
<td>为命令创建别名</td>
</tr>
</tbody>
</table>
<h3>网络命令</h3>
<p>网络命令对于排查网络问题和检查连接到客户机的特定端口非常有用。</p>
<table>
<thead>
<tr>
<th>命令</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ping</code></td>
<td>发送 ICMP（网际网路控制讯息协定）数据包</td>
</tr>
<tr>
<td><code>traceroute</code></td>
<td>打印数据包在网络中的路径</td>
</tr>
<tr>
<td><code>netstat</code></td>
<td>打印网络连接信息、路由表、接口数据</td>
</tr>
<tr>
<td><code>ftp</code>/<code>lftp</code></td>
<td>互联网文件传输程序</td>
</tr>
<tr>
<td><code>wget</code></td>
<td>非交互式网络下载器</td>
</tr>
<tr>
<td><code>ssh</code></td>
<td>OpenSSH SSH 客户端 （远程登录程序）</td>
</tr>
<tr>
<td><code>scp</code></td>
<td>安全拷贝</td>
</tr>
<tr>
<td><code>sftp</code></td>
<td>安全文件传输程序</td>
</tr>
</tbody>
</table>
<h3>grep 命令</h3>
<p><code>grep</code> 命令用于查找系统和日志中的错误。它是 Shell 拥有的强大工具之一。</p>
<table>
<thead>
<tr>
<th>命令</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>grep -h '.zip' file.list</code></td>
<td><code>.</code> 表示任意字符</td>
</tr>
<tr>
<td><code>grep -h '^zip' file.list</code></td>
<td>以 <code>zip</code> 开头</td>
</tr>
<tr>
<td><code>grep -h 'zip$' file.list</code></td>
<td>以 <code>zip</code> 结尾</td>
</tr>
<tr>
<td><code>grep -h '^zip$' file.list</code></td>
<td>只含有 <code>zip</code></td>
</tr>
<tr>
<td><code>grep -h '[^bz]zip' file.list</code></td>
<td>不含 <code>b</code> 和 <code>z</code></td>
</tr>
<tr>
<td><code>grep -h '^[A-Za-z0-9]' file.list</code></td>
<td>所有文件名有效的文件</td>
</tr>
</tbody>
</table>
<h3>量词</h3>
<p>下面是一些量词的例子：</p>
<table>
<thead>
<tr>
<th>命令</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>?</code></td>
<td>匹配出现 0 次或 1 次的元素</td>
</tr>
<tr>
<td><code>*</code></td>
<td>匹配出现 0 次或多次的元素</td>
</tr>
<tr>
<td><code>+</code></td>
<td>匹配出现 1 次或多次的元素</td>
</tr>
<tr>
<td><code>{}</code></td>
<td>匹配出现特定次数的元素</td>
</tr>
</tbody>
</table>
<h3>文本处理</h3>
<p>文本处理是当今 IT 世界中的另一项重要任务。程序员和管理员可以使用这些命令来切片、剪切和处理文本。</p>
<table>
<thead>
<tr>
<th>命令</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>cat -A $FILE</code></td>
<td>显示 <code>$FILE</code> 文件的所有内容</td>
</tr>
<tr>
<td><code>sort file1.txt file2.txt file3.txt &gt; final_sorted_list.txt</code></td>
<td>一次性将所有文件排序</td>
</tr>
<tr>
<td><code>ls - l | sort -nr -k 5</code></td>
<td>按指定的第 5 列进行排序</td>
</tr>
<tr>
<td><code>sort --key=1,1 --key=2n distor.txt</code></td>
<td>对第 1 列进行排序（默认按字母表顺序），对第 2 列进行数值排序</td>
</tr>
<tr>
<td><code>sort foo.txt | uniq -c</code></td>
<td>查找重复的行并显示该行重复的次数</td>
</tr>
<tr>
<td><code>cut -f 3 distro.txt</code></td>
<td>剪切第 3 列</td>
</tr>
<tr>
<td><code>cut -c 7-10</code></td>
<td>剪切 7 - 10 字符</td>
</tr>
<tr>
<td><code>cut -d ':' -f 1 /etc/password</code></td>
<td>分隔符 <code>:</code></td>
</tr>
<tr>
<td><code>sort -k 3.7nbr -k 3.1nbr -k 3.4nbr distro.txt</code></td>
<td>按第 3 列第 7 个字符、第 3 列第 1 个字符和第 3 列第 4 个字符排序</td>
</tr>
<tr>
<td><code>paste file1.txt file2.txt &gt; newfile.txt</code></td>
<td>合并两个文件</td>
</tr>
<tr>
<td><code>join file1.txt file2.txt</code></td>
<td>按公共字段连接两个文件</td>
</tr>
</tbody>
</table>
<h3>窍门和技巧</h3>
<p>在 Linux 中，我们可以通过使用简单的命令或控制选项返回到命令的历史记录。</p>
<table>
<thead>
<tr>
<th>命令</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>clear</code></td>
<td>清空屏幕</td>
</tr>
<tr>
<td><code>history</code></td>
<td>查看保存命令的历史记录</td>
</tr>
<tr>
<td><code>script filename</code></td>
<td>捕获文件中的所有命令执行</td>
</tr>
</tbody>
</table>
<p>一些历史命令的技巧：</p>
<ul>
<li><code>CTRL + R</code>： 搜索命令历史</li>
<li><code>!!number</code>：执行编号为 <code>number</code> 的命令</li>
<li><code>!!</code> ：执行上一条命令</li>
<li><code>!?string</code> : 执行包含 <code>string</code> 的上一条命令</li>
<li><code>!string</code>：执行以 <code>string</code> 开始的上一条命令</li>
<li><code>export HISTCONTROL=ignoredups</code>： 忽略重复条目</li>
<li><code>export HISTSIZE=10000</code>：设置存储的历史行数</li>
</ul>
<p>随着你对 Linux 命令逐渐熟悉，你将能够编写封装脚本。所有手动任务，如定期备份、清理文件、监控系统使用情况等，都可以使用脚本自动完成。在学习高级概念之前，本文将帮助您开始编写脚本。</p>
    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>links</h2>
                        <ul>
                            <li><a href="https://getpelican.com/">Pelican</a></li>
                            <li><a href="https://www.python.org/">Python.org</a></li>
                            <li><a href="https://palletsprojects.com/p/jinja/">Jinja2</a></li>
                            <li><a href="#">You can modify those links in your config file</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>

                            <li><a href="#">You can add links in your config file</a></li>
                            <li><a href="#">Another social link</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a rel="nofollow" href="https://getpelican.com/">Pelican</a>, which takes great advantage of <a rel="nofollow" href="https://www.python.org/">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a rel="nofollow" href="https://www.smashingmagazine.com/2009/08/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>