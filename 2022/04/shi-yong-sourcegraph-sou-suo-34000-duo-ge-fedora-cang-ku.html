<!DOCTYPE html>
<html lang="zh">
<head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="generator" content="Pelican" />
        <title>使用 Sourcegraph 搜索 34000 多个 Fedora 仓库</title>
        <link rel="stylesheet" href="/theme/css/main.css" />
        <meta name="description" content="Author: Justin Dorfman 在 2021 年 10 月，一个 Fedora Linux 用户 问了一个关于许可的问题。Fedora 项目负责人 Matthew Miller 回复道：“我不能快速地检查（这个问题），因为 …" />
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">linux_cn</a></h1>
                <nav><ul>
                    <li><a href="/category/chuan-shan-jia-zhuan-fang">穿山甲专访</a></li>
                    <li><a href="/category/dai-ma-ying-xiong">代码英雄</a></li>
                    <li><a href="/category/fen-xiang">分享</a></li>
                    <li><a href="/category/guan-dian">观点</a></li>
                    <li><a href="/category/huo-dong">活动</a></li>
                    <li><a href="/category/ji-ke-man-hua">极客漫画</a></li>
                    <li class="active"><a href="/category/ji-zhu">技术</a></li>
                    <li><a href="/category/kai-yuan-zhi-hui">开源智慧</a></li>
                    <li><a href="/category/linux-fa-xing-ban">Linux 发行版</a></li>
                    <li><a href="/category/mei-ri-an-quan-zi-xun">每日安全资讯</a></li>
                    <li><a href="/category/misc">Misc</a></li>
                    <li><a href="/category/qu-kuai-lian">区块链</a></li>
                    <li><a href="/category/rong-qi-yu-yun">容器与云</a></li>
                    <li><a href="/category/ruan-jian-kai-fa">软件开发</a></li>
                    <li><a href="/category/shu-mei-pai">树莓派</a></li>
                    <li><a href="/category/xi-tong-yun-wei">系统运维</a></li>
                    <li><a href="/category/xin-wen">新闻</a></li>
                    <li><a href="/category/ying-he-guan-cha">硬核观察</a></li>
                    <li><a href="/category/zhi-ye-sheng-ya">职业生涯</a></li>
                    <li><a href="/category/zhong-jiang-ming-dan">中奖名单</a></li>
                    <li><a href="/category/zhuo-mian-ying-yong">桌面应用</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="/2022/04/shi-yong-sourcegraph-sou-suo-34000-duo-ge-fedora-cang-ku.html" rel="bookmark"
           title="Permalink to 使用 Sourcegraph 搜索 34000 多个 Fedora 仓库">使用 Sourcegraph 搜索 34000 多个 Fedora 仓库</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2022-04-05T15:13:28+02:00">
                Published: Tue 05 April 2022
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/linux-fans-from-china.html">linux fans from china</a>
        </address>
<p>In <a href="/category/ji-zhu">技术</a>.</p>

</footer><!-- /.post-info -->      <p>Author: Justin Dorfman</p>
<p><img alt="" src="/data/attachment/album/202204/05/151255yuq9zem6euei5ui5.jpg"></p>
<p>在 2021 年 10 月，一个 Fedora Linux 用户 <a href="https://lists.fedoraproject.org/archives/list/legal@lists.fedoraproject.org/thread/CBCJHOSP36YXQKCVGWVL5MXU64LZ6NZA/">问了一个关于许可的问题</a>。Fedora 项目负责人 Matthew Miller <a href="https://lists.fedoraproject.org/archives/list/legal@lists.fedoraproject.org/message/LTIQS2PX33FSCEIAPJS62UZXVPDT5JPB/">回复道</a>：“我不能快速地检查（这个问题），因为我们没有一个完整的、庞大的、可搜索的存储库来检索 Fedora 中所有软件包。”</p>
<p><a href="https://lists.fedoraproject.org/archives/list/legal@lists.fedoraproject.org/message/5GEPBSRGUK5E2FLW4MQBVP6DI65XP2LQ/">接着他说</a>：“……或许我们可以付钱给 Sourcegraph，让他们帮我们做这个。他们看起来乐于助人。” 他说的没错，我们（Sourcegraph）的确是乐于助人，而且我们还不想要你的钱，相反，我们想与 Fedora 社区合作。</p>
<p>Fedora 社区现在可以在他们的开源代码世界中尽情搜索 —— 目前有超过 34,000 个存储库，而且还在不断增加。</p>
<h3>代码搜索简介</h3>
<p>如果你还不熟悉 <a href="https://codesearchguide.org/">代码搜索</a> 的概念，我现在就来告诉你。代码搜索可以让团队更快地掌握一个新的代码库，在里面找到答案，帮助团队识别安全风险，以及许多其他用例。Sourcegraph 已经在 GitHub 和 GitLab 等多个代码托管服务上，索引了 200 多万个存储库。本文只关注 <a href="http://src.fedoraproject.org">src.fedoraproject.org</a> 的代码搜索。Sourcegraph 同时提供了一个 <a href="https://sourcegraph.com/search?q=context:global+repo:%5Esrc.fedoraproject.org/&amp;patternType=regexp">Web 应用</a> 和 <a href="https://docs.sourcegraph.com/cli/quickstart">命令行客户端</a>。</p>
<h3>使用 Web 应用</h3>
<p>在使用 Sourcegraph <a href="https://sourcegraph.com/search?q=context:global+repo:%5Esrc.fedoraproject.org/&amp;patternType=regexp">Web 应用</a> 时，你需要先输入初始字符串 <code>repo:^src.fedoraprojects.org</code>，然后再开始查询。这个 <a href="https://sourcegraph.com/search?q=context:global+repo:%5Esrc.fedoraproject.org/&amp;patternType=regexp">Web 应用</a> 链接中包括了上面的初始字符串，点击这个链接后，搜索界面如下图所示：</p>
<p><img alt="Sourcegraph Web 应用界面" src="/data/attachment/album/202204/05/151330xhtmqmt09bd7ymv0.png"></p>
<p>下面我将提供几个使用 Web 应用程序进行搜索的例子，大家可能会对它们感兴趣。</p>
<h4>查找使用流行的经 OSI 批准的许可证的存储库</h4>
<p>下面的查询语句将扫描所有兼容 “<ruby> 开源定义 <rt>  Open Source Definition </rt></ruby>”（OSD） 的软件存储库。</p>
<div class="highlight"><pre><span></span><code><span class="nv">repo</span><span class="o">:^</span><span class="nv">src</span><span class="o">.</span><span class="nv">fedoraproject</span><span class="o">.</span><span class="ow">or</span><span class="nv">g</span><span class="o">/</span><span class="w"> </span><span class="nv">lang</span><span class="o">:</span><span class="s">&quot;RPM Spec&quot;</span><span class="w"> </span><span class="nv">License</span><span class="o">:</span><span class="w"> </span><span class="o">^.*</span><span class="nv">apache</span><span class="o">|</span><span class="nv">bsd</span><span class="o">|</span><span class="nv">gpl</span><span class="o">|</span><span class="nv">lgpl</span><span class="o">|</span><span class="nv">mit</span><span class="o">|</span><span class="nv">mpl</span><span class="o">|</span><span class="nv">cddl</span><span class="o">|</span><span class="nv">epl</span><span class="o">.*</span><span class="p">$</span>
</code></pre></div>

<p><img alt="许可证搜索" src="/data/attachment/album/202204/05/151331eqyncmqz88h0it3u.png"></p>
<blockquote>
<p><a href="https://sourcegraph.com/search?q=context:global+repo:%5Esrc.fedoraproject.org/+lang:%22RPM+Spec%22+License:+%5E.*apache%7Cbsd%7Cgpl%7Clgpl%7Cmit%7Cmpl%7Ccddl%7Cepl.*%24&amp;patternType=regexp">试一下！</a></p>
</blockquote>
<h4>查找带有 TODO 的文件</h4>
<p>下面的查询语句将在 34,000 多个仓库中找到 <code>TODO</code> 文件。对于那些希望为需要帮助的项目做出贡献的人来说，是一个非常棒的功能。</p>
<div class="highlight"><pre><span></span><code>repo:^src.fedoraproject.org/ &quot;TODO&quot;
</code></pre></div>

<p><img alt="搜索 TODO" src="/data/attachment/album/202204/05/151332oopo65asyouyt0ds.png"></p>
<blockquote>
<p><a href="https://sourcegraph.com/search?q=context:global+repo:%5Esrc.fedoraproject.org/+%22TODO%22&amp;patternType=regexp&amp;case=yes">试一下！</a></p>
</blockquote>
<h4>查找 FTP 服务器上的文件</h4>
<p>我的一个前同事告诉我 “FTP 是一个死协议”。真的是这样吗？你也可以在这个查询中加入任何其他协议，如 irc、https 等。</p>
<div class="highlight"><pre><span></span><code>repo:^src.fedoraproject.org/ (?:ftp)://[A-Za-z0-9-]{0,63}(.[A-Za-z0-9-]{0,63})+(:d{1,4})?/*(/*[A-Za-z0-9-._]+/*)*(?.*)?(#.*)?
</code></pre></div>

<p><img alt="搜索协议" src="/data/attachment/album/202204/05/151333kbbs444rvsw4f9nc.png"></p>
<blockquote>
<p><a href="https://sourcegraph.com/search?q=context:global+repo:%5Esrc.fedoraproject.org/+%28%3F:ftp%29:%5C/%5C/%5BA-Za-z0-9%5C-%5D%7B0%2C63%7D%28%5C.%5BA-Za-z0-9%5C-%5D%7B0%2C63%7D%29%2B%28:%5Cd%7B1%2C4%7D%29%3F%5C/*%28%5C/*%5BA-Za-z0-9%5C-._%5D%2B%5C/*%29*%28%5C%3F.*%29%3F%28%23.*%29%3F&amp;patternType=regexp">试一下！</a></p>
</blockquote>
<h4>查找使用有漏洞的 Log4j 版本的文件</h4>
<p>这个查询语句将找到任何可能存在 CVE-2021-44228（也就是 Log4j）漏洞的文件（可能会有误报）。你也可以搜索其他漏洞，然后报告给项目维护者。</p>
<div class="highlight"><pre><span></span><code>repo:^src.fedoraproject.org/ org.apache.logging.log4j 2.((0|1|2|3|4|5|6|7|8|9|10|11|12|13|14|15)(.[0-9]+)) count:all
</code></pre></div>

<p><img alt="搜索 log4j" src="/data/attachment/album/202204/05/151333w7oh2szkxzwz2uhd.png"></p>
<blockquote>
<p><a href="https://sourcegraph.com/search?q=context:global+repo:%5Esrc.fedoraproject.org/+org%5C.apache%5C.logging%5C.log4j+2.%28%280%7C1%7C2%7C3%7C4%7C5%7C6%7C7%7C8%7C9%7C10%7C11%7C12%7C13%7C14%7C15%29%28%5C.%5B0-9%5D%2B%29%29+count:all&amp;patternType=regexp">试一下！</a></p>
</blockquote>
<h3>使用命令行</h3>
<p>Sourcegraph 还有一个叫做 <a href="https://github.com/sourcegraph/src-cli#readme">src</a> 的命令行客户端，它可以让你完成我刚才提到的所有事情。此外，它还有其他一些有用的命令。比如说，它可以把结果用 JSON 格式输出，方便你在编程中使用。</p>
<div class="highlight"><pre><span></span><code>src search -json &#39;repo:^src.fedoraproject.org/ lang:&quot;RPM Spec&quot; License: ^.*apache|bsd|gpl|lgpl|mit|mpl|cddl|epl.*$&#39;
</code></pre></div>

<h4>输出 JSON</h4>
<p><img alt="输出 JSON" src="/data/attachment/album/202204/05/151334m2i3ajj6e6gs8t62.png"></p>
<blockquote>
<p><a href="https://sourcegraph.com/notebooks/Tm90ZWJvb2s6MzQ2">试一下！</a></p>
</blockquote>
<h3>搜索语法</h3>
<p>就入门而言，上面的例子是很好的起点，但 Sourcegraph 还支持更多的查询语句。你可以 <a href="https://docs.sourcegraph.com/code_search/reference/queries">查看所有的搜索查询语法</a>，并根据需要创建你自己的查询语句。</p>
<h3>总结</h3>
<p>正如你所看到的，有了 Sourcegraph，Fedora Linux 社区现在可以快速搜索托管在 <a href="https://src.fedoraproject.org/">src.fedoraproject.org</a> 上的所有代码，无论是使用普通查询还是复杂的正则查询。</p>
<p>感谢 Fedora Linux 社区的慷慨帮助和热情欢迎。如果你有任何想补充的内容或问题，我和我的团队都会在下面的评论区回复。你也可以 <a href="https://srcgr.ph/wp-join-community-space">在 Slack 上找到我们</a>。</p>
<p>特别感谢 <a href="https://twitter.com/vanesacodes">Vanesa Ortiz</a> 促成了这次合作，还有 <a href="https://handbook.sourcegraph.com/team/#ben-venker">Ben Venker</a> 帮助修复了我的正则表达式（多次），以及 <a href="https://handbook.sourcegraph.com/team/#rebecca-dodd">Rebecca Dodd</a> 和 <a href="https://twitter.com/nickwritesit">Nick Moore</a> 在编辑上的帮助。</p>
    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>links</h2>
                        <ul>
                            <li><a href="https://getpelican.com/">Pelican</a></li>
                            <li><a href="https://www.python.org/">Python.org</a></li>
                            <li><a href="https://palletsprojects.com/p/jinja/">Jinja2</a></li>
                            <li><a href="#">You can modify those links in your config file</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>

                            <li><a href="#">You can add links in your config file</a></li>
                            <li><a href="#">Another social link</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a rel="nofollow" href="https://getpelican.com/">Pelican</a>, which takes great advantage of <a rel="nofollow" href="https://www.python.org/">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a rel="nofollow" href="https://www.smashingmagazine.com/2009/08/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>