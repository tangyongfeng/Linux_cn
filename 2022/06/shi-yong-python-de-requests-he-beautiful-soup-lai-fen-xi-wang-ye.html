<!DOCTYPE html>
<html lang="zh">
<head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="generator" content="Pelican" />
        <title>使用 Python 的 requests 和 Beautiful Soup 来分析网页</title>
        <link rel="stylesheet" href="/theme/css/main.css" />
        <meta name="description" content="Author: Seth Kenlon 学习这个 Python 教程，轻松提取网页的有关信息。 浏览网页可能占了你一天中的大部分时间。然而，你总是需要手动浏览 …" />
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">linux_cn</a></h1>
                <nav><ul>
                    <li><a href="/category/chuan-shan-jia-zhuan-fang">穿山甲专访</a></li>
                    <li><a href="/category/dai-ma-ying-xiong">代码英雄</a></li>
                    <li><a href="/category/fen-xiang">分享</a></li>
                    <li><a href="/category/guan-dian">观点</a></li>
                    <li><a href="/category/huo-dong">活动</a></li>
                    <li><a href="/category/ji-ke-man-hua">极客漫画</a></li>
                    <li><a href="/category/ji-zhu">技术</a></li>
                    <li><a href="/category/kai-yuan-zhi-hui">开源智慧</a></li>
                    <li><a href="/category/linux-fa-xing-ban">Linux 发行版</a></li>
                    <li><a href="/category/mei-ri-an-quan-zi-xun">每日安全资讯</a></li>
                    <li><a href="/category/misc">Misc</a></li>
                    <li><a href="/category/qu-kuai-lian">区块链</a></li>
                    <li><a href="/category/rong-qi-yu-yun">容器与云</a></li>
                    <li class="active"><a href="/category/ruan-jian-kai-fa">软件开发</a></li>
                    <li><a href="/category/shu-mei-pai">树莓派</a></li>
                    <li><a href="/category/xi-tong-yun-wei">系统运维</a></li>
                    <li><a href="/category/xin-wen">新闻</a></li>
                    <li><a href="/category/ying-he-guan-cha">硬核观察</a></li>
                    <li><a href="/category/zhi-ye-sheng-ya">职业生涯</a></li>
                    <li><a href="/category/zhong-jiang-ming-dan">中奖名单</a></li>
                    <li><a href="/category/zhuo-mian-ying-yong">桌面应用</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="/2022/06/shi-yong-python-de-requests-he-beautiful-soup-lai-fen-xi-wang-ye.html" rel="bookmark"
           title="Permalink to 使用 Python 的 requests 和 Beautiful Soup 来分析网页">使用 Python 的 requests 和 Beautiful Soup 来分析网页</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2022-06-28T13:29:10+02:00">
                Published: Tue 28 June 2022
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/linux-fans-from-china.html">linux fans from china</a>
        </address>
<p>In <a href="/category/ruan-jian-kai-fa">软件开发</a>.</p>

</footer><!-- /.post-info -->      <p>Author: Seth Kenlon</p>
<p><img alt="" src="/data/attachment/album/202206/28/132859owwf9az49k2oje2o.jpg"></p>
<blockquote>
<p>学习这个 Python 教程，轻松提取网页的有关信息。</p>
</blockquote>
<p>浏览网页可能占了你一天中的大部分时间。然而，你总是需要手动浏览，这很讨厌，不是吗？你必须打开浏览器，然后访问一个网站，单击按钮，移动鼠标……相当费时费力。如果能够通过代码与互联网交互，岂不是更好吗？</p>
<p>在 Python 的 <code>requests</code> 模块的帮助下，你可以使用 Python 从互联网中获取数据：</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">requests</span>

<span class="n">DATA</span> <span class="o">=</span> <span class="s2">&quot;https://opensource.com/article/22/5/document-source-code-doxygen-linux&quot;</span>
<span class="n">PAGE</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">DATA</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">PAGE</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</code></pre></div>

<p>在以上代码示例中，你首先导入了 <code>requests</code> 模块。接着，你创建了两个变量：其中一个叫做 <code>DATA</code>，它用来保存你要下载的 URL。在之后的代码中，你将能够在每次运行应用程序时提供不同的 URL。不过，就目前而言，最简单的方法是“硬编码”一个测试 URL，以达到演示目的。</p>
<p>另一个变量是 <code>PAGE</code>。代码读取了存储在 <code>DATA</code> 中的 URL，然后把它作为参数传入 <code>requests.get</code> 函数，最后用变量 <code>PAGE</code> 来接收函数的返回值。<code>requests</code> 模块及其 <code>.get</code> 函数的功能是：“读取”一个互联网地址（一个 URL）、访问互联网，并下载位于该地址的任何内容。</p>
<p>当然，其中涉及到很多步骤。幸运的是，你不必自己弄清楚，这也正是 Python 模块存在的原因。最后，你告诉 Python 打印 <code>requests.get</code> 存储在 <code>PAGE</code> 变量的 <code>.text</code> 字段中的所有内容。</p>
<h3>Beautiful Soup</h3>
<p>如果你运行上面的示例代码，你会得到示例 URL 的所有内容，并且，它们会不加选择地输出到你的终端里。这是因为在代码中，你对 <code>requests</code> 收集到的数据所做的唯一事情，就是打印它。然而，解析文本才是更加有趣的。</p>
<p>Python 可以通过其最基本的功能来“读取”文本，但解析文本允许你搜索模式、特定单词、HTML 标签等。你可以自己解析 <code>requests</code> 返回的文本，不过，使用专门的模块会容易得多。针对 HTML 和 XML 文本，我们有 <a href="https://beautiful-soup-4.readthedocs.io/en/latest/">Beautiful Soup</a> 库。</p>
<p>下面这段代码完成了同样的事情，只不过，它使用了 Beautiful Soup 来解析下载的文本。因为 Beautiful Soup 可以识别 HTML 元素，所以你可以使用它的一些内置功能，让输出对人眼更友好。</p>
<p>例如，在程序的末尾，你可以使用 Beautiful Soup 的 <code>.prettify</code> 函数来处理文本（使其更美观），而不是直接打印原始文本：</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>
<span class="kn">import</span> <span class="nn">requests</span>

<span class="n">PAGE</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://opensource.com/article/22/5/document-source-code-doxygen-linux&quot;</span><span class="p">)</span>
<span class="n">SOUP</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">PAGE</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="s1">&#39;html.parser&#39;</span><span class="p">)</span>

<span class="c1"># Press the green button in the gutter to run the script.</span>
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="c1"># do a thing here</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">SOUP</span><span class="o">.</span><span class="n">prettify</span><span class="p">())</span>
</code></pre></div>

<p>通过以上代码，我们确保了每个打开的 HTML 标签都输出在单独的一行，并带有适当的缩进，以帮助说明标签的继承关系。实际上，Beautiful Soup 能够通过更多方式来理解 HTML 标签，而不仅仅是将它打印出来。</p>
<p>你可以选择打印某个特定标签，而不是打印整个页面。例如，尝试将打印的选择器从 <code>print(SOUP.prettify())</code> 更改为：</p>
<div class="highlight"><pre><span></span><code>print(SOUP.p)
</code></pre></div>

<p>这只会打印一个 <code>&lt;p&gt;</code> 标签。具体来说，它只打印遇到的第一个 <code>&lt;p&gt;</code> 标签。要打印所有的 <code>&lt;p&gt;</code> 标签，你需要使用一个循环。</p>
<h3>循环</h3>
<p>使用 Beautiful Soup 的 <code>find_all</code> 函数，你可以创建一个 <code>for</code> 循环，从而遍历 <code>SOUP</code> 变量中包含的整个网页。除了 <code>&lt;p&gt;</code> 标签之外，你可能也会对其他标签感兴趣，因此最好将其构建为自定义函数，由 Python 中的 <code>def</code> 关键字（意思是 <ruby> “定义” <rt>  define </rt></ruby>）指定。</p>
<div class="highlight"><pre><span></span><code>def loopit():
    for TAG in SOUP.find_all(&#39;p&#39;):
        print(TAG)
</code></pre></div>

<p>你可以随意更改临时变量 <code>TAG</code> 的名字，例如 <code>ITEM</code> 或 <code>i</code> 或任何你喜欢的。每次循环运行时，<code>TAG</code> 中都会包含 <code>find_all</code> 函数的搜索结果。在此代码中，它搜索的是 <code>&lt;p&gt;</code> 标签。</p>
<p>函数不会自动执行，除非你显式地调用它。你可以在代码的末尾调用这个函数：</p>
<div class="highlight"><pre><span></span><code><span class="gh">#</span> Press the green button in the gutter to run the script.
if __name__ == &#39;__main__&#39;:
    # do a thing here
    loopit()
</code></pre></div>

<p>运行代码以查看所有的 <code>&lt;p&gt;</code> 标签和它们的内容。</p>
<h3>只获取内容</h3>
<p>你可以通过指定只需要 “<ruby> 字符串 <rt>  string </rt></ruby>”（它是 “<ruby> 单词 <rt>  words </rt></ruby>” 的编程术语）来排除打印标签。</p>
<div class="highlight"><pre><span></span><code>def loopit():
    for TAG in SOUP.find_all(&#39;p&#39;):
        print(TAG.string)
</code></pre></div>

<p>当然，一旦你有了网页的文本，你就可以用标准的 Python 字符串库进一步解析它。例如，你可以使用 <code>len</code> 和 <code>split</code> 函数获得单词个数：</p>
<div class="highlight"><pre><span></span><code>def loopit():
    for TAG in SOUP.find_all(&#39;p&#39;):
        if TAG.string is not None:
            print(len(TAG.string.split()))
</code></pre></div>

<p>这将打印每个段落元素中的字符串个数，省略那些没有任何字符串的段落。要获得字符串总数，你需要用到变量和一些基本数学知识：</p>
<div class="highlight"><pre><span></span><code>def loopit():
    NUM = 0
    for TAG in SOUP.find_all(&#39;p&#39;):
        if TAG.string is not None:
            NUM = NUM + len(TAG.string.split())
    print(&quot;Grand total is &quot;, NUM)
</code></pre></div>

<h3>Python 作业</h3>
<p>你可以使用 Beautiful Soup 和 Python 提取更多信息。以下是有关如何改进你的应用程序的一些想法：</p>
<ul>
<li><a href="https://opensource.com/article/17/3/python-tricks-artists-interactivity-Python-scripts">接受输入</a>，这样你就可以在启动应用程序时，指定要下载和分析的 URL。</li>
<li>统计页面上图片（<code>&lt;img&gt;</code> 标签）的数量。</li>
<li>统计另一个标签中的图片（<code>&lt;img&gt;</code> 标签）的数量（例如，仅出现在 <code>&lt;main&gt;</code> div 中的图片，或仅出现在 <code>&lt;/p&gt;</code> 标签之后的图片）。</li>
</ul>
    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>links</h2>
                        <ul>
                            <li><a href="https://getpelican.com/">Pelican</a></li>
                            <li><a href="https://www.python.org/">Python.org</a></li>
                            <li><a href="https://palletsprojects.com/p/jinja/">Jinja2</a></li>
                            <li><a href="#">You can modify those links in your config file</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>

                            <li><a href="#">You can add links in your config file</a></li>
                            <li><a href="#">Another social link</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a rel="nofollow" href="https://getpelican.com/">Pelican</a>, which takes great advantage of <a rel="nofollow" href="https://www.python.org/">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a rel="nofollow" href="https://www.smashingmagazine.com/2009/08/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>