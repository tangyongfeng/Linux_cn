<!DOCTYPE html>
<html lang="zh">
<head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="generator" content="Pelican" />
        <title>给 “rm” 命令添加个“垃圾桶”</title>
        <link rel="stylesheet" href="/theme/css/main.css" />
        <meta name="description" content="Author: 2daygeek 人类犯错误是因为我们不是一个可编程设备，所以，在使用 rm 命令时要额外注意，不要在任何时候使用 rm -rf *。当你使用 …" />
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">linux_cn</a></h1>
                <nav><ul>
                    <li><a href="/category/chuan-shan-jia-zhuan-fang">穿山甲专访</a></li>
                    <li><a href="/category/dai-ma-ying-xiong">代码英雄</a></li>
                    <li><a href="/category/fen-xiang">分享</a></li>
                    <li><a href="/category/guan-dian">观点</a></li>
                    <li><a href="/category/huo-dong">活动</a></li>
                    <li><a href="/category/ji-ke-man-hua">极客漫画</a></li>
                    <li><a href="/category/ji-zhu">技术</a></li>
                    <li><a href="/category/kai-yuan-zhi-hui">开源智慧</a></li>
                    <li><a href="/category/linux-fa-xing-ban">Linux 发行版</a></li>
                    <li><a href="/category/mei-ri-an-quan-zi-xun">每日安全资讯</a></li>
                    <li><a href="/category/misc">Misc</a></li>
                    <li><a href="/category/qu-kuai-lian">区块链</a></li>
                    <li><a href="/category/rong-qi-yu-yun">容器与云</a></li>
                    <li><a href="/category/ruan-jian-kai-fa">软件开发</a></li>
                    <li><a href="/category/shu-mei-pai">树莓派</a></li>
                    <li><a href="/category/xi-tong-yun-wei">系统运维</a></li>
                    <li><a href="/category/xin-wen">新闻</a></li>
                    <li><a href="/category/ying-he-guan-cha">硬核观察</a></li>
                    <li><a href="/category/zhi-ye-sheng-ya">职业生涯</a></li>
                    <li><a href="/category/zhong-jiang-ming-dan">中奖名单</a></li>
                    <li class="active"><a href="/category/zhuo-mian-ying-yong">桌面应用</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="/2018/03/gei-rm-ming-ling-tian-jia-ge-la-ji-tong.html" rel="bookmark"
           title="Permalink to 给 “rm” 命令添加个“垃圾桶”">给 “rm” 命令添加个“垃圾桶”</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2018-03-09T17:42:26+01:00">
                Published: Fri 09 March 2018
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/linux-fans-from-china.html">linux fans from china</a>
        </address>
<p>In <a href="/category/zhuo-mian-ying-yong">桌面应用</a>.</p>

</footer><!-- /.post-info -->      <p>Author: 2daygeek</p>
<p><img alt="" src="/data/attachment/album/201803/09/174140s40x4xgv7zev4v40.jpg"></p>
<p>人类犯错误是因为我们不是一个可编程设备，所以，在使用 <code>rm</code> 命令时要额外注意，不要在任何时候使用 <code>rm -rf *</code>。当你使用 <code>rm</code> 命令时，它会永久删除文件，不会像文件管理器那样将这些文件移动到 “垃圾箱”。</p>
<p>有时我们会将不应该删除的文件删除掉，所以当错误地删除了文件时该怎么办？ 你必须看看恢复工具（Linux 中有很多数据恢复工具），但我们不知道是否能将它百分之百恢复，所以要如何解决这个问题？</p>
<p>我们最近发表了一篇关于 <a href="https://www.2daygeek.com/trash-cli-command-line-trashcan-linux-system/">Trash-Cli</a> 的文章，在评论部分，我们从用户 Eemil Lgz 那里获得了一个关于 <a href="https://github.com/lagerspetz/linux-stuff/blob/master/scripts/saferm.sh">saferm.sh</a> 脚本的更新，它可以帮助我们将文件移动到“垃圾箱”而不是永久删除它们。</p>
<p>将文件移动到“垃圾桶”是一个好主意，当你无意中运行 <code>rm</code> 命令时，可以拯救你；但是很少有人会说这是一个坏习惯，如果你不注意“垃圾桶”，它可能会在一定的时间内被文件和文件夹堆积起来。在这种情况下，我建议你按照你的意愿去做一个定时任务。</p>
<p>这适用于服务器和桌面两种环境。 如果脚本检测到 GNOME 、KDE、Unity 或 LXDE 桌面环境（DE），则它将文件或文件夹安全地移动到默认垃圾箱 <code>$HOME/.local/share/Trash/files</code>，否则会在您的主目录中创建垃圾箱文件夹 <code>$HOME/Trash</code>。</p>
<p><code>saferm.sh</code> 脚本托管在 Github 中，可以从仓库中克隆，也可以创建一个名为 <code>saferm.sh</code> 的文件并复制其上的代码。</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/lagerspetz/linux-stuff
$<span class="w"> </span>sudo<span class="w"> </span>mv<span class="w"> </span>linux-stuff/scripts/saferm.sh<span class="w"> </span>/bin
$<span class="w"> </span>rm<span class="w"> </span>-Rf<span class="w"> </span>linux-stuff
</code></pre></div>

<p>在 <code>.bashrc</code> 文件中设置别名，</p>
<div class="highlight"><pre><span></span><code>alias rm=saferm.sh
</code></pre></div>

<p>执行下面的命令使其生效，</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span><span class="nb">source</span><span class="w"> </span>~/.bashrc
</code></pre></div>

<p>一切就绪，现在你可以执行 <code>rm</code> 命令，自动将文件移动到”垃圾桶”，而不是永久删除它们。</p>
<p>测试一下，我们将删除一个名为 <code>magi.txt</code> 的文件，命令行明确的提醒了 <code>Moving magi.txt to $HOME/.local/share/Trash/file</code>。</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>rm<span class="w"> </span>-rf<span class="w"> </span>magi.txt
Moving<span class="w"> </span>magi.txt<span class="w"> </span>to<span class="w"> </span>/home/magi/.local/share/Trash/files
</code></pre></div>

<p>也可以通过 <code>ls</code> 命令或 <code>trash-cli</code> 进行验证。</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>ls<span class="w"> </span>-lh<span class="w"> </span>/home/magi/.local/share/Trash/files
Permissions<span class="w"> </span>Size<span class="w"> </span>User<span class="w"> </span>Date<span class="w"> </span>Modified<span class="w"> </span>Name
.rw-r--r--<span class="w"> </span><span class="m">32</span><span class="w"> </span>magi<span class="w"> </span><span class="m">11</span><span class="w"> </span>Oct<span class="w"> </span><span class="m">16</span>:24<span class="w"> </span>magi.txt<span class="w">    </span>
</code></pre></div>

<p>或者我们可以通过文件管理器界面中查看相同的内容。</p>
<p><img alt="![][3]" src="/data/attachment/album/201803/09/174228rxpmllt2pxc9h6hh.png"></p>
<p>（LCTT 译注：原文此处混淆了部分 trash-cli 的内容，考虑到文章衔接和逻辑，此处略。）</p>
<p>要了解 <code>saferm.sh</code> 的其他选项，请查看帮助。</p>
<div class="highlight"><pre><span></span><code><span class="err">$</span><span class="w"> </span><span class="n">saferm</span><span class="p">.</span><span class="n">sh</span><span class="w"> </span><span class="o">-</span><span class="n">h</span>
<span class="n">This</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">saferm</span><span class="p">.</span><span class="n">sh</span><span class="w"> </span><span class="mf">1.16</span><span class="p">.</span><span class="w"> </span><span class="n">LXDE</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">Gnome3</span><span class="w"> </span><span class="n">detection</span><span class="p">.</span>
<span class="n">Will</span><span class="w"> </span><span class="n">ask</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">unsafe</span><span class="o">-</span><span class="k">delete</span><span class="w"> </span><span class="n">instead</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="k">cross</span><span class="o">-</span><span class="n">fs</span><span class="w"> </span><span class="n">move</span><span class="p">.</span><span class="w"> </span><span class="n">Allows</span><span class="w"> </span><span class="n">unsafe</span><span class="w"> </span><span class="p">(</span><span class="n">regular</span><span class="w"> </span><span class="n">rm</span><span class="p">)</span><span class="w"> </span><span class="k">delete</span><span class="w"> </span><span class="p">(</span><span class="n">ignores</span><span class="w"> </span><span class="n">trashinfo</span><span class="p">).</span>
<span class="n">Creates</span><span class="w"> </span><span class="n">trash</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">trashinfo</span><span class="w"> </span><span class="n">directories</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">they</span><span class="w"> </span><span class="n">do</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">exist</span><span class="p">.</span><span class="w"> </span><span class="n">Handles</span><span class="w"> </span><span class="n">symbolic</span><span class="w"> </span><span class="n">link</span><span class="w"> </span><span class="n">deletion</span><span class="p">.</span>
<span class="n">Does</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">complain</span><span class="w"> </span><span class="n">about</span><span class="w"> </span><span class="n">different</span><span class="w"> </span><span class="k">user</span><span class="w"> </span><span class="ow">any</span><span class="w"> </span><span class="n">more</span><span class="p">.</span>

<span class="k">Usage</span><span class="err">:</span><span class="w"> </span><span class="o">/</span><span class="k">path</span><span class="o">/</span><span class="k">to</span><span class="o">/</span><span class="n">saferm</span><span class="p">.</span><span class="n">sh</span><span class="w"> </span><span class="o">[</span><span class="n">OPTIONS</span><span class="o">]</span><span class="w"> </span><span class="o">[</span><span class="n">--</span><span class="o">]</span><span class="w"> </span><span class="n">files</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">dirs</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">safely</span><span class="w"> </span><span class="n">remove</span>
<span class="nl">OPTIONS</span><span class="p">:</span>
<span class="o">-</span><span class="n">r</span><span class="w">      </span><span class="n">allows</span><span class="w"> </span><span class="n">recursively</span><span class="w"> </span><span class="n">removing</span><span class="w"> </span><span class="n">directories</span><span class="p">.</span>
<span class="o">-</span><span class="n">f</span><span class="w">      </span><span class="n">Allow</span><span class="w"> </span><span class="n">deleting</span><span class="w"> </span><span class="n">special</span><span class="w"> </span><span class="n">files</span><span class="w"> </span><span class="p">(</span><span class="n">devices</span><span class="p">,</span><span class="w"> </span><span class="p">...).</span>
<span class="o">-</span><span class="n">u</span><span class="w">      </span><span class="n">Unsafe</span><span class="w"> </span><span class="n">mode</span><span class="p">,</span><span class="w"> </span><span class="n">bypass</span><span class="w"> </span><span class="n">trash</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="k">delete</span><span class="w"> </span><span class="n">files</span><span class="w"> </span><span class="n">permanently</span><span class="p">.</span>
<span class="o">-</span><span class="n">v</span><span class="w">      </span><span class="n">Verbose</span><span class="p">,</span><span class="w"> </span><span class="n">prints</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="n">messages</span><span class="p">.</span><span class="w"> </span><span class="k">Default</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">version</span><span class="p">.</span>
<span class="o">-</span><span class="n">q</span><span class="w">      </span><span class="n">Quiet</span><span class="w"> </span><span class="n">mode</span><span class="p">.</span><span class="w"> </span><span class="n">Opposite</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">verbose</span><span class="p">.</span>
</code></pre></div>
    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>links</h2>
                        <ul>
                            <li><a href="https://getpelican.com/">Pelican</a></li>
                            <li><a href="https://www.python.org/">Python.org</a></li>
                            <li><a href="https://palletsprojects.com/p/jinja/">Jinja2</a></li>
                            <li><a href="#">You can modify those links in your config file</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>

                            <li><a href="#">You can add links in your config file</a></li>
                            <li><a href="#">Another social link</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a rel="nofollow" href="https://getpelican.com/">Pelican</a>, which takes great advantage of <a rel="nofollow" href="https://www.python.org/">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a rel="nofollow" href="https://www.smashingmagazine.com/2009/08/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>