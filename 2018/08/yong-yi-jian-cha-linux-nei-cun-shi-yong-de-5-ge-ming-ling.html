<!DOCTYPE html>
<html lang="zh">
<head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="generator" content="Pelican" />
        <title>用以检查 Linux 内存使用的 5 个命令</title>
        <link rel="stylesheet" href="/theme/css/main.css" />
        <meta name="description" content="Author: Jack Wallen 对于 Linux 管理员来说，检查系统内存用量是一个重要的技能。Jack 给出了解决这个问题的五种不同方式。 Linux 操作系统包 …" />
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">linux_cn</a></h1>
                <nav><ul>
                    <li><a href="/category/chuan-shan-jia-zhuan-fang">穿山甲专访</a></li>
                    <li><a href="/category/dai-ma-ying-xiong">代码英雄</a></li>
                    <li><a href="/category/fen-xiang">分享</a></li>
                    <li><a href="/category/guan-dian">观点</a></li>
                    <li><a href="/category/huo-dong">活动</a></li>
                    <li><a href="/category/ji-ke-man-hua">极客漫画</a></li>
                    <li class="active"><a href="/category/ji-zhu">技术</a></li>
                    <li><a href="/category/kai-yuan-zhi-hui">开源智慧</a></li>
                    <li><a href="/category/linux-fa-xing-ban">Linux 发行版</a></li>
                    <li><a href="/category/mei-ri-an-quan-zi-xun">每日安全资讯</a></li>
                    <li><a href="/category/misc">Misc</a></li>
                    <li><a href="/category/qu-kuai-lian">区块链</a></li>
                    <li><a href="/category/rong-qi-yu-yun">容器与云</a></li>
                    <li><a href="/category/ruan-jian-kai-fa">软件开发</a></li>
                    <li><a href="/category/shu-mei-pai">树莓派</a></li>
                    <li><a href="/category/xi-tong-yun-wei">系统运维</a></li>
                    <li><a href="/category/xin-wen">新闻</a></li>
                    <li><a href="/category/ying-he-guan-cha">硬核观察</a></li>
                    <li><a href="/category/zhi-ye-sheng-ya">职业生涯</a></li>
                    <li><a href="/category/zhong-jiang-ming-dan">中奖名单</a></li>
                    <li><a href="/category/zhuo-mian-ying-yong">桌面应用</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="/2018/08/yong-yi-jian-cha-linux-nei-cun-shi-yong-de-5-ge-ming-ling.html" rel="bookmark"
           title="Permalink to 用以检查 Linux 内存使用的 5 个命令">用以检查 Linux 内存使用的 5 个命令</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2018-08-09T01:45:36+02:00">
                Published: Thu 09 August 2018
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/linux-fans-from-china.html">linux fans from china</a>
        </address>
<p>In <a href="/category/ji-zhu">技术</a>.</p>

</footer><!-- /.post-info -->      <p>Author: Jack Wallen</p>
<blockquote>
<p>对于 Linux 管理员来说，检查系统内存用量是一个重要的技能。Jack 给出了解决这个问题的五种不同方式。</p>
</blockquote>
<p><img alt="" src="/data/attachment/album/201808/09/014512zegx7k8fehphhecf.jpg"></p>
<p>Linux 操作系统包含大量工具，所有这些工具都可以帮助你管理系统。从简单的文件和目录工具到非常复杂的安全命令，在 Linux 中没有多少是你做不了的。而且，尽管普通桌面用户可能不需要在命令行熟悉这些工具，但对于 Linux 管理员来说，它们是必需的。为什么？首先，你在某些时候不得不使用没有 GUI 的 Linux 服务器。其次，命令行工具通常比 GUI 替代工具提供更多的功能和灵活性。</p>
<p>确定内存使用情况是你可能需要的技能，尤其是某个应用程序变得异常和占用系统内存时。当发生这种情况时，知道有多种工具可以帮助你进行故障排除十分方便的。或者，你可能需要收集有关 Linux 交换分区的信息，或者有关安装的内存的详细信息？对于这些也有相应的命令。让我们深入了解各种 Linux 命令行工具，以帮助你检查系统内存使用情况。这些工具并不是非常难以使用，在本文中，我将向你展示五种不同的方法来解决这个问题。</p>
<p>我将在 <a href="https://www.ubuntu.com/download/server">Ubuntu 18.04 服务器平台</a>上进行演示，但是你应该在你选择的发行版中找到对应的所有命令。更妙的是，你不需要安装任何东西（因为大多数这些工具都包含 Linux 系统中）。</p>
<p>话虽如此，让我们开始工作吧。</p>
<h3>top</h3>
<p>我想从最常用的工具开始。<code>top</code> 命令提供正在运行的系统的实时动态视图，它检查每个进程的内存使用情况。这非常重要，因为你可以轻松地看到同一命令的多个示例消耗不同的内存量。虽然你无法在没有显示器的服务器上看到这种情况，但是你已经注意到打开 Chrome 使你的系统速度变慢了。运行 <code>top</code> 命令以查看 Chrome 有多个进程在运行（每个选项卡一个 - 图 1）。</p>
<p><img alt="top" src="/data/attachment/album/201808/09/014538b1jbuywsbyzzwjpa.jpg" title="top"></p>
<p><em>图1：top 命令中出现多个 Chrome 进程。</em></p>
<p>Chrome 并不是唯一显示多个进程的应用。你看到图 1 中的 Firefox 了吗？那是 Firefox 的主进程，而 Web Content 进程是其打开的选项卡。在输出的顶部，你将看到系统统计信息。在我的机器上（<a href="https://system76.com/desktops/leopard">System76 Leopard Extreme</a>），我总共有 16GB 可用 RAM，其中只有超过 10GB 的 RAM 正在使用中。然后，你可以整理该列表，查看每个进程使用的内存百分比。</p>
<p><code>top</code> 最好的地方之一就是发现可能已经失控的服务的进程 ID 号（PID）。有了这些 PID，你可以对有问题的任务进行故障排除（或 <code>kill</code>）。</p>
<p>如果你想让 <code>top</code> 显示更友好的内存信息，使用命令 <code>top -o ％MEM</code>，这会使 <code>top</code> 按进程所用内存对所有进程进行排序（图 2）。</p>
<p><img alt="top" src="/data/attachment/album/201808/09/014539kv40k6g9cq66ddkc.jpg" title="top"></p>
<p><em>图 2：在 top 命令中按使用内存对进程排序</em></p>
<p><code>top</code> 命令还为你提供有关使用了多少交换空间的实时更新。</p>
<h3>free</h3>
<p>然而有时候，<code>top</code> 命令可能不能满足你的需求。你可能只需要查看系统的可用和已用内存。对此，Linux 还有 <code>free</code> 命令。<code>free</code> 命令显示：</p>
<ul>
<li>可用和已使用的物理内存总量</li>
<li>系统中交换内存的总量</li>
<li>内核使用的缓冲区和缓存</li>
</ul>
<p>在终端窗口中，输入 <code>free</code> 命令。它的输出不是实时的，相反，你将获得的是当前空闲和已用内存的即时快照（图 3）。</p>
<p><img alt="free" src="/data/attachment/album/201808/09/014539wzj67qqyrn4k6d86.jpg" title="free"></p>
<p><em>图 3 ：free 命令的输出简单明了。</em></p>
<p>当然，你可以通过添加 <code>-m</code> 选项来让 <code>free</code> 显示得更友好一点，就像这样：<code>free -m</code>。这将显示内存的使用情况，以 MB 为单位（图 4）。</p>
<p><img alt="free" src="/data/attachment/album/201808/09/014539x3exhjm33jwwizmq.jpg" title="free"></p>
<p><em>图 4：free 命令以一种更易于阅读的形式输出。</em></p>
<p>当然，如果你的系统是很新的，你将希望使用 <code>-g</code> 选项（以 GB 为单位），比如 <code>free -g</code>。</p>
<p>如果你需要知道内存总量，你可以添加 <code>-t</code> 选项，比如：<code>free -mt</code>。这将简单地计算每列中的内存总量（图 5）。</p>
<p><img alt="total" src="/data/attachment/album/201808/09/014540uwm3bldd3ycdicx2.jpg" title="total"></p>
<p><em>图 5：为你提供空闲的内存列。</em></p>
<h3>vmstat</h3>
<p>另一个非常方便的工具是 <code>vmstat</code>。这个特殊的命令是一个报告虚拟内存统计信息的小技巧。<code>vmstat</code> 命令将报告关于：</p>
<ul>
<li>进程</li>
<li>内存</li>
<li>分页</li>
<li>阻塞 IO</li>
<li>中断</li>
<li>磁盘</li>
<li>CPU</li>
</ul>
<p>使用 <code>vmstat</code> 的最佳方法是使用 <code>-s</code> 选项，如 <code>vmstat -s</code>。这将在单列中报告统计信息（这比默认报告更容易阅读）。<code>vmstat</code> 命令将提供比你需要的更多的信息（图 6），但更多的总是更好的（在这种情况下）。</p>
<p><img alt="vmstat" src="/data/attachment/album/201808/09/014540ibvpe83xoxwed85m.jpg" title="vmstat"></p>
<p><em>图 6：使用 vmstat 命令来检查内存使用情况。</em></p>
<h3>dmidecode</h3>
<p>如果你想找到关于已安装的系统内存的详细信息，该怎么办？为此，你可以使用 <code>dmidecode</code> 命令。这个特殊的工具是 DMI 表解码器，它将系统的 DMI 表内容转储成人类可读的格式。如果你不清楚 DMI 表是什么，那么可以这样说，它可以用来描述系统的构成（以及系统的演变）。</p>
<p>要运行 <code>dmidecode</code> 命令，你需要 <code>sudo</code> 权限。因此输入命令 <code>sudo dmidecode -t 17</code>。该命令的输出（图 7）可能很长，因为它显示所有内存类型设备的信息。因此，如果你无法上下滚动，则可能需要将该命令的输出发送到一个文件中，比如：<code>sudo dmidecode -t 17&gt; dmi_infoI</code>，或将其传递给 <code>less</code> 命令，如 <code>sudo dmidecode | less</code>。</p>
<p><img alt="dmidecode" src="/data/attachment/album/201808/09/014541dur591hh2qqdwg6u.jpg" title="dmidecode"></p>
<p><em>图 7：dmidecode 命令的输出。</em></p>
<h3>/proc/meminfo</h3>
<p>你可能会问自己：“这些命令从哪里获取这些信息？”在某些情况下，它们从 <code>/proc/meminfo</code> 文件中获取。猜到了吗？你可以使用命令 <code>less /proc/meminfo</code> 直接读取该文件。通过使用 <code>less</code> 命令，你可以在长长的输出中向上和向下滚动，以准确找到你需要的内容（图 8）。</p>
<p><img alt="/proc/meminfo" src="/data/attachment/album/201808/09/014541w1m5puy0hmimrvzz.jpg" title="/proc/meminfo"></p>
<p><em>图 8：less /proc/meminfo 命令的输出。</em></p>
<p>关于 <code>/proc/meminfo</code> 你应该知道：这不是一个真实的文件。相反 <code>/proc/meminfo</code> 是一个虚拟文件，包含有关系统的实时动态信息。特别是，你需要检查以下值：</p>
<ul>
<li>全部内存（<code>MemTotal</code>）</li>
<li>空闲内存（<code>MemFree</code>）</li>
<li>可用内存（<code>MemAvailable</code>）</li>
<li>缓冲区（<code>Buffers</code>）</li>
<li>文件缓存（<code>Cached</code>）</li>
<li>交换缓存（<code>SwapCached</code>）</li>
<li>全部交换区（<code>SwapTotal</code>）</li>
<li>空闲交换区（<code>SwapFree</code>）</li>
</ul>
<p>如果你想使用 <code>/proc/meminfo</code>，你可以连接 egrep 命令使用它：<code>egrep --color'Mem | Cache | Swap'/proc/meminfo</code>。这将生成一个易于阅读的列表，其中包含 <code>Mem</code>、 <code>Cache</code> 和 <code>Swap</code> 等内容的条目将是彩色的（图 9）。</p>
<p><img alt="/proc/meminfo" src="/data/attachment/album/201808/09/014541wbmp3p8hdo5nzzbh.jpg" title="/proc/meminfo"></p>
<p><em>图 9：让 /proc/meminfo 更容易阅读。</em></p>
<h3>继续学习</h3>
<p>你要做的第一件事就是阅读每个命令的手册页（例如 <code>man top</code>、<code>man free</code>、<code>man vmstat</code>、<code>man dmidecode</code>）。从命令的手册页开始，对于如何在 Linux 上使用一个工具，它总是一个很好的学习方法。</p>
<p>通过 Linux 基金会和 edX 的免费 <a href="https://training.linuxfoundation.org/linux-courses/system-administration-training/introduction-to-linux">“Linux 简介”</a>课程了解有关 Linux 的更多知识。</p>
    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>links</h2>
                        <ul>
                            <li><a href="https://getpelican.com/">Pelican</a></li>
                            <li><a href="https://www.python.org/">Python.org</a></li>
                            <li><a href="https://palletsprojects.com/p/jinja/">Jinja2</a></li>
                            <li><a href="#">You can modify those links in your config file</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>

                            <li><a href="#">You can add links in your config file</a></li>
                            <li><a href="#">Another social link</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a rel="nofollow" href="https://getpelican.com/">Pelican</a>, which takes great advantage of <a rel="nofollow" href="https://www.python.org/">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a rel="nofollow" href="https://www.smashingmagazine.com/2009/08/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>