<!DOCTYPE html>
<html lang="zh">
<head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="generator" content="Pelican" />
        <title>在 Grails 中使用 jQuery 和 DataTables</title>
        <link rel="stylesheet" href="/theme/css/main.css" />
        <meta name="description" content="Author: Chris Hermansen 本文介绍如何构建一个基于 Grails 的数据浏览器来可视化复杂的表格数据。 我是 Grails 的忠实粉丝。当然，我主要是热衷于 …" />
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">linux_cn</a></h1>
                <nav><ul>
                    <li><a href="/category/chuan-shan-jia-zhuan-fang">穿山甲专访</a></li>
                    <li><a href="/category/dai-ma-ying-xiong">代码英雄</a></li>
                    <li><a href="/category/fen-xiang">分享</a></li>
                    <li><a href="/category/guan-dian">观点</a></li>
                    <li><a href="/category/huo-dong">活动</a></li>
                    <li><a href="/category/ji-ke-man-hua">极客漫画</a></li>
                    <li><a href="/category/ji-zhu">技术</a></li>
                    <li><a href="/category/kai-yuan-zhi-hui">开源智慧</a></li>
                    <li><a href="/category/linux-fa-xing-ban">Linux 发行版</a></li>
                    <li><a href="/category/mei-ri-an-quan-zi-xun">每日安全资讯</a></li>
                    <li><a href="/category/misc">Misc</a></li>
                    <li><a href="/category/qu-kuai-lian">区块链</a></li>
                    <li><a href="/category/rong-qi-yu-yun">容器与云</a></li>
                    <li class="active"><a href="/category/ruan-jian-kai-fa">软件开发</a></li>
                    <li><a href="/category/shu-mei-pai">树莓派</a></li>
                    <li><a href="/category/xi-tong-yun-wei">系统运维</a></li>
                    <li><a href="/category/xin-wen">新闻</a></li>
                    <li><a href="/category/ying-he-guan-cha">硬核观察</a></li>
                    <li><a href="/category/zhi-ye-sheng-ya">职业生涯</a></li>
                    <li><a href="/category/zhong-jiang-ming-dan">中奖名单</a></li>
                    <li><a href="/category/zhuo-mian-ying-yong">桌面应用</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="/2018/11/zai-grails-zhong-shi-yong-jquery-he-datatables.html" rel="bookmark"
           title="Permalink to 在 Grails 中使用 jQuery 和 DataTables">在 Grails 中使用 jQuery 和 DataTables</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2018-11-24T10:24:47+01:00">
                Published: Sat 24 November 2018
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/linux-fans-from-china.html">linux fans from china</a>
        </address>
<p>In <a href="/category/ruan-jian-kai-fa">软件开发</a>.</p>

</footer><!-- /.post-info -->      <p>Author: Chris Hermansen</p>
<blockquote>
<p>本文介绍如何构建一个基于 Grails 的数据浏览器来可视化复杂的表格数据。</p>
</blockquote>
<p><img alt="" src="/data/attachment/album/201811/24/102451gfdc52bnvg7fr7nv.png"></p>
<p>我是 <a href="https://grails.org/">Grails</a> 的忠实粉丝。当然，我主要是热衷于利用命令行工具来探索和分析数据的数据从业人员。数据从业人员经常需要<em>查看</em>数据，这也意味着他们通常拥有优秀的数据浏览器。利用 Grails、<a href="https://jquery.com/">jQuery</a>，以及 <a href="https://datatables.net/">DataTables jQuery 插件</a>，我们可以制作出非常友好的表格数据浏览器。</p>
<p><a href="https://datatables.net/">DataTables 网站</a>提供了许多“食谱式”的教程文档，展示了如何组合一些优秀的示例应用程序，这些程序包含了完成一些非常漂亮的东西所必要的 JavaScript、HTML，以及偶尔出现的 <a href="http://php.net/">PHP</a>。但对于那些宁愿使用 Grails 作为后端的人来说，有必要进行一些说明示教。此外，样本程序中使用的数据是一个虚构公司的员工的单个平面表格数据，因此处理这些复杂的表关系可以作为读者的一个练习项目。</p>
<p>本文中，我们将创建具有略微复杂的数据结构和 DataTables 浏览器的 Grails 应用程序。我们将介绍 Grails 标准，它是 <a href="http://groovy-lang.org/">Groovy</a> 式的 Java Hibernate 标准。我已将代码托管在 <a href="https://github.com/monetschemist/grails-datatables">GitHub</a> 上方便大家访问，因此本文主要是对代码细节的解读。</p>
<p>首先，你需要配置 Java、Groovy、Grails 的使用环境。对于 Grails，我倾向于使用终端窗口和 <a href="https://www.vim.org/">Vim</a>，本文也使用它们。为获得现代的 Java 环境，建议下载并安装 Linux 发行版提供的 <a href="http://openjdk.java.net/">Open Java Development Kit</a> （OpenJDK）（应该是 Java 8、9、10 或 11 之一，撰写本文时，我正在使用 Java 8）。从我的角度来看，获取最新的 Groovy 和 Grails 的最佳方法是使用 <a href="http://sdkman.io/">SDKMAN!</a>。</p>
<p>从未尝试过 Grails 的读者可能需要做一些背景资料阅读。作为初学者，推荐文章 <a href="http://guides.grails.org/creating-your-first-grails-app/guide/index.html">创建你的第一个 Grails 应用程序</a>。</p>
<h3>获取员工信息浏览器应用程序</h3>
<p>正如上文所提，我将本文中员工信息浏览器的源代码托管在 <a href="https://github.com/monetschemist/grails-datatables">GitHub</a>上。进一步讲，应用程序 <strong>embrow</strong> 是在 Linux 终端中用如下命令构建的：</p>
<div class="highlight"><pre><span></span><code>cd Projects
grails create-app com.nuevaconsulting.embrow
</code></pre></div>

<p>域类和单元测试创建如下：</p>
<div class="highlight"><pre><span></span><code>grails create-domain-class com.nuevaconsulting.embrow.Position
grails create-domain-class com.nuevaconsulting.embrow.Office
grails create-domain-class com.nuevaconsulting.embrow.Employeecd embrowgrails createdomaincom.grails createdomaincom.grails createdomaincom.
</code></pre></div>

<p>这种方式构建的域类没有属性，因此必须按如下方式编辑它们：</p>
<p><code>Position</code> 域类：</p>
<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">com</span><span class="p">.</span><span class="nx">nuevaconsulting</span><span class="p">.</span><span class="nx">embrow</span>

<span class="kd">class</span><span class="w"> </span><span class="nx">Position</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nx">String</span><span class="w"> </span><span class="nx">name</span>
<span class="w">    </span><span class="nx">int</span><span class="w"> </span><span class="nx">starting</span>

<span class="w">    </span><span class="nx">static</span><span class="w"> </span><span class="nx">constraints</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">name</span><span class="w"> </span><span class="nx">nullable</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="nx">blank</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span>
<span class="w">        </span><span class="nx">starting</span><span class="w"> </span><span class="nx">nullable</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span><span class="nx">com</span><span class="p">.</span><span class="nx">Stringint</span><span class="w"> </span><span class="nx">startingstatic</span><span class="w"> </span><span class="nx">constraintsnullableblankstarting</span><span class="w"> </span><span class="nx">nullable</span>
</code></pre></div>

<p><code>Office</code> 域类：</p>
<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">com</span><span class="p">.</span><span class="nx">nuevaconsulting</span><span class="p">.</span><span class="nx">embrow</span>

<span class="kd">class</span><span class="w"> </span><span class="nx">Office</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nx">String</span><span class="w"> </span><span class="nx">name</span>
<span class="w">    </span><span class="nx">String</span><span class="w"> </span><span class="nx">address</span>
<span class="w">    </span><span class="nx">String</span><span class="w"> </span><span class="nx">city</span>
<span class="w">    </span><span class="nx">String</span><span class="w"> </span><span class="nx">country</span>

<span class="w">    </span><span class="nx">static</span><span class="w"> </span><span class="nx">constraints</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">name</span><span class="w"> </span><span class="nx">nullable</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="nx">blank</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span>
<span class="w">        </span><span class="nx">address</span><span class="w"> </span><span class="nx">nullable</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="nx">blank</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span>
<span class="w">        </span><span class="nx">city</span><span class="w"> </span><span class="nx">nullable</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="nx">blank</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span>
<span class="w">        </span><span class="nx">country</span><span class="w"> </span><span class="nx">nullable</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="nx">blank</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p><code>Enployee</code> 域类：</p>
<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">com</span><span class="p">.</span><span class="nx">nuevaconsulting</span><span class="p">.</span><span class="nx">embrow</span>

<span class="kd">class</span><span class="w"> </span><span class="nx">Employee</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nx">String</span><span class="w"> </span><span class="nx">surname</span>
<span class="w">    </span><span class="nx">String</span><span class="w"> </span><span class="nx">givenNames</span>
<span class="w">    </span><span class="nx">Position</span><span class="w"> </span><span class="nx">position</span>
<span class="w">    </span><span class="nx">Office</span><span class="w"> </span><span class="nx">office</span>
<span class="w">    </span><span class="nx">int</span><span class="w"> </span><span class="nx">extension</span>
<span class="w">    </span><span class="nx">Date</span><span class="w"> </span><span class="nx">hired</span>
<span class="w">    </span><span class="nx">int</span><span class="w"> </span><span class="nx">salary</span>
<span class="w">    </span><span class="nx">static</span><span class="w"> </span><span class="nx">constraints</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">surname</span><span class="w"> </span><span class="nx">nullable</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="nx">blank</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span>
<span class="w">        </span><span class="nx">givenNames</span><span class="w"> </span><span class="nx">nullable</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="nx">blank</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span>
<span class="w">        </span><span class="p">:</span><span class="w"> </span><span class="kc">false</span>
<span class="w">        </span><span class="nx">office</span><span class="w"> </span><span class="nx">nullable</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span>
<span class="w">        </span><span class="nx">extension</span><span class="w"> </span><span class="nx">nullable</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span>
<span class="w">        </span><span class="nx">hired</span><span class="w"> </span><span class="nx">nullable</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span>
<span class="w">        </span><span class="nx">salary</span><span class="w"> </span><span class="nx">nullable</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>请注意，虽然 <code>Position</code> 和 <code>Office</code> 域类使用了预定义的 Groovy 类型 <code>String</code> 以及 <code>int</code>，但 <code>Employee</code> 域类定义了 <code>Position</code> 和 <code>Office</code> 字段（以及预定义的 <code>Date</code>）。这会导致创建数据库表，其中存储的 <code>Employee</code> 实例中包含了指向存储 <code>Position</code> 和 <code>Office</code> 实例表的引用或者外键。</p>
<p>现在你可以生成控制器，视图，以及其他各种测试组件：</p>
<div class="highlight"><pre><span></span><code>-all com.nuevaconsulting.embrow.Position
grails generate-all com.nuevaconsulting.embrow.Office
grails generate-all com.nuevaconsulting.embrow.Employeegrails generateall com.grails generateall com.grails generateall com.
</code></pre></div>

<p>此时，你已经准备好了一个基本的增删改查（CRUD）应用程序。我在 <code>grails-app/init/com/nuevaconsulting/BootStrap.groovy</code> 中包含了一些基础数据来填充表格。</p>
<p>如果你用如下命令来启动应用程序：</p>
<div class="highlight"><pre><span></span><code>grails run-app
</code></pre></div>

<p>在浏览器输入 <code>http://localhost:8080/</code>，你将会看到如下界面：</p>
<p><img alt="Embrow home screen" src="/data/attachment/album/201811/24/102453x1n1tygy5g35r15z.png"></p>
<p><em>Embrow 应用程序主界面。</em></p>
<p>单击 “OfficeController” 链接，会跳转到如下界面：</p>
<p><img alt="Office list" src="/data/attachment/album/201811/24/102455e23cwdo3yydhl3y3.png"></p>
<p><em>Office 列表</em></p>
<p>注意，此表由 <code>OfficeController</code> 的 <code>index</code> 方式生成，并由视图 <code>office/index.gsp</code> 显示。</p>
<p>同样，单击 “EmployeeController” 链接 跳转到如下界面：</p>
<p><img alt="Employee controller" src="/data/attachment/album/201811/24/102457xfhihxh3h2mjf2j6.png"></p>
<p><em>employee 控制器</em></p>
<p>好吧，这很丑陋： Position 和 Office 链接是什么？</p>
<p>上面的命令 <code>generate-all</code> 生成的视图创建了一个叫 <code>index.gsp</code> 的文件，它使用 Grails <code>&lt;f:table/&gt;</code> 标签，该标签默认会显示类名（<code>com.nuevaconsulting.embrow.Position</code>）和持久化示例标识符（<code>30</code>）。这个操作可以自定义用来产生更好看的东西，并且自动生成链接，自动生成分页以及自动生成可排序列的一些非常简洁直观的东西。</p>
<p>但该员工信息浏览器功能也是有限的。例如，如果想查找 “position” 信息中包含 “dev” 的员工该怎么办？如果要组合排序，以姓氏为主排序关键字，“office” 为辅助排序关键字，该怎么办？或者，你需要将已排序的数据导出到电子表格或 PDF 文档以便通过电子邮件发送给无法访问浏览器的人，该怎么办？</p>
<p>jQuery DataTables 插件提供了这些所需的功能。允许你创建一个完成的表格数据浏览器。</p>
<h3>创建员工信息浏览器视图和控制器的方法</h3>
<p>要基于 jQuery DataTables 创建员工信息浏览器，你必须先完成以下两个任务：</p>
<ol>
<li>创建 Grails 视图，其中包含启用 DataTable 所需的 HTML 和 JavaScript</li>
<li>给 Grails 控制器增加一个方法来控制新视图。</li>
</ol>
<h4>员工信息浏览器视图</h4>
<p>在目录 <code>embrow/grails-app/views/employee</code> 中，首先复制 <code>index.gsp</code> 文件，重命名为 <code>browser.gsp</code>：</p>
<div class="highlight"><pre><span></span><code>cd Projects
cd embrow/grails-app/views/employee
cp gsp browser.gsp
</code></pre></div>

<p>此刻，你自定义新的 <code>browser.gsp</code> 文件来添加相关的 jQuery DataTables 代码。</p>
<p>通常，在可能的时候，我喜欢从内容提供商处获得 JavaScript 和 CSS；在下面这行后面：</p>
<div class="highlight"><pre><span></span><code><span class="o">&lt;</span><span class="n">title</span><span class="o">&gt;&lt;</span><span class="nl">g</span><span class="p">:</span><span class="n">message</span><span class="w"> </span><span class="n">code</span><span class="o">=</span><span class="ss">&quot;default.list.label&quot;</span><span class="w"> </span><span class="n">args</span><span class="o">=</span><span class="ss">&quot;[entityName]&quot;</span><span class="w"> </span><span class="o">/&gt;&lt;/</span><span class="n">title</span><span class="o">&gt;</span>
</code></pre></div>

<p>插入如下代码：</p>
<div class="highlight"><pre><span></span><code><span class="nt">&lt;script</span><span class="w"> </span><span class="na">src=</span><span class="s">&quot;https://code.jquery.com/jquery-2.2.4.min.js&quot;</span><span class="w"> </span><span class="na">integrity=</span><span class="s">&quot;sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=&quot;</span><span class="w"> </span><span class="na">crossorigin=</span><span class="s">&quot;anonymous&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;link</span><span class="w"> </span><span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;text/css&quot;</span><span class="w"> </span><span class="na">href=</span><span class="s">&quot;https://cdn.datatables.net/1.10.16/css/jquery.dataTables.css&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;script</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;text/javascript&quot;</span><span class="w"> </span><span class="na">charset=</span><span class="s">&quot;utf8&quot;</span><span class="w"> </span><span class="na">src=</span><span class="s">&quot;https://cdn.datatables.net/1.10.16/js/jquery.dataTables.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;link</span><span class="w"> </span><span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;text/css&quot;</span><span class="w"> </span><span class="na">href=</span><span class="s">&quot;https://cdn.datatables.net/scroller/1.4.4/css/scroller.dataTables.min.css&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;script</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;text/javascript&quot;</span><span class="w"> </span><span class="na">charset=</span><span class="s">&quot;utf8&quot;</span><span class="w"> </span><span class="na">src=</span><span class="s">&quot;https://cdn.datatables.net/scroller/1.4.4/js/dataTables.scroller.min.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;text/javascript&quot;</span><span class="w"> </span><span class="na">charset=</span><span class="s">&quot;utf8&quot;</span><span class="w"> </span><span class="na">src=</span><span class="s">&quot;https://cdn.datatables.net/buttons/1.5.1/js/dataTables.buttons.min.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;text/javascript&quot;</span><span class="w"> </span><span class="na">charset=</span><span class="s">&quot;utf8&quot;</span><span class="w"> </span><span class="na">src=</span><span class="s">&quot;https://cdn.datatables.net/buttons/1.5.1/js/buttons.flash.min.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;text/javascript&quot;</span><span class="w"> </span><span class="na">charset=</span><span class="s">&quot;utf8&quot;</span><span class="w"> </span><span class="na">src=</span><span class="s">&quot;https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;text/javascript&quot;</span><span class="w"> </span><span class="na">charset=</span><span class="s">&quot;utf8&quot;</span><span class="w"> </span><span class="na">src=</span><span class="s">&quot;https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.32/pdfmake.min.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;text/javascript&quot;</span><span class="w"> </span><span class="na">charset=</span><span class="s">&quot;utf8&quot;</span><span class="w"> </span><span class="na">src=</span><span class="s">&quot;https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.32/vfs_fonts.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;text/javascript&quot;</span><span class="w"> </span><span class="na">charset=</span><span class="s">&quot;utf8&quot;</span><span class="w"> </span><span class="na">src=</span><span class="s">&quot;https://cdn.datatables.net/buttons/1.5.1/js/buttons.html5.min.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;text/javascript&quot;</span><span class="w"> </span><span class="na">charset=</span><span class="s">&quot;utf8&quot;</span><span class="w"> </span><span class="na">src=</span><span class="s">&quot;https://cdn.datatables.net/buttons/1.5.1/js/buttons.print.min.js &quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</code></pre></div>

<p>然后删除 <code>index.gsp</code> 中提供数据分页的代码：</p>
<div class="highlight"><pre><span></span><code><span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;list-employee&quot;</span> <span class="na">class=</span><span class="s">&quot;content scaffold-list&quot;</span> <span class="na">role=</span><span class="s">&quot;main&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;h1&gt;&lt;g:message</span> <span class="na">code=</span><span class="s">&quot;default.list.label&quot;</span> <span class="na">args=</span><span class="s">&quot;[entityName]&quot;</span> <span class="nt">/&gt;&lt;/h1&gt;</span>
<span class="nt">&lt;g:if</span> <span class="na">test=</span><span class="s">&quot;</span><span class="cp">${</span><span class="n">flash</span><span class="o">.</span><span class="n">message</span><span class="cp">}</span><span class="s">&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;message&quot;</span> <span class="na">role=</span><span class="s">&quot;status&quot;</span><span class="nt">&gt;</span><span class="cp">${</span><span class="n">flash</span><span class="o">.</span><span class="n">message</span><span class="cp">}</span><span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/g:if&gt;</span>
<span class="nt">&lt;f:table</span> <span class="na">collection=</span><span class="s">&quot;</span><span class="cp">${</span><span class="n">employeeList</span><span class="cp">}</span><span class="s">&quot;</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;pagination&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;g:paginate</span> <span class="na">total=</span><span class="s">&quot;</span><span class="cp">${</span><span class="n">employeeCount</span> <span class="err">?</span><span class="p">:</span> <span class="mi">0</span><span class="cp">}</span><span class="s">&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre></div>

<p>并插入实现 jQuery DataTables 的代码。</p>
<p>要插入的第一部分是 HTML，它将创建浏览器的基本表格结构。DataTables 与后端通信的应用程序来说，它们只提供表格页眉和页脚；DataTables JavaScript 则负责表中内容。</p>
<div class="highlight"><pre><span></span><code><span class="nt">&lt;div</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;employee-browser&quot;</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;content&quot;</span><span class="w"> </span><span class="na">role=</span><span class="s">&quot;main&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;h1&gt;</span>Employee<span class="w"> </span>Browser<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;table</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;employee_dt&quot;</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;display compact&quot;</span><span class="w"> </span><span class="na">style=</span><span class="s">&quot;width:99%;&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;thead&gt;</span>
<span class="nt">&lt;tr&gt;</span>
<span class="nt">&lt;th&gt;</span>Surname<span class="nt">&lt;/th&gt;</span>
<span class="nt">&lt;th&gt;</span>Given<span class="w"> </span>name(s)<span class="nt">&lt;/th&gt;</span>
<span class="nt">&lt;th&gt;</span>Position<span class="nt">&lt;/th&gt;</span>
<span class="nt">&lt;th&gt;</span>Office<span class="nt">&lt;/th&gt;</span>
<span class="nt">&lt;th&gt;</span>Extension<span class="nt">&lt;/th&gt;</span>
<span class="nt">&lt;th&gt;</span>Hired<span class="nt">&lt;/th&gt;</span>
<span class="nt">&lt;th&gt;</span>Salary<span class="nt">&lt;/th&gt;</span>
<span class="nt">&lt;/tr&gt;</span>
<span class="nt">&lt;/thead&gt;</span>
<span class="nt">&lt;tfoot&gt;</span>
<span class="nt">&lt;tr&gt;</span>
<span class="nt">&lt;th&gt;</span>Surname<span class="nt">&lt;/th&gt;</span>
<span class="nt">&lt;th&gt;</span>Given<span class="w"> </span>name(s)<span class="nt">&lt;/th&gt;</span>
<span class="nt">&lt;th&gt;</span>Position<span class="nt">&lt;/th&gt;</span>
<span class="nt">&lt;th&gt;</span>Office<span class="nt">&lt;/th&gt;</span>
<span class="nt">&lt;th&gt;</span>Extension<span class="nt">&lt;/th&gt;</span>
<span class="nt">&lt;th&gt;</span>Hired<span class="nt">&lt;/th&gt;</span>
<span class="nt">&lt;th&gt;</span>Salary<span class="nt">&lt;/th&gt;</span>
<span class="nt">&lt;/tr&gt;</span>
<span class="nt">&lt;/tfoot&gt;</span>
<span class="nt">&lt;/table&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre></div>

<p>接下来，插入一个 JavaScript 块，它主要提供三个功能：它设置页脚中显示的文本框的大小，以进行列过滤，建立 DataTables 表模型，并创建一个处理程序来进行列过滤。</p>
<div class="highlight"><pre><span></span><code>&lt;g:javascript&gt;
$(&#39;#employee_dt tfoot th&#39;).each( function() {javascript
</code></pre></div>

<p>下面的代码处理表格列底部的过滤器框的大小：</p>
<div class="highlight"><pre><span></span><code><span class="k">var</span><span class="w"> </span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">$</span><span class="p">(</span><span class="n">this</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">();</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">title</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">&#39;Extension&#39;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">title</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">&#39;Hired&#39;</span><span class="p">)</span>
<span class="o">$</span><span class="p">(</span><span class="n">this</span><span class="p">)</span><span class="o">.</span><span class="n">html</span><span class="p">(</span><span class="s1">&#39;&lt;input type=&quot;text&quot; size=&quot;5&quot; placeholder=&quot;&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">title</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;?&quot; /&gt;&#39;</span><span class="p">);</span>
<span class="k">else</span>
<span class="o">$</span><span class="p">(</span><span class="n">this</span><span class="p">)</span><span class="o">.</span><span class="n">html</span><span class="p">(</span><span class="s1">&#39;&lt;input type=&quot;text&quot; size=&quot;15&quot; placeholder=&quot;&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">title</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;?&quot; /&gt;&#39;</span><span class="p">);</span>
<span class="p">});</span><span class="n">titletitletitletitletitle</span>
</code></pre></div>

<p>接下来，定义表模型。这是提供所有表选项的地方，包括界面的滚动，而不是分页，根据 DOM 字符串提供的装饰，将数据导出为 CSV 和其他格式的能力，以及建立与服务器的 AJAX 连接。 请注意，使用 Groovy GString 调用 Grails <code>createLink()</code> 的方法创建 URL，在 <code>EmployeeController</code> 中指向 <code>browserLister</code> 操作。同样有趣的是表格列的定义。此信息将发送到后端，后端查询数据库并返回相应的记录。</p>
<div class="highlight"><pre><span></span><code><span class="k">var</span><span class="w"> </span><span class="n">table</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">$</span><span class="p">(</span><span class="s1">&#39;#employee_dt&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">DataTable</span><span class="p">(</span><span class="w"> </span><span class="p">{</span>
<span class="s2">&quot;scrollY&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">500</span><span class="p">,</span>
<span class="s2">&quot;deferRender&quot;</span><span class="p">:</span><span class="w"> </span><span class="bp">true</span><span class="p">,</span>
<span class="s2">&quot;scroller&quot;</span><span class="p">:</span><span class="w"> </span><span class="bp">true</span><span class="p">,</span>
<span class="s2">&quot;dom&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Brtip&quot;</span><span class="p">,</span>
<span class="s2">&quot;buttons&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s1">&#39;copy&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;csv&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;excel&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;pdf&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;print&#39;</span><span class="w"> </span><span class="p">],</span>
<span class="s2">&quot;processing&quot;</span><span class="p">:</span><span class="w"> </span><span class="bp">true</span><span class="p">,</span>
<span class="s2">&quot;serverSide&quot;</span><span class="p">:</span><span class="w"> </span><span class="bp">true</span><span class="p">,</span>
<span class="s2">&quot;ajax&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="s2">&quot;url&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;${createLink(controller: &#39;employee&#39;, action: &#39;browserLister&#39;)}&quot;</span><span class="p">,</span>
<span class="s2">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;POST&quot;</span><span class="p">,</span>
<span class="p">},</span>
<span class="s2">&quot;columns&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="p">{</span><span class="w"> </span><span class="s2">&quot;data&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;surname&quot;</span><span class="w"> </span><span class="p">},</span>
<span class="p">{</span><span class="w"> </span><span class="s2">&quot;data&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;givenNames&quot;</span><span class="w"> </span><span class="p">},</span>
<span class="p">{</span><span class="w"> </span><span class="s2">&quot;data&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;position&quot;</span><span class="w"> </span><span class="p">},</span>
<span class="p">{</span><span class="w"> </span><span class="s2">&quot;data&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;office&quot;</span><span class="w"> </span><span class="p">},</span>
<span class="p">{</span><span class="w"> </span><span class="s2">&quot;data&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;extension&quot;</span><span class="w"> </span><span class="p">},</span>
<span class="p">{</span><span class="w"> </span><span class="s2">&quot;data&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;hired&quot;</span><span class="w"> </span><span class="p">},</span>
<span class="p">{</span><span class="w"> </span><span class="s2">&quot;data&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;salary&quot;</span><span class="w"> </span><span class="p">}</span>
<span class="p">]</span>
<span class="p">});</span>
</code></pre></div>

<p>最后，监视过滤器列以进行更改，并使用它们来应用过滤器。</p>
<div class="highlight"><pre><span></span><code><span class="n">table</span><span class="o">.</span><span class="n">columns</span><span class="p">()</span><span class="o">.</span><span class="n">every</span><span class="p">(</span><span class="n">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="k">var</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">this</span><span class="p">;</span>
<span class="o">$</span><span class="p">(</span><span class="s1">&#39;input&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">this</span><span class="o">.</span><span class="n">footer</span><span class="p">())</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="s1">&#39;keyup change&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">function</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">that</span><span class="o">.</span><span class="n">search</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">this</span><span class="o">.</span><span class="n">value</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="mi">8</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">e</span><span class="o">.</span><span class="n">keyCode</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">e</span><span class="o">.</span><span class="n">keyCode</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">32</span><span class="p">)</span>
<span class="n">that</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">this</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">draw</span><span class="p">();</span>
<span class="p">});</span>
</code></pre></div>

<p>这就是 JavaScript，这样就完成了对视图代码的更改。</p>
<div class="highlight"><pre><span></span><code>});
&lt;/g:javascript&gt;
</code></pre></div>

<p>以下是此视图创建的UI的屏幕截图：</p>
<p><img alt="" src="/data/attachment/album/201811/24/102458wiezvqvvwdguwfqv.png"></p>
<p>这是另一个屏幕截图，显示了过滤和多列排序（寻找 “position” 包括字符 “dev” 的员工，先按 “office” 排序，然后按姓氏排序）：</p>
<p><img alt="" src="/data/attachment/album/201811/24/102500fee5wc2z3x6w3xxp.png"></p>
<p>这是另一个屏幕截图，显示单击 CSV 按钮时会发生什么：</p>
<p><img alt="" src="/data/attachment/album/201811/24/102504u2bkkzg2g3gz9b38.png"></p>
<p>最后，这是一个截图，显示在 LibreOffice 中打开的 CSV 数据：</p>
<p><img alt="" src="/data/attachment/album/201811/24/102508udp96d9ewdb0emt2.png"></p>
<p>好的，视图部分看起来非常简单；因此，控制器必须做所有繁重的工作，对吧？ 让我们来看看……</p>
<h4>控制器 browserLister 操作</h4>
<p>回想一下，我们看到过这个字符串：</p>
<div class="highlight"><pre><span></span><code>&quot;<span class="cp">${</span><span class="n">createLink</span><span class="p">(</span><span class="n">controller</span><span class="p">:</span> <span class="s1">&#39;employee&#39;</span><span class="p">,</span> <span class="n">action</span><span class="p">:</span> <span class="s1">&#39;browserLister&#39;</span><span class="p">)</span><span class="cp">}</span>&quot;
</code></pre></div>

<p>对于从 DataTables 模型中调用 AJAX 的 URL，是在 Grails 服务器上动态创建 HTML 链接，其 Grails 标记背后通过调用 <a href="https://gsp.grails.org/latest/ref/Tags/createLink.html">createLink()</a> 的方法实现的。这会最终产生一个指向 <code>EmployeeController</code> 的链接，位于：</p>
<div class="highlight"><pre><span></span><code>embrow/grails-app/controllers/com/nuevaconsulting/embrow/EmployeeController.groovy
</code></pre></div>

<p>特别是控制器方法 <code>browserLister()</code>。我在代码中留了一些 <code>print</code> 语句，以便在运行时能够在终端看到中间结果。</p>
<div class="highlight"><pre><span></span><code><span class="w">    </span><span class="nv">def</span><span class="w"> </span><span class="nv">browserLister</span><span class="ss">()</span><span class="w"> </span>{
<span class="w">        </span><span class="o">//</span><span class="w"> </span><span class="nv">Applies</span><span class="w"> </span><span class="nv">filters</span><span class="w"> </span><span class="nv">and</span><span class="w"> </span><span class="nv">sorting</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nv">list</span><span class="w"> </span><span class="nv">of</span><span class="w"> </span><span class="nv">desired</span><span class="w"> </span><span class="nv">employees</span>
</code></pre></div>

<p>首先，打印出传递给 <code>browserLister()</code> 的参数。我通常使用此代码开始构建控制器方法，以便我完全清楚我的控制器正在接收什么。</p>
<div class="highlight"><pre><span></span><code>      println &quot;employee browserLister params $params&quot;
        println()
</code></pre></div>

<p>接下来，处理这些参数以使它们更加有用。首先，jQuery DataTables 参数，一个名为 <code>jqdtParams</code> 的 Groovy 映射：</p>
<div class="highlight"><pre><span></span><code><span class="n">def</span><span class="w"> </span><span class="n">jqdtParams</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="n">:</span><span class="o">]</span>
<span class="n">params</span><span class="p">.</span><span class="k">each</span><span class="w"> </span><span class="err">{</span><span class="w"> </span><span class="k">key</span><span class="p">,</span><span class="w"> </span><span class="k">value</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">keyFields</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">key</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="s1">&#39;]&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">).</span><span class="n">split</span><span class="p">(</span><span class="o">/</span><span class="err">\</span><span class="o">[</span><span class="n">/)</span>
<span class="n">    def table = jqdtParams</span>
<span class="n">    for (int f = 0; f &lt; keyFields.size() - 1; f++) {</span>
<span class="n">        def keyField = keyFields[f</span><span class="o">]</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="err">!</span><span class="nc">table</span><span class="p">.</span><span class="n">containsKey</span><span class="p">(</span><span class="n">keyField</span><span class="p">))</span>
<span class="w">            </span><span class="nc">table</span><span class="o">[</span><span class="n">keyField</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="n">:</span><span class="o">]</span>
<span class="w">        </span><span class="nc">table</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">table</span><span class="o">[</span><span class="n">keyField</span><span class="o">]</span>
<span class="w">    </span><span class="err">}</span>
<span class="w">    </span><span class="nc">table</span><span class="o">[</span><span class="n">keyFields[-1</span><span class="o">]</span><span class="err">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">value</span>
<span class="err">}</span>
<span class="n">println</span><span class="w"> </span><span class="ss">&quot;employee dataTableParams $jqdtParams&quot;</span>
<span class="n">println</span><span class="p">()</span>
</code></pre></div>

<p>接下来，列数据，一个名为 <code>columnMap</code> 的 Groovy 映射：</p>
<div class="highlight"><pre><span></span><code>def<span class="w"> </span>columnMap<span class="w"> </span>=<span class="w"> </span>jqdtParams.columns.collectEntries<span class="w"> </span>{<span class="w"> </span>k,<span class="w"> </span>v<span class="w"> </span>-&gt;
<span class="w">    </span>def<span class="w"> </span>whereTerm<span class="w"> </span>=<span class="w"> </span>null
<span class="w">    </span>switch<span class="w"> </span>(v.data)<span class="w"> </span>{
<span class="w">    </span>case<span class="w"> </span>&#39;extension&#39;:
<span class="w">    </span>case<span class="w"> </span>&#39;hired&#39;:
<span class="w">    </span>case<span class="w"> </span>&#39;salary&#39;:
<span class="w">        </span>if<span class="w"> </span>(v.search.value<span class="w"> </span>==~<span class="w"> </span>/\d+(,\d+)*/)
<span class="w">            </span>whereTerm<span class="w"> </span>=<span class="w"> </span>v.search.value.split(&#39;,&#39;).collect<span class="w"> </span>{<span class="w"> </span>it<span class="w"> </span>as<span class="w"> </span>Integer<span class="w"> </span>}
<span class="w">        </span>break
<span class="w">    </span>default:
<span class="w">        </span>if<span class="w"> </span>(v.search.value<span class="w"> </span>==~<span class="w"> </span>/[A-Za-z0-9<span class="w"> </span>]+/)
<span class="w">            </span>whereTerm<span class="w"> </span>=<span class="w"> </span>&quot;%<span class="cp">${</span><span class="n">v</span><span class="o">.</span><span class="n">search</span><span class="o">.</span><span class="n">value</span><span class="cp">}</span>%&quot;<span class="w"> </span>as<span class="w"> </span>String
<span class="w">        </span>break
<span class="w">    </span>}
<span class="w">    </span>[(v.data):<span class="w"> </span>[where:<span class="w"> </span>whereTerm]]
}
println<span class="w"> </span>&quot;employee<span class="w"> </span>columnMap<span class="w"> </span><span class="nv">$columnMap</span>&quot;
println()
</code></pre></div>

<p>接下来，从 <code>columnMap</code> 中检索的所有列表，以及在视图中应如何排序这些列表，Groovy 列表分别称为 <code>allColumnList</code> 和 <code>orderList</code> ：</p>
<div class="highlight"><pre><span></span><code><span class="n">def</span><span class="w"> </span><span class="n">allColumnList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">columnMap</span><span class="p">.</span><span class="n">keySet</span><span class="p">()</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="n">List</span>
<span class="n">println</span><span class="w"> </span><span class="s">&quot;employee allColumnList $allColumnList&quot;</span>
<span class="n">def</span><span class="w"> </span><span class="n">orderList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">jqdtParams</span><span class="p">.</span><span class="n">order</span><span class="p">.</span><span class="n">collect</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">[</span><span class="n">allColumnList</span><span class="p">[</span><span class="n">v</span><span class="p">.</span><span class="n">column</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="n">Integer</span><span class="p">],</span><span class="w"> </span><span class="n">v</span><span class="p">.</span><span class="n">dir</span><span class="p">]</span><span class="w"> </span><span class="p">}</span>
<span class="n">println</span><span class="w"> </span><span class="s">&quot;employee orderList $orderList&quot;</span>
</code></pre></div>

<p>我们将使用 Grails 的 Hibernate 标准实现来实际选择要显示的元素以及它们的排序和分页。标准要求过滤器关闭；在大多数示例中，这是作为标准实例本身的创建的一部分给出的，但是在这里我们预先定义过滤器闭包。请注意，在这种情况下，“date hired” 过滤器的相对复杂的解释被视为一年并应用于建立日期范围，并使用 <code>createAlias</code> 以允许我们进入相关类别 <code>Position</code> 和 <code>Office</code>：</p>
<div class="highlight"><pre><span></span><code>def<span class="w"> </span>filterer<span class="w"> </span>=<span class="w"> </span>{
<span class="w">    </span>createAlias<span class="w"> </span>&#39;position&#39;,<span class="w">        </span>&#39;p&#39;
<span class="w">    </span>createAlias<span class="w"> </span>&#39;office&#39;,<span class="w">          </span>&#39;o&#39;

<span class="w">    </span>if<span class="w"> </span>(columnMap.surname.where)<span class="w">    </span>ilike<span class="w">  </span>&#39;surname&#39;,<span class="w">     </span>columnMap.surname.where
<span class="w">    </span>if<span class="w"> </span>(columnMap.givenNames.where)<span class="w"> </span>ilike<span class="w">  </span>&#39;givenNames&#39;,<span class="w">  </span>columnMap.givenNames.where
<span class="w">    </span>if<span class="w"> </span>(columnMap.position.where)<span class="w">   </span>ilike<span class="w">  </span>&#39;p.name&#39;,<span class="w">      </span>columnMap.position.where
<span class="w">    </span>if<span class="w"> </span>(columnMap.office.where)<span class="w">     </span>ilike<span class="w">  </span>&#39;o.name&#39;,<span class="w">      </span>columnMap.office.where
<span class="w">    </span>if<span class="w"> </span>(columnMap.extension.where)<span class="w">  </span>inList<span class="w"> </span>&#39;extension&#39;,<span class="w">   </span>columnMap.extension.where
<span class="w">    </span>if<span class="w"> </span>(columnMap.salary.where)<span class="w">     </span>inList<span class="w"> </span>&#39;salary&#39;,<span class="w">      </span>columnMap.salary.where
<span class="w">    </span>if<span class="w"> </span>(columnMap.hired.where)<span class="w"> </span>{
<span class="w">        </span>if<span class="w"> </span>(columnMap.hired.where.size()<span class="w"> </span>&gt;<span class="w"> </span>1)<span class="w"> </span>{
<span class="w">            </span>or<span class="w"> </span>{
<span class="w">                </span>columnMap.hired.where.each<span class="w"> </span>{
<span class="w">                    </span>between<span class="w"> </span>&#39;hired&#39;,<span class="w"> </span>Date.parse(&#39;yyyy/MM/dd&#39;,&quot;<span class="cp">${</span><span class="n">it</span><span class="cp">}</span>/01/01&quot;<span class="w"> </span>as<span class="w"> </span>String),
<span class="w">                        </span>Date.parse(&#39;yyyy/MM/dd&#39;,&quot;<span class="cp">${</span><span class="n">it</span><span class="cp">}</span>/12/31&quot;<span class="w"> </span>as<span class="w"> </span>String)
<span class="w">                </span>}
<span class="w">            </span>}
<span class="w">        </span>}<span class="w"> </span>else<span class="w"> </span>{
<span class="w">            </span>between<span class="w"> </span>&#39;hired&#39;,<span class="w"> </span>Date.parse(&#39;yyyy/MM/dd&#39;,&quot;<span class="cp">${</span><span class="n">columnMap</span><span class="o">.</span><span class="n">hired</span><span class="o">.</span><span class="n">where</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="cp">}</span>/01/01&quot;<span class="w"> </span>as<span class="w"> </span>String),
<span class="w">                </span>Date.parse(&#39;yyyy/MM/dd&#39;,&quot;<span class="cp">${</span><span class="n">columnMap</span><span class="o">.</span><span class="n">hired</span><span class="o">.</span><span class="n">where</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="cp">}</span>/12/31&quot;<span class="w"> </span>as<span class="w"> </span>String)
<span class="w">        </span>}
<span class="w">    </span>}
}
</code></pre></div>

<p>是时候应用上述内容了。第一步是获取分页代码所需的所有 <code>Employee</code> 实例的总数：</p>
<div class="highlight"><pre><span></span><code>        def recordsTotal = Employee.count()
        println &quot;employee recordsTotal $recordsTotal&quot;
</code></pre></div>

<p>接下来，将过滤器应用于 <code>Employee</code> 实例以获取过滤结果的计数，该结果将始终小于或等于总数（同样，这是针对分页代码）：</p>
<div class="highlight"><pre><span></span><code>        def c = Employee.createCriteria()
        def recordsFiltered = c.count {
            filterer.delegate = delegate
            filterer()
        }
        println &quot;employee recordsFiltered $recordsFiltered&quot;
</code></pre></div>

<p>获得这两个计数后，你还可以使用分页和排序信息获取实际过滤的实例。</p>
<div class="highlight"><pre><span></span><code><span class="w">      </span><span class="n">def</span><span class="w"> </span><span class="n">orderer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Employee</span><span class="p">.</span><span class="n">withCriteria</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">filterer</span><span class="p">.</span><span class="n">delegate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">delegate</span>
<span class="w">            </span><span class="n">filterer</span><span class="p">()</span>
<span class="w">            </span><span class="n">orderList</span><span class="p">.</span><span class="n">each</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">oi</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">                </span><span class="n">switch</span><span class="w"> </span><span class="p">(</span><span class="n">oi</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="kr">case</span><span class="w"> </span><span class="s">&#39;surname&#39;</span><span class="o">:</span><span class="w">    </span><span class="n">order</span><span class="w"> </span><span class="s">&#39;surname&#39;</span><span class="p">,</span><span class="w">    </span><span class="n">oi</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span><span class="w"> </span><span class="n">break</span>
<span class="w">                </span><span class="kr">case</span><span class="w"> </span><span class="s">&#39;givenNames&#39;</span><span class="o">:</span><span class="w"> </span><span class="n">order</span><span class="w"> </span><span class="s">&#39;givenNames&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">oi</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span><span class="w"> </span><span class="n">break</span>
<span class="w">                </span><span class="kr">case</span><span class="w"> </span><span class="s">&#39;position&#39;</span><span class="o">:</span><span class="w">   </span><span class="n">order</span><span class="w"> </span><span class="s">&#39;p.name&#39;</span><span class="p">,</span><span class="w">     </span><span class="n">oi</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span><span class="w"> </span><span class="n">break</span>
<span class="w">                </span><span class="kr">case</span><span class="w"> </span><span class="s">&#39;office&#39;</span><span class="o">:</span><span class="w">     </span><span class="n">order</span><span class="w"> </span><span class="s">&#39;o.name&#39;</span><span class="p">,</span><span class="w">     </span><span class="n">oi</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span><span class="w"> </span><span class="n">break</span>
<span class="w">                </span><span class="kr">case</span><span class="w"> </span><span class="s">&#39;extension&#39;</span><span class="o">:</span><span class="w">  </span><span class="n">order</span><span class="w"> </span><span class="s">&#39;extension&#39;</span><span class="p">,</span><span class="w">  </span><span class="n">oi</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span><span class="w"> </span><span class="n">break</span>
<span class="w">                </span><span class="kr">case</span><span class="w"> </span><span class="s">&#39;hired&#39;</span><span class="o">:</span><span class="w">      </span><span class="n">order</span><span class="w"> </span><span class="s">&#39;hired&#39;</span><span class="p">,</span><span class="w">      </span><span class="n">oi</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span><span class="w"> </span><span class="n">break</span>
<span class="w">                </span><span class="kr">case</span><span class="w"> </span><span class="s">&#39;salary&#39;</span><span class="o">:</span><span class="w">     </span><span class="n">order</span><span class="w"> </span><span class="s">&#39;salary&#39;</span><span class="p">,</span><span class="w">     </span><span class="n">oi</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span><span class="w"> </span><span class="n">break</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="n">maxResults</span><span class="w"> </span><span class="p">(</span><span class="n">jqdtParams</span><span class="p">.</span><span class="nf">length</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="n">Integer</span><span class="p">)</span>
<span class="w">            </span><span class="n">firstResult</span><span class="w"> </span><span class="p">(</span><span class="n">jqdtParams</span><span class="p">.</span><span class="n">start</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="n">Integer</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
</code></pre></div>

<p>要完全清楚，JTable 中的分页代码管理三个计数：数据集中的记录总数，应用过滤器后得到的数字，以及要在页面上显示的数字（显示是滚动还是分页）。 排序应用于所有过滤的记录，并且分页应用于那些过滤的记录的块以用于显示目的。</p>
<p>接下来，处理命令返回的结果，在每行中创建指向 <code>Employee</code>、<code>Position</code> 和 <code>Office</code> 实例的链接，以便用户可以单击这些链接以获取相关实例的所有详细信息：</p>
<div class="highlight"><pre><span></span><code><span class="w">        </span>def<span class="w"> </span>dollarFormatter<span class="w"> </span>=<span class="w"> </span>new<span class="w"> </span>DecimalFormat(&#39;$##,###.##&#39;)
<span class="w">        </span>def<span class="w"> </span>employees<span class="w"> </span>=<span class="w"> </span>orderer.collect<span class="w"> </span>{<span class="w"> </span>employee<span class="w"> </span>-&gt;
<span class="w">            </span>[&#39;surname&#39;:<span class="w"> </span>&quot;<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&#39;</span><span class="cp">${</span><span class="n">createLink</span><span class="p">(</span><span class="n">controller</span><span class="p">:</span> <span class="s1">&#39;employee&#39;</span><span class="p">,</span> <span class="n">action</span><span class="p">:</span> <span class="s1">&#39;show&#39;</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span> <span class="n">employee</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="cp">}</span><span class="s">&#39;</span><span class="nt">&gt;</span><span class="cp">${</span><span class="n">employee</span><span class="o">.</span><span class="n">surname</span><span class="cp">}</span><span class="nt">&lt;/a&gt;</span>&quot;,
<span class="w">                </span>&#39;givenNames&#39;:<span class="w"> </span>employee.givenNames,
<span class="w">                </span>&#39;position&#39;:<span class="w"> </span>&quot;<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&#39;</span><span class="cp">${</span><span class="n">createLink</span><span class="p">(</span><span class="n">controller</span><span class="p">:</span> <span class="s1">&#39;position&#39;</span><span class="p">,</span> <span class="n">action</span><span class="p">:</span> <span class="s1">&#39;show&#39;</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span> <span class="n">employee</span><span class="o">.</span><span class="n">position</span><span class="err">?</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="cp">}</span><span class="s">&#39;</span><span class="nt">&gt;</span><span class="cp">${</span><span class="n">employee</span><span class="o">.</span><span class="n">position</span><span class="err">?</span><span class="o">.</span><span class="n">name</span><span class="cp">}</span><span class="nt">&lt;/a&gt;</span>&quot;,
<span class="w">                </span>&#39;office&#39;:<span class="w"> </span>&quot;<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&#39;</span><span class="cp">${</span><span class="n">createLink</span><span class="p">(</span><span class="n">controller</span><span class="p">:</span> <span class="s1">&#39;office&#39;</span><span class="p">,</span> <span class="n">action</span><span class="p">:</span> <span class="s1">&#39;show&#39;</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span> <span class="n">employee</span><span class="o">.</span><span class="n">office</span><span class="err">?</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="cp">}</span><span class="s">&#39;</span><span class="nt">&gt;</span><span class="cp">${</span><span class="n">employee</span><span class="o">.</span><span class="n">office</span><span class="err">?</span><span class="o">.</span><span class="n">name</span><span class="cp">}</span><span class="nt">&lt;/a&gt;</span>&quot;,
<span class="w">                </span>&#39;extension&#39;:<span class="w"> </span>employee.extension,
<span class="w">                </span>&#39;hired&#39;:<span class="w"> </span>employee.hired.format(&#39;yyyy/MM/dd&#39;),
<span class="w">                </span>&#39;salary&#39;:<span class="w"> </span>dollarFormatter.format(employee.salary)]
<span class="w">        </span>}
</code></pre></div>

<p>最后，创建要返回的结果并将其作为 JSON 返回，这是 jQuery DataTables 所需要的。</p>
<div class="highlight"><pre><span></span><code>        def result = [draw: jqdtParams.draw, recordsTotal: recordsTotal, recordsFiltered: recordsFiltered, data: employees]
        render(result as JSON)
    }
</code></pre></div>

<p>大功告成。</p>
<p>如果你熟悉 Grails，这可能看起来比你原先想象的要多，但这里没有火箭式的一步到位方法，只是很多分散的操作步骤。但是，如果你没有太多接触 Grails（或 Groovy），那么需要了解很多新东西 - 闭包，代理和构建器等等。</p>
<p>在那种情况下，从哪里开始？ 最好的地方是了解 Groovy 本身，尤其是 <a href="http://groovy-lang.org/closures.html">Groovy closures</a> 和 <a href="http://groovy-lang.org/dsls.html">Groovy delegates and builders</a>。然后再去阅读上面关于 Grails 和 Hibernate 条件查询的建议阅读文章。</p>
<h3>结语</h3>
<p>jQuery DataTables 为 Grails 制作了很棒的表格数据浏览器。对视图进行编码并不是太棘手，但 DataTables 文档中提供的 PHP 示例提供的功能仅到此位置。特别是，它们不是用 Grails 程序员编写的，也不包含探索使用引用其他类（实质上是查找表）的元素的更精细的细节。</p>
<p>我使用这种方法制作了几个数据浏览器，允许用户选择要查看和累积记录计数的列，或者只是浏览数据。即使在相对适度的 VPS 上的百万行表中，性能也很好。</p>
<p>一个警告：我偶然发现了 Grails 中暴露的各种 Hibernate 标准机制的一些问题（请参阅我的其他 GitHub 代码库），因此需要谨慎和实验。如果所有其他方法都失败了，另一种方法是动态构建 SQL 字符串并执行它们。在撰写本文时，我更喜欢使用 Grails 标准，除非我遇到杂乱的子查询，但这可能只反映了我在 Hibernate 中对子查询的相对缺乏经验。</p>
<p>我希望 Grails 程序员发现本文的有趣性。请随时在下面留下评论或建议。</p>
    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>links</h2>
                        <ul>
                            <li><a href="https://getpelican.com/">Pelican</a></li>
                            <li><a href="https://www.python.org/">Python.org</a></li>
                            <li><a href="https://palletsprojects.com/p/jinja/">Jinja2</a></li>
                            <li><a href="#">You can modify those links in your config file</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>

                            <li><a href="#">You can add links in your config file</a></li>
                            <li><a href="#">Another social link</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a rel="nofollow" href="https://getpelican.com/">Pelican</a>, which takes great advantage of <a rel="nofollow" href="https://www.python.org/">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a rel="nofollow" href="https://www.smashingmagazine.com/2009/08/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>