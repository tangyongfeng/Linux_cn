<!DOCTYPE html>
<html lang="zh">
<head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="generator" content="Pelican" />
        <title>在 Linux 中安全且轻松地管理 Cron 定时任务</title>
        <link rel="stylesheet" href="/theme/css/main.css" />
        <meta name="description" content="Author: Sk 在 Linux 中遇到计划任务的时候，你首先会想到的大概就是 Cron 定时任务了。Cron 定时任务能帮助你在类 Unix 操作系统中计划 …" />
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">linux_cn</a></h1>
                <nav><ul>
                    <li><a href="/category/chuan-shan-jia-zhuan-fang">穿山甲专访</a></li>
                    <li><a href="/category/dai-ma-ying-xiong">代码英雄</a></li>
                    <li><a href="/category/fen-xiang">分享</a></li>
                    <li><a href="/category/guan-dian">观点</a></li>
                    <li><a href="/category/huo-dong">活动</a></li>
                    <li><a href="/category/ji-ke-man-hua">极客漫画</a></li>
                    <li class="active"><a href="/category/ji-zhu">技术</a></li>
                    <li><a href="/category/kai-yuan-zhi-hui">开源智慧</a></li>
                    <li><a href="/category/linux-fa-xing-ban">Linux 发行版</a></li>
                    <li><a href="/category/mei-ri-an-quan-zi-xun">每日安全资讯</a></li>
                    <li><a href="/category/misc">Misc</a></li>
                    <li><a href="/category/qu-kuai-lian">区块链</a></li>
                    <li><a href="/category/rong-qi-yu-yun">容器与云</a></li>
                    <li><a href="/category/ruan-jian-kai-fa">软件开发</a></li>
                    <li><a href="/category/shu-mei-pai">树莓派</a></li>
                    <li><a href="/category/xi-tong-yun-wei">系统运维</a></li>
                    <li><a href="/category/xin-wen">新闻</a></li>
                    <li><a href="/category/ying-he-guan-cha">硬核观察</a></li>
                    <li><a href="/category/zhi-ye-sheng-ya">职业生涯</a></li>
                    <li><a href="/category/zhong-jiang-ming-dan">中奖名单</a></li>
                    <li><a href="/category/zhuo-mian-ying-yong">桌面应用</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="/2018/10/zai-linux-zhong-an-quan-qie-qing-song-di-guan-li-cron-ding-shi-ren-wu.html" rel="bookmark"
           title="Permalink to 在 Linux 中安全且轻松地管理 Cron 定时任务">在 Linux 中安全且轻松地管理 Cron 定时任务</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2018-10-03T21:29:37+02:00">
                Published: Wed 03 October 2018
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/linux-fans-from-china.html">linux fans from china</a>
        </address>
<p>In <a href="/category/ji-zhu">技术</a>.</p>

</footer><!-- /.post-info -->      <p>Author: Sk</p>
<p><img alt="" src="/data/attachment/album/201810/03/212938rnqohu4nuhnguaou.jpg"></p>
<p>在 Linux 中遇到计划任务的时候，你首先会想到的大概就是 Cron 定时任务了。Cron 定时任务能帮助你在类 Unix 操作系统中计划性地执行命令或者任务。也可以参考一下我们之前的一篇《<a href="https://www.ostechnix.com/a-beginners-guide-to-cron-jobs/">关于 Cron 定时任务的新手指导</a>》。对于有一定 Linux 经验的人来说，设置 Cron 定时任务不是什么难事，但对于新手来说就不一定了，他们在编辑 crontab 文件的时候不知不觉中犯的一些小错误，也有可能把整个 Cron 定时任务搞挂了。如果你在处理 Cron 定时任务的时候为了以防万一，可以尝试使用 <strong>Crontab UI</strong>，它是一个可以在类 Unix 操作系统上安全轻松管理 Cron 定时任务的 Web 页面工具。</p>
<p>Crontab UI 是使用 NodeJS 编写的自由开源软件。有了 Crontab UI，你在创建、删除和修改 Cron 定时任务的时候就不需要手工编辑 Crontab 文件了，只需要打开浏览器稍微操作一下，就能完成上面这些工作。你可以用 Crontab UI 轻松创建、编辑、暂停、删除、备份 Cron 定时任务，甚至还可以简单地做到导入、导出、部署其它机器上的 Cron 定时任务，它还支持错误日志、邮件发送和钩子。</p>
<h3>安装 Crontab UI</h3>
<p>只需要一条命令就可以安装好 Crontab UI，但前提是已经安装好 NPM。如果还没有安装 NPM，可以参考《<a href="https://www.ostechnix.com/install-node-js-linux/">如何在 Linux 上安装 NodeJS</a>》这篇文章。</p>
<p>执行这一条命令来安装 Crontab UI。</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>npm<span class="w"> </span>install<span class="w"> </span>-g<span class="w"> </span>crontab-ui
</code></pre></div>

<p>就是这么简单，下面继续来看看在 Crontab UI 上如何管理 Cron 定时任务。</p>
<h3>在 Linux 上安全轻松管理 Cron 定时任务</h3>
<p>执行这一条命令启动 Crontab UI：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>crontab-ui
</code></pre></div>

<p>你会看到这样的输出：</p>
<div class="highlight"><pre><span></span><code>Node version: 10.8.0
Crontab UI is running at http://127.0.0.1:8000
</code></pre></div>

<p>首先在你的防火墙和路由器上放开 8000 端口，然后打开浏览器访问 <code>&lt;http://127.0.0.1:8000&gt;</code>。</p>
<p>注意，默认只有在本地才能访问到 Crontab UI 的控制台页面。但如果你想让 Crontab UI 使用系统的 IP 地址和自定义端口，也就是想让其它机器也访问到本地的 Crontab UI，你需要使用以下这个命令：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span><span class="nv">HOST</span><span class="o">=</span><span class="m">0</span>.0.0.0<span class="w"> </span><span class="nv">PORT</span><span class="o">=</span><span class="m">9000</span><span class="w"> </span>crontab-ui
Node<span class="w"> </span>version:<span class="w"> </span><span class="m">10</span>.8.0
Crontab<span class="w"> </span>UI<span class="w"> </span>is<span class="w"> </span>running<span class="w"> </span>at<span class="w"> </span>http://0.0.0.0:9000
</code></pre></div>

<p>Crontab UI 就能够通过 <code>&lt;http://IP-Address&gt;:9000</code> 这样的 URL 被远程机器访问到了。</p>
<p>Crontab UI 的控制台页面长这样：</p>
<p><img alt="" src="/data/attachment/album/201810/03/212939ctiit3soheg09ttx.png"></p>
<p>从上面的截图就可以看到，Crontab UI 的界面非常简洁，所有选项的含义都能不言自明。</p>
<p>在终端输入 <code>Ctrl + C</code> 就可以关闭 Crontab UI。</p>
<h4>创建、编辑、运行、停止、删除 Cron 定时任务</h4>
<p>点击 “New”，输入 Cron 定时任务的信息并点击 “Save” 保存，就可以创建一个新的 Cron 定时任务了。</p>
<ol>
<li>为 Cron 定时任务命名，这是可选的；</li>
<li>你想要执行的完整命令；</li>
<li>设定计划执行的时间。你可以按照启动、每时、每日、每周、每月、每年这些指标快速指定计划任务，也可以明确指定任务执行的具体时间。指定好计划时间后，“Jobs” 区域就会显示 Cron 定时任务的句式。</li>
<li>选择是否为某个 Cron 定时任务记录错误日志。</li>
</ol>
<p>这是我的一个 Cron 定时任务样例。</p>
<p><img alt="" src="/data/attachment/album/201810/03/212940ia4hwicajwa3vtw3.png"></p>
<p>如你所见，我设置了一个每月清理 <code>pacman</code> 缓存的 Cron 定时任务。你也可以设置多个 Cron 定时任务，都能在控制台页面看到。</p>
<p><img alt="" src="/data/attachment/album/201810/03/212941tnx126n1xw7mon0c.png"></p>
<p>如果你需要更改 Cron 定时任务中的某些参数，只需要点击 “Edit” 按钮并按照你的需求更改对应的参数。点击 “Run” 按钮可以立即执行 Cron 定时任务，点击 “Stop” 则可以立即停止 Cron 定时任务。如果想要查看某个 Cron 定时任务的详细日志，可以点击 “Log” 按钮。对于不再需要的 Cron 定时任务，就可以按 “Delete” 按钮删除。</p>
<h4>备份 Cron 定时任务</h4>
<p>点击控制台页面的 “Backup” 按钮并确认，就可以备份所有 Cron 定时任务。</p>
<p><img alt="" src="/data/attachment/album/201810/03/212941t415j0k9kjpp11k3.png"></p>
<p>备份之后，一旦 Crontab 文件出现了错误，就可以使用备份来恢复了。</p>
<h4>导入/导出其它机器上的 Cron 定时任务</h4>
<p>Crontab UI 还有一个令人注目的功能，就是导入、导出、部署其它机器上的 Cron 定时任务。如果同一个网络里的多台机器都需要执行同样的 Cron 定时任务，只需要点击 “Export” 按钮并选择文件的保存路径，所有的 Cron 定时任务都会导出到 <code>crontab.db</code> 文件中。</p>
<p>以下是 <code>crontab.db</code> 文件的内容：</p>
<div class="highlight"><pre><span></span><code><span class="o">$</span><span class="w"> </span><span class="n">cat</span><span class="w"> </span><span class="n">Downloads</span><span class="o">/</span><span class="n">crontab</span><span class="o">.</span><span class="n">db</span>
<span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;Remove Pacman Cache&quot;</span><span class="p">,</span><span class="s2">&quot;command&quot;</span><span class="p">:</span><span class="s2">&quot;rm -rf /var/cache/pacman&quot;</span><span class="p">,</span><span class="s2">&quot;schedule&quot;</span><span class="p">:</span><span class="s2">&quot;@monthly&quot;</span><span class="p">,</span><span class="s2">&quot;stopped&quot;</span><span class="p">:</span><span class="bp">false</span><span class="p">,</span><span class="s2">&quot;timestamp&quot;</span><span class="p">:</span><span class="s2">&quot;Thu Aug 23 2018 10:34:19 GMT+0000 (Coordinated Universal Time)&quot;</span><span class="p">,</span><span class="s2">&quot;logging&quot;</span><span class="p">:</span><span class="s2">&quot;true&quot;</span><span class="p">,</span><span class="s2">&quot;mailing&quot;</span><span class="p">:{},</span><span class="s2">&quot;created&quot;</span><span class="p">:</span><span class="mi">1535020459093</span><span class="p">,</span><span class="s2">&quot;_id&quot;</span><span class="p">:</span><span class="s2">&quot;lcVc1nSdaceqS1ut&quot;</span><span class="p">}</span>
</code></pre></div>

<p>导出成文件以后，你就可以把这个 <code>crontab.db</code> 文件放置到其它机器上并导入成 Cron 定时任务，而不需要在每一台主机上手动设置 Cron 定时任务。总之，在一台机器上设置完，导出，再导入到其他机器，就完事了。</p>
<h4>在 Crontab 文件获取/保存 Cron 定时任务</h4>
<p>你可能在使用 Crontab UI 之前就已经使用 <code>crontab</code> 命令创建过 Cron 定时任务。如果是这样，你可以点击控制台页面上的 “Get from crontab” 按钮来获取已有的 Cron 定时任务。</p>
<p><img alt="" src="/data/attachment/album/201810/03/212942u1ve128g2j2s7u28.png"></p>
<p>同样地，你也可以使用 Crontab UI 来将新的 Cron 定时任务保存到 Crontab 文件中，只需要点击 “Save to crontab” 按钮就可以了。</p>
<p>管理 Cron 定时任务并没有想象中那么难，即使是新手使用 Crontab UI 也能轻松管理 Cron 定时任务。赶快开始尝试并发表一下你的看法吧。</p>
    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>links</h2>
                        <ul>
                            <li><a href="https://getpelican.com/">Pelican</a></li>
                            <li><a href="https://www.python.org/">Python.org</a></li>
                            <li><a href="https://palletsprojects.com/p/jinja/">Jinja2</a></li>
                            <li><a href="#">You can modify those links in your config file</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>

                            <li><a href="#">You can add links in your config file</a></li>
                            <li><a href="#">Another social link</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a rel="nofollow" href="https://getpelican.com/">Pelican</a>, which takes great advantage of <a rel="nofollow" href="https://www.python.org/">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a rel="nofollow" href="https://www.smashingmagazine.com/2009/08/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>