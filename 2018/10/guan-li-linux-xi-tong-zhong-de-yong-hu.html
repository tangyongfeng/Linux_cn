<!DOCTYPE html>
<html lang="zh">
<head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="generator" content="Pelican" />
        <title>管理 Linux 系统中的用户</title>
        <link rel="stylesheet" href="/theme/css/main.css" />
        <meta name="description" content="Author: Sandra Henry-stocker 也许你的 Linux 用户并不是愤怒的公牛，但是当涉及管理他们的账户的时候，能让他们一直满意也是一种挑战。你需要 …" />
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">linux_cn</a></h1>
                <nav><ul>
                    <li><a href="/category/chuan-shan-jia-zhuan-fang">穿山甲专访</a></li>
                    <li><a href="/category/dai-ma-ying-xiong">代码英雄</a></li>
                    <li><a href="/category/fen-xiang">分享</a></li>
                    <li><a href="/category/guan-dian">观点</a></li>
                    <li><a href="/category/huo-dong">活动</a></li>
                    <li><a href="/category/ji-ke-man-hua">极客漫画</a></li>
                    <li class="active"><a href="/category/ji-zhu">技术</a></li>
                    <li><a href="/category/kai-yuan-zhi-hui">开源智慧</a></li>
                    <li><a href="/category/linux-fa-xing-ban">Linux 发行版</a></li>
                    <li><a href="/category/mei-ri-an-quan-zi-xun">每日安全资讯</a></li>
                    <li><a href="/category/misc">Misc</a></li>
                    <li><a href="/category/qu-kuai-lian">区块链</a></li>
                    <li><a href="/category/rong-qi-yu-yun">容器与云</a></li>
                    <li><a href="/category/ruan-jian-kai-fa">软件开发</a></li>
                    <li><a href="/category/shu-mei-pai">树莓派</a></li>
                    <li><a href="/category/xi-tong-yun-wei">系统运维</a></li>
                    <li><a href="/category/xin-wen">新闻</a></li>
                    <li><a href="/category/ying-he-guan-cha">硬核观察</a></li>
                    <li><a href="/category/zhi-ye-sheng-ya">职业生涯</a></li>
                    <li><a href="/category/zhong-jiang-ming-dan">中奖名单</a></li>
                    <li><a href="/category/zhuo-mian-ying-yong">桌面应用</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="/2018/10/guan-li-linux-xi-tong-zhong-de-yong-hu.html" rel="bookmark"
           title="Permalink to 管理 Linux 系统中的用户">管理 Linux 系统中的用户</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2018-10-10T13:12:00+02:00">
                Published: Wed 10 October 2018
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/linux-fans-from-china.html">linux fans from china</a>
        </address>
<p>In <a href="/category/ji-zhu">技术</a>.</p>

</footer><!-- /.post-info -->      <p>Author: Sandra Henry-stocker</p>
<p><img alt="" src="/data/attachment/album/201810/10/131228je3yc8i3ttyaa3ot.jpg"></p>
<p>也许你的 Linux 用户并不是愤怒的公牛，但是当涉及管理他们的账户的时候，能让他们一直满意也是一种挑战。你需要监控他们的访问权限，跟进他们遇到问题时的解决方案，并且把他们在使用系统时出现的重要变动记录下来。这里有一些方法和工具可以让这个工作轻松一点。</p>
<h3>配置账户</h3>
<p>添加和删除账户是管理用户中比较简单的一项，但是这里面仍然有很多需要考虑的方面。无论你是用桌面工具或是命令行选项，这都是一个非常自动化的过程。你可以使用 <code>adduser jdoe</code> 命令添加一个新用户，同时会触发一系列的反应。在创建 John 这个账户时会自动使用下一个可用的 UID，并有很多自动生成的文件来完成这个工作。当你运行 <code>adduser</code> 后跟一个参数时（要创建的用户名），它会提示一些额外的信息，同时解释这是在干什么。</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>sudo<span class="w"> </span>adduser<span class="w"> </span>jdoe
Adding<span class="w"> </span>user<span class="w"> </span><span class="s1">&#39;jdoe&#39;</span><span class="w"> </span>...
Adding<span class="w"> </span>new<span class="w"> </span>group<span class="w"> </span><span class="sb">`</span>jdoe<span class="s1">&#39; (1001) ...</span>
<span class="s1">Adding new user `jdoe&#39;</span><span class="w"> </span><span class="o">(</span><span class="m">1001</span><span class="o">)</span><span class="w"> </span>with<span class="w"> </span>group<span class="w"> </span><span class="sb">`</span>jdoe<span class="s1">&#39; ...</span>
<span class="s1">Creating home directory `/home/jdoe&#39;</span><span class="w"> </span>...
Copying<span class="w"> </span>files<span class="w"> </span>from<span class="w"> </span><span class="sb">`</span>/etc/skel<span class="err">&#39;</span><span class="w"> </span>…
Enter<span class="w"> </span>new<span class="w"> </span>UNIX<span class="w"> </span>password:
Retype<span class="w"> </span>new<span class="w"> </span>UNIX<span class="w"> </span>password:
passwd:<span class="w"> </span>password<span class="w"> </span>updated<span class="w"> </span>successfully
Changing<span class="w"> </span>the<span class="w"> </span>user<span class="w"> </span>information<span class="w"> </span><span class="k">for</span><span class="w"> </span>jdoe
Enter<span class="w"> </span>the<span class="w"> </span>new<span class="w"> </span>value,<span class="w"> </span>or<span class="w"> </span>press<span class="w"> </span>ENTER<span class="w"> </span><span class="k">for</span><span class="w"> </span>the<span class="w"> </span>default
<span class="w">    </span>Full<span class="w"> </span>Name<span class="w"> </span><span class="o">[]</span>:<span class="w"> </span>John<span class="w"> </span>Doe
<span class="w">    </span>Room<span class="w"> </span>Number<span class="w"> </span><span class="o">[]</span>:
<span class="w">    </span>Work<span class="w"> </span>Phone<span class="w"> </span><span class="o">[]</span>:
<span class="w">    </span>Home<span class="w"> </span>Phone<span class="w"> </span><span class="o">[]</span>:
<span class="w">    </span>Other<span class="w"> </span><span class="o">[]</span>:
Is<span class="w"> </span>the<span class="w"> </span>information<span class="w"> </span>correct?<span class="w"> </span><span class="o">[</span>Y/n<span class="o">]</span><span class="w"> </span>Y
</code></pre></div>

<p>如你所见，<code>adduser</code> 会添加用户的信息（到 <code>/etc/passwd</code> 和 <code>/etc/shadow</code> 文件中），创建新的<ruby> 家目录 <rt>  home directory </rt></ruby>，并用 <code>/etc/skel</code> 里设置的文件填充家目录，提示你分配初始密码和认证信息，然后确认这些信息都是正确的，如果你在最后的提示 “Is the information correct?” 处的回答是 “n”，它会回溯你之前所有的回答，允许修改任何你想要修改的地方。</p>
<p>创建好一个用户后，你可能会想要确认一下它是否是你期望的样子，更好的方法是确保在添加第一个帐户<strong>之前</strong>，“自动”选择与你想要查看的内容是否匹配。默认有默认的好处，它对于你想知道他们定义在哪里很有用，以便你想做出一些变动 —— 例如，你不想让用户的家目录在 <code>/home</code> 里，你不想让用户 UID 从 1000 开始，或是你不想让家目录下的文件被系统中的<strong>每个人</strong>都可读。</p>
<p><code>adduser</code> 的一些配置细节设置在 <code>/etc/adduser.conf</code> 文件里。这个文件包含的一些配置项决定了一个新的账户如何配置，以及它之后的样子。注意，注释和空白行将会在输出中被忽略，因此我们更关注配置项。</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>cat<span class="w"> </span>/etc/adduser.conf<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-v<span class="w"> </span><span class="s2">&quot;^#&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-v<span class="w"> </span><span class="s2">&quot;^</span>$<span class="s2">&quot;</span>
<span class="nv">DSHELL</span><span class="o">=</span>/bin/bash
<span class="nv">DHOME</span><span class="o">=</span>/home
<span class="nv">GROUPHOMES</span><span class="o">=</span>no
<span class="nv">LETTERHOMES</span><span class="o">=</span>no
<span class="nv">SKEL</span><span class="o">=</span>/etc/skel
<span class="nv">FIRST_SYSTEM_UID</span><span class="o">=</span><span class="m">100</span>
<span class="nv">LAST_SYSTEM_UID</span><span class="o">=</span><span class="m">999</span>
<span class="nv">FIRST_SYSTEM_GID</span><span class="o">=</span><span class="m">100</span>
<span class="nv">LAST_SYSTEM_GID</span><span class="o">=</span><span class="m">999</span>
<span class="nv">FIRST_UID</span><span class="o">=</span><span class="m">1000</span>
<span class="nv">LAST_UID</span><span class="o">=</span><span class="m">29999</span>
<span class="nv">FIRST_GID</span><span class="o">=</span><span class="m">1000</span>
<span class="nv">LAST_GID</span><span class="o">=</span><span class="m">29999</span>
<span class="nv">USERGROUPS</span><span class="o">=</span>yes
<span class="nv">USERS_GID</span><span class="o">=</span><span class="m">100</span>
<span class="nv">DIR_MODE</span><span class="o">=</span><span class="m">0755</span>
<span class="nv">SETGID_HOME</span><span class="o">=</span>no
<span class="nv">QUOTAUSER</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
<span class="nv">SKEL_IGNORE_REGEX</span><span class="o">=</span><span class="s2">&quot;dpkg-(old|new|dist|save)&quot;</span>
</code></pre></div>

<p>可以看到，我们有了一个默认的 shell（<code>DSHELL</code>），UID（<code>FIRST_UID</code>）的起始值，家目录（<code>DHOME</code>）的位置，以及启动文件（<code>SKEL</code>）的来源位置。这个文件也会指定分配给家目录（<code>DIR_HOME</code>）的权限。</p>
<p>其中 <code>DIR_HOME</code> 是最重要的设置，它决定了每个家目录被使用的权限。这个设置分配给用户创建的目录权限是 755，家目录的权限将会设置为 <code>rwxr-xr-x</code>。用户可以读其他用户的文件，但是不能修改和移除它们。如果你想要更多的限制，你可以更改这个设置为 750（用户组外的任何人都不可访问）甚至是 700（除用户自己外的人都不可访问）。</p>
<p>任何用户账号在创建之前都可以进行手动修改。例如，你可以编辑 <code>/etc/passwd</code> 或者修改家目录的权限，开始在新服务器上添加用户之前配置 <code>/etc/adduser.conf</code> 可以确保一定的一致性，从长远来看可以节省时间和避免一些麻烦。</p>
<p><code>/etc/adduser.conf</code> 的修改将会在之后创建的用户上生效。如果你想以不同的方式设置某个特定账户，除了用户名之外，你还可以选择使用 <code>adduser</code> 命令提供账户配置选项。或许你想为某些账户分配不同的 shell，分配特殊的 UID，或完全禁用该账户登录。<code>adduser</code> 的帮助页将会为你显示一些配置个人账户的选择。</p>
<div class="highlight"><pre><span></span><code><span class="n">adduser</span><span class="w"> </span><span class="o">[</span><span class="n">options</span><span class="o">]</span><span class="w"> </span><span class="o">[</span><span class="n">--home DIR</span><span class="o">]</span><span class="w"> </span><span class="o">[</span><span class="n">--shell SHELL</span><span class="o">]</span><span class="w"> </span><span class="o">[</span><span class="n">--no-create-home</span><span class="o">]</span>
<span class="o">[</span><span class="n">--uid ID</span><span class="o">]</span><span class="w"> </span><span class="o">[</span><span class="n">--firstuid ID</span><span class="o">]</span><span class="w"> </span><span class="o">[</span><span class="n">--lastuid ID</span><span class="o">]</span><span class="w"> </span><span class="o">[</span><span class="n">--ingroup GROUP | --gid ID</span><span class="o">]</span>
<span class="o">[</span><span class="n">--disabled-password</span><span class="o">]</span><span class="w"> </span><span class="o">[</span><span class="n">--disabled-login</span><span class="o">]</span><span class="w"> </span><span class="o">[</span><span class="n">--gecos GECOS</span><span class="o">]</span>
<span class="o">[</span><span class="n">--add_extra_groups</span><span class="o">]</span><span class="w"> </span><span class="o">[</span><span class="n">--encrypt-home</span><span class="o">]</span><span class="w"> </span><span class="k">user</span>
</code></pre></div>

<p>每个 Linux 系统现在都会默认把每个用户放入对应的组中。作为一个管理员，你可能会选择以不同的方式。你也许会发现把用户放在一个共享组中更适合你的站点，你就可以选择使用 <code>adduser</code> 的 <code>--gid</code> 选项指定一个特定的组。当然，用户总是许多组的成员，因此也有一些选项来管理主要和次要的组。</p>
<h3>处理用户密码</h3>
<p>一直以来，知道其他人的密码都不是一件好事，在设置账户时，管理员通常使用一个临时密码，然后在用户第一次登录时运行一条命令强制他修改密码。这里是一个例子：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>sudo<span class="w"> </span>chage<span class="w"> </span>-d<span class="w"> </span><span class="m">0</span><span class="w"> </span>jdoe
</code></pre></div>

<p>当用户第一次登录时，会看到类似下面的提示：</p>
<div class="highlight"><pre><span></span><code><span class="n">WARNING</span><span class="o">:</span><span class="w"> </span><span class="n">Your</span><span class="w"> </span><span class="n">password</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">expired</span><span class="o">.</span>
<span class="n">You</span><span class="w"> </span><span class="n">must</span><span class="w"> </span><span class="n">change</span><span class="w"> </span><span class="n">your</span><span class="w"> </span><span class="n">password</span><span class="w"> </span><span class="n">now</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">login</span><span class="w"> </span><span class="n">again</span><span class="o">!</span>
<span class="n">Changing</span><span class="w"> </span><span class="n">password</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">jdoe</span><span class="o">.</span>
<span class="o">(</span><span class="n">current</span><span class="o">)</span><span class="w"> </span><span class="n">UNIX</span><span class="w"> </span><span class="n">password</span><span class="o">:</span>
</code></pre></div>

<h3>添加用户到副组</h3>
<p>添加用户到副组中，你可能会用如下所示的 <code>usermod</code> 命令添加用户到组中并确认已经做出变动。</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>sudo<span class="w"> </span>usermod<span class="w"> </span>-a<span class="w"> </span>-G<span class="w"> </span>sudo<span class="w"> </span>jdoe
$<span class="w"> </span>sudo<span class="w"> </span>grep<span class="w"> </span>sudo<span class="w"> </span>/etc/group
sudo:x:27:shs,jdoe
</code></pre></div>

<p>记住在一些组意味着特别的权限，如 sudo 或者 wheel 组，一定要特别注意这一点。</p>
<h3>移除用户，添加组等</h3>
<p>Linux 系统也提供了移除账户，添加新的组，移除组等一些命令。例如，<code>deluser</code> 命令，将会从 <code>/etc/passwd</code> 和 <code>/etc/shadow</code> 中移除用户记录，但是会完整保留其家目录，除非你添加了 <code>--remove-home</code> 或者 <code>--remove-all-files</code> 选项。<code>addgroup</code> 命令会添加一个组，默认按目前组的次序分配下一个 id（在用户组范围内），除非你使用 <code>--gid</code> 选项指定 id。</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>sudo<span class="w"> </span>addgroup<span class="w"> </span>testgroup<span class="w"> </span>--gid<span class="o">=</span><span class="m">131</span>
Adding<span class="w"> </span>group<span class="w"> </span><span class="sb">`</span>testgroup<span class="err">&#39;</span><span class="w"> </span><span class="o">(</span>GID<span class="w"> </span><span class="m">131</span><span class="o">)</span><span class="w"> </span>...
Done.
</code></pre></div>

<h3>管理特权账户</h3>
<p>一些 Linux 系统中有一个 wheel 组，它给组中成员赋予了像 root 一样运行命令的权限。在这种情况下，<code>/etc/sudoers</code> 将会引用该组。在 Debian 系统中，这个组被叫做 sudo，但是原理是相同的，你在 <code>/etc/sudoers</code> 中可以看到像这样的信息：</p>
<div class="highlight"><pre><span></span><code><span class="nf">%sudo</span><span class="w">   </span><span class="n">ALL</span><span class="o">=</span><span class="p">(</span><span class="n">ALL</span><span class="o">:</span><span class="n">ALL</span><span class="p">)</span><span class="w"> </span><span class="n">ALL</span>
</code></pre></div>

<p>这行基本的配置意味着任何在 wheel 或者 sudo 组中的成员只要在他们运行的命令之前添加 <code>sudo</code>，就可以以 root 的权限去运行命令。</p>
<p>你可以向 sudoers 文件中添加更多有限的权限 —— 也许给特定用户几个能以 root 运行的命令。如果你是这样做的，你应该定期查看 <code>/etc/sudoers</code> 文件以评估用户拥有的权限，以及仍然需要提供的权限。</p>
<p>在下面显示的命令中，我们过滤了 <code>/etc/sudoers</code> 中有效的配置行。其中最有意思的是，它包含了能使用 <code>sudo</code> 运行命令的路径设置，以及两个允许通过 <code>sudo</code> 运行命令的组。像刚才提到的那样，单个用户可以通过包含在 sudoers 文件中来获得权限，但是更有实际意义的方法是通过组成员来定义各自的权限。</p>
<div class="highlight"><pre><span></span><code><span class="cp"># cat /etc/sudoers | grep -v &quot;^#&quot; | grep -v &quot;^$&quot;</span>
<span class="n">Defaults</span><span class="w"> </span><span class="n">env_reset</span>
<span class="n">Defaults</span><span class="w"> </span><span class="n">mail_badpass</span>
<span class="n">Defaults</span><span class="w"> </span><span class="n">secure_path</span><span class="o">=</span><span class="s">&quot;/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/snap/bin&quot;</span>
<span class="n">root</span><span class="w">    </span><span class="n">ALL</span><span class="o">=</span><span class="p">(</span><span class="n">ALL</span><span class="o">:</span><span class="n">ALL</span><span class="p">)</span><span class="w"> </span><span class="n">ALL</span>
<span class="nf">%admin</span><span class="w">  </span><span class="n">ALL</span><span class="o">=</span><span class="p">(</span><span class="n">ALL</span><span class="p">)</span><span class="w"> </span><span class="n">ALL</span><span class="w">       </span><span class="o">&lt;==</span><span class="w"> </span><span class="n">admin</span><span class="w"> </span><span class="n">group</span>
<span class="nf">%sudo</span><span class="w">   </span><span class="n">ALL</span><span class="o">=</span><span class="p">(</span><span class="n">ALL</span><span class="o">:</span><span class="n">ALL</span><span class="p">)</span><span class="w"> </span><span class="n">ALL</span><span class="w">   </span><span class="o">&lt;==</span><span class="w"> </span><span class="n">sudo</span><span class="w"> </span><span class="n">group</span>
</code></pre></div>

<h3>登录检查</h3>
<p>你可以通过以下命令查看用户的上一次登录：</p>
<div class="highlight"><pre><span></span><code># last jdoe
jdoe pts/18 192.168.0.11 Thu Sep 14 08:44 - 11:48 (00:04)
jdoe pts/18 192.168.0.11 Thu Sep 14 13:43 - 18:44 (00:00)
jdoe pts/18 192.168.0.11 Thu Sep 14 19:42 - 19:43 (00:00)
</code></pre></div>

<p>如果你想查看每一个用户上一次的登录情况，你可以通过一个像这样的循环来运行 <code>last</code> 命令：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span><span class="k">for</span><span class="w"> </span>user<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="sb">`</span>ls<span class="w"> </span>/home<span class="sb">`</span><span class="p">;</span><span class="w"> </span><span class="k">do</span><span class="w"> </span>last<span class="w"> </span><span class="nv">$user</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>head<span class="w"> </span>-1<span class="p">;</span><span class="w"> </span><span class="k">done</span>

jdoe<span class="w"> </span>pts/18<span class="w"> </span><span class="m">192</span>.168.0.11<span class="w"> </span>Thu<span class="w"> </span>Sep<span class="w"> </span><span class="m">14</span><span class="w"> </span><span class="m">19</span>:42<span class="w"> </span>-<span class="w"> </span><span class="m">19</span>:43<span class="w"> </span><span class="o">(</span><span class="m">00</span>:03<span class="o">)</span>

rocket<span class="w"> </span>pts/18<span class="w"> </span><span class="m">192</span>.168.0.11<span class="w"> </span>Thu<span class="w"> </span>Sep<span class="w"> </span><span class="m">14</span><span class="w"> </span><span class="m">13</span>:02<span class="w"> </span>-<span class="w"> </span><span class="m">13</span>:02<span class="w"> </span><span class="o">(</span><span class="m">00</span>:00<span class="o">)</span>
shs<span class="w"> </span>pts/17<span class="w"> </span><span class="m">192</span>.168.0.11<span class="w"> </span>Thu<span class="w"> </span>Sep<span class="w"> </span><span class="m">14</span><span class="w"> </span><span class="m">12</span>:45<span class="w"> </span>still<span class="w"> </span>logged<span class="w"> </span><span class="k">in</span>
</code></pre></div>

<p>此命令仅显示自当前 wtmp 文件登录过的用户。空白行表示用户自那以后从未登录过，但没有将他们显示出来。一个更好的命令可以明确地显示这期间从未登录过的用户：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span><span class="k">for</span><span class="w"> </span>user<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="sb">`</span>ls<span class="w"> </span>/home<span class="sb">`</span><span class="p">;</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span>-n<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$user</span><span class="s2">&quot;</span><span class="p">;</span><span class="w"> </span>last<span class="w"> </span><span class="nv">$user</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>head<span class="w"> </span>-1<span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">&#39;{print substr($0,40)}&#39;</span><span class="p">;</span><span class="w"> </span><span class="k">done</span>
dhayes
jdoe<span class="w"> </span>pts/18<span class="w"> </span><span class="m">192</span>.168.0.11<span class="w"> </span>Thu<span class="w"> </span>Sep<span class="w"> </span><span class="m">14</span><span class="w"> </span><span class="m">19</span>:42<span class="w"> </span>-<span class="w"> </span><span class="m">19</span>:43
peanut<span class="w"> </span>pts/19<span class="w"> </span><span class="m">192</span>.168.0.29<span class="w"> </span>Mon<span class="w"> </span>Sep<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">09</span>:15<span class="w"> </span>-<span class="w"> </span><span class="m">17</span>:11
rocket<span class="w"> </span>pts/18<span class="w"> </span><span class="m">192</span>.168.0.11<span class="w"> </span>Thu<span class="w"> </span>Sep<span class="w"> </span><span class="m">14</span><span class="w"> </span><span class="m">13</span>:02<span class="w"> </span>-<span class="w"> </span><span class="m">13</span>:02
shs<span class="w"> </span>pts/17<span class="w"> </span><span class="m">192</span>.168.0.11<span class="w"> </span>Thu<span class="w"> </span>Sep<span class="w"> </span><span class="m">14</span><span class="w"> </span><span class="m">12</span>:45<span class="w"> </span>still<span class="w"> </span>logged
tsmith
</code></pre></div>

<p>这个命令要打很多字，但是可以通过一个脚本使它更加清晰易用。</p>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>

<span class="k">for</span><span class="w"> </span>user<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="sb">`</span>ls<span class="w"> </span>/home<span class="sb">`</span>
<span class="k">do</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span>-n<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$user</span><span class="s2"> &quot;</span><span class="p">;</span>last<span class="w"> </span><span class="nv">$user</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>head<span class="w"> </span>-1<span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">&#39;{print substr($0,40)}&#39;</span>
<span class="k">done</span>
</code></pre></div>

<p>有时这些信息可以提醒你用户角色的变动，表明他们可能不再需要相关帐户了。</p>
<h3>与用户沟通</h3>
<p>Linux 提供了许多和用户沟通的方法。你可以向 <code>/etc/motd</code> 文件中添加信息，当用户从终端登录到服务器时，将会显示这些信息。你也可以通过例如 <code>write</code>（通知单个用户）或者 <code>wall</code>（write 给所有已登录的用户）命令发送通知。</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>wall<span class="w"> </span>System<span class="w"> </span>will<span class="w"> </span>go<span class="w"> </span>down<span class="w"> </span><span class="k">in</span><span class="w"> </span>one<span class="w"> </span>hour

Broadcast<span class="w"> </span>message<span class="w"> </span>from<span class="w"> </span>shs@stinkbug<span class="w"> </span><span class="o">(</span>pts/17<span class="o">)</span><span class="w"> </span><span class="o">(</span>Thu<span class="w"> </span>Sep<span class="w"> </span><span class="m">14</span><span class="w"> </span><span class="m">14</span>:04:16<span class="w"> </span><span class="m">2017</span><span class="o">)</span>:

System<span class="w"> </span>will<span class="w"> </span>go<span class="w"> </span>down<span class="w"> </span><span class="k">in</span><span class="w"> </span>one<span class="w"> </span>hour
</code></pre></div>

<p>重要的通知应该通过多个渠道传达，因为很难预测用户实际会注意到什么。mesage-of-the-day（motd），<code>wall</code> 和 email 通知可以吸引用户大部分的注意力。</p>
<h3>注意日志文件</h3>
<p>多注意日志文件也可以帮你理解用户的活动情况。尤其 <code>/var/log/auth.log</code> 文件将会显示用户的登录和注销活动，组的创建记录等。<code>/var/log/message</code> 或者 <code>/var/log/syslog</code> 文件将会告诉你更多有关系统活动的日志。</p>
<h3>追踪问题和需求</h3>
<p>无论你是否在 Linux 系统上安装了事件跟踪系统，跟踪用户遇到的问题以及他们提出的需求都非常重要。如果需求的一部分久久不见回应，用户必然不会高兴。即使是记录在纸上也是有用的，或者最好有个电子表格，这可以让你注意到哪些问题仍然悬而未决，以及问题的根本原因是什么。确认问题和需求非常重要，记录还可以帮助你记住你必须采取的措施来解决几个月甚至几年后重新出现的问题。</p>
<h3>总结</h3>
<p>在繁忙的服务器上管理用户帐号，部分取决于配置良好的默认值，部分取决于监控用户活动和遇到的问题。如果用户觉得你对他们的顾虑有所回应并且知道在需要系统升级时会发生什么，他们可能会很高兴。</p>
    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>links</h2>
                        <ul>
                            <li><a href="https://getpelican.com/">Pelican</a></li>
                            <li><a href="https://www.python.org/">Python.org</a></li>
                            <li><a href="https://palletsprojects.com/p/jinja/">Jinja2</a></li>
                            <li><a href="#">You can modify those links in your config file</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>

                            <li><a href="#">You can add links in your config file</a></li>
                            <li><a href="#">Another social link</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a rel="nofollow" href="https://getpelican.com/">Pelican</a>, which takes great advantage of <a rel="nofollow" href="https://www.python.org/">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a rel="nofollow" href="https://www.smashingmagazine.com/2009/08/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>