<!DOCTYPE html>
<html lang="zh">
<head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="generator" content="Pelican" />
        <title>学习用工具来驾驭 Git 历史</title>
        <link rel="stylesheet" href="/theme/css/main.css" />
        <meta name="description" content="Author: Ilija Eftimov 在你的日常工作中，不可能每天都从头开始去开发一个新的应用程序。而真实的情况是，在日常工作中，我们大多数 …" />
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">linux_cn</a></h1>
                <nav><ul>
                    <li><a href="/category/chuan-shan-jia-zhuan-fang">穿山甲专访</a></li>
                    <li><a href="/category/dai-ma-ying-xiong">代码英雄</a></li>
                    <li><a href="/category/fen-xiang">分享</a></li>
                    <li><a href="/category/guan-dian">观点</a></li>
                    <li><a href="/category/huo-dong">活动</a></li>
                    <li><a href="/category/ji-ke-man-hua">极客漫画</a></li>
                    <li><a href="/category/ji-zhu">技术</a></li>
                    <li><a href="/category/kai-yuan-zhi-hui">开源智慧</a></li>
                    <li><a href="/category/linux-fa-xing-ban">Linux 发行版</a></li>
                    <li><a href="/category/mei-ri-an-quan-zi-xun">每日安全资讯</a></li>
                    <li><a href="/category/misc">Misc</a></li>
                    <li><a href="/category/qu-kuai-lian">区块链</a></li>
                    <li><a href="/category/rong-qi-yu-yun">容器与云</a></li>
                    <li class="active"><a href="/category/ruan-jian-kai-fa">软件开发</a></li>
                    <li><a href="/category/shu-mei-pai">树莓派</a></li>
                    <li><a href="/category/xi-tong-yun-wei">系统运维</a></li>
                    <li><a href="/category/xin-wen">新闻</a></li>
                    <li><a href="/category/ying-he-guan-cha">硬核观察</a></li>
                    <li><a href="/category/zhi-ye-sheng-ya">职业生涯</a></li>
                    <li><a href="/category/zhong-jiang-ming-dan">中奖名单</a></li>
                    <li><a href="/category/zhuo-mian-ying-yong">桌面应用</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="/2018/02/xue-xi-yong-gong-ju-lai-jia-yu-git-li-shi.html" rel="bookmark"
           title="Permalink to 学习用工具来驾驭 Git 历史">学习用工具来驾驭 Git 历史</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2018-02-27T17:03:11+01:00">
                Published: Tue 27 February 2018
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/linux-fans-from-china.html">linux fans from china</a>
        </address>
<p>In <a href="/category/ruan-jian-kai-fa">软件开发</a>.</p>

</footer><!-- /.post-info -->      <p>Author: Ilija Eftimov</p>
<p><img alt="" src="/data/attachment/album/201802/27/170304t4tk9oogkronnint.jpg"></p>
<p>在你的日常工作中，不可能每天都从头开始去开发一个新的应用程序。而真实的情况是，在日常工作中，我们大多数时候所面对的都是遗留下来的一个代码库，去修改一些特性的内容或者现存的一些代码行，这是我们在日常工作中很重要的一部分。而这也就是分布式版本控制系统 <code>git</code> 的价值所在。现在，我们来深入了解怎么去使用 <code>git</code> 的历史以及如何很轻松地去浏览它的历史。</p>
<h3>Git 历史</h3>
<p>首先和最重要的事是，什么是 <code>git</code> 历史？正如其名字一样，它是一个 <code>git</code> 仓库的提交历史。它包含一堆提交信息，其中有它们的作者的名字、该提交的哈希值以及提交日期。查看一个 <code>git</code> 仓库历史的方法很简单，就是一个 <code>git log</code> 命令。</p>
<blockquote>
<p><em>旁注：为便于本文的演示，我们使用 Ruby on Rails 的仓库的 <code>master</code> 分支。之所以选择它的理由是因为，Rails 有良好的 <code>git</code> 历史，漂亮的提交信息、引用以及对每个变更的解释。如果考虑到代码库的大小、维护者的年龄和数量，Rails 肯定是我见过的最好的仓库。当然了，我并不是说其它的 <code>git</code> 仓库做的不好，它只是我见过的比较好的一个仓库。</em></p>
</blockquote>
<p>那么，回到 Rails 仓库。如果你在 Ralis 仓库上运行 <code>git log</code>。你将看到如下所示的输出：</p>
<div class="highlight"><pre><span></span><code><span class="n">commit</span><span class="w"> </span><span class="mi">66</span><span class="n">ebbc4952f6cfb37d719f63036441ef98149418</span>
<span class="nl">Author</span><span class="p">:</span><span class="w"> </span><span class="n">Arthur</span><span class="w"> </span><span class="n">Neves</span><span class="w"> </span><span class="o">&lt;</span><span class="n">foo</span><span class="p">@</span><span class="n">bar</span><span class="p">.</span><span class="n">com</span><span class="o">&gt;</span>
<span class="nl">Date</span><span class="p">:</span><span class="w">   </span><span class="n">Fri</span><span class="w"> </span><span class="n">Jun</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="mi">17</span><span class="o">:</span><span class="mi">17</span><span class="o">:</span><span class="mi">38</span><span class="w"> </span><span class="mi">2016</span><span class="w"> </span><span class="mo">-0400</span>

<span class="w">    </span><span class="n">Dont</span><span class="w"> </span><span class="n">re</span><span class="o">-</span><span class="n">define</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="n">SQLite3Adapter</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">test</span>

<span class="w">    </span><span class="n">We</span><span class="w"> </span><span class="n">were</span><span class="w"> </span><span class="n">declaring</span><span class="w">  </span><span class="k">in</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">few</span><span class="w"> </span><span class="n">tests</span><span class="p">,</span><span class="w"> </span><span class="n">which</span><span class="w"> </span><span class="n">depending</span><span class="w"> </span><span class="n">of</span><span class="w">    </span><span class="n">the</span><span class="w"> </span><span class="n">order</span><span class="w"> </span><span class="n">load</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">cause</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">error</span><span class="p">,</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="nb">super</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="n">could</span><span class="w"> </span><span class="n">change</span><span class="p">.</span>

<span class="w">    </span><span class="n">see</span><span class="w"> </span><span class="n">https</span><span class="o">:</span><span class="c1">//github.com/rails/rails/commit/ac1c4e141b20c1067af2c2703db6e1b463b985da#commitcomment-17731383</span>

<span class="n">commit</span><span class="w"> </span><span class="mf">755f</span><span class="mi">6</span><span class="n">bf3d3d568bc0af2c636be2f6df16c651eb1</span>
<span class="nl">Merge</span><span class="p">:</span><span class="w"> </span><span class="mf">4e85538</span><span class="w"> </span><span class="n">f7b850e</span>
<span class="nl">Author</span><span class="p">:</span><span class="w"> </span><span class="n">Eileen</span><span class="w"> </span><span class="n">M</span><span class="p">.</span><span class="w"> </span><span class="n">Uchitelle</span><span class="w"> </span><span class="o">&lt;</span><span class="n">foo</span><span class="p">@</span><span class="n">bar</span><span class="p">.</span><span class="n">com</span><span class="o">&gt;</span>
<span class="nl">Date</span><span class="p">:</span><span class="w">   </span><span class="n">Fri</span><span class="w"> </span><span class="n">Jun</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="mi">10</span><span class="o">:</span><span class="mi">21</span><span class="o">:</span><span class="mi">49</span><span class="w"> </span><span class="mi">2016</span><span class="w"> </span><span class="mo">-0400</span>

<span class="w">    </span><span class="n">Merge</span><span class="w"> </span><span class="n">pull</span><span class="w"> </span><span class="n">request</span><span class="w"> </span><span class="err">#</span><span class="mi">25263</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">abhishekjain16</span><span class="o">/</span><span class="n">doc_accessor_thread</span>

<span class="w">    </span><span class="p">[</span><span class="n">skip</span><span class="w"> </span><span class="n">ci</span><span class="p">]</span><span class="w"> </span><span class="n">Fix</span><span class="w"> </span><span class="n">grammar</span>

<span class="n">commit</span><span class="w"> </span><span class="n">f7b850ec9f6036802339e965c8ce74494f731b4a</span>
<span class="nl">Author</span><span class="p">:</span><span class="w"> </span><span class="n">Abhishek</span><span class="w"> </span><span class="n">Jain</span><span class="w"> </span><span class="o">&lt;</span><span class="n">foo</span><span class="p">@</span><span class="n">bar</span><span class="p">.</span><span class="n">com</span><span class="o">&gt;</span>
<span class="nl">Date</span><span class="p">:</span><span class="w">   </span><span class="n">Fri</span><span class="w"> </span><span class="n">Jun</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="mi">16</span><span class="o">:</span><span class="mi">49</span><span class="o">:</span><span class="mi">21</span><span class="w"> </span><span class="mi">2016</span><span class="w"> </span><span class="o">+</span><span class="mo">0530</span>

<span class="w">    </span><span class="p">[</span><span class="n">skip</span><span class="w"> </span><span class="n">ci</span><span class="p">]</span><span class="w"> </span><span class="n">Fix</span><span class="w"> </span><span class="n">grammar</span>

<span class="n">commit</span><span class="w"> </span><span class="mf">4e85538</span><span class="n">dddf47877cacc65cea6c050e349af0405</span>
<span class="nl">Merge</span><span class="p">:</span><span class="w"> </span><span class="mi">082</span><span class="n">a515</span><span class="w"> </span><span class="n">cf2158c</span>
<span class="nl">Author</span><span class="p">:</span><span class="w"> </span><span class="n">Vijay</span><span class="w"> </span><span class="n">Dev</span><span class="w"> </span><span class="o">&lt;</span><span class="n">foo</span><span class="p">@</span><span class="n">bar</span><span class="p">.</span><span class="n">com</span><span class="o">&gt;</span>
<span class="nl">Date</span><span class="p">:</span><span class="w">   </span><span class="n">Fri</span><span class="w"> </span><span class="n">Jun</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="mi">14</span><span class="o">:</span><span class="mo">00</span><span class="o">:</span><span class="mi">47</span><span class="w"> </span><span class="mi">2016</span><span class="w"> </span><span class="o">+</span><span class="mo">0000</span>

<span class="w">    </span><span class="n">Merge</span><span class="w"> </span><span class="n">branch</span><span class="w"> </span><span class="err">&#39;</span><span class="n">master</span><span class="err">&#39;</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">:</span><span class="n">rails</span><span class="o">/</span><span class="n">docrails</span>

<span class="w">    </span><span class="nl">Conflicts</span><span class="p">:</span>
<span class="w">        </span><span class="n">guides</span><span class="o">/</span><span class="n">source</span><span class="o">/</span><span class="n">action_cable_overview</span><span class="p">.</span><span class="n">md</span>

<span class="n">commit</span><span class="w"> </span><span class="mi">082</span><span class="n">a5158251c6578714132e5c4f71bd39f462d71</span>
<span class="nl">Merge</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="n">bd11d4</span><span class="w"> </span><span class="mi">3</span><span class="n">bd30d9</span>
<span class="nl">Author</span><span class="p">:</span><span class="w"> </span><span class="n">Yves</span><span class="w"> </span><span class="n">Senn</span><span class="w"> </span><span class="o">&lt;</span><span class="n">foo</span><span class="p">@</span><span class="n">bar</span><span class="p">.</span><span class="n">com</span><span class="o">&gt;</span>
<span class="nl">Date</span><span class="p">:</span><span class="w">   </span><span class="n">Fri</span><span class="w"> </span><span class="n">Jun</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="mi">11</span><span class="o">:</span><span class="mi">30</span><span class="o">:</span><span class="mi">19</span><span class="w"> </span><span class="mi">2016</span><span class="w"> </span><span class="o">+</span><span class="mo">0200</span>

<span class="w">    </span><span class="n">Merge</span><span class="w"> </span><span class="n">pull</span><span class="w"> </span><span class="n">request</span><span class="w"> </span><span class="err">#</span><span class="mi">25243</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">sukesan1984</span><span class="o">/</span><span class="n">add_i18n_validation_test</span>

<span class="w">    </span><span class="n">Add</span><span class="w"> </span><span class="n">i18n_validation_test</span>

<span class="n">commit</span><span class="w"> </span><span class="mi">4</span><span class="n">bd11d46de892676830bca51d3040f29200abbfa</span>
<span class="nl">Merge</span><span class="p">:</span><span class="w"> </span><span class="mi">99</span><span class="n">d8d45</span><span class="w"> </span><span class="n">e98caf8</span>
<span class="nl">Author</span><span class="p">:</span><span class="w"> </span><span class="n">Arthur</span><span class="w"> </span><span class="n">Nogueira</span><span class="w"> </span><span class="n">Neves</span><span class="w"> </span><span class="o">&lt;</span><span class="n">foo</span><span class="p">@</span><span class="n">bar</span><span class="p">.</span><span class="n">com</span><span class="o">&gt;</span>
<span class="nl">Date</span><span class="p">:</span><span class="w">   </span><span class="n">Thu</span><span class="w"> </span><span class="n">Jun</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="mi">22</span><span class="o">:</span><span class="mi">55</span><span class="o">:</span><span class="mi">52</span><span class="w"> </span><span class="mi">2016</span><span class="w"> </span><span class="mo">-0400</span>

<span class="w">    </span><span class="n">Merge</span><span class="w"> </span><span class="n">pull</span><span class="w"> </span><span class="n">request</span><span class="w"> </span><span class="err">#</span><span class="mi">25258</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">alexcameron89</span><span class="o">/</span><span class="n">master</span>

<span class="w">    </span><span class="p">[</span><span class="n">skip</span><span class="w"> </span><span class="n">ci</span><span class="p">]</span><span class="w"> </span><span class="n">Make</span><span class="w"> </span><span class="n">header</span><span class="w"> </span><span class="n">bullets</span><span class="w"> </span><span class="n">consistent</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">engines</span><span class="p">.</span><span class="n">md</span>

<span class="n">commit</span><span class="w"> </span><span class="n">e98caf81fef54746126d31076c6d346c48ae8e1b</span>
<span class="nl">Author</span><span class="p">:</span><span class="w"> </span><span class="n">Alex</span><span class="w"> </span><span class="n">Kitchens</span><span class="w"> </span><span class="o">&lt;</span><span class="n">foo</span><span class="p">@</span><span class="n">bar</span><span class="p">.</span><span class="n">com</span><span class="o">&gt;</span>
<span class="nl">Date</span><span class="p">:</span><span class="w">   </span><span class="n">Thu</span><span class="w"> </span><span class="n">Jun</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="mi">21</span><span class="o">:</span><span class="mi">26</span><span class="o">:</span><span class="mi">53</span><span class="w"> </span><span class="mi">2016</span><span class="w"> </span><span class="mo">-0500</span>

<span class="w">    </span><span class="p">[</span><span class="n">skip</span><span class="w"> </span><span class="n">ci</span><span class="p">]</span><span class="w"> </span><span class="n">Make</span><span class="w"> </span><span class="n">header</span><span class="w"> </span><span class="n">bullets</span><span class="w"> </span><span class="n">consistent</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">engines</span><span class="p">.</span><span class="n">md</span>
</code></pre></div>

<p>正如你所见，<code>git log</code> 展示了提交的哈希、作者及其 email 以及该提交创建的日期。当然，<code>git</code> 输出的可定制性很强大，它允许你去定制 <code>git log</code> 命令的输出格式。比如说，我们只想看提交信息的第一行，我们可以运行 <code>git log --oneline</code>，它将输出一个更紧凑的日志：</p>
<div class="highlight"><pre><span></span><code><span class="mi">66</span><span class="n">ebbc4</span><span class="w"> </span><span class="n">Dont</span><span class="w"> </span><span class="n">re</span><span class="o">-</span><span class="n">define</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="n">SQLite3Adapter</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">test</span>
<span class="mf">755f</span><span class="mi">6</span><span class="n">bf</span><span class="w"> </span><span class="n">Merge</span><span class="w"> </span><span class="n">pull</span><span class="w"> </span><span class="n">request</span><span class="w"> </span><span class="err">#</span><span class="mi">25263</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">abhishekjain16</span><span class="o">/</span><span class="n">doc_accessor_thread</span>
<span class="n">f7b850e</span><span class="w"> </span><span class="p">[</span><span class="n">skip</span><span class="w"> </span><span class="n">ci</span><span class="p">]</span><span class="w"> </span><span class="n">Fix</span><span class="w"> </span><span class="n">grammar4e85538</span><span class="w"> </span><span class="n">Merge</span><span class="w"> </span><span class="n">branch</span><span class="w"> </span><span class="err">&#39;</span><span class="n">master</span><span class="err">&#39;</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="o">:</span><span class="n">rails</span><span class="o">/</span><span class="n">docrails</span>
<span class="mi">082</span><span class="n">a515</span><span class="w"> </span><span class="n">Merge</span><span class="w"> </span><span class="n">pull</span><span class="w"> </span><span class="n">request</span><span class="w"> </span><span class="err">#</span><span class="mi">25243</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">sukesan1984</span><span class="o">/</span><span class="n">add_i18n_validation_test</span>
<span class="mi">4</span><span class="n">bd11d4</span><span class="w"> </span><span class="n">Merge</span><span class="w"> </span><span class="n">pull</span><span class="w"> </span><span class="n">request</span><span class="w"> </span><span class="err">#</span><span class="mi">25258</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">alexcameron89</span><span class="o">/</span><span class="n">master</span>
<span class="n">e98caf8</span><span class="w"> </span><span class="p">[</span><span class="n">skip</span><span class="w"> </span><span class="n">ci</span><span class="p">]</span><span class="w"> </span><span class="n">Make</span><span class="w"> </span><span class="n">header</span><span class="w"> </span><span class="n">bullets</span><span class="w"> </span><span class="n">consistent</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">engines</span><span class="p">.</span><span class="n">md</span>
<span class="mi">99</span><span class="n">d8d45</span><span class="w"> </span><span class="n">Merge</span><span class="w"> </span><span class="n">pull</span><span class="w"> </span><span class="n">request</span><span class="w"> </span><span class="err">#</span><span class="mi">25254</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">kamipo</span><span class="o">/</span><span class="n">fix_debug_helper_test</span>
<span class="mi">818397</span><span class="n">c</span><span class="w"> </span><span class="n">Merge</span><span class="w"> </span><span class="n">pull</span><span class="w"> </span><span class="n">request</span><span class="w"> </span><span class="err">#</span><span class="mi">25240</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">matthewd</span><span class="o">/</span><span class="n">reloadable</span><span class="o">-</span><span class="n">channels</span>
<span class="mi">2</span><span class="n">c5a8ba</span><span class="w"> </span><span class="n">Don</span><span class="err">&#39;</span><span class="n">t</span><span class="w"> </span><span class="n">blank</span><span class="w"> </span><span class="n">pad</span><span class="w"> </span><span class="n">day</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">month</span><span class="w"> </span><span class="n">when</span><span class="w"> </span><span class="n">formatting</span><span class="w"> </span><span class="n">dates</span>
<span class="mf">14f</span><span class="n">f8e7</span><span class="w"> </span><span class="n">Fix</span><span class="w"> </span><span class="n">debug</span><span class="w"> </span><span class="n">helper</span><span class="w"> </span><span class="n">test</span>
</code></pre></div>

<p>如果你想看 <code>git log</code> 的全部选项，我建议你去查阅 <code>git log</code> 的 man 页面，你可以在一个终端中输入 <code>man git-log</code> 或者 <code>git help log</code> 来获得。</p>
<blockquote>
<p><em>小提示：如果你觉得 <code>git log</code> 看起来太恐怖或者过于复杂，或者你觉得看它太无聊了，我建议你去寻找一些 <code>git</code> 的 GUI 或命令行工具。在之前，我使用过 <a href="http://gitx.frim.nl/">GitX</a> ，我觉得它很不错，但是，由于我看命令行更“亲切”一些，在我尝试了 <a href="https://github.com/jonas/tig">tig</a> 之后，就再也没有去用过它。</em></p>
</blockquote>
<h3>寻找尼莫</h3>
<p>现在，我们已经知道了关于 <code>git log</code> 命令的一些很基础的知识之后，我们来看一下，在我们的日常工作中如何使用它更加高效地浏览历史。</p>
<p>假如，我们怀疑在 <code>String#classify</code> 方法中有一个预期之外的行为，我们希望能够找出原因，并且定位出实现它的代码行。</p>
<p>为达到上述目的，你可以使用的第一个命令是 <code>git grep</code>，通过它可以找到这个方法定义在什么地方。简单来说，这个命令输出了匹配特定模式的那些行。现在，我们来找出定义它的方法，它非常简单 —— 我们对 <code>def classify</code> 运行 grep，然后看到的输出如下：</p>
<div class="highlight"><pre><span></span><code><span class="err">➜</span><span class="w">  </span><span class="n">git</span><span class="w"> </span><span class="n">grep</span><span class="w"> </span><span class="s1">&#39;def classify&#39;</span>

<span class="n">activesupport</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">active_support</span><span class="o">/</span><span class="n">core_ext</span><span class="o">/</span><span class="n">string</span><span class="o">/</span><span class="n">inflections</span><span class="o">.</span><span class="n">rb</span><span class="p">:</span><span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">classifyactivesupport</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">active_support</span><span class="o">/</span><span class="n">inflector</span><span class="o">/</span><span class="n">methods</span><span class="o">.</span><span class="n">rb</span><span class="p">:</span><span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">classify</span><span class="p">(</span><span class="n">table_name</span><span class="p">)</span><span class="n">tools</span><span class="o">/</span><span class="n">profile</span><span class="p">:</span><span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">classify</span>
</code></pre></div>

<p>现在，虽然我们已经看到这个方法是在哪里创建的，但是，并不能够确定它是哪一行。如果，我们在 <code>git grep</code> 命令上增加 <code>-n</code> 标志，<code>git</code> 将提供匹配的行号：</p>
<div class="highlight"><pre><span></span><code><span class="err">➜</span><span class="w">  </span><span class="n">git</span><span class="w"> </span><span class="n">grep</span><span class="w"> </span><span class="o">-</span><span class="n">n</span><span class="w"> </span><span class="s1">&#39;def classify&#39;</span>

<span class="n">activesupport</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">active_support</span><span class="o">/</span><span class="n">core_ext</span><span class="o">/</span><span class="n">string</span><span class="o">/</span><span class="n">inflections</span><span class="o">.</span><span class="n">rb</span><span class="p">:</span><span class="mi">205</span><span class="p">:</span><span class="w">  </span><span class="n">def</span><span class="w"> </span><span class="n">classifyactivesupport</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">active_support</span><span class="o">/</span><span class="n">inflector</span><span class="o">/</span><span class="n">methods</span><span class="o">.</span><span class="n">rb</span><span class="p">:</span><span class="mi">186</span><span class="p">:</span><span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">classify</span><span class="p">(</span><span class="n">table_name</span><span class="p">)</span><span class="n">tools</span><span class="o">/</span><span class="n">profile</span><span class="p">:</span><span class="mi">112</span><span class="p">:</span><span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">classify</span>
</code></pre></div>

<p>更好看了，是吧？考虑到上下文，我们可以很轻松地找到，这个方法在 <code>activesupport/lib/active_support/core_ext/string/inflections.rb</code> 的第 205 行的 <code>classify</code> 方法，它看起来像这样，是不是很容易？</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Creates a class name from a plural table name like Rails does for table names to models.</span>
<span class="c1"># Note that this returns a string and not a class. (To convert to an actual class</span>
<span class="c1"># follow +classify+ with +constantize+.)</span>
<span class="c1">#</span>
<span class="c1">#   &#39;ham_and_eggs&#39;.classify # =&gt; &quot;HamAndEgg&quot;</span>
<span class="c1">#   &#39;posts&#39;.classify        # =&gt; &quot;Post&quot;</span>
<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">classify</span>
<span class="w">        </span><span class="n">ActiveSupport</span><span class="p">::</span><span class="n">Inflector</span><span class="o">.</span><span class="n">classify</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
<span class="w">    </span><span class="n">end</span>
</code></pre></div>

<p>尽管我们找到的这个方法是在 <code>String</code> 上的一个常见的调用，它调用了 <code>ActiveSupport::Inflector</code> 上的另一个同名的方法。根据之前的 <code>git grep</code> 的结果，我们可以很轻松地发现结果的第二行， <code>activesupport/lib/active_support/inflector/methods.rb</code> 在 186 行上。我们正在寻找的方法是这样的：</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Creates a class name from a plural table name like Rails does for table</span>
<span class="c1"># names to models. Note that this returns a string and not a Class (To</span>
<span class="c1"># convert to an actual class follow +classify+ with constantize).</span>
<span class="c1">#</span>
<span class="c1">#   classify(&#39;ham_and_eggs&#39;) # =&gt; &quot;HamAndEgg&quot;</span>
<span class="c1">#   classify(&#39;posts&#39;)        # =&gt; &quot;Post&quot;</span>
<span class="c1">#</span>
<span class="c1"># Singular names are not handled correctly:</span>
<span class="c1">#</span>
<span class="c1">#   classify(&#39;calculus&#39;)     # =&gt; &quot;Calculus&quot;</span>
<span class="n">def</span><span class="w"> </span><span class="n">classify</span><span class="p">(</span><span class="n">table_name</span><span class="p">)</span>
<span class="w">    </span><span class="c1"># strip out any leading schema name</span>
<span class="w">    </span><span class="n">camelize</span><span class="p">(</span><span class="n">singularize</span><span class="p">(</span><span class="n">table_name</span><span class="o">.</span><span class="n">to_s</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="o">/.*</span>\<span class="o">./</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">freeze</span><span class="p">)))</span>
<span class="n">end</span>
</code></pre></div>

<p>酷！考虑到 Rails 仓库的大小，我们借助 <code>git grep</code> 找到它，用时都没有超越 30 秒。</p>
<h3>那么，最后的变更是什么？</h3>
<p>现在，我们已经找到了所要找的方法，现在，我们需要搞清楚这个文件所经历的变更。由于我们已经知道了正确的文件名和行数，我们可以使用 <code>git blame</code>。这个命令展示了一个文件中每一行的最后修订者和修订的内容。我们来看一下这个文件最后的修订都做了什么：</p>
<div class="highlight"><pre><span></span><code>git blame activesupport/lib/active_support/inflector/methods.rb
</code></pre></div>

<p>虽然我们得到了这个文件每一行的最后的变更，但是，我们更感兴趣的是对特定方法（176 到 189 行）的最后变更。让我们在 <code>git blame</code> 命令上增加一个选项，让它只显示那些行的变化。此外，我们将在命令上增加一个 <code>-s</code> （忽略）选项，去跳过那一行变更时的作者名字和修订（提交）的时间戳：</p>
<div class="highlight"><pre><span></span><code><span class="n">git</span><span class="w"> </span><span class="n">blame</span><span class="w"> </span><span class="o">-</span><span class="n">L</span><span class="w"> </span><span class="mi">176</span><span class="p">,</span><span class="mi">189</span><span class="w"> </span><span class="o">-</span><span class="n">s</span><span class="w"> </span><span class="n">activesupport</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">active_support</span><span class="o">/</span><span class="n">inflector</span><span class="o">/</span><span class="n">methods</span><span class="o">.</span><span class="n">rb</span>

<span class="mi">9</span><span class="n">fe8e19a</span><span class="w"> </span><span class="mi">176</span><span class="p">)</span><span class="w">   </span><span class="c1">#Creates a class name from a plural table name like Rails does for table</span>
<span class="mi">5</span><span class="n">ea3f284</span><span class="w"> </span><span class="mi">177</span><span class="p">)</span><span class="w">   </span><span class="c1"># names to models. Note that this returns a string and not a Class (To</span>
<span class="mi">9</span><span class="n">fe8e19a</span><span class="w"> </span><span class="mi">178</span><span class="p">)</span><span class="w">   </span><span class="c1"># convert to an actual class follow +classify+ with #constantize).</span>
<span class="mi">51</span><span class="n">cd6bb8</span><span class="w"> </span><span class="mi">179</span><span class="p">)</span><span class="w">   </span><span class="c1">#</span>
<span class="mi">6</span><span class="n">d077205</span><span class="w"> </span><span class="mi">180</span><span class="p">)</span><span class="w">   </span><span class="c1">#   classify(&#39;ham_and_eggs&#39;) # =&gt; &quot;HamAndEgg&quot;</span>
<span class="mi">9</span><span class="n">fe8e19a</span><span class="w"> </span><span class="mi">181</span><span class="p">)</span><span class="w">   </span><span class="c1">#   classify(&#39;posts&#39;)        # =&gt; &quot;Post&quot;</span>
<span class="mi">51</span><span class="n">cd6bb8</span><span class="w"> </span><span class="mi">182</span><span class="p">)</span><span class="w">   </span><span class="c1">#</span>
<span class="mi">51</span><span class="n">cd6bb8</span><span class="w"> </span><span class="mi">183</span><span class="p">)</span><span class="w">   </span><span class="c1"># Singular names are not handled correctly:</span>
<span class="mi">5</span><span class="n">ea3f284</span><span class="w"> </span><span class="mi">184</span><span class="p">)</span><span class="w">   </span><span class="c1">#</span>
<span class="mi">66</span><span class="n">d6e7be</span><span class="w"> </span><span class="mi">185</span><span class="p">)</span><span class="w">   </span><span class="c1">#   classify(&#39;calculus&#39;)     # =&gt; &quot;Calculus&quot;</span>
<span class="mi">51</span><span class="n">cd6bb8</span><span class="w"> </span><span class="mi">186</span><span class="p">)</span><span class="w">   </span><span class="n">def</span><span class="w"> </span><span class="n">classify</span><span class="p">(</span><span class="n">table_name</span><span class="p">)</span>
<span class="mi">51</span><span class="n">cd6bb8</span><span class="w"> </span><span class="mi">187</span><span class="p">)</span><span class="w">     </span><span class="c1"># strip out any leading schema name</span>
<span class="mi">5</span><span class="n">bb1d4d2</span><span class="w"> </span><span class="mi">188</span><span class="p">)</span><span class="w">     </span><span class="n">camelize</span><span class="p">(</span><span class="n">singularize</span><span class="p">(</span><span class="n">table_name</span><span class="o">.</span><span class="n">to_s</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="o">/.*</span>\<span class="o">./</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">freeze</span><span class="p">)))</span>
<span class="mi">51</span><span class="n">cd6bb8</span><span class="w"> </span><span class="mi">189</span><span class="p">)</span><span class="w">     </span><span class="n">end</span>
</code></pre></div>

<p>现在，<code>git blame</code> 命令的输出展示了指定行的全部内容以及它们各自的修订。让我们来看一下指定的修订，换句话说就是，每个变更都修订了什么，我们可以使用 <code>git show</code> 命令。当指定一个修订哈希（像 <code>66d6e7be</code>）作为一个参数时，它将展示这个修订的全部内容。包括作者名字、时间戳以及完整的修订内容。我们来看一下 188 行最后的修订都做了什么？</p>
<div class="highlight"><pre><span></span><code><span class="nv">git</span><span class="w"> </span><span class="k">show</span><span class="w"> </span><span class="mi">5</span><span class="nv">bb1d4d2</span>
</code></pre></div>

<p>你亲自做实验了吗？如果没有做，我直接告诉你结果，这个令人惊叹的 <a href="https://github.com/rails/rails/commit/5bb1d4d288d019e276335465d0389fd2f5246bfd">提交</a> 是由 <a href="https://twitter.com/schneems">Schneems</a> 完成的，他通过使用 frozen 字符串做了一个非常有趣的性能优化，这在我们当前的场景中是非常有意义的。但是，由于我们在这个假设的调试会话中，这样做并不能告诉我们当前问题所在。因此，我们怎么样才能够通过研究来发现，我们选定的方法经过了哪些变更？</p>
<h3>搜索日志</h3>
<p>现在，我们回到 <code>git</code> 日志，现在的问题是，怎么能够看到 <code>classify</code> 方法经历了哪些修订？</p>
<p><code>git log</code> 命令非常强大，因此它提供了非常多的列表选项。我们尝试使用 <code>-p</code> 选项去看一下保存了这个文件的 <code>git</code> 日志内容，这个选项的意思是在 <code>git</code> 日志中显示这个文件的完整补丁:</p>
<div class="highlight"><pre><span></span><code>git log -p activesupport/lib/active_support/inflector/methods.rb
</code></pre></div>

<p>这将给我们展示一个很长的修订列表，显示了对这个文件的每个修订。但是，正如下面所显示的，我们感兴趣的是对指定行的修订。对命令做一个小的修改，只显示我们希望的内容：</p>
<div class="highlight"><pre><span></span><code>git log -L 176,189:activesupport/lib/active_support/inflector/methods.rb
</code></pre></div>

<p><code>git log</code> 命令接受 <code>-L</code> 选项，它用一个行的范围和文件名做为参数。它的格式可能有点奇怪，格式解释如下：</p>
<div class="highlight"><pre><span></span><code><span class="nv">git</span><span class="w"> </span><span class="nv">log</span><span class="w"> </span><span class="o">-</span><span class="nv">L</span><span class="w"> </span><span class="o">&lt;</span><span class="nv">start</span><span class="o">-</span><span class="nv">line</span><span class="o">&gt;</span>,<span class="o">&lt;</span><span class="k">end</span><span class="o">-</span><span class="nv">line</span><span class="o">&gt;</span>:<span class="o">&lt;</span><span class="nv">path</span><span class="o">-</span><span class="nv">to</span><span class="o">-</span><span class="nv">file</span><span class="o">&gt;</span>
</code></pre></div>

<p>当我们运行这个命令之后，我们可以看到对这些行的一个修订列表，它将带我们找到创建这个方法的第一个修订：</p>
<div class="highlight"><pre><span></span><code><span class="n">commit</span><span class="w"> </span><span class="mi">51</span><span class="n">xd6bb829c418c5fbf75de1dfbb177233b1b154</span>
<span class="n">Author</span><span class="p">:</span><span class="w"> </span><span class="n">Foo</span><span class="w"> </span><span class="n">Bar</span><span class="w"> </span><span class="o">&lt;</span><span class="n">foo</span><span class="err">@</span><span class="n">bar</span><span class="o">.</span><span class="n">com</span><span class="o">&gt;</span>
<span class="n">Date</span><span class="p">:</span><span class="w">   </span><span class="n">Tue</span><span class="w"> </span><span class="n">Jun</span><span class="w"> </span><span class="mi">7</span><span class="w"> </span><span class="mi">19</span><span class="p">:</span><span class="mi">05</span><span class="p">:</span><span class="mi">09</span><span class="w"> </span><span class="mi">2011</span><span class="w"> </span><span class="o">-</span><span class="mi">0700</span>

<span class="w">    </span><span class="n">Refactor</span>

<span class="n">diff</span><span class="o">--</span><span class="n">git</span><span class="w"> </span><span class="n">a</span><span class="o">/</span><span class="n">activesupport</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">active_support</span><span class="o">/</span><span class="n">inflector</span><span class="o">/</span><span class="n">methods</span><span class="o">.</span><span class="n">rb</span><span class="w"> </span><span class="n">b</span><span class="o">/</span><span class="n">activesupport</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">active_support</span><span class="o">/</span><span class="n">inflector</span><span class="o">/</span><span class="n">methods</span><span class="o">.</span><span class="n">rb</span>
<span class="o">---</span><span class="w"> </span><span class="n">a</span><span class="o">/</span><span class="n">activesupport</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">active_support</span><span class="o">/</span><span class="n">inflector</span><span class="o">/</span><span class="n">methods</span><span class="o">.</span><span class="n">rb</span>
<span class="o">+++</span><span class="w"> </span><span class="n">b</span><span class="o">/</span><span class="n">activesupport</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">active_support</span><span class="o">/</span><span class="n">inflector</span><span class="o">/</span><span class="n">methods</span><span class="o">.</span><span class="n">rb</span>
<span class="err">@@</span><span class="w"> </span><span class="o">-</span><span class="mi">58</span><span class="p">,</span><span class="mi">0</span><span class="w"> </span><span class="o">+</span><span class="mi">135</span><span class="p">,</span><span class="mi">14</span><span class="w"> </span><span class="err">@@</span>
<span class="o">+</span><span class="w">    </span><span class="c1"># Create a class name from a plural table name like Rails does for table names to models.</span>
<span class="o">+</span><span class="w">    </span><span class="c1"># Note that this returns a string and not a Class. (To convert to an actual class</span>
<span class="o">+</span><span class="w">    </span><span class="c1"># follow +classify+ with +constantize+.)</span>
<span class="o">+</span><span class="w">    </span><span class="c1">#</span>
<span class="o">+</span><span class="w">    </span><span class="c1"># Examples:</span>
<span class="o">+</span><span class="w">    </span><span class="c1">#   &quot;egg_and_hams&quot;.classify # =&gt; &quot;EggAndHam&quot;</span>
<span class="o">+</span><span class="w">    </span><span class="c1">#   &quot;posts&quot;.classify        # =&gt; &quot;Post&quot;</span>
<span class="o">+</span><span class="w">    </span><span class="c1">#</span>
<span class="o">+</span><span class="w">    </span><span class="c1"># Singular names are not handled correctly:</span>
<span class="o">+</span><span class="w">    </span><span class="c1">#   &quot;business&quot;.classify     # =&gt; &quot;Busines&quot;</span>
<span class="o">+</span><span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">classify</span><span class="p">(</span><span class="n">table_name</span><span class="p">)</span>
<span class="o">+</span><span class="w">      </span><span class="c1"># strip out any leading schema name</span>
<span class="o">+</span><span class="w">      </span><span class="n">camelize</span><span class="p">(</span><span class="n">singularize</span><span class="p">(</span><span class="n">table_name</span><span class="o">.</span><span class="n">to_s</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="o">/.*</span>\<span class="o">./</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">)))</span>
<span class="o">+</span><span class="w">    </span><span class="n">end</span>
</code></pre></div>

<p>现在，我们再来看一下 —— 它是在 2011 年提交的。<code>git</code> 可以让我们重回到这个时间。这是一个很好的例子，它充分说明了足够的提交信息对于重新了解当时的上下文环境是多么的重要，因为从这个提交信息中，我们并不能获得足够的信息来重新理解当时的创建这个方法的上下文环境，但是，话说回来，你<strong>不应该</strong>对此感到恼怒，因为，你看到的这些项目，它们的作者都是无偿提供他们的工作时间和精力来做开源工作的。（向开源项目贡献者致敬！）</p>
<p>回到我们的正题，我们并不能确认 <code>classify</code> 方法最初实现是怎么回事，考虑到这个第一次的提交只是一个重构。现在，如果你认为，“或许、有可能、这个方法不在 176 行到 189 行的范围之内，那么就你应该在这个文件中扩大搜索范围”，这样想是对的。我们看到在它的修订提交的信息中提到了“重构”这个词，它意味着这个方法可能在那个文件中是真实存在的，而且是在重构之后它才存在于那个行的范围内。</p>
<p>但是，我们如何去确认这一点呢？不管你信不信，<code>git</code> 可以再次帮助你。<code>git log</code> 命令有一个 <code>-S</code> 选项，它可以传递一个特定的字符串作为参数，然后去查找代码变更（添加或者删除）。也就是说，如果我们执行 <code>git log -S classify</code> 这样的命令，我们可以看到所有包含 <code>classify</code> 字符串的变更行的提交。</p>
<p>如果你在 Ralis 仓库上运行上述命令，首先你会发现这个命令运行有点慢。但是，你应该会发现 <code>git</code> 实际上解析了在那个仓库中的所有修订来匹配这个字符串，其实它的运行速度是非常快的。在你的指尖下 <code>git</code> 再次展示了它的强大之处。因此，如果去找关于 <code>classify</code> 方法的第一个修订，我们可以运行如下的命令：</p>
<div class="highlight"><pre><span></span><code>git log -S &#39;def classify&#39;
</code></pre></div>

<p>它将返回所有这个方法的引用和修改的地方。如果你一直往下看，你将看到日志中它的最后的提交：</p>
<div class="highlight"><pre><span></span><code><span class="n">commit</span><span class="w"> </span><span class="n">db045dbbf60b53dbe013ef25554fd013baf88134</span>
<span class="nl">Author</span><span class="p">:</span><span class="w"> </span><span class="n">David</span><span class="w"> </span><span class="n">Heinemeier</span><span class="w"> </span><span class="n">Hansson</span><span class="w"> </span><span class="o">&lt;</span><span class="n">foo</span><span class="p">@</span><span class="n">bar</span><span class="p">.</span><span class="n">com</span><span class="o">&gt;</span>
<span class="nl">Date</span><span class="p">:</span><span class="w">   </span><span class="n">Wed</span><span class="w"> </span><span class="n">Nov</span><span class="w"> </span><span class="mi">24</span><span class="w"> </span><span class="mo">01</span><span class="o">:</span><span class="mo">04</span><span class="o">:</span><span class="mi">44</span><span class="w"> </span><span class="mi">2004</span><span class="w"> </span><span class="o">+</span><span class="mo">0000</span>
<span class="w">    </span><span class="n">Initial</span>
<span class="w">    </span><span class="n">git</span><span class="o">-</span><span class="n">svn</span><span class="o">-</span><span class="kt">id</span><span class="o">:</span><span class="w"> </span><span class="n">http</span><span class="o">:</span><span class="c1">//svn-commit.rubyonrails.org/rails/trunk@4 5ecf4fe2-1ee6-0310-87b1-e25e094e27de</span>
</code></pre></div>

<p>很酷！是吧？它初次被提交到 Rails，是由 DHH 在一个 <code>svn</code> 仓库上做的！这意味着 <code>classify</code> 大概在一开始就被提交到了 Rails 仓库。现在，我们去看一下这个提交的所有变更信息，我们运行如下的命令：</p>
<div class="highlight"><pre><span></span><code><span class="nv">git</span><span class="w"> </span><span class="k">show</span><span class="w"> </span><span class="nv">db045dbbf60b53dbe013ef25554fd013baf88134</span>
</code></pre></div>

<p>非常好！我们终于找到它的根源了。现在，我们使用 <code>git log -S 'def classify'</code> 的输出，结合 <code>git log -L</code> 命令来跟踪这个方法都发生了哪些变更。</p>
<h3>下次见</h3>
<p>当然，我们并没有真的去修改任何 bug，因为我们只是去尝试使用一些 <code>git</code> 命令，来演示如何查看 <code>classify</code> 方法的演变历史。但是不管怎样，<code>git</code> 是一个非常强大的工具，我们必须学好它、用好它。我希望这篇文章可以帮助你掌握更多的关于如何使用 <code>git</code> 的知识。</p>
<p>你喜欢这些内容吗？</p>
<p>via: <a href="https://ieftimov.com/learn-your-tools-navigating-git-history">https://ieftimov.com/learn-your-tools-navigating-git-history</a></p>
<p>作者：<a href="https://ieftimov.com/">Ilija Eftimov</a> 译者：<a href="https://github.com/qhwdw">qhwdw</a> 校对：<a href="https://github.com/wxy">wxy</a></p>
<p>本文由 <a href="https://github.com/LCTT/TranslateProject">LCTT</a> 原创编译，<a href="https://linux.cn/">Linux中国</a> 荣誉推出</p>
    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>links</h2>
                        <ul>
                            <li><a href="https://getpelican.com/">Pelican</a></li>
                            <li><a href="https://www.python.org/">Python.org</a></li>
                            <li><a href="https://palletsprojects.com/p/jinja/">Jinja2</a></li>
                            <li><a href="#">You can modify those links in your config file</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>

                            <li><a href="#">You can add links in your config file</a></li>
                            <li><a href="#">Another social link</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a rel="nofollow" href="https://getpelican.com/">Pelican</a>, which takes great advantage of <a rel="nofollow" href="https://www.python.org/">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a rel="nofollow" href="https://www.smashingmagazine.com/2009/08/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>