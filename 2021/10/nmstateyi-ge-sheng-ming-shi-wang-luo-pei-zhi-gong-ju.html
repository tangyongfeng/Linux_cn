<!DOCTYPE html>
<html lang="zh">
<head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="generator" content="Pelican" />
        <title>NMState：一个声明式网络配置工具</title>
        <link rel="stylesheet" href="/theme/css/main.css" />
        <meta name="description" content="Author: Maurizio Garcia 这篇文章描述并演示了 NMState，这是一个使用声明式方法配置主机的网络管理器。这意味着你可以通过 API 定义所需的 …" />
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">linux_cn</a></h1>
                <nav><ul>
                    <li><a href="/category/chuan-shan-jia-zhuan-fang">穿山甲专访</a></li>
                    <li><a href="/category/dai-ma-ying-xiong">代码英雄</a></li>
                    <li><a href="/category/fen-xiang">分享</a></li>
                    <li><a href="/category/guan-dian">观点</a></li>
                    <li><a href="/category/huo-dong">活动</a></li>
                    <li><a href="/category/ji-ke-man-hua">极客漫画</a></li>
                    <li><a href="/category/ji-zhu">技术</a></li>
                    <li><a href="/category/kai-yuan-zhi-hui">开源智慧</a></li>
                    <li><a href="/category/linux-fa-xing-ban">Linux 发行版</a></li>
                    <li><a href="/category/mei-ri-an-quan-zi-xun">每日安全资讯</a></li>
                    <li><a href="/category/misc">Misc</a></li>
                    <li><a href="/category/qu-kuai-lian">区块链</a></li>
                    <li><a href="/category/rong-qi-yu-yun">容器与云</a></li>
                    <li><a href="/category/ruan-jian-kai-fa">软件开发</a></li>
                    <li><a href="/category/shu-mei-pai">树莓派</a></li>
                    <li class="active"><a href="/category/xi-tong-yun-wei">系统运维</a></li>
                    <li><a href="/category/xin-wen">新闻</a></li>
                    <li><a href="/category/ying-he-guan-cha">硬核观察</a></li>
                    <li><a href="/category/zhi-ye-sheng-ya">职业生涯</a></li>
                    <li><a href="/category/zhong-jiang-ming-dan">中奖名单</a></li>
                    <li><a href="/category/zhuo-mian-ying-yong">桌面应用</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="/2021/10/nmstateyi-ge-sheng-ming-shi-wang-luo-pei-zhi-gong-ju.html" rel="bookmark"
           title="Permalink to NMState：一个声明式网络配置工具">NMState：一个声明式网络配置工具</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2021-10-08T14:58:26+02:00">
                Published: Fri 08 October 2021
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/linux-fans-from-china.html">linux fans from china</a>
        </address>
<p>In <a href="/category/xi-tong-yun-wei">系统运维</a>.</p>

</footer><!-- /.post-info -->      <p>Author: Maurizio Garcia</p>
<p><img alt="" src="/data/attachment/album/202110/08/145714mqcyh6sshchomyot.jpg"></p>
<p>这篇文章描述并演示了 NMState，这是一个使用声明式方法配置主机的网络管理器。这意味着你可以通过 API 定义所需的配置状态，而工具则通过<ruby> 提供者 <rt>  provider </rt></ruby>来应用配置。</p>
<h3>配置方法：命令式与声明式</h3>
<p>网络管理有时候是一项非常复杂的任务，这取决于环境的规模和多样性。在 IT 的早期，网络管理依赖于网络管理员在网络设备上手动执行命令。如今，<ruby> 基础设施即代码 <rt>  Infrastructure as Code </rt></ruby>（IaC）允许以不同的方式将这些任务自动化。z这基本上有两种方法：命令式或声明式。</p>
<p>在命令式方法中，你会定义“如何”达到所需的配置状态。而在声明式范式里则定义了“什么”是所需的配置状态，所以它不确定哪些步骤是必需的，也不确定它们必须以何种顺序执行。这种方法目前正在聚集更多的人员参与，你可以在目前使用的大多数管理和编排工具上找到它。</p>
<h3>NMState：一个声明式的工具</h3>
<p>NMState 是一个网络管理器，允许你按照声明式方法配置主机。这意味着你通过一个北向的声明式 API 定义所需的配置状态，这个工具通过南向的<ruby> 提供者 <rt>  provider </rt></ruby>应用配置。</p>
<p>目前 NMState 支持的唯一的提供者是 NetworkManager，它是为 Fedora Linux 提供网络功能的主要服务。不过，NMState 的开发计划中将逐渐增加其他提供者。</p>
<p>关于 NMState 的进一步信息，请访问其项目 <a href="https://nmstate.io/">站点</a> 或 GitHub <a href="https://github.com/nmstate/nmstate">仓库</a>。</p>
<h3>安装</h3>
<p>NMState 在 Fedora Linux 29+ 上可用，需要在系统上安装并运行 NetworkManager 1.26 或更高版本。下面是在 Fedora Linux 34 上的安装情况：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>sudo<span class="w"> </span>dnf<span class="w"> </span>-y<span class="w"> </span>install<span class="w"> </span>nmstate
...
输出节略
...
Installed:
<span class="w">  </span>NetworkManager-config-server-1:1.30.4-1.fc34.noarch<span class="w">      </span>gobject-introspection-1.68.0-3.fc34.x86_64<span class="w">      </span>nispor-1.0.1-2.fc34.x86_64<span class="w">              </span>nmstate-1.0.3-2.fc34.noarch
<span class="w">  </span>python3-gobject-base-3.40.1-1.fc34.x86_64<span class="w">                </span>python3-libnmstate-1.0.3-2.fc34.noarch<span class="w">          </span>python3-nispor-1.0.1-2.fc34.noarch<span class="w">      </span>python3-varlink-30.3.1-2.fc34.noarch

Complete!
</code></pre></div>

<p>这样，你可以使用 <code>nmstatectl</code> 作为 NMState 的命令行工具。请参考 <code>nmstatectl -help</code> 或 <code>man nmstatectl</code> 以了解关于这个工具的进一步信息。</p>
<h3>使用 NMstate</h3>
<p>首先要检查系统中安装的 NMState 版本：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>nmstatectl<span class="w"> </span>version
<span class="m">1</span>.0.3
</code></pre></div>

<p>检查一个网络接口的当前配置，例如 <code>eth0</code> 的配置：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>nmstatectl<span class="w"> </span>show<span class="w"> </span>eth0
<span class="m">2021</span>-06-29<span class="w"> </span><span class="m">10</span>:28:21,530<span class="w"> </span>root<span class="w">         </span>DEBUG<span class="w">    </span>NetworkManager<span class="w"> </span>version<span class="w"> </span><span class="m">1</span>.30.4
<span class="m">2021</span>-06-29<span class="w"> </span><span class="m">10</span>:28:21,531<span class="w"> </span>root<span class="w">         </span>DEBUG<span class="w">    </span>Async<span class="w"> </span>action:<span class="w"> </span>Retrieve<span class="w"> </span>applied<span class="w"> </span>config:<span class="w"> </span>ethernet<span class="w"> </span>eth0<span class="w"> </span>started
<span class="m">2021</span>-06-29<span class="w"> </span><span class="m">10</span>:28:21,531<span class="w"> </span>root<span class="w">         </span>DEBUG<span class="w">    </span>Async<span class="w"> </span>action:<span class="w"> </span>Retrieve<span class="w"> </span>applied<span class="w"> </span>config:<span class="w"> </span>ethernet<span class="w"> </span>eth1<span class="w"> </span>started
<span class="m">2021</span>-06-29<span class="w"> </span><span class="m">10</span>:28:21,532<span class="w"> </span>root<span class="w">         </span>DEBUG<span class="w">    </span>Async<span class="w"> </span>action:<span class="w"> </span>Retrieve<span class="w"> </span>applied<span class="w"> </span>config:<span class="w"> </span>ethernet<span class="w"> </span>eth0<span class="w"> </span>finished
<span class="m">2021</span>-06-29<span class="w"> </span><span class="m">10</span>:28:21,533<span class="w"> </span>root<span class="w">         </span>DEBUG<span class="w">    </span>Async<span class="w"> </span>action:<span class="w"> </span>Retrieve<span class="w"> </span>applied<span class="w"> </span>config:<span class="w"> </span>ethernet<span class="w"> </span>eth1<span class="w"> </span>finished
dns-resolver:
<span class="w">  </span>config:<span class="w"> </span><span class="o">{}</span>
<span class="w">  </span>running:
<span class="w">    </span>search:<span class="w"> </span><span class="o">[]</span>
<span class="w">    </span>server:
<span class="w">    </span>-<span class="w"> </span><span class="m">192</span>.168.122.1
route-rules:
<span class="w">  </span>config:<span class="w"> </span><span class="o">[]</span>
routes:
<span class="w">  </span>config:<span class="w"> </span><span class="o">[]</span>
<span class="w">  </span>running:
<span class="w">  </span>-<span class="w"> </span>destination:<span class="w"> </span>fe80::/64
<span class="w">    </span>metric:<span class="w"> </span><span class="m">100</span>
<span class="w">    </span>next-hop-address:<span class="w"> </span><span class="s1">&#39;&#39;</span>
<span class="w">    </span>next-hop-interface:<span class="w"> </span>eth0
<span class="w">    </span>table-id:<span class="w"> </span><span class="m">254</span>
<span class="w">  </span>-<span class="w"> </span>destination:<span class="w"> </span><span class="m">0</span>.0.0.0/0
<span class="w">    </span>metric:<span class="w"> </span><span class="m">100</span>
<span class="w">    </span>next-hop-address:<span class="w"> </span><span class="m">192</span>.168.122.1
<span class="w">    </span>next-hop-interface:<span class="w"> </span>eth0
<span class="w">    </span>table-id:<span class="w"> </span><span class="m">254</span>
<span class="w">  </span>-<span class="w"> </span>destination:<span class="w"> </span><span class="m">192</span>.168.122.0/24
<span class="w">    </span>metric:<span class="w"> </span><span class="m">100</span>
<span class="w">    </span>next-hop-address:<span class="w"> </span><span class="s1">&#39;&#39;</span>
<span class="w">    </span>next-hop-interface:<span class="w"> </span>eth0
<span class="w">    </span>table-id:<span class="w"> </span><span class="m">254</span>
interfaces:
-<span class="w"> </span>name:<span class="w"> </span>eth0
<span class="w">  </span>type:<span class="w"> </span>ethernet
<span class="w">  </span>state:<span class="w"> </span>up
<span class="w">  </span>ipv4:
<span class="w">    </span>enabled:<span class="w"> </span><span class="nb">true</span>
<span class="w">    </span>address:
<span class="w">    </span>-<span class="w"> </span>ip:<span class="w"> </span><span class="m">192</span>.168.122.123
<span class="w">      </span>prefix-length:<span class="w"> </span><span class="m">24</span>
<span class="w">    </span>auto-dns:<span class="w"> </span><span class="nb">true</span>
<span class="w">    </span>auto-gateway:<span class="w"> </span><span class="nb">true</span>
<span class="w">    </span>auto-route-table-id:<span class="w"> </span><span class="m">0</span>
<span class="w">    </span>auto-routes:<span class="w"> </span><span class="nb">true</span>
<span class="w">    </span>dhcp:<span class="w"> </span><span class="nb">true</span>
<span class="w">  </span>ipv6:
<span class="w">    </span>enabled:<span class="w"> </span><span class="nb">true</span>
<span class="w">    </span>address:
<span class="w">    </span>-<span class="w"> </span>ip:<span class="w"> </span>fe80::c3c9:c4f9:75b1:a570
<span class="w">      </span>prefix-length:<span class="w"> </span><span class="m">64</span>
<span class="w">    </span>auto-dns:<span class="w"> </span><span class="nb">true</span>
<span class="w">    </span>auto-gateway:<span class="w"> </span><span class="nb">true</span>
<span class="w">    </span>auto-route-table-id:<span class="w"> </span><span class="m">0</span>
<span class="w">    </span>auto-routes:<span class="w"> </span><span class="nb">true</span>
<span class="w">    </span>autoconf:<span class="w"> </span><span class="nb">true</span>
<span class="w">    </span>dhcp:<span class="w"> </span><span class="nb">true</span>
<span class="w">  </span>lldp:
<span class="w">    </span>enabled:<span class="w"> </span><span class="nb">false</span>
<span class="w">  </span>mac-address:<span class="w"> </span><span class="m">52</span>:54:00:91:E4:4E
<span class="w">  </span>mtu:<span class="w"> </span><span class="m">9000</span>
</code></pre></div>

<p>在保存并退出编辑器后，NMState 应用新的网络期望状态：</p>
<div class="highlight"><pre><span></span><code><span class="mi">2021</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">29</span><span class="w"> </span><span class="mi">11</span><span class="p">:</span><span class="mi">29</span><span class="p">:</span><span class="mi">05</span><span class="p">,</span><span class="mi">726</span><span class="w"> </span><span class="nx">root</span><span class="w">         </span><span class="nx">DEBUG</span><span class="w">    </span><span class="nx">Nmstate</span><span class="w"> </span><span class="nx">version</span><span class="p">:</span><span class="w"> </span><span class="m m-Double">1.0.3</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">29</span><span class="w"> </span><span class="mi">11</span><span class="p">:</span><span class="mi">29</span><span class="p">:</span><span class="mi">05</span><span class="p">,</span><span class="mi">726</span><span class="w"> </span><span class="nx">root</span><span class="w">         </span><span class="nx">DEBUG</span><span class="w">    </span><span class="nx">Applying</span><span class="w"> </span><span class="nx">desire</span><span class="w"> </span><span class="nx">state</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="err">&#39;</span><span class="nx">dns</span><span class="o">-</span><span class="nx">resolver</span><span class="err">&#39;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="err">&#39;</span><span class="nx">config</span><span class="err">&#39;</span><span class="p">:</span><span class="w"> </span><span class="p">{},</span><span class="w"> </span><span class="err">&#39;</span><span class="nx">running</span><span class="err">&#39;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="err">&#39;</span><span class="nx">search</span><span class="err">&#39;</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w"> </span><span class="err">&#39;</span><span class="nx">server</span><span class="err">&#39;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="err">&#39;</span><span class="m m-Double">192.168.122.1</span><span class="err">&#39;</span><span class="p">]}},</span><span class="w"> </span><span class="err">&#39;</span><span class="nx">route</span><span class="o">-</span><span class="nx">rules</span><span class="err">&#39;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="err">&#39;</span><span class="nx">config</span><span class="err">&#39;</span><span class="p">:</span><span class="w"> </span><span class="p">[]},</span><span class="w"> </span><span class="err">&#39;</span><span class="nx">routes</span><span class="err">&#39;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="err">&#39;</span><span class="nx">config</span><span class="err">&#39;</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w"> </span><span class="err">&#39;</span><span class="nx">running</span><span class="err">&#39;</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="err">&#39;</span><span class="nx">destination</span><span class="err">&#39;</span><span class="p">:</span><span class="w"> </span><span class="err">&#39;</span><span class="nx">fe80</span><span class="o">::/</span><span class="mi">64</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="err">&#39;</span><span class="nx">metric</span><span class="err">&#39;</span><span class="p">:</span><span class="w"> </span><span class="mi">102</span><span class="p">,</span><span class="w"> </span><span class="err">&#39;</span><span class="nx">next</span><span class="o">-</span><span class="nx">hop</span><span class="o">-</span><span class="nx">address</span><span class="err">&#39;</span><span class="p">:</span><span class="w"> </span><span class="err">&#39;&#39;</span><span class="p">,</span><span class="w"> </span><span class="err">&#39;</span><span class="nx">next</span><span class="o">-</span><span class="nx">hop</span><span class="o">-</span><span class="kd">interface</span><span class="err">&#39;</span><span class="p">:</span><span class="w"> </span><span class="err">&#39;</span><span class="nx">eth0</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="err">&#39;</span><span class="nx">table</span><span class="o">-</span><span class="nx">id</span><span class="err">&#39;</span><span class="p">:</span><span class="w"> </span><span class="mi">254</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="err">&#39;</span><span class="nx">destination</span><span class="err">&#39;</span><span class="p">:</span><span class="w"> </span><span class="err">&#39;</span><span class="m m-Double">0.0.0.0</span><span class="o">/</span><span class="mi">0</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="err">&#39;</span><span class="nx">metric</span><span class="err">&#39;</span><span class="p">:</span><span class="w"> </span><span class="mi">102</span><span class="p">,</span><span class="w"> </span><span class="err">&#39;</span><span class="nx">next</span><span class="o">-</span><span class="nx">hop</span><span class="o">-</span><span class="nx">address</span><span class="err">&#39;</span><span class="p">:</span><span class="w"> </span><span class="err">&#39;</span><span class="m m-Double">192.168.122.1</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="err">&#39;</span><span class="nx">next</span><span class="o">-</span><span class="nx">hop</span><span class="o">-</span><span class="kd">interface</span><span class="err">&#39;</span><span class="p">:</span><span class="w"> </span><span class="err">&#39;</span><span class="nx">eth0</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="err">&#39;</span><span class="nx">table</span><span class="o">-</span><span class="nx">id</span><span class="err">&#39;</span><span class="p">:</span><span class="w"> </span><span class="mi">254</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="err">&#39;</span><span class="nx">destination</span><span class="err">&#39;</span><span class="p">:</span><span class="w"> </span><span class="err">&#39;</span><span class="m m-Double">192.168.122.0</span><span class="o">/</span><span class="mi">24</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="err">&#39;</span><span class="nx">metric</span><span class="err">&#39;</span><span class="p">:</span><span class="w"> </span><span class="mi">102</span><span class="p">,</span><span class="w"> </span><span class="err">&#39;</span><span class="nx">next</span><span class="o">-</span><span class="nx">hop</span><span class="o">-</span><span class="nx">address</span><span class="err">&#39;</span><span class="p">:</span><span class="w"> </span><span class="err">&#39;&#39;</span><span class="p">,</span><span class="w"> </span><span class="err">&#39;</span><span class="nx">next</span><span class="o">-</span><span class="nx">hop</span><span class="o">-</span><span class="kd">interface</span><span class="err">&#39;</span><span class="p">:</span><span class="w"> </span><span class="err">&#39;</span><span class="nx">eth0</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="err">&#39;</span><span class="nx">table</span><span class="o">-</span><span class="nx">id</span><span class="err">&#39;</span><span class="p">:</span><span class="w"> </span><span class="mi">254</span><span class="p">}]},</span><span class="w"> </span><span class="err">&#39;</span><span class="nx">interfaces</span><span class="err">&#39;</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="err">&#39;</span><span class="nx">name</span><span class="err">&#39;</span><span class="p">:</span><span class="w"> </span><span class="err">&#39;</span><span class="nx">eth0</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="err">&#39;</span><span class="k">type</span><span class="err">&#39;</span><span class="p">:</span><span class="w"> </span><span class="err">&#39;</span><span class="nx">ethernet</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="err">&#39;</span><span class="nx">state</span><span class="err">&#39;</span><span class="p">:</span><span class="w"> </span><span class="err">&#39;</span><span class="nx">up</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="err">&#39;</span><span class="nx">ipv4</span><span class="err">&#39;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="err">&#39;</span><span class="nx">enabled</span><span class="err">&#39;</span><span class="p">:</span><span class="w"> </span><span class="nx">True</span><span class="p">,</span><span class="w"> </span><span class="err">&#39;</span><span class="nx">address</span><span class="err">&#39;</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="err">&#39;</span><span class="nx">ip</span><span class="err">&#39;</span><span class="p">:</span><span class="w"> </span><span class="err">&#39;</span><span class="m m-Double">192.168.122.238</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="err">&#39;</span><span class="nx">prefix</span><span class="o">-</span><span class="nx">length</span><span class="err">&#39;</span><span class="p">:</span><span class="w"> </span><span class="mi">24</span><span class="p">}],</span><span class="w"> </span><span class="err">&#39;</span><span class="kt">auto</span><span class="o">-</span><span class="nx">dns</span><span class="err">&#39;</span><span class="p">:</span><span class="w"> </span><span class="nx">True</span><span class="p">,</span><span class="w"> </span><span class="err">&#39;</span><span class="kt">auto</span><span class="o">-</span><span class="nx">gateway</span><span class="err">&#39;</span><span class="p">:</span><span class="w"> </span><span class="nx">True</span><span class="p">,</span><span class="w"> </span><span class="err">&#39;</span><span class="kt">auto</span><span class="o">-</span><span class="nx">route</span><span class="o">-</span><span class="nx">table</span><span class="o">-</span><span class="nx">id</span><span class="err">&#39;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="err">&#39;</span><span class="kt">auto</span><span class="o">-</span><span class="nx">routes</span><span class="err">&#39;</span><span class="p">:</span><span class="w"> </span><span class="nx">True</span><span class="p">,</span><span class="w"> </span><span class="err">&#39;</span><span class="nx">dhcp</span><span class="err">&#39;</span><span class="p">:</span><span class="w"> </span><span class="nx">True</span><span class="p">},</span><span class="w"> </span><span class="err">&#39;</span><span class="nx">ipv6</span><span class="err">&#39;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="err">&#39;</span><span class="nx">enabled</span><span class="err">&#39;</span><span class="p">:</span><span class="w"> </span><span class="nx">True</span><span class="p">,</span><span class="w"> </span><span class="err">&#39;</span><span class="nx">address</span><span class="err">&#39;</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="err">&#39;</span><span class="nx">ip</span><span class="err">&#39;</span><span class="p">:</span><span class="w"> </span><span class="err">&#39;</span><span class="nx">fe80</span><span class="o">::</span><span class="mi">5054</span><span class="p">:</span><span class="nx">ff</span><span class="p">:</span><span class="nx">fe91</span><span class="p">:</span><span class="nx">e44e</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="err">&#39;</span><span class="nx">prefix</span><span class="o">-</span><span class="nx">length</span><span class="err">&#39;</span><span class="p">:</span><span class="w"> </span><span class="mi">64</span><span class="p">}],</span><span class="w"> </span><span class="err">&#39;</span><span class="kt">auto</span><span class="o">-</span><span class="nx">dns</span><span class="err">&#39;</span><span class="p">:</span><span class="w"> </span><span class="nx">True</span><span class="p">,</span><span class="w"> </span><span class="err">&#39;</span><span class="kt">auto</span><span class="o">-</span><span class="nx">gateway</span><span class="err">&#39;</span><span class="p">:</span><span class="w"> </span><span class="nx">True</span><span class="p">,</span><span class="w"> </span><span class="err">&#39;</span><span class="kt">auto</span><span class="o">-</span><span class="nx">route</span><span class="o">-</span><span class="nx">table</span><span class="o">-</span><span class="nx">id</span><span class="err">&#39;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="err">&#39;</span><span class="kt">auto</span><span class="o">-</span><span class="nx">routes</span><span class="err">&#39;</span><span class="p">:</span><span class="w"> </span><span class="nx">True</span><span class="p">,</span><span class="w"> </span><span class="err">&#39;</span><span class="nx">autoconf</span><span class="err">&#39;</span><span class="p">:</span><span class="w"> </span><span class="nx">True</span><span class="p">,</span><span class="w"> </span><span class="err">&#39;</span><span class="nx">dhcp</span><span class="err">&#39;</span><span class="p">:</span><span class="w"> </span><span class="nx">True</span><span class="p">},</span><span class="w"> </span><span class="err">&#39;</span><span class="nx">lldp</span><span class="err">&#39;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="err">&#39;</span><span class="nx">enabled</span><span class="err">&#39;</span><span class="p">:</span><span class="w"> </span><span class="nx">False</span><span class="p">},</span><span class="w"> </span><span class="err">&#39;</span><span class="nx">mac</span><span class="o">-</span><span class="nx">address</span><span class="err">&#39;</span><span class="p">:</span><span class="w"> </span><span class="err">&#39;</span><span class="mi">52</span><span class="p">:</span><span class="mi">54</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">91</span><span class="p">:</span><span class="nx">E4</span><span class="p">:</span><span class="mi">4</span><span class="nx">E</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="err">&#39;</span><span class="nx">mtu</span><span class="err">&#39;</span><span class="p">:</span><span class="w"> </span><span class="mi">9000</span><span class="p">}]}</span>
<span class="o">---</span><span class="w"> </span><span class="nx">output</span><span class="w"> </span><span class="nx">omitted</span><span class="w"> </span><span class="o">---</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">29</span><span class="w"> </span><span class="mi">11</span><span class="p">:</span><span class="mi">29</span><span class="p">:</span><span class="mi">05</span><span class="p">,</span><span class="mi">760</span><span class="w"> </span><span class="nx">root</span><span class="w">         </span><span class="nx">DEBUG</span><span class="w">    </span><span class="nx">Async</span><span class="w"> </span><span class="nx">action</span><span class="p">:</span><span class="w"> </span><span class="nx">Update</span><span class="w"> </span><span class="nx">profile</span><span class="w"> </span><span class="nx">uuid</span><span class="p">:</span><span class="mi">2</span><span class="nx">bdee700</span><span class="o">-</span><span class="nx">f62b</span><span class="o">-</span><span class="mi">365</span><span class="nx">a</span><span class="o">-</span><span class="nx">bd1d</span><span class="o">-</span><span class="mi">69</span><span class="nx">d9c31a9f0c</span><span class="w"> </span><span class="nx">iface</span><span class="p">:</span><span class="nx">eth0</span><span class="w"> </span><span class="k">type</span><span class="p">:</span><span class="nx">ethernet</span><span class="w"> </span><span class="nx">started</span>
<span class="mi">2021</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">29</span><span class="w"> </span><span class="mi">11</span><span class="p">:</span><span class="mi">29</span><span class="p">:</span><span class="mi">05</span><span class="p">,</span><span class="mi">792</span><span class="w"> </span><span class="nx">root</span><span class="w">         </span><span class="nx">DEBUG</span><span class="w">    </span><span class="nx">Async</span><span class="w"> </span><span class="nx">action</span><span class="p">:</span><span class="w"> </span><span class="nx">Update</span><span class="w"> </span><span class="nx">profile</span><span class="w"> </span><span class="nx">uuid</span><span class="p">:</span><span class="mi">2</span><span class="nx">bdee700</span><span class="o">-</span><span class="nx">f62b</span><span class="o">-</span><span class="mi">365</span><span class="nx">a</span><span class="o">-</span><span class="nx">bd1d</span><span class="o">-</span><span class="mi">69</span><span class="nx">d9c31a9f0c</span><span class="w"> </span><span class="nx">iface</span><span class="p">:</span><span class="nx">eth0</span><span class="w"> </span><span class="k">type</span><span class="p">:</span><span class="nx">ethernet</span><span class="w"> </span><span class="nx">finished</span>
</code></pre></div>

<p>现在，使用 <code>ip</code> 命令和 <code>eth0</code> 的配置文件来检查 <code>eth0</code> 的 <code>MTU</code> 是不是 9000 字节。</p>
<div class="highlight"><pre><span></span><code><span class="err">$</span><span class="w"> </span><span class="n">ip</span><span class="w"> </span><span class="n">link</span><span class="w"> </span><span class="n">show</span><span class="w"> </span><span class="n">eth0</span>
<span class="mi">2</span><span class="err">:</span><span class="w"> </span><span class="nl">eth0</span><span class="p">:</span><span class="w"> </span><span class="o">&lt;</span><span class="n">BROADCAST</span><span class="p">,</span><span class="n">MULTICAST</span><span class="p">,</span><span class="n">UP</span><span class="p">,</span><span class="n">LOWER_UP</span><span class="o">&gt;</span><span class="w"> </span><span class="n">mtu</span><span class="w"> </span><span class="mi">9000</span><span class="w"> </span><span class="n">qdisc</span><span class="w"> </span><span class="n">fq_codel</span><span class="w"> </span><span class="k">state</span><span class="w"> </span><span class="n">UP</span><span class="w"> </span><span class="n">mode</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">group</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="n">qlen</span><span class="w"> </span><span class="mi">1000</span>
<span class="w">    </span><span class="n">link</span><span class="o">/</span><span class="n">ether</span><span class="w"> </span><span class="mi">52</span><span class="err">:</span><span class="mi">54</span><span class="err">:</span><span class="mi">00</span><span class="err">:</span><span class="mi">91</span><span class="err">:</span><span class="nl">e4</span><span class="p">:</span><span class="mi">4</span><span class="n">e</span><span class="w"> </span><span class="n">brd</span><span class="w"> </span><span class="nl">ff</span><span class="p">:</span><span class="nl">ff</span><span class="p">:</span><span class="nl">ff</span><span class="p">:</span><span class="nl">ff</span><span class="p">:</span><span class="nl">ff</span><span class="p">:</span><span class="n">ff</span>
<span class="w">    </span><span class="n">altname</span><span class="w"> </span><span class="n">enp1s0</span>

<span class="err">$</span><span class="w"> </span><span class="n">sudo</span><span class="w"> </span><span class="n">cat</span><span class="w"> </span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">NetworkManager</span><span class="o">/</span><span class="k">system</span><span class="o">-</span><span class="n">connections</span><span class="o">/</span><span class="n">eth0</span><span class="p">.</span><span class="n">nmconnection</span>
<span class="o">[</span><span class="n">sudo</span><span class="o">]</span><span class="w"> </span><span class="n">password</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="k">admin</span><span class="err">:</span>
<span class="o">[</span><span class="n">connection</span><span class="o">]</span>
<span class="n">id</span><span class="o">=</span><span class="n">eth0</span>
<span class="n">uuid</span><span class="o">=</span><span class="mi">2</span><span class="n">bdee700</span><span class="o">-</span><span class="n">f62b</span><span class="o">-</span><span class="mi">365</span><span class="n">a</span><span class="o">-</span><span class="n">bd1d</span><span class="o">-</span><span class="mi">69</span><span class="n">d9c31a9f0c</span>
<span class="n">type</span><span class="o">=</span><span class="n">ethernet</span>
<span class="n">interface</span><span class="o">-</span><span class="n">name</span><span class="o">=</span><span class="n">eth0</span>
<span class="n">lldp</span><span class="o">=</span><span class="mi">0</span>
<span class="nf">permissions</span><span class="o">=</span>

<span class="o">[</span><span class="n">ethernet</span><span class="o">]</span>
<span class="n">cloned</span><span class="o">-</span><span class="n">mac</span><span class="o">-</span><span class="n">address</span><span class="o">=</span><span class="mi">52</span><span class="err">:</span><span class="mi">54</span><span class="err">:</span><span class="mi">00</span><span class="err">:</span><span class="mi">91</span><span class="err">:</span><span class="nl">E4</span><span class="p">:</span><span class="mi">4</span><span class="n">E</span>
<span class="n">mac</span><span class="o">-</span><span class="n">address</span><span class="o">-</span><span class="n">blacklist</span><span class="o">=</span>
<span class="n">mtu</span><span class="o">=</span><span class="mi">9000</span>

<span class="o">[</span><span class="n">ipv4</span><span class="o">]</span>
<span class="n">dhcp</span><span class="o">-</span><span class="n">client</span><span class="o">-</span><span class="n">id</span><span class="o">=</span><span class="n">mac</span>
<span class="n">dhcp</span><span class="o">-</span><span class="n">timeout</span><span class="o">=</span><span class="mi">2147483647</span>
<span class="n">dns</span><span class="o">-</span><span class="k">search</span><span class="o">=</span>
<span class="k">method</span><span class="o">=</span><span class="n">auto</span>

<span class="o">[</span><span class="n">ipv6</span><span class="o">]</span>
<span class="n">addr</span><span class="o">-</span><span class="n">gen</span><span class="o">-</span><span class="n">mode</span><span class="o">=</span><span class="n">eui64</span>
<span class="n">dhcp</span><span class="o">-</span><span class="n">duid</span><span class="o">=</span><span class="n">ll</span>
<span class="n">dhcp</span><span class="o">-</span><span class="n">iaid</span><span class="o">=</span><span class="n">mac</span>
<span class="n">dhcp</span><span class="o">-</span><span class="n">timeout</span><span class="o">=</span><span class="mi">2147483647</span>
<span class="n">dns</span><span class="o">-</span><span class="k">search</span><span class="o">=</span>
<span class="k">method</span><span class="o">=</span><span class="n">auto</span>
<span class="n">ra</span><span class="o">-</span><span class="n">timeout</span><span class="o">=</span><span class="mi">2147483647</span>

<span class="o">[</span><span class="n">proxy</span><span class="o">]</span>
</code></pre></div>

<h4>基于文件的配置模式的例子</h4>
<p>让我们使用基于文件的方法来设置一个新的配置状态。这里我们禁用 <code>eth1</code> 接口的 IPv6 配置。</p>
<p>首先，创建一个 yaml 文件来定义 <code>eth1</code> 接口的期望状态。使用 <code>nmstatectl show</code> 来保存当前设置，然后使用 <code>nmstatectl edit</code> 来禁用 IPv6。</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>nmstatectl<span class="w"> </span>show<span class="w"> </span>eth1<span class="w"> </span>&gt;<span class="w"> </span>eth1.yaml

$<span class="w"> </span>vi<span class="w"> </span>eth1.yaml
dns-resolver:
<span class="w">  </span>config:<span class="w"> </span><span class="o">{}</span>
<span class="w">  </span>running:
<span class="w">    </span>search:<span class="w"> </span><span class="o">[]</span>
<span class="w">    </span>server:
<span class="w">    </span>-<span class="w"> </span><span class="m">192</span>.168.122.1
route-rules:
<span class="w">  </span>config:<span class="w"> </span><span class="o">[]</span>
routes:
<span class="w">  </span>config:<span class="w"> </span><span class="o">[]</span>
<span class="w">  </span>running:
<span class="w">  </span>-<span class="w"> </span>destination:<span class="w"> </span>fe80::/64
<span class="w">    </span>metric:<span class="w"> </span><span class="m">101</span>
<span class="w">    </span>next-hop-address:<span class="w"> </span><span class="s1">&#39;&#39;</span>
<span class="w">    </span>next-hop-interface:<span class="w"> </span>eth1
<span class="w">    </span>table-id:<span class="w"> </span><span class="m">254</span>
<span class="w">  </span>-<span class="w"> </span>destination:<span class="w"> </span><span class="m">0</span>.0.0.0/0
<span class="w">    </span>metric:<span class="w"> </span><span class="m">101</span>
<span class="w">    </span>next-hop-address:<span class="w"> </span><span class="m">192</span>.168.122.1
<span class="w">    </span>next-hop-interface:<span class="w"> </span>eth1
<span class="w">    </span>table-id:<span class="w"> </span><span class="m">254</span>
<span class="w">  </span>-<span class="w"> </span>destination:<span class="w"> </span><span class="m">192</span>.168.122.0/24
<span class="w">    </span>metric:<span class="w"> </span><span class="m">101</span>
<span class="w">    </span>next-hop-address:<span class="w"> </span><span class="s1">&#39;&#39;</span>
<span class="w">    </span>next-hop-interface:<span class="w"> </span>eth1
<span class="w">    </span>table-id:<span class="w"> </span><span class="m">254</span>
interfaces:
-<span class="w"> </span>name:<span class="w"> </span>eth1
<span class="w">  </span>type:<span class="w"> </span>ethernet
<span class="w">  </span>state:<span class="w"> </span>up
<span class="w">  </span>ipv4:
<span class="w">    </span>enabled:<span class="w"> </span><span class="nb">true</span>
<span class="w">    </span>address:
<span class="w">    </span>-<span class="w"> </span>ip:<span class="w"> </span><span class="m">192</span>.168.122.108
<span class="w">      </span>prefix-length:<span class="w"> </span><span class="m">24</span>
<span class="w">    </span>auto-dns:<span class="w"> </span><span class="nb">true</span>
<span class="w">    </span>auto-gateway:<span class="w"> </span><span class="nb">true</span>
<span class="w">    </span>auto-route-table-id:<span class="w"> </span><span class="m">0</span>
<span class="w">    </span>auto-routes:<span class="w"> </span><span class="nb">true</span>
<span class="w">    </span>dhcp:<span class="w"> </span><span class="nb">true</span>
<span class="w">  </span>ipv6:
<span class="w">    </span>enabled:<span class="w"> </span><span class="nb">false</span>
<span class="w">  </span>lldp:
<span class="w">    </span>enabled:<span class="w"> </span><span class="nb">false</span>
<span class="w">  </span>mac-address:<span class="w"> </span><span class="m">52</span>:54:00:3C:9B:04
<span class="w">  </span>mtu:<span class="w"> </span><span class="m">1500</span>
</code></pre></div>

<p>你可以检查看到 <code>eth1</code> 接口没有配置任何 IPv6：</p>
<div class="highlight"><pre><span></span><code><span class="err">$</span><span class="w"> </span><span class="n">ip</span><span class="w"> </span><span class="o">-</span><span class="n">br</span><span class="w"> </span><span class="n">a</span>
<span class="n">lo</span><span class="w">               </span><span class="k">UNKNOWN</span><span class="w">        </span><span class="mf">127.0.0.1</span><span class="o">/</span><span class="mi">8</span><span class="w"> </span><span class="o">::</span><span class="mi">1</span><span class="o">/</span><span class="mi">128</span>
<span class="n">eth0</span><span class="w">             </span><span class="n">UP</span><span class="w">             </span><span class="mf">192.168.122.238</span><span class="o">/</span><span class="mi">24</span><span class="w"> </span><span class="nl">fe80</span><span class="p">:</span><span class="err">:</span><span class="mi">5054</span><span class="err">:</span><span class="nl">ff</span><span class="p">:</span><span class="nl">fe91</span><span class="p">:</span><span class="n">e44e</span><span class="o">/</span><span class="mi">64</span>
<span class="n">eth1</span><span class="w">             </span><span class="n">UP</span><span class="w">             </span><span class="mf">192.168.122.108</span><span class="o">/</span><span class="mi">24</span>

<span class="err">$</span><span class="w"> </span><span class="n">sudo</span><span class="w"> </span><span class="n">cat</span><span class="w"> </span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">NetworkManager</span><span class="o">/</span><span class="k">system</span><span class="o">-</span><span class="n">connections</span><span class="o">/</span><span class="n">eth1</span><span class="p">.</span><span class="n">nmconnection</span>
<span class="o">[</span><span class="n">connection</span><span class="o">]</span>
<span class="n">id</span><span class="o">=</span><span class="n">eth1</span>
<span class="n">uuid</span><span class="o">=</span><span class="mi">5</span><span class="n">d7244cb</span><span class="o">-</span><span class="mi">673</span><span class="n">d</span><span class="o">-</span><span class="mi">3</span><span class="n">b88</span><span class="o">-</span><span class="n">a675</span><span class="o">-</span><span class="mf">32e31</span><span class="n">fad4347</span>
<span class="n">type</span><span class="o">=</span><span class="n">ethernet</span>
<span class="n">interface</span><span class="o">-</span><span class="n">name</span><span class="o">=</span><span class="n">eth1</span>
<span class="n">lldp</span><span class="o">=</span><span class="mi">0</span>
<span class="nf">permissions</span><span class="o">=</span>

<span class="o">[</span><span class="n">ethernet</span><span class="o">]</span>
<span class="n">cloned</span><span class="o">-</span><span class="n">mac</span><span class="o">-</span><span class="n">address</span><span class="o">=</span><span class="mi">52</span><span class="err">:</span><span class="mi">54</span><span class="err">:</span><span class="mi">00</span><span class="err">:</span><span class="mi">3</span><span class="nl">C</span><span class="p">:</span><span class="mi">9</span><span class="nl">B</span><span class="p">:</span><span class="mi">04</span>
<span class="n">mac</span><span class="o">-</span><span class="n">address</span><span class="o">-</span><span class="n">blacklist</span><span class="o">=</span>
<span class="n">mtu</span><span class="o">=</span><span class="mi">1500</span>

<span class="o">[</span><span class="n">ipv4</span><span class="o">]</span>
<span class="n">dhcp</span><span class="o">-</span><span class="n">client</span><span class="o">-</span><span class="n">id</span><span class="o">=</span><span class="n">mac</span>
<span class="n">dhcp</span><span class="o">-</span><span class="n">timeout</span><span class="o">=</span><span class="mi">2147483647</span>
<span class="n">dns</span><span class="o">-</span><span class="k">search</span><span class="o">=</span>
<span class="k">method</span><span class="o">=</span><span class="n">auto</span>

<span class="o">[</span><span class="n">ipv6</span><span class="o">]</span>
<span class="n">addr</span><span class="o">-</span><span class="n">gen</span><span class="o">-</span><span class="n">mode</span><span class="o">=</span><span class="n">eui64</span>
<span class="n">dhcp</span><span class="o">-</span><span class="n">duid</span><span class="o">=</span><span class="n">ll</span>
<span class="n">dhcp</span><span class="o">-</span><span class="n">iaid</span><span class="o">=</span><span class="n">mac</span>
<span class="n">dns</span><span class="o">-</span><span class="k">search</span><span class="o">=</span>
<span class="k">method</span><span class="o">=</span><span class="n">disabled</span>

<span class="o">[</span><span class="n">proxy</span><span class="o">]</span>
</code></pre></div>

<h4>临时应用改变</h4>
<p>NMState 的一个有趣的功能允许你临时配置一个期望的网络状态。如果你对这个配置感到满意，你可以事后提交。否则，当超时（默认为 60 秒）过后，它将回滚。</p>
<p>修改前面例子中的 <code>eth1</code> 配置，使它有一个 IPv4 静态地址，而不是通过 DHCP 动态获得。</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>vi<span class="w"> </span>eth1.yaml

dns-resolver:
<span class="w">  </span>config:<span class="w"> </span><span class="o">{}</span>
<span class="w">  </span>running:
<span class="w">    </span>search:<span class="w"> </span><span class="o">[]</span>
<span class="w">    </span>server:
<span class="w">    </span>-<span class="w"> </span><span class="m">192</span>.168.122.1
route-rules:
<span class="w">  </span>config:<span class="w"> </span><span class="o">[]</span>
routes:
<span class="w">  </span>config:<span class="w"> </span><span class="o">[]</span>
<span class="w">  </span>running:
<span class="w">  </span>-<span class="w"> </span>destination:<span class="w"> </span>fe80::/64
<span class="w">    </span>metric:<span class="w"> </span><span class="m">101</span>
<span class="w">    </span>next-hop-address:<span class="w"> </span><span class="s1">&#39;&#39;</span>
<span class="w">    </span>next-hop-interface:<span class="w"> </span>eth1
<span class="w">    </span>table-id:<span class="w"> </span><span class="m">254</span>
<span class="w">  </span>-<span class="w"> </span>destination:<span class="w"> </span><span class="m">0</span>.0.0.0/0
<span class="w">    </span>metric:<span class="w"> </span><span class="m">101</span>
<span class="w">    </span>next-hop-address:<span class="w"> </span><span class="m">192</span>.168.122.1
<span class="w">    </span>next-hop-interface:<span class="w"> </span>eth1
<span class="w">    </span>table-id:<span class="w"> </span><span class="m">254</span>
<span class="w">  </span>-<span class="w"> </span>destination:<span class="w"> </span><span class="m">192</span>.168.122.0/24
<span class="w">    </span>metric:<span class="w"> </span><span class="m">101</span>
<span class="w">    </span>next-hop-address:<span class="w"> </span><span class="s1">&#39;&#39;</span>
<span class="w">    </span>next-hop-interface:<span class="w"> </span>eth1
<span class="w">    </span>table-id:<span class="w"> </span><span class="m">254</span>
interfaces:
-<span class="w"> </span>name:<span class="w"> </span>eth1
<span class="w">  </span>type:<span class="w"> </span>ethernet
<span class="w">  </span>state:<span class="w"> </span>up
<span class="w">  </span>ipv4:
<span class="w">    </span>enabled:<span class="w"> </span><span class="nb">true</span>
<span class="w">    </span>address:
<span class="w">    </span>-<span class="w"> </span>ip:<span class="w"> </span><span class="m">192</span>.168.122.110
<span class="w">      </span>prefix-length:<span class="w"> </span><span class="m">24</span>
<span class="w">    </span>dhcp:<span class="w"> </span><span class="nb">false</span>
<span class="w">  </span>ipv6:
<span class="w">    </span>enabled:<span class="w"> </span><span class="nb">false</span>
<span class="w">  </span>lldp:
<span class="w">    </span>enabled:<span class="w"> </span><span class="nb">false</span>
<span class="w">  </span>mac-address:<span class="w"> </span><span class="m">52</span>:54:00:3C:9B:04
<span class="w">  </span>mtu:<span class="w"> </span><span class="m">1500</span>
Checkpoint:<span class="w"> </span>NetworkManager<span class="p">|</span>/org/freedesktop/NetworkManager/Checkpoint/7
lo<span class="w">               </span>UNKNOWN<span class="w">        </span><span class="m">127</span>.0.0.1/8<span class="w"> </span>::1/128
eth0<span class="w">             </span>UP<span class="w">             </span><span class="m">192</span>.168.122.238/24<span class="w"> </span>fe80::5054:ff:fe91:e44e/64
eth1<span class="w">             </span>UP<span class="w">             </span><span class="m">192</span>.168.122.110/24
lo<span class="w">               </span>UNKNOWN<span class="w">        </span><span class="m">127</span>.0.0.1/8<span class="w"> </span>::1/128
eth0<span class="w">             </span>UP<span class="w">             </span><span class="m">192</span>.168.122.238/24<span class="w"> </span>fe80::5054:ff:fe91:e44e/64
eth1<span class="w">             </span>UP<span class="w">             </span><span class="m">192</span>.168.122.108/24
</code></pre></div>

<p>从上面可以看到，<code>eth1</code> 的 IP 地址从 <code>192.168.122.108</code> 暂时变成了 <code>192.168.122.110</code>，然后在超时结束后又回到了 <code>192.168.122.108</code>。</p>
<h3>总结</h3>
<p>NMState 是一个声明式的网络配置工具，目前可以通过 NetworkManager API 在主机中应用所需的网络配置状态。这种状态既可以用文本编辑器交互式地定义，也可以用基于文件的方法创建一个 yaml 或 json 文件。</p>
<p>这种工具提供了“基础设施即代码”，它可以自动化网络任务，也减少了使用传统配置方法可能出现的潜在错误配置或不稳定的网络情况。</p>
    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>links</h2>
                        <ul>
                            <li><a href="https://getpelican.com/">Pelican</a></li>
                            <li><a href="https://www.python.org/">Python.org</a></li>
                            <li><a href="https://palletsprojects.com/p/jinja/">Jinja2</a></li>
                            <li><a href="#">You can modify those links in your config file</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>

                            <li><a href="#">You can add links in your config file</a></li>
                            <li><a href="#">Another social link</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a rel="nofollow" href="https://getpelican.com/">Pelican</a>, which takes great advantage of <a rel="nofollow" href="https://www.python.org/">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a rel="nofollow" href="https://www.smashingmagazine.com/2009/08/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>