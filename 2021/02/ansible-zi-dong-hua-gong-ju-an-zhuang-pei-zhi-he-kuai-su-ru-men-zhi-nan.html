<!DOCTYPE html>
<html lang="zh">
<head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="generator" content="Pelican" />
        <title>Ansible 自动化工具安装、配置和快速入门指南</title>
        <link rel="stylesheet" href="/theme/css/main.css" />
        <meta name="description" content="Author: Magesh Maruthamuthu 市面上有很多自动化工具。我可以举几个例子，例如 Puppet、Chef、CFEngine、Foreman、Katello、Saltstock、Space Walk，它们被许多组织广泛使用。 自动化工具可以 …" />
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">linux_cn</a></h1>
                <nav><ul>
                    <li><a href="/category/chuan-shan-jia-zhuan-fang">穿山甲专访</a></li>
                    <li><a href="/category/dai-ma-ying-xiong">代码英雄</a></li>
                    <li><a href="/category/fen-xiang">分享</a></li>
                    <li><a href="/category/guan-dian">观点</a></li>
                    <li><a href="/category/huo-dong">活动</a></li>
                    <li><a href="/category/ji-ke-man-hua">极客漫画</a></li>
                    <li><a href="/category/ji-zhu">技术</a></li>
                    <li><a href="/category/kai-yuan-zhi-hui">开源智慧</a></li>
                    <li><a href="/category/linux-fa-xing-ban">Linux 发行版</a></li>
                    <li><a href="/category/mei-ri-an-quan-zi-xun">每日安全资讯</a></li>
                    <li><a href="/category/misc">Misc</a></li>
                    <li><a href="/category/qu-kuai-lian">区块链</a></li>
                    <li><a href="/category/rong-qi-yu-yun">容器与云</a></li>
                    <li><a href="/category/ruan-jian-kai-fa">软件开发</a></li>
                    <li><a href="/category/shu-mei-pai">树莓派</a></li>
                    <li class="active"><a href="/category/xi-tong-yun-wei">系统运维</a></li>
                    <li><a href="/category/xin-wen">新闻</a></li>
                    <li><a href="/category/ying-he-guan-cha">硬核观察</a></li>
                    <li><a href="/category/zhi-ye-sheng-ya">职业生涯</a></li>
                    <li><a href="/category/zhong-jiang-ming-dan">中奖名单</a></li>
                    <li><a href="/category/zhuo-mian-ying-yong">桌面应用</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="/2021/02/ansible-zi-dong-hua-gong-ju-an-zhuang-pei-zhi-he-kuai-su-ru-men-zhi-nan.html" rel="bookmark"
           title="Permalink to Ansible 自动化工具安装、配置和快速入门指南">Ansible 自动化工具安装、配置和快速入门指南</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2021-02-22T12:48:20+01:00">
                Published: Mon 22 February 2021
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/linux-fans-from-china.html">linux fans from china</a>
        </address>
<p>In <a href="/category/xi-tong-yun-wei">系统运维</a>.</p>

</footer><!-- /.post-info -->      <p>Author: Magesh Maruthamuthu</p>
<p><img alt="" src="/data/attachment/album/202102/22/124803cgryrgxqezjllfqg.jpg"></p>
<p>市面上有很多自动化工具。我可以举几个例子，例如 Puppet、Chef、CFEngine、Foreman、Katello、Saltstock、Space Walk，它们被许多组织广泛使用。</p>
<h3>自动化工具可以做什么？</h3>
<p>自动化工具可以自动执行例行任务，无需人工干预，从而使 Linux 管理员的工作变得更加轻松。这些工具允许用户执行配置管理，应用程序部署和资源调配。</p>
<h3>为什么喜欢 Ansible？</h3>
<p>Ansible 是一种无代理的自动化工具，使用 SSH 执行所有任务，但其它工具需要在客户端节点上安装代理。</p>
<h3>什么是 Ansible？</h3>
<p>Ansible 是一个开源、易于使用的功能强大的 IT 自动化工具，通过 SSH 在客户端节点上执行任务。</p>
<p>它是用 Python 构建的，这是当今世界上最流行、最强大的编程语言之一。两端都需要使用 Python 才能执行所有模块。</p>
<p>它可以配置系统、部署软件和安排高级 IT 任务，例如连续部署或零停机滚动更新。你可以通过 Ansible 轻松执行任何类型的自动化任务，包括简单和复杂的任务。</p>
<p>在开始之前，你需要了解一些 Ansible 术语，这些术语可以帮助你更好的创建任务。</p>
<h3>Ansible 如何工作？</h3>
<p>Ansible 通过在客户端节点上推送称为 ansible 模块的小程序来工作，这些模块临时存储在客户端节点中，通过 JSON 协议与 Ansible 服务器进行通信。</p>
<p>Ansible 通过 SSH 运行这些模块，并在完成后将其删除。</p>
<p>模块是用 Python 或 Perl 等编写的一些脚本。</p>
<p><img alt="" src="/data/attachment/album/202102/22/124822meej9lngyylly290.png"></p>
<p><em>控制节点，用于控制剧本的全部功能，包括客户端节点（主机）。</em></p>
<ul>
<li><ruby> 控制节点 <rt>  Control node </rt></ruby>：使用 Ansible 在受控节点上执行任务的主机。你可以有多个控制节点，但不能使用 Windows 系统主机当作控制节点。</li>
<li><ruby> 受控节点 <rt>  Managed node </rt></ruby>：控制节点配置的主机列表。</li>
<li><ruby> 清单 <rt>  Inventory </rt></ruby>：控制节点管理的一个主机列表，这些节点在 <code>/etc/ansible/hosts</code> 文件中配置。它包含每个节点的信息，比如 IP 地址或其主机名，还可以根据需要对这些节点进行分组。</li>
<li><ruby> 模块 <rt>  Module </rt></ruby>：每个模块用于执行特定任务，目前有 3387 个模块。</li>
<li><ruby> 点对点 <rt>  ad-hoc </rt></ruby>：它允许你一次性运行一个任务，它使用 <code>/usr/bin/ansible</code> 二进制文件。</li>
<li><ruby> 任务 <rt>  Task </rt></ruby>：每个<ruby> 动作 <rt>  Play </rt></ruby>都有一个任务列表。任务按顺序执行，在受控节点中一次执行一个任务。</li>
<li><ruby> 剧本 <rt>  Playbook </rt></ruby>：你可以使用剧本同时执行多个任务，而使用点对点只能执行一个任务。剧本使用 YAML 编写，易于阅读。将来，我们将会写一篇有关剧本的文章，你可以用它来执行复杂的任务。</li>
</ul>
<h3>测试环境</h3>
<p>此环境包含一个控制节点（<code>server.2g.lab</code>）和三个受控节点（<code>node1.2g.lab</code>、<code>node2.2g.lab</code>、<code>node3.2g.lab</code>），它们均在虚拟环境中运行，操作系统分别为：</p>
<table>
<thead>
<tr>
<th>System Purpose</th>
<th>Hostname</th>
<th>IP Address</th>
<th>OS</th>
</tr>
</thead>
<tbody>
<tr>
<td>Ansible Control Node</td>
<td>server.2g.lab</td>
<td>192.168.1.7</td>
<td>Manjaro 18</td>
</tr>
<tr>
<td>Managed Node1</td>
<td>node1.2g.lab</td>
<td>192.168.1.6</td>
<td>CentOS7</td>
</tr>
<tr>
<td>Managed Node2</td>
<td>node2.2g.lab</td>
<td>192.168.1.5</td>
<td>CentOS8</td>
</tr>
<tr>
<td>Managed Node3</td>
<td>node3.2g.lab</td>
<td>192.168.1.9</td>
<td>Ubuntu 18.04</td>
</tr>
<tr>
<td>User: daygeek</td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h3>前置条件</h3>
<ul>
<li>在 Ansible 控制节点和受控节点之间启用无密码身份验证。</li>
<li>控制节点必须是 Python 2（2.7 版本） 或 Python 3（3.5 或更高版本）。</li>
<li>受控节点必须是 Python 2（2.6 或更高版本） 或 Python 3（3.5 或更高版本）。</li>
<li>如果在远程节点上启用了 SELinux，则在 Ansible 中使用任何与复制、文件、模板相关的功能之前，还需要在它们上安装 <code>libselinux-python</code>。</li>
</ul>
<h3>如何在控制节点上安装 Ansible</h3>
<p>对于 Fedora/RHEL 8/CentOS 8 系统，使用 <a href="https://www.2daygeek.com/linux-dnf-command-examples-manage-packages-fedora-centos-rhel-systems/">DNF 命令</a> 来安装 Ansible。</p>
<p>注意：你需要在 RHEL/CentOS 系统上启用 <a href="https://www.2daygeek.com/install-enable-epel-repository-on-rhel-centos-oracle-linux/">EPEL 仓库</a>，因为 Ansible 软件包在发行版官方仓库中不可用。</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>sudo<span class="w"> </span>dnf<span class="w"> </span>install<span class="w"> </span>ansible
</code></pre></div>

<p>对于 Debian/Ubuntu 系统，使用 <a href="https://www.2daygeek.com/apt-get-apt-cache-command-examples-manage-packages-debian-ubuntu-systems/">APT-GET 命令</a> 或 <a href="https://www.2daygeek.com/apt-command-examples-manage-packages-debian-ubuntu-systems/">APT 命令</a> 来安装 Ansible。</p>
<p>配置下面的 PPA 以便在 Ubuntu 上安装最新稳定版本的 Ansible。</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>sudo<span class="w"> </span>apt<span class="w"> </span>update
$<span class="w"> </span>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>software-properties-common
$<span class="w"> </span>sudo<span class="w"> </span>apt-add-repository<span class="w"> </span>--yes<span class="w"> </span>--update<span class="w"> </span>ppa:ansible/ansible
$<span class="w"> </span>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>ansible
</code></pre></div>

<p>对于 Debian 系统，配置以下源列表：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;deb http://ppa.launchpad.net/ansible/ansible/ubuntu trusty main&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>-a<span class="w"> </span>/etc/apt/sources.list.d/ansible.list
$<span class="w"> </span>sudo<span class="w"> </span>apt-key<span class="w"> </span>adv<span class="w"> </span>--keyserver<span class="w"> </span>keyserver.ubuntu.com<span class="w"> </span>--recv-keys<span class="w"> </span>93C4A3FD7BB9C367
$<span class="w"> </span>sudo<span class="w"> </span>apt<span class="w"> </span>update
$<span class="w"> </span>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>ansible
</code></pre></div>

<p>对于 Arch Linux 系统，使用 <a href="https://www.2daygeek.com/pacman-command-examples-manage-packages-arch-linux-system/">Pacman 命令</a> 来安装 Ansible：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>sudo<span class="w"> </span>pacman<span class="w"> </span>-S<span class="w"> </span>ansible
</code></pre></div>

<p>对于 RHEL/CentOS 系统，使用 <a href="https://www.2daygeek.com/yum-command-examples-manage-packages-rhel-centos-systems/">YUM 命令</a> 来安装 Ansible：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>sudo<span class="w"> </span>yum<span class="w"> </span>install<span class="w"> </span>ansible
</code></pre></div>

<p>对于 openSUSE 系统，使用 <a href="https://www.2daygeek.com/zypper-command-examples-manage-packages-opensuse-system/">Zypper 命令</a> 来安装 Ansible：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>sudo<span class="w"> </span>zypper<span class="w"> </span>install<span class="w"> </span>ansible
</code></pre></div>

<p>或者，你可以使用 <a href="https://www.2daygeek.com/install-pip-manage-python-packages-linux/">Python PIP 包管理工具</a> 来安装：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>curl<span class="w"> </span>https://bootstrap.pypa.io/get-pip.py<span class="w"> </span>-o<span class="w"> </span>get-pip.py
$<span class="w"> </span>sudo<span class="w"> </span>python<span class="w"> </span>get-pip.py
$<span class="w"> </span>sudo<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>ansible
</code></pre></div>

<p>在控制节点上检查安装的 Ansible 版本：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>ansible<span class="w"> </span>--version

ansible<span class="w"> </span><span class="m">2</span>.9.2
<span class="w">  </span>config<span class="w"> </span><span class="nv">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>/etc/ansible/ansible.cfg
<span class="w">  </span>configured<span class="w"> </span>module<span class="w"> </span>search<span class="w"> </span><span class="nv">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="s1">&#39;/home/daygeek/.ansible/plugins/modules&#39;</span>,<span class="w"> </span><span class="s1">&#39;/usr/share/ansible/plugins/modules&#39;</span><span class="o">]</span>
<span class="w">  </span>ansible<span class="w"> </span>python<span class="w"> </span>module<span class="w"> </span><span class="nv">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>/usr/lib/python3.8/site-packages/ansible
<span class="w">  </span>executable<span class="w"> </span><span class="nv">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>/usr/bin/ansible
<span class="w">  </span>python<span class="w"> </span><span class="nv">version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span>.8.1<span class="w"> </span><span class="o">(</span>default,<span class="w"> </span>Jan<span class="w">  </span><span class="m">8</span><span class="w"> </span><span class="m">2020</span>,<span class="w"> </span><span class="m">23</span>:09:20<span class="o">)</span><span class="w"> </span><span class="o">[</span>GCC<span class="w"> </span><span class="m">9</span>.2.0<span class="o">]</span>
</code></pre></div>

<h3>如何在受控节点上安装 Python？</h3>
<p>使用以下命令在受控节点上安装 python：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>sudo<span class="w"> </span>yum<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>python
$<span class="w"> </span>sudo<span class="w"> </span>dnf<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>python
$<span class="w"> </span>sudo<span class="w"> </span>zypper<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>python
$<span class="w"> </span>sudo<span class="w"> </span>pacman<span class="w"> </span>-S<span class="w"> </span>python
$<span class="w"> </span>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>python
</code></pre></div>

<h3>如何在 Linux 设置 SSH 密钥身份验证（无密码身份验证）</h3>
<p>使用以下命令创建 ssh 密钥，然后将其复制到远程计算机。</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>ssh-keygen
$<span class="w"> </span>ssh-copy-id<span class="w"> </span>daygeek@node1.2g.lab
$<span class="w"> </span>ssh-copy-id<span class="w"> </span>daygeek@node2.2g.lab
$<span class="w"> </span>ssh-copy-id<span class="w"> </span>daygeek@node3.2g.lab
</code></pre></div>

<p>具体参考这篇文章《<a href="https://www.2daygeek.com/configure-setup-passwordless-ssh-key-based-authentication-linux/">在 Linux 上设置 SSH 密钥身份验证（无密码身份验证）</a>》。</p>
<h3>如何创建 Ansible 主机清单</h3>
<p>在 <code>/etc/ansible/hosts</code> 文件中添加要管理的节点列表。如果没有该文件，则可以创建一个新文件。以下是我的测试环境的主机清单文件：</p>
<div class="highlight"><pre><span></span><code><span class="err">$</span><span class="w"> </span><span class="n">sudo</span><span class="w"> </span><span class="n">vi</span><span class="w"> </span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">ansible</span><span class="o">/</span><span class="n">hosts</span>

<span class="o">[</span><span class="n">web</span><span class="o">]</span>
<span class="n">node1</span><span class="mf">.2</span><span class="n">g</span><span class="p">.</span><span class="n">lab</span>
<span class="n">node2</span><span class="mf">.2</span><span class="n">g</span><span class="p">.</span><span class="n">lab</span>

<span class="o">[</span><span class="n">app</span><span class="o">]</span>
<span class="n">node3</span><span class="mf">.2</span><span class="n">g</span><span class="p">.</span><span class="n">lab</span>
</code></pre></div>

<p>让我们看看是否可以使用以下命令查找所有主机。</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>ansible<span class="w"> </span>all<span class="w"> </span>--list-hosts

<span class="w"> </span>hosts<span class="w"> </span><span class="o">(</span><span class="m">3</span><span class="o">)</span>:
<span class="w">   </span>node1.2g.lab
<span class="w">   </span>node2.2g.lab
<span class="w">   </span>node3.2g.lab
</code></pre></div>

<p>对单个组运行以下命令：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>ansible<span class="w"> </span>web<span class="w"> </span>--list-hosts

<span class="w"> </span>hosts<span class="w"> </span><span class="o">(</span><span class="m">2</span><span class="o">)</span>:
<span class="w">   </span>node1.2g.lab
<span class="w">   </span>node2.2g.lab
</code></pre></div>

<h3>如何使用点对点命令执行任务</h3>
<p>一旦完成主机清单验证检查后，你就可以上路了。干的漂亮！</p>
<p><strong>语法：</strong></p>
<div class="highlight"><pre><span></span><code><span class="n">ansible</span><span class="w"> </span><span class="p">[</span><span class="n">pattern</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="n">m</span><span class="w"> </span><span class="p">[</span><span class="n">module</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="n">a</span><span class="w"> </span><span class="s">&quot;[module options]&quot;</span>

<span class="nl">Details</span><span class="p">:</span>
<span class="o">========</span>
<span class="nl">ansible</span><span class="p">:</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="n">command</span>
<span class="nl">pattern</span><span class="p">:</span><span class="w"> </span><span class="n">Enter</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">entire</span><span class="w"> </span><span class="n">inventory</span><span class="w"> </span><span class="n">or</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">specific</span><span class="w"> </span><span class="n">group</span>
<span class="o">-</span><span class="n">m</span><span class="w"> </span><span class="p">[</span><span class="n">module</span><span class="p">]</span><span class="o">:</span><span class="w"> </span><span class="n">Run</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">given</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="n">name</span>
<span class="o">-</span><span class="n">a</span><span class="w"> </span><span class="p">[</span><span class="n">module</span><span class="w"> </span><span class="n">options</span><span class="p">]</span><span class="o">:</span><span class="w"> </span><span class="n">Specify</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="n">arguments</span>
</code></pre></div>

<p>使用 Ping 模块对主机清单中的所有节点执行 ping 操作：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>ansible<span class="w"> </span>all<span class="w"> </span>-m<span class="w"> </span>ping

node3.2g.lab<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nv">SUCCESS</span><span class="w"> </span><span class="o">=</span>&gt;<span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="s2">&quot;ansible_facts&quot;</span>:<span class="w"> </span><span class="o">{</span>
<span class="w">        </span><span class="s2">&quot;discovered_interpreter_python&quot;</span>:<span class="w"> </span><span class="s2">&quot;/usr/bin/python&quot;</span>
<span class="w">    </span><span class="o">}</span>,
<span class="w">    </span><span class="s2">&quot;changed&quot;</span>:<span class="w"> </span>false,
<span class="w">    </span><span class="s2">&quot;ping&quot;</span>:<span class="w"> </span><span class="s2">&quot;pong&quot;</span>
<span class="o">}</span>
node1.2g.lab<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nv">SUCCESS</span><span class="w"> </span><span class="o">=</span>&gt;<span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="s2">&quot;ansible_facts&quot;</span>:<span class="w"> </span><span class="o">{</span>
<span class="w">        </span><span class="s2">&quot;discovered_interpreter_python&quot;</span>:<span class="w"> </span><span class="s2">&quot;/usr/bin/python&quot;</span>
<span class="w">    </span><span class="o">}</span>,
<span class="w">    </span><span class="s2">&quot;changed&quot;</span>:<span class="w"> </span>false,
<span class="w">    </span><span class="s2">&quot;ping&quot;</span>:<span class="w"> </span><span class="s2">&quot;pong&quot;</span>
<span class="o">}</span>
node2.2g.lab<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nv">SUCCESS</span><span class="w"> </span><span class="o">=</span>&gt;<span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="s2">&quot;ansible_facts&quot;</span>:<span class="w"> </span><span class="o">{</span>
<span class="w">        </span><span class="s2">&quot;discovered_interpreter_python&quot;</span>:<span class="w"> </span><span class="s2">&quot;/usr/libexec/platform-python&quot;</span>
<span class="w">    </span><span class="o">}</span>,
<span class="w">    </span><span class="s2">&quot;changed&quot;</span>:<span class="w"> </span>false,
<span class="w">    </span><span class="s2">&quot;ping&quot;</span>:<span class="w"> </span><span class="s2">&quot;pong&quot;</span>
<span class="o">}</span>
</code></pre></div>

<p>所有系统都返回了成功，但什么都没有改变，只返回了 <code>pong</code> 代表成功。</p>
<p>你可以使用以下命令获取可用模块的列表。</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>ansible-doc<span class="w"> </span>-l
</code></pre></div>

<p>当前有 3387 个内置模块，它们会随着 Ansible 版本的递增而增加：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>ansible-doc<span class="w"> </span>-l<span class="w"> </span><span class="p">|</span><span class="w"> </span>wc<span class="w"> </span>-l
<span class="m">3387</span>
</code></pre></div>

<p>使用 command 模块对主机清单中的所有节点执行命令：</p>
<div class="highlight"><pre><span></span><code><span class="o">$</span><span class="w"> </span><span class="n">ansible</span><span class="w"> </span><span class="n">all</span><span class="w"> </span><span class="o">-</span><span class="n">m</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="o">-</span><span class="n">a</span><span class="w"> </span><span class="s2">&quot;uptime&quot;</span>

<span class="n">node3</span><span class="o">.</span><span class="mi">2</span><span class="n">g</span><span class="o">.</span><span class="n">lab</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">CHANGED</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">rc</span><span class="o">=</span><span class="mi">0</span><span class="w"> </span><span class="o">&gt;&gt;</span>
<span class="w"> </span><span class="mi">18</span><span class="p">:</span><span class="mi">05</span><span class="p">:</span><span class="mi">07</span><span class="w"> </span><span class="n">up</span><span class="w">  </span><span class="mi">1</span><span class="p">:</span><span class="mi">21</span><span class="p">,</span><span class="w">  </span><span class="mi">3</span><span class="w"> </span><span class="n">users</span><span class="p">,</span><span class="w">  </span><span class="nb">load</span><span class="w"> </span><span class="n">average</span><span class="p">:</span><span class="w"> </span><span class="mf">0.12</span><span class="p">,</span><span class="w"> </span><span class="mf">0.06</span><span class="p">,</span><span class="w"> </span><span class="mf">0.01</span>
<span class="n">node1</span><span class="o">.</span><span class="mi">2</span><span class="n">g</span><span class="o">.</span><span class="n">lab</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">CHANGED</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">rc</span><span class="o">=</span><span class="mi">0</span><span class="w"> </span><span class="o">&gt;&gt;</span>
<span class="w"> </span><span class="mi">06</span><span class="p">:</span><span class="mi">35</span><span class="p">:</span><span class="mi">06</span><span class="w"> </span><span class="n">up</span><span class="w">  </span><span class="mi">1</span><span class="p">:</span><span class="mi">21</span><span class="p">,</span><span class="w">  </span><span class="mi">4</span><span class="w"> </span><span class="n">users</span><span class="p">,</span><span class="w">  </span><span class="nb">load</span><span class="w"> </span><span class="n">average</span><span class="p">:</span><span class="w"> </span><span class="mf">0.01</span><span class="p">,</span><span class="w"> </span><span class="mf">0.03</span><span class="p">,</span><span class="w"> </span><span class="mf">0.05</span>
<span class="n">node2</span><span class="o">.</span><span class="mi">2</span><span class="n">g</span><span class="o">.</span><span class="n">lab</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">CHANGED</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">rc</span><span class="o">=</span><span class="mi">0</span><span class="w"> </span><span class="o">&gt;&gt;</span>
<span class="w"> </span><span class="mi">18</span><span class="p">:</span><span class="mi">05</span><span class="p">:</span><span class="mi">07</span><span class="w"> </span><span class="n">up</span><span class="w">  </span><span class="mi">1</span><span class="p">:</span><span class="mi">25</span><span class="p">,</span><span class="w">  </span><span class="mi">3</span><span class="w"> </span><span class="n">users</span><span class="p">,</span><span class="w">  </span><span class="nb">load</span><span class="w"> </span><span class="n">average</span><span class="p">:</span><span class="w"> </span><span class="mf">0.01</span><span class="p">,</span><span class="w"> </span><span class="mf">0.01</span><span class="p">,</span><span class="w"> </span><span class="mf">0.00</span>
</code></pre></div>

<p>对指定组执行 command 模块。</p>
<p>检查 app 组主机的内存使用情况：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>ansible<span class="w"> </span>app<span class="w"> </span>-m<span class="w"> </span><span class="nb">command</span><span class="w"> </span>-a<span class="w"> </span><span class="s2">&quot;free -m&quot;</span>

node3.2g.lab<span class="w"> </span><span class="p">|</span><span class="w"> </span>CHANGED<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nv">rc</span><span class="o">=</span><span class="m">0</span><span class="w"> </span>&gt;&gt;
<span class="w">              </span>total<span class="w">        </span>used<span class="w">        </span>free<span class="w">      </span>shared<span class="w">  </span>buff/cache<span class="w">   </span>available
Mem:<span class="w">           </span><span class="m">1993</span><span class="w">        </span><span class="m">1065</span><span class="w">          </span><span class="m">91</span><span class="w">           </span><span class="m">6</span><span class="w">         </span><span class="m">836</span><span class="w">         </span><span class="m">748</span>
Swap:<span class="w">          </span><span class="m">1425</span><span class="w">           </span><span class="m">0</span><span class="w">        </span><span class="m">1424</span>
</code></pre></div>

<p>要对 web 组运行 <code>hostnamectl</code> 命令，使用以下格式：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>ansible<span class="w"> </span>web<span class="w"> </span>-m<span class="w"> </span><span class="nb">command</span><span class="w"> </span>-a<span class="w"> </span><span class="s2">&quot;hostnamectl&quot;</span>

node1.2g.lab<span class="w"> </span><span class="p">|</span><span class="w"> </span>CHANGED<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nv">rc</span><span class="o">=</span><span class="m">0</span><span class="w"> </span>&gt;&gt;
<span class="w">   </span>Static<span class="w"> </span>hostname:<span class="w"> </span>CentOS7.2daygeek.com
<span class="w">         </span>Icon<span class="w"> </span>name:<span class="w"> </span>computer-vm
<span class="w">           </span>Chassis:<span class="w"> </span>vm
<span class="w">        </span>Machine<span class="w"> </span>ID:<span class="w"> </span>002f47b82af248f5be1d67b67e03514c
<span class="w">           </span>Boot<span class="w"> </span>ID:<span class="w"> </span>dc38f9b8089d4b2d9304e526e00c6a8f
<span class="w">    </span>Virtualization:<span class="w"> </span>kvm
<span class="w">  </span>Operating<span class="w"> </span>System:<span class="w"> </span>CentOS<span class="w"> </span>Linux<span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="o">(</span>Core<span class="o">)</span>
<span class="w">       </span>CPE<span class="w"> </span>OS<span class="w"> </span>Name:<span class="w"> </span>cpe:/o:centos:centos:7
<span class="w">            </span>Kernel:<span class="w"> </span>Linux<span class="w"> </span><span class="m">3</span>.10.0-957.el7.x86_64
<span class="w">      </span>Architecture:<span class="w"> </span>x86-64
node2.2g.lab<span class="w"> </span><span class="p">|</span><span class="w"> </span>CHANGED<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nv">rc</span><span class="o">=</span><span class="m">0</span><span class="w"> </span>&gt;&gt;
<span class="w">   </span>Static<span class="w"> </span>hostname:<span class="w"> </span>node2.2g.lab
<span class="w">         </span>Icon<span class="w"> </span>name:<span class="w"> </span>computer-vm
<span class="w">           </span>Chassis:<span class="w"> </span>vm
<span class="w">        </span>Machine<span class="w"> </span>ID:<span class="w"> </span>e39e3a27005d44d8bcbfcab201480b45
<span class="w">           </span>Boot<span class="w"> </span>ID:<span class="w"> </span>27b46a09dde546da95ace03420fe12cb
<span class="w">    </span>Virtualization:<span class="w"> </span>oracle
<span class="w">  </span>Operating<span class="w"> </span>System:<span class="w"> </span>CentOS<span class="w"> </span>Linux<span class="w"> </span><span class="m">8</span><span class="w"> </span><span class="o">(</span>Core<span class="o">)</span>
<span class="w">       </span>CPE<span class="w"> </span>OS<span class="w"> </span>Name:<span class="w"> </span>cpe:/o:centos:centos:8
<span class="w">            </span>Kernel:<span class="w"> </span>Linux<span class="w"> </span><span class="m">4</span>.18.0-80.el8.x86_64
<span class="w">      </span>Architecture:<span class="w"> </span>x86-64
</code></pre></div>

<p>参考：<a href="https://docs.ansible.com/ansible/latest/user_guide/index.html">Ansible 文档</a>。</p>
    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>links</h2>
                        <ul>
                            <li><a href="https://getpelican.com/">Pelican</a></li>
                            <li><a href="https://www.python.org/">Python.org</a></li>
                            <li><a href="https://palletsprojects.com/p/jinja/">Jinja2</a></li>
                            <li><a href="#">You can modify those links in your config file</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>

                            <li><a href="#">You can add links in your config file</a></li>
                            <li><a href="#">Another social link</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a rel="nofollow" href="https://getpelican.com/">Pelican</a>, which takes great advantage of <a rel="nofollow" href="https://www.python.org/">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a rel="nofollow" href="https://www.smashingmagazine.com/2009/08/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>