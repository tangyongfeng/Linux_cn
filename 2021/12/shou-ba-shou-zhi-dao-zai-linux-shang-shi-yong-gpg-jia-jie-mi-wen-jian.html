<!DOCTYPE html>
<html lang="zh">
<head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="generator" content="Pelican" />
        <title>手把手指导：在 Linux 上使用 GPG 加解密文件</title>
        <link rel="stylesheet" href="/theme/css/main.css" />
        <meta name="description" content="Author: Hunter Wittenborn GnuPG，俗称 GPG，是一个非常通用的工具，被广泛用作电子邮件、信息、文件或任何你需要安全地发送给别人的东西的加密 …" />
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">linux_cn</a></h1>
                <nav><ul>
                    <li><a href="/category/chuan-shan-jia-zhuan-fang">穿山甲专访</a></li>
                    <li><a href="/category/dai-ma-ying-xiong">代码英雄</a></li>
                    <li><a href="/category/fen-xiang">分享</a></li>
                    <li><a href="/category/guan-dian">观点</a></li>
                    <li><a href="/category/huo-dong">活动</a></li>
                    <li><a href="/category/ji-ke-man-hua">极客漫画</a></li>
                    <li class="active"><a href="/category/ji-zhu">技术</a></li>
                    <li><a href="/category/kai-yuan-zhi-hui">开源智慧</a></li>
                    <li><a href="/category/linux-fa-xing-ban">Linux 发行版</a></li>
                    <li><a href="/category/mei-ri-an-quan-zi-xun">每日安全资讯</a></li>
                    <li><a href="/category/misc">Misc</a></li>
                    <li><a href="/category/qu-kuai-lian">区块链</a></li>
                    <li><a href="/category/rong-qi-yu-yun">容器与云</a></li>
                    <li><a href="/category/ruan-jian-kai-fa">软件开发</a></li>
                    <li><a href="/category/shu-mei-pai">树莓派</a></li>
                    <li><a href="/category/xi-tong-yun-wei">系统运维</a></li>
                    <li><a href="/category/xin-wen">新闻</a></li>
                    <li><a href="/category/ying-he-guan-cha">硬核观察</a></li>
                    <li><a href="/category/zhi-ye-sheng-ya">职业生涯</a></li>
                    <li><a href="/category/zhong-jiang-ming-dan">中奖名单</a></li>
                    <li><a href="/category/zhuo-mian-ying-yong">桌面应用</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="/2021/12/shou-ba-shou-zhi-dao-zai-linux-shang-shi-yong-gpg-jia-jie-mi-wen-jian.html" rel="bookmark"
           title="Permalink to 手把手指导：在 Linux 上使用 GPG 加解密文件">手把手指导：在 Linux 上使用 GPG 加解密文件</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2021-12-15T13:36:45+01:00">
                Published: Wed 15 December 2021
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/linux-fans-from-china.html">linux fans from china</a>
        </address>
<p>In <a href="/category/ji-zhu">技术</a>.</p>

</footer><!-- /.post-info -->      <p>Author: Hunter Wittenborn</p>
<p><img alt="" src="/data/attachment/album/202112/15/133531wcs1iy4luihr3beg.jpg"></p>
<p><a href="https://gnupg.org/">GnuPG</a>，俗称 GPG，是一个非常通用的工具，被广泛用作电子邮件、信息、文件或任何你需要安全地发送给别人的东西的加密行业标准。</p>
<p>学习使用 GPG 很容易，你可以在几分钟内就学会使用它。</p>
<p>在本教程中，我将告诉你如何用 GPG 加密和解密文件。这是一个简单的教程，你可以在你的 Linux 系统上尝试所有的练习。这将帮助你练习 GPG 命令，并在你完全陌生的情况下理解它。</p>
<p>请先阅读整个教程，然后开始自己做。</p>
<h3>GPG 是如何进行加密的？</h3>
<p><img alt="GPG 加密" src="/data/attachment/album/202112/15/133645b1i73az322l66l57.png"></p>
<p>要使用 GPG，你首先需要有一个 GPG 密钥。</p>
<p>GPG 密钥是你在后面的教程中用来加密（或解密）文件的东西。它也是用来识别你的身份的，你的名字和电子邮件也会与密钥绑定。</p>
<p>GPG 密钥的工作原理是使用两个文件，一个私钥和一个公钥。这两个密钥是相互联系的，并且 GPG 的所有功能都需要使用它们，特别是对文件加密和解密。</p>
<p>当你用 GPG 加密一个文件时，它使用的是私钥。然后，这个新的加密文件<strong>只能</strong>用配对的公钥进行解密。</p>
<p>私钥，顾名思义，是以私下的、不给任何人看的方式来存储的密钥。</p>
<p>另一方面，公钥是用来给其他人的，或者你希望能够解密你的文件的任何人。</p>
<p>这就是 GPG 的加密方法的主要作用。它允许你对文件进行本地加密，然后允许其他人确保他们收到的文件实际上是由你发送的。因为他们能够解密文件的唯一方法是使用你的公钥，而这只有在文件首先使用你的私钥加密的情况下才有效。</p>
<p><strong>反之</strong>，其他人可以用你的公钥对文件进行加密，而唯一能够解密的方法是用你的私钥。因此，允许其他人公开发布文件，而不用担心除了你以外的人能够阅读它们。（LCTT 译注：另外一个常见的用例是你用你的私钥对公开发布的文件进行签名，别人使用你的公钥通过验证你的签名而确信文件是你发布的、并没有被篡改。但本文没有涉及这个用例。）</p>
<p>换句话说，如果一个文件是用私钥加密的，它只能用相应的公钥解密。而如果一个文件是用公钥加密的，它只能用相应的私钥解密。</p>
<h4>你已经在使用 GPG 而没有意识到</h4>
<p>一个最常见的使用 GPG 的例子是在 Linux 软件包管理器中，特别是 <a href="https://itsfoss.com/adding-external-repositories-ubuntu/">外部仓库</a>。你把开发者的公钥添加到你系统的可信密钥中。开发者用他/她的私钥签署软件包（生成签名）。由于你的 Linux 系统拥有该公钥文件，它就能理解该软件包实际上是来自受信任的开发者。</p>
<p>许多加密服务在你没有意识到的情况下使用了某种 GPG 的实现。但现在最好不要去研究这些细节。</p>
<p>现在你对这个概念有点熟悉了，让我们看看如何使用 GPG 来加密一个文件，然后用它来解密。</p>
<h3>用 GPG 对文件进行加密和解密</h3>
<p><img alt="" src="/data/attachment/album/202112/15/133646o30ren9lnfnn6jyn.png"></p>
<p>这是一个非常简单的场景。我假定你只有一个系统，你想看看 GPG 是如何工作的。你并没有把文件发送到其他系统。你对文件进行加密，然后在同一个系统上解密。</p>
<p>当然，这不是一个实际的用例，但这也不是本教程的目的。我的目的是让你熟悉 GPG 命令和功能。之后，你可以在现实世界中使用这些知识（如果需要的话）。为此，我将告诉你如何与他人分享你的公钥。</p>
<h4>第一步：安装 GPG</h4>
<p>GPG 可以在大多数发行版的软件库中找到，开箱即用。</p>
<p>在基于 Debian 和 Ubuntu 的系统中，安装 <code>gpg</code> 包：</p>
<div class="highlight"><pre><span></span><code>sudo apt install gpg
</code></pre></div>

<p>如果你使用 <a href="https://itsfoss.com/arch-based-linux-distros/">基于 Arch 的发行版</a>，用 <a href="https://itsfoss.com/pacman-command/">pacman 命令</a> 安装 <code>gnupg</code> 软件包：</p>
<div class="highlight"><pre><span></span><code>sudo pacman -S gnupg
</code></pre></div>

<h4>第二步：生成一个 GPG 密钥</h4>
<p>在你的系统上生成一个 GPG 密钥只需要一条简单的命令。</p>
<p>只要运行下面的命令，就会生成你的密钥（你可以对大多数问题使用默认值，如下面的下划线部分所示）。</p>
<div class="highlight"><pre><span></span><code>gpg --full-generate-key
</code></pre></div>

<p><img alt="生成 GPG 密钥" src="/data/attachment/album/202112/15/133646o4vmvoddrpo4mm4b.png"></p>
<p><strong>检查 GPG 密钥</strong></p>
<p>然后你可以通过使用 <code>--list-secret-keys</code> 和 <code>--list-public-keys</code> 参数，分别看到私钥和公钥都是通过 <code>pub</code> 下显示的那个 ID 相互绑定的。</p>
<p><img alt="列出 GPG 密钥" src="/data/attachment/album/202112/15/133646hkm9czc4wl3l19zk.png"></p>
<h4>第三步：用 GPG 加密一个文件</h4>
<p>现在你已经设置了 GPG 密钥，你可以开始对我们的文件进行加密了。</p>
<p>使用下面的命令来加密文件：</p>
<div class="highlight"><pre><span></span><code><span class="n">gpg</span><span class="w"> </span><span class="c1">--encrypt --output file.gpg --recipient user@example.com file</span>
</code></pre></div>

<p>让我们快速浏览一下该命令的内容：</p>
<p>首先，你指定了 <code>—encrypt</code> 选项。这告诉 GPG，我们将对一个文件进行加密。</p>
<p>接下来，你指定了 <code>--output file.gpg</code>。这可以是任何名字，不过惯例是给你要加密的文件的名称加上 <code>.gpg</code> 扩展名（所以 <code>message.txt</code> 会变成 <code>message.txt.gpg</code>）。</p>
<p>接下来，你输入 <code>—recipient user@example.com</code>。这指定了一个相应的 GPG 密钥的电子邮件，这个密钥实际上在这个系统上还不存在。</p>
<p>有点迷惑？</p>
<p>工作原理是，你在这里指定的电子邮件必须与你本地系统中的公钥相联系。</p>
<p>通常情况下，这将是来自另外一个人的 GPG 公钥，你要用它来加密你的文件。之后，该文件将只能用该用户的私钥进行解密。</p>
<p>在这个例子中，我将使用我以前的与 <code>user@example.com</code> 关联的 GPG 密钥。因此，其逻辑是，我用 <code>user@example.com</code> 的 <em>公钥</em> 对文件进行加密，然后只能用 <code>user@example.com</code> 的 <em>私钥</em> 进行解密。</p>
<p>如果你是为别人加密文件，你只有该公钥，但由于你是为自己加密文件，你的系统上有这两个密钥。</p>
<p>最后，你只需指定你要加密的文件。在这个例子中，让我们使用一个名为 <code>message.txt</code> 的文件，内容如下：</p>
<div class="highlight"><pre><span></span><code>We&#39;re encrypting with GPG!
</code></pre></div>

<p><img alt="文本文件样本" src="/data/attachment/album/202112/15/133647pd2yesr9y9kdqynm.png"></p>
<p>同样地，如果电子邮件是 <code>user@example.com</code>，新的 GPG 命令将如下所示：</p>
<div class="highlight"><pre><span></span><code><span class="n">gpg</span><span class="w"> </span><span class="c1">--encrypt --output message.txt.gpg --recipient user@example.com message.txt</span>
</code></pre></div>

<p><img alt="用 GPG 加密文件" src="/data/attachment/album/202112/15/133647gsnxq3nsgnsq3s3y.png"></p>
<p>如果你尝试阅读该文件，你会看到它看起来像乱码。这是预料之中的，因为该文件现在已经被加密了。</p>
<p><img alt="读取加密文件会产生乱码" src="/data/attachment/album/202112/15/133647tjsiiijpfwpujiz1.png"></p>
<p>现在让我们删除未加密的 <code>message.txt</code> 文件，这样你就可以看到 <code>message.txt.gpg</code> 文件实际上在没有原始文件的情况下也能正常解密。</p>
<p><img alt="" src="/data/attachment/album/202112/15/133647rjkcbjc5byj79cky.png"></p>
<h4>第四步：用 GPG 解密加密的文件</h4>
<p>最后，让我们来实际解密加密的信息。你可以用下面的命令来做。</p>
<div class="highlight"><pre><span></span><code>gpg --decrypt --output file file.gpg
</code></pre></div>

<p>通过这里的参数，我们首先指定 <code>—decrypt</code>，它告诉 GPG 你将会解密一个文件。</p>
<p>接下来，你输入 <code>—output</code> 文件，这只是告诉 GPG，在你解密后，你将把我们文件的解密形式保存到哪个文件。</p>
<p>最后，你输入 <code>file.gpg</code>，这是你的加密文件的路径。</p>
<p>按照这个例子，我使用的命令是这样的。</p>
<div class="highlight"><pre><span></span><code>gpg --decrypt --output message.txt message.txt.gpg
</code></pre></div>

<p><img alt="用GPG解密文件" src="/data/attachment/album/202112/15/133647z7tv3726ko9to9oq.png"></p>
<p>然后就完成了！当你想用 GPG 加密和解密文件时，这就是全部内容了。</p>
<p>剩下你可能想知道的是如何与他人分享你的公钥，以便他们在将文件发送给你之前对其进行加密。</p>
<h3>发送和接收 GPG 密钥</h3>
<p>要给别人发送一个 GPG 密钥，你首先需要从你的<strong>钥匙链</strong>中导出它，它包含了你所有的公钥和私钥。</p>
<p>要导出一个密钥，只需在你的钥匙链中找到密钥的 ID，然后运行以下命令，用密钥的 ID 替换 <code>id</code>，用你想保存的文件名替换 <code>key.gpg</code>。</p>
<div class="highlight"><pre><span></span><code><span class="n">gpg</span><span class="w"> </span><span class="o">--</span><span class="n">output</span><span class="w"> </span><span class="n">key</span><span class="o">.</span><span class="n">gpg</span><span class="w"> </span><span class="o">--</span><span class="k">export</span><span class="w"> </span><span class="n">id</span>
</code></pre></div>

<p><img alt="导出 GPG 公钥" src="/data/attachment/album/202112/15/133648q99nhi98a9ib8c91.png"></p>
<p>要导入一个密钥，只需把输出文件（来自前面的命令）给其他用户，然后让他们运行下面的命令。</p>
<div class="highlight"><pre><span></span><code><span class="n">gpg</span> <span class="o">--</span><span class="kn">import</span> <span class="nn">key.gpg</span>
</code></pre></div>

<p><img alt="" src="/data/attachment/album/202112/15/133648g7dubcrr3yfcocmu.png"></p>
<p>但要正常使用该密钥，你需要验证该密钥，以便 GPG 正确地信任它。</p>
<p>这可以通过在其他用户的系统上使用 <code>--edit-key</code> 参数来完成，然后对密钥进行签名。</p>
<p>首先运行 <code>gpg --edit-key id</code>：</p>
<p><img alt="GPG 编辑密钥" src="/data/attachment/album/202112/15/133648vt6ucccq3tjdceuv.png"></p>
<p>接下来，使用 <code>—fpr</code> 参数，它将显示密钥的指纹。这个命令的输出应该与你自己机器上的输出进行验证，这可以通过在你的系统上运行同样的 <code>--edit-key</code> 参数来找到。</p>
<p><img alt="GPG 密钥的指纹" src="/data/attachment/album/202112/15/133648bxss6p16zbssppg6.png"></p>
<p>如果一切吻合，只需使用 <code>—sign</code> 参数，一切就可以开始了。</p>
<p><img alt="签署 GPG 密钥" src="/data/attachment/album/202112/15/133649hi1pv42s2iv2avsj.png"></p>
<p>就是这样！其他用户现在可以开始用你的公钥加密文件了，就像你之前做的那样，这可以确保它们只有在你用你的私钥解密时才能被你读取。</p>
<p>这就是使用 GPG 的所有基础知识！</p>
<h3>总结</h3>
<p>现在你已经了解了开始使用 GPG 所需要的一切，包括为自己和他人加密文件。正如我前面提到的，这只是为了了解 GPG 的加密和解密过程是如何工作的。你刚刚获得的基本 GPG 知识在应用于真实世界的场景中时可以更上一层楼。</p>
<p>还需要一些帮助来弄清楚一些东西，或者有一些不工作的东西？欢迎在下面的评论中留下任何内容。</p>
    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>links</h2>
                        <ul>
                            <li><a href="https://getpelican.com/">Pelican</a></li>
                            <li><a href="https://www.python.org/">Python.org</a></li>
                            <li><a href="https://palletsprojects.com/p/jinja/">Jinja2</a></li>
                            <li><a href="#">You can modify those links in your config file</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>

                            <li><a href="#">You can add links in your config file</a></li>
                            <li><a href="#">Another social link</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a rel="nofollow" href="https://getpelican.com/">Pelican</a>, which takes great advantage of <a rel="nofollow" href="https://www.python.org/">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a rel="nofollow" href="https://www.smashingmagazine.com/2009/08/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>