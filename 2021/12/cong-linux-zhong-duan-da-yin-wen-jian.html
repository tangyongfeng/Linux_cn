<!DOCTYPE html>
<html lang="zh">
<head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="generator" content="Pelican" />
        <title>从 Linux 终端打印文件</title>
        <link rel="stylesheet" href="/theme/css/main.css" />
        <meta name="description" content="Author: Seth Kenlon 使用 lpr 命令在终端中打印文件。 在 Linux 上打印很容易，但有时感觉要做很多工作，比如启动应用程序、打开文件、在菜单 …" />
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">linux_cn</a></h1>
                <nav><ul>
                    <li><a href="/category/chuan-shan-jia-zhuan-fang">穿山甲专访</a></li>
                    <li><a href="/category/dai-ma-ying-xiong">代码英雄</a></li>
                    <li><a href="/category/fen-xiang">分享</a></li>
                    <li><a href="/category/guan-dian">观点</a></li>
                    <li><a href="/category/huo-dong">活动</a></li>
                    <li><a href="/category/ji-ke-man-hua">极客漫画</a></li>
                    <li class="active"><a href="/category/ji-zhu">技术</a></li>
                    <li><a href="/category/kai-yuan-zhi-hui">开源智慧</a></li>
                    <li><a href="/category/linux-fa-xing-ban">Linux 发行版</a></li>
                    <li><a href="/category/mei-ri-an-quan-zi-xun">每日安全资讯</a></li>
                    <li><a href="/category/misc">Misc</a></li>
                    <li><a href="/category/qu-kuai-lian">区块链</a></li>
                    <li><a href="/category/rong-qi-yu-yun">容器与云</a></li>
                    <li><a href="/category/ruan-jian-kai-fa">软件开发</a></li>
                    <li><a href="/category/shu-mei-pai">树莓派</a></li>
                    <li><a href="/category/xi-tong-yun-wei">系统运维</a></li>
                    <li><a href="/category/xin-wen">新闻</a></li>
                    <li><a href="/category/ying-he-guan-cha">硬核观察</a></li>
                    <li><a href="/category/zhi-ye-sheng-ya">职业生涯</a></li>
                    <li><a href="/category/zhong-jiang-ming-dan">中奖名单</a></li>
                    <li><a href="/category/zhuo-mian-ying-yong">桌面应用</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="/2021/12/cong-linux-zhong-duan-da-yin-wen-jian.html" rel="bookmark"
           title="Permalink to 从 Linux 终端打印文件">从 Linux 终端打印文件</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2021-12-20T13:58:28+01:00">
                Published: Mon 20 December 2021
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/linux-fans-from-china.html">linux fans from china</a>
        </address>
<p>In <a href="/category/ji-zhu">技术</a>.</p>

</footer><!-- /.post-info -->      <p>Author: Seth Kenlon</p>
<blockquote>
<p>使用 lpr 命令在终端中打印文件。</p>
</blockquote>
<p><img alt="" src="/data/attachment/album/202112/20/135809an6s6bxyg7sjnwyq.jpg" title="Typewriter with hands"></p>
<p><a href="https://opensource.com/article/21/8/setup-your-printer-linux">在 Linux 上打印很容易</a>，但有时感觉要做很多工作，比如启动应用程序、打开文件、在菜单中找到打印选项，单击确认按钮等等。当你是一个终端用户时，通常希望使用简单的触发器执行复杂的操作。打印很复杂，但没有什么比 <code>lpr</code> 命令更简单了。</p>
<h3>使用 lpr 命令打印</h3>
<p>使用 <code>lpr</code> 命令在终端打印文件：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>lpr<span class="w"> </span>myfile.odt
</code></pre></div>

<p>如果失败的话，你需要设置默认打印机或手动指定打印机。</p>
<h3>设置默认打印机</h3>
<p>根据我在 1984 年印刷的 Berkeley 4.2 手册的旧版本中找到的资料，<code>lpr</code> 命令会分页并将文件发送到打印机池，后者将数据传输到称为 <ruby> 行式打印机 <rt>  line printer </rt></ruby> 的东西。</p>
<p><img alt="显示 LPR 命令信息的页面" src="/data/attachment/album/202112/20/135831cwuu53g81v7dh7dz.jpg"></p>
<p>现在，最初的 <code>lpr</code> 命令已经无法满足，因为现代计算机可以访问多台打印机，而且是那些比点阵行式打印机复杂得多的打印机。现在有一个称为<ruby> 通用 Unix 打印系统 <rt>  Common Unix Printing System </rt></ruby>（CUPS）子系统，可以跟踪你的计算机可以访问的所有打印机，计算机应该使用哪个驱动程序与每台打印机通信，默认使用哪台打印机等等。 CUPS 捆绑提供的 <code>lpr.cups</code> 或 <code>lpr-cups</code> 命令通常以符号链接到 <code>lpr</code>，允许你首先借助 CUPS 配置从终端打印。</p>
<p>使用 <code>lpr</code> 打印文件，你应该首先设置默认打印机。你可以在系统的打印机设置中设置：</p>
<p><img alt="设置默认打印机对话框" src="/data/attachment/album/202112/20/135833oqbksdd60szckkhz.jpg"></p>
<p>或者，你也可以使用 <code>lpadmin</code> 命令设置：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>sudo<span class="w"> </span>lpadmin<span class="w"> </span>-d<span class="w"> </span>HP_LaserJet_P2015_Series
$<span class="w"> </span>lpstat<span class="w"> </span>-v
device<span class="w"> </span><span class="k">for</span><span class="w"> </span>HP_LaserJet_P2015_Series:<span class="w"> </span>ipp://10.0.1.222:631/printers/HP_LaserJet_P2015_Series
</code></pre></div>

<h3>使用环境变量设置</h3>
<p>你不能在没有管理员账户的系统上设置默认打印机，因为更改打印机默认设置是一项特权任务。在 <code>lpr</code> 借助 CUPS 找到目标打印机前，它会在系统中查询 <code>PRINTER</code> <a href="https://opensource.com/article/19/8/what-are-environment-variables">环境变量</a>。</p>
<p>在本例中，<code>HP_LaserJet_P2015_Series</code> 是打印机的名称。将 <code>PRINTER</code> 设置为该值：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span><span class="nv">PRINTER</span><span class="o">=</span>HP_LaserJet_P2015_Series
$<span class="w"> </span><span class="nb">export</span><span class="w"> </span>PRINTER
</code></pre></div>

<p>一旦设置了 <code>PRINTER</code> 变量，你就可以打印了：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>lpr<span class="w"> </span>myfile.pdf
</code></pre></div>

<h3>获取连接的打印机列表</h3>
<p>你可以使用 <code>lpstat</code> 命令查看所有连接到系统接受打印任务的打印机：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>lpstat<span class="w"> </span>-a
HP_LaserJet_P2015_Series<span class="w"> </span>accepting<span class="w"> </span>requests<span class="w"> </span>since<span class="w"> </span>Sun<span class="w"> </span><span class="m">1</span><span class="w"> </span>Aug<span class="w"> </span><span class="m">2021</span><span class="w"> </span><span class="m">10</span>:11:02<span class="w"> </span>PM<span class="w"> </span>NZST
r1060<span class="w"> </span>accepting<span class="w"> </span>requests<span class="w"> </span>since<span class="w"> </span>Wed<span class="w"> </span><span class="m">18</span><span class="w"> </span>Aug<span class="w"> </span><span class="m">2021</span><span class="w"> </span><span class="m">04</span>:43:57<span class="w"> </span>PM<span class="w"> </span>NZST
</code></pre></div>

<h3>打印到任意一台打印机</h3>
<p>将打印机添加到系统后，并且现在你知道如何识别它们了，你可以打印到其中任何一台，无论你是否设置了默认打印机：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>lpr<span class="w"> </span>-P<span class="w"> </span>HP_LaserJet_P2015_Series<span class="w"> </span>myfile.txt
</code></pre></div>

<h3>如何定义打印机</h3>
<p>CUPS 有一个友好的前端页面，可通过 Web 浏览器如 Firefox 访问。虽然它使用 Web 浏览器作为用户界面，但它实际上是在本机（一个称为 <code>localhost</code> 的位置）的 631 端口上提供服务。CUPS 管理连接到计算机的打印机，并将其配置存储在 <code>/etc/cups/priters.conf</code> 中。</p>
<p><code>printers.conf</code> 文件包含详细描述计算机可以访问的打印设备的定义。不要直接编辑它，但如果你想这样做，你必须先停止 <code>cupsd</code> 守护进程。</p>
<p>一个典型的文件定义如下所示：</p>
<div class="highlight"><pre><span></span><code><span class="nt">&lt;Printer</span><span class="w"> </span><span class="err">r1060</span><span class="nt">&gt;</span>
<span class="w">  </span>Info<span class="w"> </span>Ricoh<span class="w"> </span>1060
<span class="w">  </span>Location<span class="w"> </span>Downstairs
<span class="w">  </span>MakeModel<span class="w"> </span>Ricoh<span class="w"> </span>Aficio<span class="w"> </span>1060<span class="w"> </span>-<span class="w"> </span>CUPS+Gutenprint<span class="w"> </span>v5.2.6
<span class="w">  </span>DeviceURI<span class="w"> </span>lpd://192.168.4.8
<span class="w">  </span>State<span class="w"> </span>Idle
<span class="w">  </span>StateTime<span class="w"> </span>1316011347
<span class="w">  </span>Type<span class="w"> </span>12308
<span class="w">  </span>Filter<span class="w"> </span>application/vnd.cups-raw<span class="w"> </span>0<span class="w"> </span>-
<span class="w">  </span>Filter<span class="w"> </span>application/vnd.cups-raster<span class="w"> </span>100<span class="w"> </span>rastertogutenprint.5.2
<span class="w">  </span>Accepting<span class="w"> </span>Yes
<span class="w">  </span>Shared<span class="w"> </span>No
<span class="w">  </span>JobSheets<span class="w"> </span>none<span class="w"> </span>none
<span class="w">  </span>QuotaPeriod<span class="w"> </span>0
<span class="w">  </span>PageLimit<span class="w"> </span>0
<span class="w">  </span>KLimit<span class="w"> </span>0
<span class="w">  </span>OpPolicy<span class="w"> </span>default
<span class="w">  </span>ErrorPolicy<span class="w"> </span>stop-printer
<span class="nt">&lt;/Printer&gt;</span>
</code></pre></div>

<p>在本例中，打印机的名称是 <code>r1060</code>，即 “Ricoh Aficio 1060”。</p>
<p><code>MakeModel</code> 属性是从 <code>lpinfo</code> 命令中提取的，该命令列出了系统上所有可用的打印机驱动程序。假设你知道要打印到 Ricoh Aficio 1060，那么你会发出以下命令：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>lpinfo<span class="w"> </span>-m<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="m">1060</span>
gutenprint.5.2://brother-hl-1060/expert<span class="w"> </span>Brother<span class="w"> </span>HL-1060<span class="w"> </span>-<span class="w"> </span>CUPS+Gutenprint<span class="w"> </span>v5.2.11
gutenprint.5.2://ricoh-afc_1060/expert<span class="w"> </span>Ricoh<span class="w"> </span>Aficio<span class="w"> </span><span class="m">1060</span><span class="w"> </span>-<span class="w"> </span>CUPS+Gutenprint<span class="w"> </span>v5.2.11
</code></pre></div>

<p>它会列出已安装的相关驱动程序。</p>
<p><code>MakeModel</code> 属性是结果的后半部分。在本例中为 <code>Ricoh Aficio 1060 - CUPS+Gutenprint v5.2.11</code>。</p>
<p><code>DeviceURI</code> 属性标识打印机在网络上的位置（或物理位置，例如 USB 端口）。在本例中，它是 <code>lpd://192.168.4.8</code>，因为我使用 <code>lpd</code> 协议将数据发送到一台网络打印机。在我的另一个系统上，我有一个通过 USB 连接的 HP LaserJect 打印机，因此 <code>DeviceURI</code> 是 <code>hp:/usb/HP_LaserJet_P2015_Series?serial=00CNCJM26429</code>。</p>
<h3>在终端中打印</h3>
<p>将作业发送到打印机是一个简单的过程，只要你了解连接到系统的设备以及如何识别它们。在终端打印非常快速、高效，并且易于编写脚本或作为批处理作业完成。试试看！</p>
    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>links</h2>
                        <ul>
                            <li><a href="https://getpelican.com/">Pelican</a></li>
                            <li><a href="https://www.python.org/">Python.org</a></li>
                            <li><a href="https://palletsprojects.com/p/jinja/">Jinja2</a></li>
                            <li><a href="#">You can modify those links in your config file</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>

                            <li><a href="#">You can add links in your config file</a></li>
                            <li><a href="#">Another social link</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a rel="nofollow" href="https://getpelican.com/">Pelican</a>, which takes great advantage of <a rel="nofollow" href="https://www.python.org/">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a rel="nofollow" href="https://www.smashingmagazine.com/2009/08/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>