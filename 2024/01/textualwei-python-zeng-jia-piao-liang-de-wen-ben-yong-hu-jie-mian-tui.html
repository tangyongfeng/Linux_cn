<!DOCTYPE html>
<html lang="zh">
<head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="generator" content="Pelican" />
        <title>Textual：为 Python 增加漂亮的文本用户界面（TUI）</title>
        <link rel="stylesheet" href="/theme/css/main.css" />
        <meta name="description" content="Author: Jose Nunez 快速入门使用 Textual Python 在 Linux 上有像 TkInter 这样的优秀 GUI（图形用户界面）开发库，但如果你不能运行图形应用程序怎么办？ 文 …" />
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">linux_cn</a></h1>
                <nav><ul>
                    <li><a href="/category/chuan-shan-jia-zhuan-fang">穿山甲专访</a></li>
                    <li><a href="/category/dai-ma-ying-xiong">代码英雄</a></li>
                    <li><a href="/category/fen-xiang">分享</a></li>
                    <li><a href="/category/guan-dian">观点</a></li>
                    <li><a href="/category/huo-dong">活动</a></li>
                    <li><a href="/category/ji-ke-man-hua">极客漫画</a></li>
                    <li><a href="/category/ji-zhu">技术</a></li>
                    <li><a href="/category/kai-yuan-zhi-hui">开源智慧</a></li>
                    <li><a href="/category/linux-fa-xing-ban">Linux 发行版</a></li>
                    <li><a href="/category/mei-ri-an-quan-zi-xun">每日安全资讯</a></li>
                    <li><a href="/category/misc">Misc</a></li>
                    <li><a href="/category/qu-kuai-lian">区块链</a></li>
                    <li><a href="/category/rong-qi-yu-yun">容器与云</a></li>
                    <li class="active"><a href="/category/ruan-jian-kai-fa">软件开发</a></li>
                    <li><a href="/category/shu-mei-pai">树莓派</a></li>
                    <li><a href="/category/xi-tong-yun-wei">系统运维</a></li>
                    <li><a href="/category/xin-wen">新闻</a></li>
                    <li><a href="/category/ying-he-guan-cha">硬核观察</a></li>
                    <li><a href="/category/zhi-ye-sheng-ya">职业生涯</a></li>
                    <li><a href="/category/zhong-jiang-ming-dan">中奖名单</a></li>
                    <li><a href="/category/zhuo-mian-ying-yong">桌面应用</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="/2024/01/textualwei-python-zeng-jia-piao-liang-de-wen-ben-yong-hu-jie-mian-tui.html" rel="bookmark"
           title="Permalink to Textual：为 Python 增加漂亮的文本用户界面（TUI）">Textual：为 Python 增加漂亮的文本用户界面（TUI）</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2024-01-15T11:04:38+01:00">
                Published: Mon 15 January 2024
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/linux-fans-from-china.html">linux fans from china</a>
        </address>
<p>In <a href="/category/ruan-jian-kai-fa">软件开发</a>.</p>

</footer><!-- /.post-info -->      <p>Author: Jose Nunez</p>
<p><img alt="" src="/data/attachment/album/202401/15/110359fptrxpqffztniz45.jpg"></p>
<h3>快速入门使用 Textual</h3>
<p>Python 在 Linux 上有像 <a href="https://docs.python.org/3/library/tkinter.html">TkInter</a> 这样的优秀 GUI（图形用户界面）开发库，但如果你不能运行图形应用程序怎么办？</p>
<p>文本终端，并非只在 Linux 上有，而且 BSD 和其它的出色的类 Unix 操作系统上也有。如果你的代码是用 Python 编写的，你应该使用 <a href="https://textual.textualize.io/">Textual</a> 来帮助你编写 TUI（文本用户界面）。在这个快速介绍中，我将向你展示两个你可以用 Textual 做的示例，并且介绍它未来可能的应用方向。</p>
<p>所以 Textual 是什么？</p>
<blockquote>
<p>Textual 是一个为 Python 构建的快速应用程序开发框架，由 <a href="http://Textualize.io">Textualize.io</a> 构建。它可以让你用简单的 Python API 构建复杂的用户界面，并运行在终端或网络浏览器上！</p>
</blockquote>
<h4>你需要的跟进这个教程的工具</h4>
<p>你需要有以下条件：</p>
<ol>
<li>具备基础的编程经验，最好熟练使用 Python。</li>
<li>理解基础的面向对象概念，比如类和继承。</li>
<li>一台安装了 Linux 与 Python 3.9+ 的机器</li>
<li>一款好的编辑器（Vim 或者 PyCharm 是不错的选择）</li>
</ol>
<p>我尽可能简单化代码，以便你能轻松理解。此外，我强烈建议你下载代码，或至少按照接下来的说明安装相关程序。</p>
<h4>安装步骤</h4>
<p>首先创建一个虚拟环境：</p>
<div class="highlight"><pre><span></span><code>python3 -m venv ~/virtualenv/Textualize
</code></pre></div>

<p>现在，你可以克隆 Git 仓库并创建一个可以编辑的发布版本：</p>
<div class="highlight"><pre><span></span><code>. ~/virtualenv/Textualize/bin/activate
pip install --upgrade pip
pip install --upgrade wheel
pip install --upgrade build
pip install --editable .
</code></pre></div>

<p>或者直接从 <a href="http://Pypi.org">Pypi.org</a> 安装：</p>
<div class="highlight"><pre><span></span><code>. ~/virtualenv/Textualize/bin/activate
pip install --upgrade KodegeekTextualize
</code></pre></div>

<h3>我们的首个程序：日志浏览器</h3>
<p><img alt="" src="/data/attachment/album/202401/15/110439y6oo97pb89989wwh.svg"></p>
<p>这个 <em>日志浏览器</em> 就是一款简单的应用，能执行用户 <em><a href="https://manpages.org/bash">PATH</a></em> 路径上的一系列 UNIX 命令，并在任务执行完毕后捕获输出。</p>
<p>以下是该应用的代码：</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">from</span> <span class="nn">textual</span> <span class="kn">import</span> <span class="n">on</span>
<span class="kn">from</span> <span class="nn">textual.app</span> <span class="kn">import</span> <span class="n">ComposeResult</span><span class="p">,</span> <span class="n">App</span>
<span class="kn">from</span> <span class="nn">textual.widgets</span> <span class="kn">import</span> <span class="n">Footer</span><span class="p">,</span> <span class="n">Header</span><span class="p">,</span> <span class="n">Button</span><span class="p">,</span> <span class="n">SelectionList</span>
<span class="kn">from</span> <span class="nn">textual.widgets.selection_list</span> <span class="kn">import</span> <span class="n">Selection</span>
<span class="kn">from</span> <span class="nn">textual.screen</span> <span class="kn">import</span> <span class="n">ModalScreen</span>
<span class="c1"># Operating system commands are hardcoded</span>
<span class="n">OS_COMMANDS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;LSHW&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;lshw&quot;</span><span class="p">,</span> <span class="s2">&quot;-json&quot;</span><span class="p">,</span> <span class="s2">&quot;-sanitize&quot;</span><span class="p">,</span> <span class="s2">&quot;-notime&quot;</span><span class="p">,</span> <span class="s2">&quot;-quiet&quot;</span><span class="p">],</span>
    <span class="s2">&quot;LSCPU&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;lscpu&quot;</span><span class="p">,</span> <span class="s2">&quot;--all&quot;</span><span class="p">,</span> <span class="s2">&quot;--extended&quot;</span><span class="p">,</span> <span class="s2">&quot;--json&quot;</span><span class="p">],</span>
    <span class="s2">&quot;LSMEM&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;lsmem&quot;</span><span class="p">,</span> <span class="s2">&quot;--json&quot;</span><span class="p">,</span> <span class="s2">&quot;--all&quot;</span><span class="p">,</span> <span class="s2">&quot;--output-all&quot;</span><span class="p">],</span>
    <span class="s2">&quot;NUMASTAT&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;numastat&quot;</span><span class="p">,</span> <span class="s2">&quot;-z&quot;</span><span class="p">]</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">LogScreen</span><span class="p">(</span><span class="n">ModalScreen</span><span class="p">):</span>
    <span class="c1"># ... Code of the full separate screen omitted, will be explained next</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">ident</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">classes</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">selections</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">ident</span><span class="p">,</span> <span class="n">classes</span><span class="p">)</span>
        <span class="k">pass</span>

<span class="k">class</span> <span class="nc">OsApp</span><span class="p">(</span><span class="n">App</span><span class="p">):</span>
    <span class="n">BINDINGS</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;q&quot;</span><span class="p">,</span> <span class="s2">&quot;quit_app&quot;</span><span class="p">,</span> <span class="s2">&quot;Quit&quot;</span><span class="p">),</span>
    <span class="p">]</span>
    <span class="n">CSS_PATH</span> <span class="o">=</span> <span class="s2">&quot;os_app.tcss&quot;</span>
    <span class="n">ENABLE_COMMAND_PALETTE</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># Do not need the command palette</span>

    <span class="k">def</span> <span class="nf">action_quit_app</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">compose</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ComposeResult</span><span class="p">:</span>
        <span class="c1"># Create a list of commands, valid commands are assumed to be on the PATH variable.</span>
        <span class="n">selections</span> <span class="o">=</span> <span class="p">[</span><span class="n">Selection</span><span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">title</span><span class="p">(),</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cmd</span><span class="p">),</span> <span class="kc">True</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">cmd</span> <span class="ow">in</span> <span class="n">OS_COMMANDS</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">shutil</span><span class="o">.</span><span class="n">which</span><span class="p">(</span><span class="n">cmd</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())]</span>
        <span class="k">yield</span> <span class="n">Header</span><span class="p">(</span><span class="n">show_clock</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">sel_list</span> <span class="o">=</span> <span class="n">SelectionList</span><span class="p">(</span><span class="o">*</span><span class="n">selections</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="s1">&#39;cmds&#39;</span><span class="p">)</span>
        <span class="n">sel_list</span><span class="o">.</span><span class="n">tooltip</span> <span class="o">=</span> <span class="s2">&quot;Select one more more command to execute&quot;</span>
        <span class="k">yield</span> <span class="n">sel_list</span>
        <span class="k">yield</span> <span class="n">Button</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Execute </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">selections</span><span class="p">)</span><span class="si">}</span><span class="s2"> commands&quot;</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;exec&quot;</span><span class="p">,</span> <span class="n">variant</span><span class="o">=</span><span class="s2">&quot;primary&quot;</span><span class="p">)</span>
        <span class="k">yield</span> <span class="n">Footer</span><span class="p">()</span>

    <span class="nd">@on</span><span class="p">(</span><span class="n">SelectionList</span><span class="o">.</span><span class="n">SelectedChanged</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">on_selection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">SelectionList</span><span class="o">.</span><span class="n">SelectedChanged</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">button</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query_one</span><span class="p">(</span><span class="s2">&quot;#exec&quot;</span><span class="p">,</span> <span class="n">Button</span><span class="p">)</span>
        <span class="n">selections</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">selection_list</span><span class="o">.</span><span class="n">selected</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">selections</span><span class="p">:</span>
            <span class="n">button</span><span class="o">.</span><span class="n">disabled</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">button</span><span class="o">.</span><span class="n">disabled</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">button</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Execute </span><span class="si">{</span><span class="n">selections</span><span class="si">}</span><span class="s2"> commands&quot;</span>

    <span class="nd">@on</span><span class="p">(</span><span class="n">Button</span><span class="o">.</span><span class="n">Pressed</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">on_button_click</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">selection_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query_one</span><span class="p">(</span><span class="s1">&#39;#cmds&#39;</span><span class="p">,</span> <span class="n">SelectionList</span><span class="p">)</span>
        <span class="n">selections</span> <span class="o">=</span> <span class="n">selection_list</span><span class="o">.</span><span class="n">selected</span>
        <span class="n">log_screen</span> <span class="o">=</span> <span class="n">LogScreen</span><span class="p">(</span><span class="n">selections</span><span class="o">=</span><span class="n">selections</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push_screen</span><span class="p">(</span><span class="n">log_screen</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">app</span> <span class="o">=</span> <span class="n">OsApp</span><span class="p">()</span>
    <span class="n">app</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Output of multiple well known UNIX commands&quot;</span><span class="o">.</span><span class="n">title</span><span class="p">()</span>
    <span class="n">app</span><span class="o">.</span><span class="n">sub_title</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">OS_COMMANDS</span><span class="p">)</span><span class="si">}</span><span class="s2"> commands available&quot;</span>
    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</code></pre></div>

<p>现在我们逐条梳理一下程序的代码：</p>
<ol>
<li>每个应用都扩展自 <code>App</code> 类。其中最重要的有 <code>compose</code> 与 <code>mount</code> 等方法。但在当前应用中，我们只实现了 <a href="https://textual.textualize.io/tutorial/#composing-the-widgets">compose</a>。</li>
<li>在 <code>compose</code> 方法中，你会返回一系列 <ruby> <a href="https://textual.textualize.io/widget_gallery/">  组件 </a> <rt>  Widget </rt></ruby>，并按顺序添加到主屏幕中。每一个组件都有定制自身外观的选项。</li>
<li>你可以设定单字母的 <ruby> <a href="https://textual.textualize.io/api/binding/">  绑定 </a> <rt>  binding </rt></ruby>，比如此处我们设定了 <code>q</code> 键来退出应用（参见 <code>action_quit_app</code> 函数和 <code>BINDINGS</code> 列表）。</li>
<li>利用 <code>SelectionList</code> 组件，我们展示了待运行的命令列表。然后，你可以通过 <code>@on(SelectionList.SelectedChanged)</code> 注解以及 <code>on_selection</code> 方法告知应用获取所选的内容。</li>
<li>对于无选定元素的应对很重要，我们会根据运行的命令数量来决定是否禁用 “exec” 按钮。</li>
<li>我们使用类似的监听器（ <code>@on(Button.Pressed)</code> ）来执行命令。我们做的就是将我们的选择送到一个新的屏幕，该屏幕会负责执行命令并收集结果。</li>
</ol>
<p>你注意到 <code>CSS_PATH = "os_app.tcss"</code> 这个变量了吗？Textual 允许你使用 CSS 来控制单个或多个组件的外观（色彩、位置、尺寸）：</p>
<div class="highlight"><pre><span></span><code><span class="nt">Screen</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">layout</span><span class="p">:</span><span class="w"> </span><span class="kc">vertical</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">Header</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">dock</span><span class="p">:</span><span class="w"> </span><span class="kc">top</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">Footer</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">dock</span><span class="p">:</span><span class="w"> </span><span class="kc">bottom</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">SelectionList</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">padding</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">        </span><span class="k">border</span><span class="p">:</span><span class="w"> </span><span class="kc">solid</span><span class="w"> </span><span class="err">$</span><span class="n">accent</span><span class="p">;</span>
<span class="w">        </span><span class="k">width</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="n">fr</span><span class="p">;</span>
<span class="w">        </span><span class="k">height</span><span class="p">:</span><span class="w"> </span><span class="mi">80</span><span class="kt">%</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">Button</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">width</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="n">fr</span>
<span class="p">}</span>
</code></pre></div>

<p>引自 Textual 官方网站：</p>
<blockquote>
<p>Textual 中使用的 CSS 是互联网上常见 CSS 的简化版本，容易上手。</p>
</blockquote>
<p><em>这真是太棒了</em>，只需要用一哥独立的 <a href="https://textual.textualize.io/guide/styles/">样式表</a>，就可以轻松调整应用的样式。</p>
<p>好，我们现在来看看如何在新屏幕上展示结果。</p>
<h4>在新屏幕上展示结果</h4>
<p><img alt="" src="/data/attachment/album/202401/15/110439yqdsozs9m2qhms2m.svg"></p>
<p>以下是在新屏幕上处理输出的代码：</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">asyncio</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>
<span class="kn">from</span> <span class="nn">textual</span> <span class="kn">import</span> <span class="n">on</span><span class="p">,</span> <span class="n">work</span>
<span class="kn">from</span> <span class="nn">textual.reactive</span> <span class="kn">import</span> <span class="n">reactive</span>
<span class="kn">from</span> <span class="nn">textual.screen</span> <span class="kn">import</span> <span class="n">ModalScreen</span>
<span class="kn">from</span> <span class="nn">textual.widgets</span> <span class="kn">import</span> <span class="n">Button</span><span class="p">,</span> <span class="n">Label</span><span class="p">,</span> <span class="n">Log</span>
<span class="kn">from</span> <span class="nn">textual.worker</span> <span class="kn">import</span> <span class="n">Worker</span>
<span class="kn">from</span> <span class="nn">textual.app</span> <span class="kn">import</span> <span class="n">ComposeResult</span>

<span class="k">class</span> <span class="nc">LogScreen</span><span class="p">(</span><span class="n">ModalScreen</span><span class="p">):</span>
    <span class="n">count</span> <span class="o">=</span> <span class="n">reactive</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">MAX_LINES</span> <span class="o">=</span> <span class="mi">10_000</span>
    <span class="n">ENABLE_COMMAND_PALETTE</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">CSS_PATH</span> <span class="o">=</span> <span class="s2">&quot;log_screen.tcss&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">ident</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">classes</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">selections</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">ident</span><span class="p">,</span> <span class="n">classes</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selections</span> <span class="o">=</span> <span class="n">selections</span>

    <span class="k">def</span> <span class="nf">compose</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ComposeResult</span><span class="p">:</span>
        <span class="k">yield</span> <span class="n">Label</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Running </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">selections</span><span class="p">)</span><span class="si">}</span><span class="s2"> commands&quot;</span><span class="p">)</span>
        <span class="n">event_log</span> <span class="o">=</span> <span class="n">Log</span><span class="p">(</span>
            <span class="nb">id</span><span class="o">=</span><span class="s1">&#39;event_log&#39;</span><span class="p">,</span>
            <span class="n">max_lines</span><span class="o">=</span><span class="n">LogScreen</span><span class="o">.</span><span class="n">MAX_LINES</span><span class="p">,</span>
            <span class="n">highlight</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="n">event_log</span><span class="o">.</span><span class="n">loading</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">yield</span> <span class="n">event_log</span>
        <span class="n">button</span> <span class="o">=</span> <span class="n">Button</span><span class="p">(</span><span class="s2">&quot;Close&quot;</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;close&quot;</span><span class="p">,</span> <span class="n">variant</span><span class="o">=</span><span class="s2">&quot;success&quot;</span><span class="p">)</span>
        <span class="n">button</span><span class="o">.</span><span class="n">disabled</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">yield</span> <span class="n">button</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">on_mount</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">event_log</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query_one</span><span class="p">(</span><span class="s1">&#39;#event_log&#39;</span><span class="p">,</span> <span class="n">Log</span><span class="p">)</span>
        <span class="n">event_log</span><span class="o">.</span><span class="n">loading</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">event_log</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="n">lst</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">selections</span><span class="p">)</span>
        <span class="n">event_log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Preparing:</span><span class="se">\n</span><span class="si">{</span><span class="n">lst</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">event_log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">command</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">selections</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">run_process</span><span class="p">(</span><span class="n">cmd</span><span class="o">=</span><span class="n">command</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">on_worker_state_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">Worker</span><span class="o">.</span><span class="n">StateChanged</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">button</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query_one</span><span class="p">(</span><span class="s1">&#39;#close&#39;</span><span class="p">,</span> <span class="n">Button</span><span class="p">)</span>
            <span class="n">button</span><span class="o">.</span><span class="n">disabled</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>

    <span class="nd">@work</span><span class="p">(</span><span class="n">exclusive</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">run_process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cmd</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">event_log</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query_one</span><span class="p">(</span><span class="s1">&#39;#event_log&#39;</span><span class="p">,</span> <span class="n">Log</span><span class="p">)</span>
        <span class="n">event_log</span><span class="o">.</span><span class="n">write_line</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Running: </span><span class="si">{</span><span class="n">cmd</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="c1"># Combine STDOUT and STDERR output</span>
        <span class="n">proc</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">create_subprocess_shell</span><span class="p">(</span>
            <span class="n">cmd</span><span class="p">,</span>
            <span class="n">stdout</span><span class="o">=</span><span class="n">asyncio</span><span class="o">.</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
            <span class="n">stderr</span><span class="o">=</span><span class="n">asyncio</span><span class="o">.</span><span class="n">subprocess</span><span class="o">.</span><span class="n">STDOUT</span>
        <span class="p">)</span>
        <span class="n">stdout</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="k">await</span> <span class="n">proc</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">proc</span><span class="o">.</span><span class="n">returncode</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">cmd</span><span class="si">}</span><span class="s2">&#39; finished with errors (</span><span class="si">{</span><span class="n">proc</span><span class="o">.</span><span class="n">returncode</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
        <span class="n">stdout</span> <span class="o">=</span> <span class="n">stdout</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;replace&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">stdout</span><span class="p">:</span>
            <span class="n">event_log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Output of &quot;</span><span class="si">{</span><span class="n">cmd</span><span class="si">}</span><span class="s1">&quot;:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">event_log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">stdout</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">-=</span> <span class="mi">1</span>

    <span class="nd">@on</span><span class="p">(</span><span class="n">Button</span><span class="o">.</span><span class="n">Pressed</span><span class="p">,</span> <span class="s2">&quot;#close&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">on_button_pressed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">pop_screen</span><span class="p">()</span>
</code></pre></div>

<p>你会注意到：</p>
<ol>
<li><code>LogScreen</code> 类扩展自 <code>ModalScreen</code> 类， 该类负责处理模态模式的屏幕。</li>
<li>这个屏幕同样有一个 <code>compose</code> 方法，我们在这里添加了组件以展示 Unix 命令的内容。</li>
<li>我们创建了一个叫做 <code>mount</code> 的新方法。一旦你用 <code>compose</code> 编排好组件，你就可以运行代码来获取数据，并再进一步定制它们的外观。</li>
<li>我们使用 <a href="https://docs.python.org/3/library/asyncio.html">asyncio</a> 运行命令，这样我们就能让 TUI 主工作线程在每个命令的结果出来时就及时更新内容。</li>
<li>对于“工作线程”，请注意 <code>run_process</code> 方法上的 <code>@work(exclusive=False)</code> 注解，该方法用于运行命令并捕获 STDOUT + STDERR 输出。使用 <a href="https://textual.textualize.io/guide/workers/">工作线程</a> 来管理并发并不复杂，尽管它们在手册中确实有专门的章节。这主要是因为运行的外部命令可能会执行很长时间。</li>
<li>在 <code>run_process</code> 中，我们通过调用 <code>write</code> 以命令的输出内容来更新 <code>event_log</code>。</li>
<li>最后，<code>on_button_pressed</code> 把我们带回到前一屏幕（从堆栈中移除屏幕）。</li>
</ol>
<p>这个小应用向你展示了如何一份不到 200 行的代码来编写一个简单的前端，用来运行非 Python 代码。</p>
<p>现在我们来看一个更复杂的例子，这个例子用到了我们还未探索过的 Textual 的新特性。</p>
<h3>示例二：展示赛事成绩的表格</h3>
<p><img alt="通过 Textual 创建的表格应用" src="/data/attachment/album/202401/15/110439oercynysjncnku7y.svg"></p>
<p>本示例将展示如何使用 <code>DataTable</code> 组件在表格中展示赛事成绩。你能通过这个应用实现：</p>
<ul>
<li>通过列来排序表格</li>
<li>选择表格中的行，完整窗口展示赛事细节，我们将使用我们在日志浏览器中看到的 “推送屏幕” 技巧。</li>
<li>能进行表格搜索，查看选手详情，或执行其他操作如退出应用。</li>
</ul>
<p>下面，我们来看看应用代码：</p>
<div class="highlight"><pre><span></span><code><span class="ch">#!/usr/bin/env python</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Author: Jose Vicente Nunez</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">List</span>

<span class="kn">from</span> <span class="nn">rich.style</span> <span class="kn">import</span> <span class="n">Style</span>
<span class="kn">from</span> <span class="nn">textual</span> <span class="kn">import</span> <span class="n">on</span>
<span class="kn">from</span> <span class="nn">textual.app</span> <span class="kn">import</span> <span class="n">ComposeResult</span><span class="p">,</span> <span class="n">App</span>
<span class="kn">from</span> <span class="nn">textual.command</span> <span class="kn">import</span> <span class="n">Provider</span>
<span class="kn">from</span> <span class="nn">textual.screen</span> <span class="kn">import</span> <span class="n">ModalScreen</span><span class="p">,</span> <span class="n">Screen</span>
<span class="kn">from</span> <span class="nn">textual.widgets</span> <span class="kn">import</span> <span class="n">DataTable</span><span class="p">,</span> <span class="n">Footer</span><span class="p">,</span> <span class="n">Header</span>

<span class="n">MY_DATA</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="s2">&quot;level&quot;</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;gender&quot;</span><span class="p">,</span> <span class="s2">&quot;country&quot;</span><span class="p">,</span> <span class="s2">&quot;age&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;Green&quot;</span><span class="p">,</span> <span class="s2">&quot;Wai&quot;</span><span class="p">,</span> <span class="s2">&quot;M&quot;</span><span class="p">,</span> <span class="s2">&quot;MYS&quot;</span><span class="p">,</span> <span class="mi">22</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;Red&quot;</span><span class="p">,</span> <span class="s2">&quot;Ryoji&quot;</span><span class="p">,</span> <span class="s2">&quot;M&quot;</span><span class="p">,</span> <span class="s2">&quot;JPN&quot;</span><span class="p">,</span> <span class="mi">30</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;Purple&quot;</span><span class="p">,</span> <span class="s2">&quot;Fabio&quot;</span><span class="p">,</span> <span class="s2">&quot;M&quot;</span><span class="p">,</span> <span class="s2">&quot;ITA&quot;</span><span class="p">,</span> <span class="mi">99</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;Blue&quot;</span><span class="p">,</span> <span class="s2">&quot;Manuela&quot;</span><span class="p">,</span> <span class="s2">&quot;F&quot;</span><span class="p">,</span> <span class="s2">&quot;VEN&quot;</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>
<span class="p">]</span>

<span class="k">class</span> <span class="nc">DetailScreen</span><span class="p">(</span><span class="n">ModalScreen</span><span class="p">):</span>
    <span class="n">ENABLE_COMMAND_PALETTE</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">CSS_PATH</span> <span class="o">=</span> <span class="s2">&quot;details_screen.tcss&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">ident</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">classes</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">row</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">ident</span><span class="p">,</span> <span class="n">classes</span><span class="p">)</span>
        <span class="c1"># Rest of screen code will be show later</span>

<span class="k">class</span> <span class="nc">CustomCommand</span><span class="p">(</span><span class="n">Provider</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">screen</span><span class="p">:</span> <span class="n">Screen</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="n">match_style</span><span class="p">:</span> <span class="n">Style</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">screen</span><span class="p">,</span> <span class="n">match_style</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># Rest of provider code will be show later</span>

<span class="k">class</span> <span class="nc">CompetitorsApp</span><span class="p">(</span><span class="n">App</span><span class="p">):</span>
    <span class="n">BINDINGS</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;q&quot;</span><span class="p">,</span> <span class="s2">&quot;quit_app&quot;</span><span class="p">,</span> <span class="s2">&quot;Quit&quot;</span><span class="p">),</span>
    <span class="p">]</span>
    <span class="n">CSS_PATH</span> <span class="o">=</span> <span class="s2">&quot;competitors_app.tcss&quot;</span>
    <span class="c1"># Enable the command palette, to add our custom filter commands</span>
    <span class="n">ENABLE_COMMAND_PALETTE</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="c1"># Add the default commands and the TablePopulateProvider to get a row directly by name</span>
    <span class="n">COMMANDS</span> <span class="o">=</span> <span class="n">App</span><span class="o">.</span><span class="n">COMMANDS</span> <span class="o">|</span> <span class="p">{</span><span class="n">CustomCommand</span><span class="p">}</span>

    <span class="k">def</span> <span class="nf">action_quit_app</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">compose</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ComposeResult</span><span class="p">:</span>
        <span class="k">yield</span> <span class="n">Header</span><span class="p">(</span><span class="n">show_clock</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">table</span> <span class="o">=</span> <span class="n">DataTable</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;competitors_table&#39;</span><span class="p">)</span>
        <span class="n">table</span><span class="o">.</span><span class="n">cursor_type</span> <span class="o">=</span> <span class="s1">&#39;row&#39;</span>
        <span class="n">table</span><span class="o">.</span><span class="n">zebra_stripes</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">table</span><span class="o">.</span><span class="n">loading</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">yield</span> <span class="n">table</span>
        <span class="k">yield</span> <span class="n">Footer</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">on_mount</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_widget_by_id</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;competitors_table&#39;</span><span class="p">,</span> <span class="n">expect_type</span><span class="o">=</span><span class="n">DataTable</span><span class="p">)</span>
        <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">title</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">MY_DATA</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="n">table</span><span class="o">.</span><span class="n">add_columns</span><span class="p">(</span><span class="o">*</span><span class="n">columns</span><span class="p">)</span>
        <span class="n">table</span><span class="o">.</span><span class="n">add_rows</span><span class="p">(</span><span class="n">MY_DATA</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
        <span class="n">table</span><span class="o">.</span><span class="n">loading</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">table</span><span class="o">.</span><span class="n">tooltip</span> <span class="o">=</span> <span class="s2">&quot;Select a row to get more details&quot;</span>

    <span class="nd">@on</span><span class="p">(</span><span class="n">DataTable</span><span class="o">.</span><span class="n">HeaderSelected</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">on_header_clicked</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">DataTable</span><span class="o">.</span><span class="n">HeaderSelected</span><span class="p">):</span>
        <span class="n">table</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">data_table</span>
        <span class="n">table</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">column_key</span><span class="p">)</span>

    <span class="nd">@on</span><span class="p">(</span><span class="n">DataTable</span><span class="o">.</span><span class="n">RowSelected</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">on_row_clicked</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">DataTable</span><span class="o">.</span><span class="n">RowSelected</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">table</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">data_table</span>
        <span class="n">row</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">get_row</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">row_key</span><span class="p">)</span>
        <span class="n">runner_detail</span> <span class="o">=</span> <span class="n">DetailScreen</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show_detail</span><span class="p">(</span><span class="n">runner_detail</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">show_detail</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">detailScreen</span><span class="p">:</span> <span class="n">DetailScreen</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push_screen</span><span class="p">(</span><span class="n">detailScreen</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">app</span> <span class="o">=</span> <span class="n">CompetitorsApp</span><span class="p">()</span>
    <span class="n">app</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Summary&quot;</span><span class="o">.</span><span class="n">title</span><span class="p">()</span>
    <span class="n">app</span><span class="o">.</span><span class="n">sub_title</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">MY_DATA</span><span class="p">)</span><span class="si">}</span><span class="s2"> users&quot;</span>
    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</code></pre></div>

<p>有哪些部分值得我们关注呢？</p>
<ol>
<li><code>compose</code> 方法中添加了 <a href="https://textual.textualize.io/widgets/header/">表头</a>，“命令面板” 就位于此处，我们的表格（<a href="https://textual.textualize.io/widgets/data_table/#guide">DataTable</a>）也在这里。表格数据在 <code>mount</code> 方法中填充。</li>
<li>我们设定了预期的绑定（<code>BINDINGS</code>），并指定了外部的 CSS 文件来设置样式（<code>CSS_PATH</code>）。</li>
<li>默认情况下，我们无需任何设置便能使用 <a href="https://textual.textualize.io/guide/command_palette/">命令面板</a>，但在此我们显式启用了它（<code>ENABLE_COMMAND_PALETTE = True</code>）。</li>
<li>我们的应用有一个自定义表格搜索功能。当用户输入一名选手的名字后，应用会显示可能的匹配项，用户可以点击匹配项查看该选手的详细信息。这需要告诉应用我们有一个定制的命令提供者（<code>COMMANDS = App.COMMANDS | {CustomCo_ mmand}</code>），即类 <code>CustomCommand(Provider)</code>。</li>
<li>如果用户点击了表头，表格内容会按照该列进行排序。这是通过 <code>on_header_clicked</code> 方法实现的，该方法上具有 <code>@on(DataTable.HeaderSelected)</code> 注解。</li>
<li>类似地，当选中表格中的一行时， <code>on_row_clicked</code> 方法会被调用，这得益于它拥有 <code>@on(DataTable.RowSelected)</code> 注解。当方法接受选中的行后，它会推送一个新的屏幕，显示选中行的详细信息（<code>class DetailScreen(ModalScreen)</code>）。</li>
</ol>
<p>现在，我们详细地探讨一下如何显示选手的详细信息。</p>
<h4>利用多屏展示复杂视图</h4>
<p><img alt="" src="/data/attachment/album/202401/15/110439ot0st0qqqzc395am.svg"></p>
<p>当用户选择表格中的一行，<code>on_row_clicked</code> 方法就会被调用。它收到的是一个 <code>DataTable.RowSelected</code> 类型的事件。从这里我们会用选中的行的内容构建一个 <code>DetailScreen(ModalScreen)</code> 类的实例：</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">List</span>
<span class="kn">from</span> <span class="nn">textual</span> <span class="kn">import</span> <span class="n">on</span>
<span class="kn">from</span> <span class="nn">textual.app</span> <span class="kn">import</span> <span class="n">ComposeResult</span>
<span class="kn">from</span> <span class="nn">textual.screen</span> <span class="kn">import</span> <span class="n">ModalScreen</span>
<span class="kn">from</span> <span class="nn">textual.widgets</span> <span class="kn">import</span> <span class="n">Button</span><span class="p">,</span> <span class="n">MarkdownViewer</span>

<span class="n">MY_DATA</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="s2">&quot;level&quot;</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;gender&quot;</span><span class="p">,</span> <span class="s2">&quot;country&quot;</span><span class="p">,</span> <span class="s2">&quot;age&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;Green&quot;</span><span class="p">,</span> <span class="s2">&quot;Wai&quot;</span><span class="p">,</span> <span class="s2">&quot;M&quot;</span><span class="p">,</span> <span class="s2">&quot;MYS&quot;</span><span class="p">,</span> <span class="mi">22</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;Red&quot;</span><span class="p">,</span> <span class="s2">&quot;Ryoji&quot;</span><span class="p">,</span> <span class="s2">&quot;M&quot;</span><span class="p">,</span> <span class="s2">&quot;JPN&quot;</span><span class="p">,</span> <span class="mi">30</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;Purple&quot;</span><span class="p">,</span> <span class="s2">&quot;Fabio&quot;</span><span class="p">,</span> <span class="s2">&quot;M&quot;</span><span class="p">,</span> <span class="s2">&quot;ITA&quot;</span><span class="p">,</span> <span class="mi">99</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;Blue&quot;</span><span class="p">,</span> <span class="s2">&quot;Manuela&quot;</span><span class="p">,</span> <span class="s2">&quot;F&quot;</span><span class="p">,</span> <span class="s2">&quot;VEN&quot;</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>
<span class="p">]</span>

<span class="k">class</span> <span class="nc">DetailScreen</span><span class="p">(</span><span class="n">ModalScreen</span><span class="p">):</span>
    <span class="n">ENABLE_COMMAND_PALETTE</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">CSS_PATH</span> <span class="o">=</span> <span class="s2">&quot;details_screen.tcss&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">ident</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">classes</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">row</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">ident</span><span class="p">,</span> <span class="n">classes</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">row</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span>

    <span class="k">def</span> <span class="nf">compose</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ComposeResult</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Details: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">row</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">columns</span> <span class="o">=</span> <span class="n">MY_DATA</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">row_markdown</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">columns</span><span class="p">)):</span>
            <span class="n">row_markdown</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;* **</span><span class="si">{</span><span class="n">columns</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">title</span><span class="p">()</span><span class="si">}</span><span class="s2">:** </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">row</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">yield</span> <span class="n">MarkdownViewer</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;## User details:</span>
<span class="s2">        </span><span class="si">{</span><span class="n">row_markdown</span><span class="si">}</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">)</span>
        <span class="n">button</span> <span class="o">=</span> <span class="n">Button</span><span class="p">(</span><span class="s2">&quot;Close&quot;</span><span class="p">,</span> <span class="n">variant</span><span class="o">=</span><span class="s2">&quot;primary&quot;</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;close&quot;</span><span class="p">)</span>
        <span class="n">button</span><span class="o">.</span><span class="n">tooltip</span> <span class="o">=</span> <span class="s2">&quot;Go back to main screen&quot;</span>
        <span class="k">yield</span> <span class="n">button</span>

    <span class="nd">@on</span><span class="p">(</span><span class="n">Button</span><span class="o">.</span><span class="n">Pressed</span><span class="p">,</span> <span class="s2">&quot;#close&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">on_button_pressed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">pop_screen</span><span class="p">()</span>
</code></pre></div>

<p>这个类的职责很直接：</p>
<ol>
<li><code>compose</code> 方法取得此行数据，并利用一个 <a href="https://textual.textualize.io/widget_gallery/#markdownviewer">支持 Markdown 渲染的组件</a> 来展示内容。它的便利之处在于，它会为我们自动生成一个内容目录。</li>
<li>当用户点击 “close” 后，方法 <code>on_button_pressed</code> 会引导应用回到原始屏幕。注解 <code>@on(Button.Pressed, "#close")</code> 用来接收按键被点击的事件。</li>
</ol>
<p>最后，我们来详细讲解一下那个多功能的搜索栏（也叫做命令面板）。</p>
<h4>命令面板的搜索功能</h4>
<p><img alt="" src="/data/attachment/album/202401/15/110440xepv8skxe8ueuu8e.svg"></p>
<p>任何使用了表头的 Textual 应用都默认开启了 <a href="https://textual.textualize.io/guide/command_palette/">命令面板</a>。有意思的是，你可以在 <code>CompetitorsApp</code> 类中添加自定义的命令，这会增加到默认命令集之上：</p>
<div class="highlight"><pre><span></span><code>COMMANDS = App.COMMANDS | {CustomCommand}
</code></pre></div>

<p>然后是执行大部分任务的 <code>CustomCommand(Provider)</code> 类：</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">List</span>
<span class="kn">from</span> <span class="nn">rich.style</span> <span class="kn">import</span> <span class="n">Style</span>
<span class="kn">from</span> <span class="nn">textual.command</span> <span class="kn">import</span> <span class="n">Provider</span><span class="p">,</span> <span class="n">Hit</span>
<span class="kn">from</span> <span class="nn">textual.screen</span> <span class="kn">import</span> <span class="n">ModalScreen</span><span class="p">,</span> <span class="n">Screen</span>
<span class="kn">from</span> <span class="nn">textual.widgets</span> <span class="kn">import</span> <span class="n">DataTable</span>
<span class="kn">from</span> <span class="nn">textual.app</span> <span class="kn">import</span> <span class="n">App</span>

<span class="k">class</span> <span class="nc">CustomCommand</span><span class="p">(</span><span class="n">Provider</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">screen</span><span class="p">:</span> <span class="n">Screen</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="n">match_style</span><span class="p">:</span> <span class="n">Style</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">screen</span><span class="p">,</span> <span class="n">match_style</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">startup</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">my_app</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span>
        <span class="n">my_app</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Loaded provider: CustomCommand&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table</span> <span class="o">=</span> <span class="n">my_app</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">DataTable</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">search</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Hit</span><span class="p">:</span>
        <span class="n">matcher</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">matcher</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>

        <span class="n">my_app</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">app</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">my_app</span><span class="p">,</span> <span class="n">CompetitorsApp</span><span class="p">)</span>

        <span class="n">my_app</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Got query: </span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">row_key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">rows</span><span class="p">:</span>
            <span class="n">row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">get_row</span><span class="p">(</span><span class="n">row_key</span><span class="p">)</span>
            <span class="n">my_app</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Searching </span><span class="si">{</span><span class="n">row</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">searchable</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">score</span> <span class="o">=</span> <span class="n">matcher</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">searchable</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">score</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">runner_detail</span> <span class="o">=</span> <span class="n">DetailScreen</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">)</span>
                <span class="k">yield</span> <span class="n">Hit</span><span class="p">(</span>
                    <span class="n">score</span><span class="p">,</span>
                    <span class="n">matcher</span><span class="o">.</span><span class="n">highlight</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">searchable</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">),</span>
                    <span class="n">partial</span><span class="p">(</span><span class="n">my_app</span><span class="o">.</span><span class="n">show_detail</span><span class="p">,</span> <span class="n">runner_detail</span><span class="p">),</span>
                    <span class="n">help</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Show details about </span><span class="si">{</span><span class="n">searchable</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>

<span class="k">class</span> <span class="nc">DetailScreen</span><span class="p">(</span><span class="n">ModalScreen</span><span class="p">):</span>
        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">ident</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">classes</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">row</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">ident</span><span class="p">,</span> <span class="n">classes</span><span class="p">)</span>
        <span class="c1"># Code of this class explained on the previous section</span>

<span class="k">class</span> <span class="nc">CompetitorsApp</span><span class="p">(</span><span class="n">App</span><span class="p">):</span>
    <span class="c1"># Add the default commands and the TablePopulateProvider to get a row directly by name</span>
    <span class="n">COMMANDS</span> <span class="o">=</span> <span class="n">App</span><span class="o">.</span><span class="n">COMMANDS</span> <span class="o">|</span> <span class="p">{</span><span class="n">CustomCommand</span><span class="p">}</span>
    <span class="c1"># Most of the code shown before, only displaying relevant code</span>
    <span class="k">def</span> <span class="nf">show_detail</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">detailScreen</span><span class="p">:</span> <span class="n">DetailScreen</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push_screen</span><span class="p">(</span><span class="n">detailScreen</span><span class="p">)</span>
</code></pre></div>

<ol>
<li>所有继承自 <code>Provider</code> 的类需实现 <code>search</code> 方法。在我们的例子中，我们还覆盖了 <code>startup</code> 方法，为了获取到我们应用表格（和其内容）的引用，这里使用到了 <code>App.query(DataTable).first()</code>。在类的生命周期中， <code>startup</code> 方法只会被调用一次。</li>
<li>在 <code>search</code> 方法内，我们使用 <code>Provider.matcher</code> 对每个表格行的第二列（即名字）进行模糊搜索，以与用户在 TUI 中输入的词条进行比较。<code>matcher.match(searchable)</code> 返回一个整型的评分，大于零说明匹配成功。</li>
<li>在 <code>search</code> 方法中，如果评分大于零，则返回一个 <code>Hit</code> 对象，以告知命令面板搜索查询是否成功。</li>
<li>每个 <code>Hit</code> 都有以下信息：评分（用于在命令面板中对匹配项排序）、高亮显示的搜索词、一个可调用对象的引用（在我们的案例中，它是一个可以将表格行推送到新屏幕的函数）。</li>
<li><code>Provider</code> 类的所有方法都是异步的。这使你能释放主线程，只有当响应准备好后才返回结果，这个过程不会冻结用户界面。</li>
</ol>
<p>理解了这些信息，我们就可以现在展示赛手的详细信息了。</p>
<p>尽管这个架构的追踪功能相对直观，但是组件间传递的消息复杂性不可忽视。幸运的是，Textual 提供了有效的调试工具帮助我们理解背后的工作原理。</p>
<h3>Textual 应用的问题排查</h3>
<p>对于 Python 的 Textual 应用进行 <a href="https://github.com/josevnz/tutorials/blob/main/docs/PythonDebugger/README.md">调试</a> 相较而言更具挑战性。这是因为其中有一些操作可能是异步的，而在解决组件问题时设置断点可能颇为复杂。</p>
<p>根据具体情况，你可以使用一些工具。但首先，确保你已经安装了 textual 的开发工具：</p>
<div class="highlight"><pre><span></span><code>pip install textual-dev==1.3.0
</code></pre></div>

<h4>确保你能捕捉到正确的按键</h4>
<p>不确定 Textual 应用是否能捕捉到你的按键操作？运行 keys 应用：</p>
<div class="highlight"><pre><span></span><code>textual keys
</code></pre></div>

<p>这让你能够验证一下你的按键组合，并确认在 Textual 中产生了哪些事件。</p>
<h4>图片比千言万语更直观</h4>
<p>如果说你在布局设计上遇到了问题，想向他人展示你当前的困境，Textual 为你的运行应用提供了截图功能：</p>
<div class="highlight"><pre><span></span><code>textual run --screenshot 5 ./kodegeek_textualize/log_scroller.py
</code></pre></div>

<p>就像你所看到的，我是通过这种方式为这篇教程创建了插图。</p>
<h4>捕获事件并输出定制消息</h4>
<p>在 Textual 中，每一个应用实例都有一个日志记录器，可以使用如下方式访问：</p>
<div class="highlight"><pre><span></span><code>my_app = self.screen.app
my_app.log.info(f&quot;Loaded provider: CustomCommand&quot;)
</code></pre></div>

<p>想要查看这些消息，首先需要开启一个控制台：</p>
<div class="highlight"><pre><span></span><code>. ~/virtualenv/Textualize/bin/activate
textual console
</code></pre></div>

<p>然后在另一个终端运行你的应用程序：</p>
<div class="highlight"><pre><span></span><code>. ~/virtualenv/Textualize/bin/activate
textual run --dev ./kodegeek_textualize/log_scroller.py
</code></pre></div>

<p>在运行控制台的终端中，你可以看到实时的事件和消息输出：</p>
<p>```
▌Textual Development Console v0.46.0
▌Run a Textual app with textual run --dev my_app.py to connect.
▌Press Ctrl+C to quit.
─────────────────────────────────────────────────────────────────────────────── Client '127.0.0.1' connected ────────────────────────────────────────────────────────────────────────────────
[20:29:43] SYSTEM                                                                                                                                                                 app.py:2188
Connected to devtools ( ws://127.0.0.1:8081 )
[20:29:43] SYSTEM                                                                                                                                                                 app.py:2192</p>
<p>via: <a href="https://fedoramagazine.org/crash-course-on-using-textual/">https://fedoramagazine.org/crash-course-on-using-textual/</a></p>
<p>作者：<a href="https://fedoramagazine.org/author/josevnz/">Jose Nunez</a> 选题：<a href="https://github.com/lujun9972">lujun9972</a> 译者：<a href="https://linux.cn/lctt/ChatGPT">ChatGPT</a> 校对：<a href="https://github.com/wxy">wxy</a></p>
<p>本文由 <a href="https://github.com/LCTT/TranslateProject">LCTT</a> 原创编译，<a href="https://linux.cn/">Linux中国</a> 荣誉推出</p>
    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>links</h2>
                        <ul>
                            <li><a href="https://getpelican.com/">Pelican</a></li>
                            <li><a href="https://www.python.org/">Python.org</a></li>
                            <li><a href="https://palletsprojects.com/p/jinja/">Jinja2</a></li>
                            <li><a href="#">You can modify those links in your config file</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>

                            <li><a href="#">You can add links in your config file</a></li>
                            <li><a href="#">Another social link</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a rel="nofollow" href="https://getpelican.com/">Pelican</a>, which takes great advantage of <a rel="nofollow" href="https://www.python.org/">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a rel="nofollow" href="https://www.smashingmagazine.com/2009/08/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>