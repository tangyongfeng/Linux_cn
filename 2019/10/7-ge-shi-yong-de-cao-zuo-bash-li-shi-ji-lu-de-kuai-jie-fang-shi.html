<!DOCTYPE html>
<html lang="zh">
<head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="generator" content="Pelican" />
        <title>7 个实用的操作 Bash 历史记录的快捷方式</title>
        <link rel="stylesheet" href="/theme/css/main.css" />
        <meta name="description" content="Author: Ian Miell 这些必不可少的 Bash 快捷键可在命令行上节省时间。 大多数介绍 Bash 历史记录的指南都详尽地列出了全部可用的快 …" />
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">linux_cn</a></h1>
                <nav><ul>
                    <li><a href="/category/chuan-shan-jia-zhuan-fang">穿山甲专访</a></li>
                    <li><a href="/category/dai-ma-ying-xiong">代码英雄</a></li>
                    <li><a href="/category/fen-xiang">分享</a></li>
                    <li><a href="/category/guan-dian">观点</a></li>
                    <li><a href="/category/huo-dong">活动</a></li>
                    <li><a href="/category/ji-ke-man-hua">极客漫画</a></li>
                    <li class="active"><a href="/category/ji-zhu">技术</a></li>
                    <li><a href="/category/kai-yuan-zhi-hui">开源智慧</a></li>
                    <li><a href="/category/linux-fa-xing-ban">Linux 发行版</a></li>
                    <li><a href="/category/mei-ri-an-quan-zi-xun">每日安全资讯</a></li>
                    <li><a href="/category/misc">Misc</a></li>
                    <li><a href="/category/qu-kuai-lian">区块链</a></li>
                    <li><a href="/category/rong-qi-yu-yun">容器与云</a></li>
                    <li><a href="/category/ruan-jian-kai-fa">软件开发</a></li>
                    <li><a href="/category/shu-mei-pai">树莓派</a></li>
                    <li><a href="/category/xi-tong-yun-wei">系统运维</a></li>
                    <li><a href="/category/xin-wen">新闻</a></li>
                    <li><a href="/category/ying-he-guan-cha">硬核观察</a></li>
                    <li><a href="/category/zhi-ye-sheng-ya">职业生涯</a></li>
                    <li><a href="/category/zhong-jiang-ming-dan">中奖名单</a></li>
                    <li><a href="/category/zhuo-mian-ying-yong">桌面应用</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="/2019/10/7-ge-shi-yong-de-cao-zuo-bash-li-shi-ji-lu-de-kuai-jie-fang-shi.html" rel="bookmark"
           title="Permalink to 7 个实用的操作 Bash 历史记录的快捷方式">7 个实用的操作 Bash 历史记录的快捷方式</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2019-10-14T11:16:27+02:00">
                Published: Mon 14 October 2019
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/linux-fans-from-china.html">linux fans from china</a>
        </address>
<p>In <a href="/category/ji-zhu">技术</a>.</p>

</footer><!-- /.post-info -->      <p>Author: Ian Miell</p>
<blockquote>
<p>这些必不可少的 Bash 快捷键可在命令行上节省时间。</p>
</blockquote>
<p><img alt="" src="/data/attachment/album/201910/14/111601gdu73c29o283acs1.jpg"></p>
<p>大多数介绍 Bash 历史记录的指南都详尽地列出了全部可用的快捷方式。这样做的问题是，你会对每个快捷方式都浅尝辄止，然后在尝试了那么多的快捷方式后就搞得目不暇接。而在开始工作时它们就全被丢在脑后，只记住了刚开始使用 Bash 时学到的 <a href="https://opensource.com/article/18/5/bash-tricks">!! 技巧</a>。这些技巧大多数从未进入记忆当中。</p>
<p>本文概述了我每天实际使用的快捷方式。它基于我的书《<a href="https://leanpub.com/learnbashthehardway">Bash 学习，艰难之旅</a>》中的某些内容（你可以阅读其中的<a href="https://leanpub.com/learnbashthehardway/read_sample">样章</a>以了解更多信息）。</p>
<p>当人们看到我使用这些快捷方式时，他们经常问我：“你做了什么！？” 学习它们只需付出很少的精力或智力，但是要真正的学习它们，我建议每周用一天学一个，然后下次再继续学习一个。值得花时间让它们落在你的指尖下，因为从长远来看，节省的时间将很重要。</p>
<h3>1、最后一个参数：<code>!$</code></h3>
<p>如果你仅想从本文中学习一种快捷方式，那就是这个。它会将最后一个命令的最后一个参数替换到你的命令行中。</p>
<p>看看这种情况：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>mv<span class="w"> </span>/path/to/wrongfile<span class="w"> </span>/some/other/place
mv:<span class="w"> </span>cannot<span class="w"> </span>stat<span class="w"> </span><span class="s1">&#39;/path/to/wrongfile&#39;</span>:<span class="w"> </span>No<span class="w"> </span>such<span class="w"> </span>file<span class="w"> </span>or<span class="w"> </span>directory
</code></pre></div>

<p>啊哈，我在命令中写了错误的文件名 “wrongfile”，我应该用正确的文件名 “rightfile” 代替。</p>
<p>你可以重新键入上一个命令，并用 “rightfile” 完全替换 “wrongfile”。但是，你也可以键入：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>mv<span class="w"> </span>/path/to/rightfile<span class="w"> </span>!$
mv<span class="w"> </span>/path/to/rightfile<span class="w"> </span>/some/other/place
</code></pre></div>

<p>这个命令也可以奏效。</p>
<p>在 Bash 中还有其他方法可以通过快捷方式实现相同的目的，但是重用上一个命令的最后一个参数的这种技巧是我最常使用的。</p>
<h3>2、第 n 个参数：<code>!:2</code></h3>
<p>是不是干过像这样的事情：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>tar<span class="w"> </span>-cvf<span class="w"> </span>afolder<span class="w"> </span>afolder.tar
tar:<span class="w"> </span>failed<span class="w"> </span>to<span class="w"> </span>open
</code></pre></div>

<p>像许多其他人一样，我也经常搞错 <code>tar</code>（和 <code>ln</code>）的参数顺序。</p>
<p><img alt="xkcd comic" src="/data/attachment/album/201910/14/111630abb4xexy4t1fiq5y.png" title="xkcd comic"></p>
<p>当你搞混了参数，你可以这样：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>!:0<span class="w"> </span>!:1<span class="w"> </span>!:3<span class="w"> </span>!:2
tar<span class="w"> </span>-cvf<span class="w"> </span>afolder.tar<span class="w"> </span>afolder
</code></pre></div>

<p>这样就不会出丑了。</p>
<p>上一个命令的各个参数的索引是从零开始的，并且可以用 <code>!:</code> 之后跟上该索引数字代表各个参数。</p>
<p>显然，你也可以使用它来重用上一个命令中的特定参数，而不是所有参数。</p>
<h3>3、全部参数：<code>!:1-$</code></h3>
<p>假设我运行了类似这样的命令：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>grep<span class="w"> </span><span class="s1">&#39;(ping|pong)&#39;</span><span class="w"> </span>afile
</code></pre></div>

<p>参数是正确的。然而，我想在文件中匹配 “ping” 或 “pong”，但我使用的是 <code>grep</code> 而不是 <code>egrep</code>。</p>
<p>我开始输入 <code>egrep</code>，但是我不想重新输入其他参数。因此，我可以使用 <code>!:1-$</code> 快捷方式来调取上一个命令的所有参数，从第二个（记住它们的索引从零开始，因此是 <code>1</code>）到最后一个（由 <code>$</code> 表示）。</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>egrep<span class="w"> </span>!:1-$
egrep<span class="w"> </span><span class="s1">&#39;(ping|pong)&#39;</span><span class="w"> </span>afile
ping
</code></pre></div>

<p>你不用必须用 <code>1-$</code> 选择全部参数；你也可以选择一个子集，例如 <code>1-2</code> 或 <code>3-9</code> （如果上一个命令中有那么多参数的话）。</p>
<h3>4、倒数第 n 行的最后一个参数：<code>!-2:$</code></h3>
<p>当我输错之后马上就知道该如何更正我的命令时，上面的快捷键非常有用，但是我经常在原来的命令之后运行别的命令，这意味着上一个命令不再是我所要引用的命令。</p>
<p>例如，还是用之前的 <code>mv</code> 例子，如果我通过 <code>ls</code> 检查文件夹的内容来纠正我的错误：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>mv<span class="w"> </span>/path/to/wrongfile<span class="w"> </span>/some/other/place
mv:<span class="w"> </span>cannot<span class="w"> </span>stat<span class="w"> </span><span class="s1">&#39;/path/to/wrongfile&#39;</span>:<span class="w"> </span>No<span class="w"> </span>such<span class="w"> </span>file<span class="w"> </span>or<span class="w"> </span>directory
$<span class="w"> </span>ls<span class="w"> </span>/path/to/
rightfile
</code></pre></div>

<p>我就不能再使用 <code>!$</code> 快捷方式了。</p>
<p>在这些情况下，我可以在 <code>!</code> 之后插入 <code>-n</code>：（其中 <code>n</code> 是要在历史记录中回溯的命令条数），以从较旧的命令取得最后的参数：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>mv<span class="w"> </span>/path/to/rightfile<span class="w"> </span>!-2:$
mv<span class="w"> </span>/path/to/rightfile<span class="w"> </span>/some/other/place
</code></pre></div>

<p>同样，一旦你学会了它，你可能会惊讶于你需要使用它的频率。</p>
<h3>5、进入文件夹：<code>!$:h</code></h3>
<p>从表面上看，这个看起来不太有用，但我每天要用它几十次。</p>
<p>想象一下，我运行的命令如下所示：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>tar<span class="w"> </span>-cvf<span class="w"> </span>system.tar<span class="w"> </span>/etc/system
<span class="w"> </span>tar:<span class="w"> </span>/etc/system:<span class="w"> </span>Cannot<span class="w"> </span>stat:<span class="w"> </span>No<span class="w"> </span>such<span class="w"> </span>file<span class="w"> </span>or<span class="w"> </span>directory
<span class="w"> </span>tar:<span class="w"> </span>Error<span class="w"> </span><span class="nb">exit</span><span class="w"> </span>delayed<span class="w"> </span>from<span class="w"> </span>previous<span class="w"> </span>errors.
</code></pre></div>

<p>我可能要做的第一件事是转到 <code>/etc</code> 文件夹，查看其中的内容并找出我做错了什么。</p>
<p>我可以通过以下方法来做到这一点：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>!$:h
<span class="nb">cd</span><span class="w"> </span>/etc
</code></pre></div>

<p>这是说：“获取上一个命令的最后一个参数（<code>/etc/system</code>），并删除其最后的文件名部分，仅保留 <code>/ etc</code>。”</p>
<h3>6、当前行：<code>!#:1</code></h3>
<p>多年以来，在我最终找到并学会之前，我有时候想知道是否可以在当前行引用一个参数。我多希望我能早早学会这个快捷方式。我经常常使用它制作备份文件：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>cp<span class="w"> </span>/path/to/some/file<span class="w"> </span>!#:1.bak
cp<span class="w"> </span>/path/to/some/file<span class="w"> </span>/path/to/some/file.bak
</code></pre></div>

<p>但当我学会之后，它很快就被下面的快捷方式替代了……</p>
<h3>7、搜索并替换：<code>!!:gs</code></h3>
<p>这将搜索所引用的命令，并将前两个 <code>/</code> 之间的字符替换为后两个 <code>/</code> 之间的字符。</p>
<p>假设我想告诉别人我的 <code>s</code> 键不起作用，而是输出了 <code>f</code>：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span><span class="nb">echo</span><span class="w"> </span>my<span class="w"> </span>f<span class="w"> </span>key<span class="w"> </span>doef<span class="w"> </span>not<span class="w"> </span>work
my<span class="w"> </span>f<span class="w"> </span>key<span class="w"> </span>doef<span class="w"> </span>not<span class="w"> </span>work
</code></pre></div>

<p>然后我意识到这里出现的 <code>f</code> 键都是错的。要将所有 <code>f</code> 替换为 <code>s</code>，我可以输入：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>!!:gs/f<span class="w"> </span>/s<span class="w"> </span>/
<span class="nb">echo</span><span class="w"> </span>my<span class="w"> </span>s<span class="w"> </span>key<span class="w"> </span>does<span class="w"> </span>not<span class="w"> </span>work
my<span class="w"> </span>s<span class="w"> </span>key<span class="w"> </span>does<span class="w"> </span>not<span class="w"> </span>work
</code></pre></div>

<p>它不只对单个字符起作用。我也可以替换单词或句子：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>!!:gs/does/did/
<span class="nb">echo</span><span class="w"> </span>my<span class="w"> </span>s<span class="w"> </span>key<span class="w"> </span>did<span class="w"> </span>not<span class="w"> </span>work
my<span class="w"> </span>s<span class="w"> </span>key<span class="w"> </span>did<span class="w"> </span>not<span class="w"> </span>work
</code></pre></div>

<h3>测试一下</h3>
<p>为了向你展示如何组合这些快捷方式，你知道这些命令片段将输出什么吗？</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>ping<span class="w"> </span>!#:0:gs/i/o
$<span class="w"> </span>vi<span class="w"> </span>/tmp/!:0.txt
$<span class="w"> </span>ls<span class="w"> </span>!$:h
$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>!-2:$:h
$<span class="w"> </span>touch<span class="w"> </span>!<span class="nv">$!</span>-3:$<span class="w"> </span>!!<span class="w"> </span>!$.txt
$<span class="w"> </span>cat<span class="w"> </span>!:1-$
</code></pre></div>

<h3>总结</h3>
<p>对于日常的命令行用户，Bash 可以作为快捷方式的优雅来源。虽然有成千上万的技巧要学习，但这些是我经常使用的最喜欢的技巧。</p>
<p>如果你想更深入地了解 Bash 可以教给你的全部知识，请买本我的书，《<a href="https://leanpub.com/learnbashthehardway">Bash 学习，艰难之旅</a>》，或查看我的在线课程《<a href="https://www.educative.io/courses/master-the-bash-shell">精通 Bash shell</a>》。</p>
<p>via: <a href="https://opensource.com/article/19/10/bash-history-shortcuts">https://opensource.com/article/19/10/bash-history-shortcuts</a></p>
<p>作者：<a href="https://opensource.com/users/ianmiell">Ian Miell</a> 选题：<a href="https://github.com/lujun9972">lujun9972</a> 译者：<a href="https://github.com/wxy">wxy</a> 校对：<a href="https://github.com/wxy">wxy</a></p>
<p>本文由 <a href="https://github.com/LCTT/TranslateProject">LCTT</a> 原创编译，<a href="https://linux.cn/">Linux中国</a> 荣誉推出</p>
    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>links</h2>
                        <ul>
                            <li><a href="https://getpelican.com/">Pelican</a></li>
                            <li><a href="https://www.python.org/">Python.org</a></li>
                            <li><a href="https://palletsprojects.com/p/jinja/">Jinja2</a></li>
                            <li><a href="#">You can modify those links in your config file</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>

                            <li><a href="#">You can add links in your config file</a></li>
                            <li><a href="#">Another social link</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a rel="nofollow" href="https://getpelican.com/">Pelican</a>, which takes great advantage of <a rel="nofollow" href="https://www.python.org/">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a rel="nofollow" href="https://www.smashingmagazine.com/2009/08/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>