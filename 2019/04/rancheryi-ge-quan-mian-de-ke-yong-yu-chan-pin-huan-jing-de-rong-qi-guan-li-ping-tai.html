<!DOCTYPE html>
<html lang="zh">
<head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="generator" content="Pelican" />
        <title>Rancher：一个全面的可用于产品环境的容器管理平台</title>
        <link rel="stylesheet" href="/theme/css/main.css" />
        <meta name="description" content="Author: Magesh Maruthamuthu Docker 作为一款容器化应用的新兴软件，被大多数 IT 公司使用来减少基础设施平台的成本。 通常，没有 GUI 的 Docker 软件对于 …" />
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">linux_cn</a></h1>
                <nav><ul>
                    <li><a href="/category/chuan-shan-jia-zhuan-fang">穿山甲专访</a></li>
                    <li><a href="/category/dai-ma-ying-xiong">代码英雄</a></li>
                    <li><a href="/category/fen-xiang">分享</a></li>
                    <li><a href="/category/guan-dian">观点</a></li>
                    <li><a href="/category/huo-dong">活动</a></li>
                    <li><a href="/category/ji-ke-man-hua">极客漫画</a></li>
                    <li><a href="/category/ji-zhu">技术</a></li>
                    <li><a href="/category/kai-yuan-zhi-hui">开源智慧</a></li>
                    <li><a href="/category/linux-fa-xing-ban">Linux 发行版</a></li>
                    <li><a href="/category/mei-ri-an-quan-zi-xun">每日安全资讯</a></li>
                    <li><a href="/category/misc">Misc</a></li>
                    <li><a href="/category/qu-kuai-lian">区块链</a></li>
                    <li><a href="/category/rong-qi-yu-yun">容器与云</a></li>
                    <li><a href="/category/ruan-jian-kai-fa">软件开发</a></li>
                    <li><a href="/category/shu-mei-pai">树莓派</a></li>
                    <li class="active"><a href="/category/xi-tong-yun-wei">系统运维</a></li>
                    <li><a href="/category/xin-wen">新闻</a></li>
                    <li><a href="/category/ying-he-guan-cha">硬核观察</a></li>
                    <li><a href="/category/zhi-ye-sheng-ya">职业生涯</a></li>
                    <li><a href="/category/zhong-jiang-ming-dan">中奖名单</a></li>
                    <li><a href="/category/zhuo-mian-ying-yong">桌面应用</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="/2019/04/rancheryi-ge-quan-mian-de-ke-yong-yu-chan-pin-huan-jing-de-rong-qi-guan-li-ping-tai.html" rel="bookmark"
           title="Permalink to Rancher：一个全面的可用于产品环境的容器管理平台">Rancher：一个全面的可用于产品环境的容器管理平台</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2019-04-05T11:04:00+02:00">
                Published: Fri 05 April 2019
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/linux-fans-from-china.html">linux fans from china</a>
        </address>
<p>In <a href="/category/xi-tong-yun-wei">系统运维</a>.</p>

</footer><!-- /.post-info -->      <p>Author: Magesh Maruthamuthu</p>
<p><img alt="" src="/data/attachment/album/201904/05/110329em54gafhqmii4ohl.jpg"></p>
<p>Docker 作为一款容器化应用的新兴软件，被大多数 IT 公司使用来减少基础设施平台的成本。</p>
<p>通常，没有 GUI 的 Docker 软件对于 Linux 管理员来说很容易，但是对于开发者来就有点困难。当把它搬到生产环境上来，那么它对 Linux 管理员来说也相当不友好。那么，轻松管理 Docker 的最佳解决方案是什么呢？</p>
<p>唯一的办法就是提供 GUI。Docker API 允许第三方应用接入 Docker。在市场上有许多 Docker GUI 应用。我们已经写过一篇关于 Portainer 应用的文章。今天我们来讨论另一个应用，Rancher。</p>
<p>容器让软件开发更容易，让开发者更快的写代码、更好的运行它们。但是，在生产环境上运行容器却很困难。</p>
<p><strong>推荐阅读：</strong> <a href="https://www.2daygeek.com/portainer-a-simple-docker-management-gui/">Portainer：一个简单的 Docker 管理图形工具</a></p>
<h3>Rancher 简介</h3>
<p><a href="http://rancher.com/">Rancher</a> 是一个全面的容器管理平台，它可以让容器在各种基础设施平台的生产环境上部署和运行更容易。它提供了诸如多主机网络、全局/本地负载均衡和卷快照等基础设施服务。它整合了原生 Docker 的管理能力，如 Docker Machine 和 Docker Swarm。它提供了丰富的用户体验，让 DevOps 管理员在更大规模的生产环境上运行 Docker。</p>
<p>访问以下文章可以了解 Linux 系统上安装 Docker。</p>
<p><strong>推荐阅读：</strong></p>
<ul>
<li><a href="https://www.2daygeek.com/install-docker-on-centos-rhel-fedora-ubuntu-debian-oracle-archi-scentific-linux-mint-opensuse/">如何在 Linux 上安装 Docker</a></li>
<li><a href="https://www.2daygeek.com/list-search-pull-download-remove-docker-images-on-linux/">如何在 Linux 上使用 Docker 镜像</a></li>
<li><a href="https://www.2daygeek.com/create-run-list-start-stop-attach-delete-interactive-daemonized-docker-containers-on-linux/">如何在 Linux 上使用 Docker 容器</a></li>
<li><a href="https://www.2daygeek.com/install-run-applications-inside-docker-containers/">如何在 Docker 容器内安装和运行应用</a></li>
</ul>
<h3>Rancher 特性</h3>
<ul>
<li>可以在两分钟内安装 Kubernetes。</li>
<li>一键启动应用（90 个流行的 Docker 应用）。</li>
<li>部署和管理 Docker 更容易。</li>
<li>全面的生产级容器管理平台。</li>
<li>可以在生产环境上快速部署容器。</li>
<li>强大的自动部署和运营容器技术。</li>
<li>模块化基础设施服务。</li>
<li>丰富的编排工具。</li>
<li>Rancher 支持多种认证机制。</li>
</ul>
<h3>怎样安装 Rancher</h3>
<p>由于 Rancher 是以轻量级的 Docker 容器方式运行，所以它的安装非常简单。Rancher 是由一组 Docker 容器部署的。只需要简单的启动两个容器就能运行 Rancher。一个容器用作管理服务器，另一个容器在各个节点上作为代理。在 Linux 系统下简单的运行下列命令就能部署 Rancher。</p>
<p>Rancher 服务器提供了两个不同的安装包标签如 <code>stable</code> 和 <code>latest</code>。下列命令将会拉取适合的 Rancher 镜像并安装到你的操作系统上。Rancher 服务器仅需要两分钟就可以启动。</p>
<ul>
<li><code>latest</code>：这个标签是他们的最新开发构建。这些构建将通过 Rancher CI 的自动化框架进行验证，不建议在生产环境使用。</li>
<li><code>stable</code>：这是最新的稳定发行版本，推荐在生产环境使用。</li>
</ul>
<p>Rancher 的安装方法有多种。在这篇教程中我们仅讨论两种方法。</p>
<ul>
<li>以单一容器的方式安装 Rancher（内嵌 Rancher 数据库）</li>
<li>以单一容器的方式安装 Rancher（外部数据库）</li>
</ul>
<h3>方法 - 1</h3>
<p>运行下列命令以单一容器的方式安装 Rancher 服务器（内嵌数据库）</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>sudo<span class="w"> </span>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>--restart<span class="o">=</span>unless-stopped<span class="w"> </span>-p<span class="w"> </span><span class="m">8080</span>:8080<span class="w"> </span>rancher/server:stable
$<span class="w"> </span>sudo<span class="w"> </span>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>--restart<span class="o">=</span>unless-stopped<span class="w"> </span>-p<span class="w"> </span><span class="m">8080</span>:8080<span class="w"> </span>rancher/server:latest
</code></pre></div>

<h3>方法 - 2</h3>
<p>你可以在启动 Rancher 服务器时指向外部数据库，而不是使用自带的内部数据库。首先创建所需的数据库，数据库用户为同一个。</p>
<div class="highlight"><pre><span></span><code><span class="k">&gt; </span><span class="ge">CREATE DATABASE IF NOT EXISTS cattle COLLATE = &#39;utf8_general_ci&#39; CHARACTER SET = &#39;utf8&#39;;</span>
<span class="k">&gt; </span><span class="ge">GRANT ALL ON cattle.* TO &#39;cattle&#39;@&#39;%&#39; IDENTIFIED BY &#39;cattle&#39;;</span>
<span class="k">&gt; </span><span class="ge">GRANT ALL ON cattle.* TO &#39;cattle&#39;@&#39;localhost&#39; IDENTIFIED BY &#39;cattle&#39;;</span>
</code></pre></div>

<p>运行下列命令启动 Rancher 去连接外部数据库。</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>sudo<span class="w"> </span>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>--restart<span class="o">=</span>unless-stopped<span class="w"> </span>-p<span class="w"> </span><span class="m">8080</span>:8080<span class="w"> </span>rancher/server<span class="w"> </span><span class="se">\</span>
<span class="w"> </span>--db-host<span class="w"> </span>myhost.example.com<span class="w"> </span>--db-port<span class="w"> </span><span class="m">3306</span><span class="w"> </span>--db-user<span class="w"> </span>username<span class="w"> </span>--db-pass<span class="w"> </span>password<span class="w"> </span>--db-name<span class="w"> </span>cattle
</code></pre></div>

<p>如果你想测试 Rancher 2.0，使用下列的命令去启动。</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>sudo<span class="w"> </span>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>--restart<span class="o">=</span>unless-stopped<span class="w"> </span>-p<span class="w"> </span><span class="m">80</span>:80<span class="w"> </span>-p<span class="w"> </span><span class="m">443</span>:443<span class="w"> </span>rancher/server:preview
</code></pre></div>

<h3>通过 GUI 访问 &amp; 安装 Rancher</h3>
<p>浏览器输入 <code>http://hostname:8080</code> 或 <code>http://server_ip:8080</code> 去访问 rancher GUI.</p>
<p><img alt="" src="/data/attachment/album/201904/05/110403xupu3u32c6plulcz.png"></p>
<h3>怎样注册主机</h3>
<p>注册你的主机 URL 允许它连接到 Rancher API。这是一次性设置。</p>
<p>接下来，点击主菜单下面的 “Add a Host” 链接或者点击主菜单上的 “INFRASTRUCTURE &gt;&gt; Add Hosts”，点击 “Save” 按钮。</p>
<p><img alt="" src="/data/attachment/album/201904/05/110404puzjky12flrfyr2l.png"></p>
<p>默认情况下，Rancher 里的访问控制认证禁止了访问，因此我们首先需要通过一些方法打开访问控制认证，否则任何人都不能访问 GUI。</p>
<p>点击 “&gt;&gt; Admin &gt;&gt; Access Control”，输入下列的值最后点击 “Enable Authentication” 按钮去打开它。在我这里，是通过 “local authentication” 的方式打开的。</p>
<ul>
<li>“Login UserName”： 输入你期望的登录名</li>
<li>“Full Name”： 输入你的全名</li>
<li>“Password”： 输入你期望的密码</li>
<li>“Confirm Password”： 再一次确认密码</li>
</ul>
<p><img alt="" src="/data/attachment/album/201904/05/110405nf0dxov2xxyudzfj.png"></p>
<p>注销然后使用新的登录凭证重新登录：</p>
<p><img alt="" src="/data/attachment/album/201904/05/110406pxvrqq6622zkl2dz.png"></p>
<p>现在，我能看到本地认证已经被打开。</p>
<p><img alt="" src="/data/attachment/album/201904/05/110407leme9jijmu5dmwdt.png"></p>
<h3>怎样添加主机</h3>
<p>注册你的主机后，它将带你进入下一个页面，在那里你能选择不同云服务提供商的 Linux 主机。我们将添加一个主机运行 Rancher 服务，因此选择“custom”选项然后输入必要的信息。</p>
<p>在第 4 步输入你服务器的公有 IP，运行第 5 步列出的命令，最后点击 “close” 按钮。</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>sudo<span class="w"> </span>docker<span class="w"> </span>run<span class="w"> </span>-e<span class="w"> </span><span class="nv">CATTLE_AGENT_IP</span><span class="o">=</span><span class="s2">&quot;192.168.56.2&quot;</span><span class="w">  </span>--rm<span class="w"> </span>--privileged<span class="w"> </span>-v<span class="w"> </span>/var/run/docker.sock:/var/run/docker.sock<span class="w"> </span>-v<span class="w"> </span>/var/lib/rancher:/var/lib/rancher<span class="w"> </span>rancher/agent:v1.2.11<span class="w"> </span>http://192.168.56.2:8080/v1/scripts/16A52B9BE2BAB87BB0F5:1546214400000:ODACe3sfis5V6U8E3JASL8jQ

INFO:<span class="w"> </span>Running<span class="w"> </span>Agent<span class="w"> </span>Registration<span class="w"> </span>Process,<span class="w"> </span><span class="nv">CATTLE_URL</span><span class="o">=</span>http://192.168.56.2:8080/v1
INFO:<span class="w"> </span>Attempting<span class="w"> </span>to<span class="w"> </span>connect<span class="w"> </span>to:<span class="w"> </span>http://192.168.56.2:8080/v1
INFO:<span class="w"> </span>http://192.168.56.2:8080/v1<span class="w"> </span>is<span class="w"> </span>accessible
INFO:<span class="w"> </span>Configured<span class="w"> </span>Host<span class="w"> </span>Registration<span class="w"> </span>URL<span class="w"> </span>info:<span class="w"> </span><span class="nv">CATTLE_URL</span><span class="o">=</span>http://192.168.56.2:8080/v1<span class="w"> </span><span class="nv">ENV_URL</span><span class="o">=</span>http://192.168.56.2:8080/v1
INFO:<span class="w"> </span>Inspecting<span class="w"> </span>host<span class="w"> </span>capabilities
INFO:<span class="w"> </span>Boot2Docker:<span class="w"> </span><span class="nb">false</span>
INFO:<span class="w"> </span>Host<span class="w"> </span>writable:<span class="w"> </span><span class="nb">true</span>
INFO:<span class="w"> </span>Token:<span class="w"> </span>xxxxxxxx
INFO:<span class="w"> </span>Running<span class="w"> </span>registration
INFO:<span class="w"> </span>Printing<span class="w"> </span>Environment
INFO:<span class="w"> </span>ENV:<span class="w"> </span><span class="nv">CATTLE_ACCESS_KEY</span><span class="o">=</span>9946BD1DCBCFEF3439F8
INFO:<span class="w"> </span>ENV:<span class="w"> </span><span class="nv">CATTLE_AGENT_IP</span><span class="o">=</span><span class="m">192</span>.168.56.2
INFO:<span class="w"> </span>ENV:<span class="w"> </span><span class="nv">CATTLE_HOME</span><span class="o">=</span>/var/lib/cattle
INFO:<span class="w"> </span>ENV:<span class="w"> </span><span class="nv">CATTLE_REGISTRATION_ACCESS_KEY</span><span class="o">=</span>registrationToken
INFO:<span class="w"> </span>ENV:<span class="w"> </span><span class="nv">CATTLE_REGISTRATION_SECRET_KEY</span><span class="o">=</span>xxxxxxx
INFO:<span class="w"> </span>ENV:<span class="w"> </span><span class="nv">CATTLE_SECRET_KEY</span><span class="o">=</span>xxxxxxx
INFO:<span class="w"> </span>ENV:<span class="w"> </span><span class="nv">CATTLE_URL</span><span class="o">=</span>http://192.168.56.2:8080/v1
INFO:<span class="w"> </span>ENV:<span class="w"> </span><span class="nv">DETECTED_CATTLE_AGENT_IP</span><span class="o">=</span><span class="m">172</span>.17.0.1
INFO:<span class="w"> </span>ENV:<span class="w"> </span><span class="nv">RANCHER_AGENT_IMAGE</span><span class="o">=</span>rancher/agent:v1.2.11
INFO:<span class="w"> </span>Launched<span class="w"> </span>Rancher<span class="w"> </span>Agent:<span class="w"> </span>e83b22afd0c023dabc62404f3e74abb1fa99b9a178b05b1728186c9bfca71e8d
</code></pre></div>

<p><img alt="" src="/data/attachment/album/201904/05/110408kfcc8okpfolqqolk.png"></p>
<p>等待几秒钟后新添加的主机将会出现。点击 “Infrastructure &gt;&gt; Hosts” 页面。</p>
<p><img alt="" src="/data/attachment/album/201904/05/110410e7phgzprkgvgvhvx.png"></p>
<h3>怎样查看容器</h3>
<p>只需要点击下列位置就能列出所有容器。点击 “Infrastructure &gt;&gt; Containers” 页面。</p>
<p><img alt="" src="/data/attachment/album/201904/05/110411zdsennvb1zf77dnr.png"></p>
<h3>怎样创建容器</h3>
<p>非常简单，只需点击下列位置就能创建容器。</p>
<p>点击 “Infrastructure &gt;&gt; Containers &gt;&gt; Add Container” 然后输入每个你需要的信息。为了测试，我将创建一个 <code>latest</code> 标签的 CentOS 容器。</p>
<p><img alt="" src="/data/attachment/album/201904/05/110412tym0g9a1w9yo9g9e.png"></p>
<p>在同样的列表位置，点击 “ Infrastructure &gt;&gt; Containers”。</p>
<p><img alt="" src="/data/attachment/album/201904/05/110414wce99k3cbg03oume.png"></p>
<p>点击容器名展示容器的性能信息，如 CPU、内存、网络和存储。</p>
<p><img alt="" src="/data/attachment/album/201904/05/110414ul42osz2l0covqoo.png"></p>
<p>选择特定容器，然后点击最右边的“三点”按钮或者点击“Actions”按钮对容器进行管理，如停止、启动、克隆、重启等。</p>
<p><img alt="" src="/data/attachment/album/201904/05/110416y6u7j0jzjf57gjzj.png"></p>
<p>如果你想控制台访问容器，只需要点击 “Actions” 按钮中的 “Execute Shell” 选项即可。</p>
<p><img alt="" src="/data/attachment/album/201904/05/110417iulgq2l28oq24hlh.png"></p>
<h3>怎样从应用目录部署容器</h3>
<p>Rancher 提供了一个应用模版目录，让部署变的很容易，只需要单击一下就可以。 它维护了多数流行应用，这些应用由 Rancher 社区贡献。</p>
<p><img alt="" src="/data/attachment/album/201904/05/110419x0wmwv8q338d9rx3.png"></p>
<p>点击 “Catalog &gt;&gt; All &gt;&gt; Choose the required application”，最后点击 “Launch” 去部署。</p>
<p><img alt="" src="/data/attachment/album/201904/05/110420d8xlpyp9489l4lul.png"></p>
    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>links</h2>
                        <ul>
                            <li><a href="https://getpelican.com/">Pelican</a></li>
                            <li><a href="https://www.python.org/">Python.org</a></li>
                            <li><a href="https://palletsprojects.com/p/jinja/">Jinja2</a></li>
                            <li><a href="#">You can modify those links in your config file</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>

                            <li><a href="#">You can add links in your config file</a></li>
                            <li><a href="#">Another social link</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a rel="nofollow" href="https://getpelican.com/">Pelican</a>, which takes great advantage of <a rel="nofollow" href="https://www.python.org/">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a rel="nofollow" href="https://www.smashingmagazine.com/2009/08/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>